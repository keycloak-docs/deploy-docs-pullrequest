<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Red Hat Single Sign-On for OpenShift on Eclipse OpenJ9</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.4"/><meta name="description" content="This guide consists of basic information and instructions to get started with Red Hat Single Sign-On 7.5 for OpenShift on OpenJ9"/><link rel="next" href="#making-open-source-more-inclusive" title="Making open source more inclusive"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm140078750172384"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat Single Sign-On</span> <span class="productnumber">7.5</span></div><div><h1 class="title">Red Hat Single Sign-On for OpenShift on Eclipse OpenJ9</h1></div><div><h2 class="subtitle">For use with Red Hat Single Sign-On 7.5</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm140078750986432">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This guide consists of basic information and instructions to get started with Red Hat Single Sign-On 7.5 for OpenShift on OpenJ9
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="preface"><a href="#making-open-source-more-inclusive">Making open source more inclusive</a></span></li><li><span class="chapter"><a href="#introduction">1. Introduction</a></span><ul><li><span class="section"><a href="#what_is_red_hat_single_sign_on">1.1. What Is Red Hat Single Sign-On?</a></span></li></ul></li><li><span class="chapter"><a href="#before_you_begin">2. Before You Begin</a></span><ul><li><span class="section"><a href="#comparison_red_hat_single_sign_on_for_openshift_image_and_red_hat_single_sign_on">2.1. Comparison: Red Hat Single Sign-On for OpenShift Image and Red Hat Single Sign-On</a></span></li><li><span class="section"><a href="#version_compatibility_and_support">2.2. Version Compatibility and Support</a></span></li><li><span class="section"><a href="#deprecated_image_streams_and_application_templates_for_red_hat_single_sign_on_for_openshift">2.3. Deprecated Image Streams and Application Templates for Red Hat Single Sign-On for OpenShift</a></span></li><li><span class="section"><a href="#initial_setup">2.4. Initial Setup</a></span></li></ul></li><li><span class="chapter"><a href="#get_started">3. Get Started</a></span><ul><li><span class="section"><a href="#image-streams-applications-templates">3.1. Using the Red Hat Single Sign-On for OpenShift Image Streams and Application Templates</a></span></li><li><span class="section"><a href="#Example-Deploying-SSO">3.2. Deploying the Red Hat Single Sign-On Image</a></span><ul><li><span class="section"><a href="#Preparing-SSO-Authentication-for-OpenShift-Deployment">3.2.1. Preparing the Deployment</a></span></li><li><span class="section"><a href="#deploying_the_red_hat_single_sign_on_image_using_the_application_template">3.2.2. Deploying the Red Hat Single Sign-On Image using the Application Template</a></span></li><li><span class="section"><a href="#accessing_the_administrator_console_of_the_red_hat_single_sign_on_pod">3.2.3. Accessing the Administrator Console of the Red Hat Single Sign-On Pod</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#advanced_concepts">4. Advanced Concepts</a></span><ul><li><span class="section"><a href="#requirements_and_deploying_link_xl_href_introduction_introduction_xml_passthrough_templates_passthrough_tls_termination_link_red_hat_single_sign_on_templates">4.1. Requirements and Deploying Passthrough TLS Termination Red Hat Single Sign-On Templates</a></span><ul><li><span class="section"><a href="#preparing_the_deployment">4.1.1. Preparing the Deployment</a></span></li><li><span class="section"><a href="#Configuring-Keystores">4.1.2. Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server</a></span></li><li><span class="section"><a href="#Configuring-Secrets">4.1.3. Secrets</a></span></li><li><span class="section"><a href="#deploying_the_chosen_red_hat_single_sign_on_passthrough_tls_template_via_openshift_cli">4.1.4. Deploying the Chosen Red Hat Single Sign-On Passthrough TLS Template via OpenShift CLI</a></span></li></ul></li><li><span class="section"><a href="#advanced-concepts-sso-hostname-spi-setup">4.2. Customizing the Hostname for the Red Hat Single Sign-On Server</a></span></li><li><span class="section"><a href="#sso-connecting-to-an-external-database">4.3. Connecting to an external database</a></span></li><li><span class="section"><a href="#sso-using-custom-jdbc-driver">4.4. Using Custom JDBC Driver</a></span></li><li><span class="section"><a href="#sso-administrator-setup">4.5. Creating the Administrator Account for Red Hat Single Sign-On Server</a></span><ul><li><span class="section"><a href="#sso-admin-template-parameters">4.5.1. Creating the Administrator Account Using Template Parameters</a></span></li><li><span class="section"><a href="#sso-admin-remote-shell">4.5.2. Creating the Administrator Account via Remote Shell Session to Red Hat Single Sign-On Pod</a></span></li></ul></li><li><span class="section"><a href="#customizing_the_default_behavior_of_the_red_hat_single_sign_on_image">4.6. Customizing the default behavior of the Red Hat Single Sign-On image</a></span></li><li><span class="section"><a href="#deployment_process">4.7. Deployment Process</a></span></li><li><span class="section"><a href="#SSO-Clients">4.8. Red Hat Single Sign-On Clients</a></span><ul><li><span class="section"><a href="#Auto-Man-Client-Reg">4.8.1. Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a></span></li></ul></li><li><span class="section"><a href="#using_red_hat_single_sign_on_vault_with_openshift_secrets">4.9. Using Red Hat Single Sign-On vault with OpenShift secrets</a></span></li><li><span class="section"><a href="#limitations">4.10. Limitations</a></span></li></ul></li><li><span class="chapter"><a href="#tutorials">5. Tutorials</a></span><ul><li><span class="section"><a href="#upgrading-sso-db-from-previous-version">5.1. Example Workflow: Updating Existing Database to Migrate to New Red Hat Single Sign-On for OpenShift Image Version</a></span><ul><li><span class="section"><a href="#automatic-db-migration">5.1.1. Automatic Database Migration</a></span></li><li><span class="section"><a href="#manual-db-migration">5.1.2. Manual Database Migration</a></span></li></ul></li><li><span class="section"><a href="#example_workflow_migrating_the_red_hat_single_sign_on_server_s_database_across_environments">5.2. Example Workflow: Migrating The Red Hat Single Sign-On Server’s Database Across Environments</a></span><ul><li><span class="section"><a href="#deploying_the_red_hat_single_sign_on_postgresql_application_template">5.2.1. Deploying the Red Hat Single Sign-On PostgreSQL Application Template</a></span></li><li><span class="section"><a href="#optional_creating_additional_red_hat_single_sign_on_link_xl_href_https_access_redhat_com_documentation_en_us_red_hat_single_sign_on_7_2_html_single_server_administration_guide_core_concepts_and_terms_realm_and_users_link_to_be_also_exported">5.2.2. (Optional) Creating additional Red Hat Single Sign-On realm and users to be also exported</a></span></li><li><span class="section"><a href="#sso-export-the-database">5.2.3. Export the Red Hat Single Sign-On database as a JSON file on the OpenShift pod</a></span></li><li><span class="section"><a href="#retrieve_and_import_the_exported_json_file">5.2.4. Retrieve and import the exported JSON file</a></span></li></ul></li><li><span class="section"><a href="#OSE-SSO-AUTH-TUTE">5.3. Example Workflow: Configuring OpenShift 3.11 to use Red Hat Single Sign-On for Authentication</a></span><ul><li><span class="section"><a href="#configuring_red_hat_single_sign_on_credentials">5.3.1. Configuring Red Hat Single Sign-On Credentials</a></span></li><li><span class="section"><a href="#configuring_openshift_master_for_red_hat_single_sign_on_authentication">5.3.2. Configuring OpenShift Master for Red Hat Single Sign-On Authentication</a></span></li><li><span class="section"><a href="#logging_in_to_openshift">5.3.3. Logging in to OpenShift</a></span></li></ul></li><li><span class="section"><a href="#binary-builds">5.4. Example Workflow: Creating OpenShift Application from Existing Maven Binaries and Securing it Using Red Hat Single Sign-On</a></span><ul><li><span class="section"><a href="#deploy_binary_build_of_eap_6_4_7_1_jsp_service_invocation_application_and_secure_it_using_red_hat_single_sign_on">5.4.1. Deploy Binary Build of EAP 6.4 / 7.1 JSP Service Invocation Application and Secure it Using Red Hat Single Sign-On</a></span></li></ul></li><li><span class="section"><a href="#Example-EAP-Auto">5.5. Example Workflow: Automatically Registering EAP Application in Red Hat Single Sign-On with OpenID-Connect Client</a></span><ul><li><span class="section"><a href="#preparing_red_hat_single_sign_on_authentication_for_openshift_deployment">5.5.1. Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</a></span></li><li><span class="section"><a href="#preparing_the_red_hat_single_sign_on_credentials">5.5.2. Preparing the Red Hat Single Sign-On Credentials</a></span></li><li><span class="section"><a href="#deploy_the_red_hat_single_sign_on_enabled_jboss_eap_image">5.5.3. Deploy the Red Hat Single Sign-On-enabled JBoss EAP Image</a></span></li><li><span class="section"><a href="#log_in_to_the_jboss_eap_server_using_red_hat_single_sign_on">5.5.4. Log in to the JBoss EAP Server Using Red Hat Single Sign-On</a></span></li></ul></li><li><span class="section"><a href="#Example-EAP-Manual">5.6. Example Workflow: Manually Registering EAP Application in Red Hat Single Sign-On with SAML Client</a></span><ul><li><span class="section"><a href="#preparing_the_red_hat_single_sign_on_credentials_2">5.6.1. Preparing the Red Hat Single Sign-On Credentials</a></span></li><li><span class="section"><a href="#preparing_red_hat_single_sign_on_authentication_for_openshift_deployment_2">5.6.2. Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</a></span></li><li><span class="section"><a href="#modified-saml-xml">5.6.3. Modifying the <span class="strong strong"><strong>secure-saml-deployments</strong></span> File</a></span></li><li><span class="section"><a href="#configuring_saml_client_registration_in_the_application_emphasis_role_strong_web_xml_emphasis">5.6.4. Configuring SAML Client Registration in the Application <span class="strong strong"><strong>web.xml</strong></span></a></span></li><li><span class="section"><a href="#deploying_the_application">5.6.5. Deploying the Application</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#reference">6. Reference</a></span><ul><li><span class="section"><a href="#sso-artifact-repository-mirrors-section">6.1. Artifact Repository Mirrors</a></span></li><li><span class="section"><a href="#env_vars">6.2. Environment Variables</a></span><ul><li><span class="section"><a href="#information_environment_variables">6.2.1. Information Environment Variables</a></span></li><li><span class="section"><a href="#configuration_environment_variables">6.2.2. Configuration Environment Variables</a></span></li><li><span class="section"><a href="#template_variables_for_all_red_hat_single_sign_on_images">6.2.3. Template variables for all Red Hat Single Sign-On images</a></span></li><li><span class="section"><a href="#template_variables_specific_to_emphasis_role_strong_emphasis_sso75_openj9_postgresql_emphasis_emphasis_emphasis_role_strong_emphasis_sso75_openj9_postgresql_persistent_emphasis_emphasis_and_emphasis_role_strong_emphasis_sso75_openj9_x509_postgresql_persistent_emphasis_emphasis">6.2.4. Template variables specific to <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span></a></span></li><li><span class="section"><a href="#template_variables_for_general_emphasis_role_strong_eap64_emphasis_and_emphasis_role_strong_eap71_emphasis_s2i_images">6.2.5. Template variables for general <span class="strong strong"><strong>eap64</strong></span> and <span class="strong strong"><strong>eap71</strong></span> S2I images</a></span></li><li><span class="section"><a href="#template_variables_specific_to_emphasis_role_strong_emphasis_eap64_sso_s2i_emphasis_emphasis_and_emphasis_role_strong_emphasis_eap71_sso_s2i_emphasis_emphasis_for_automatic_client_registration">6.2.6. Template variables specific to <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span> for automatic client registration</a></span></li><li><span class="section"><a href="#template_variables_specific_to_emphasis_role_strong_emphasis_eap64_sso_s2i_emphasis_emphasis_and_emphasis_role_strong_emphasis_eap71_sso_s2i_emphasis_emphasis_for_automatic_client_registration_with_saml_clients">6.2.7. Template variables specific to <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span> for automatic client registration with SAML clients</a></span></li></ul></li><li><span class="section"><a href="#exposed_ports">6.3. Exposed Ports</a></span></li></ul></li></ul></div><section class="preface" id="making-open-source-more-inclusive"><div class="titlepage"><div><div><h1 class="title">Making open source more inclusive</h1></div></div></div><p>
			Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see <a class="link" href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright’s message</a>.
		</p></section><section class="chapter" id="introduction"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Introduction</h1></div></div></div><section class="section" id="what_is_red_hat_single_sign_on"><div class="titlepage"><div><div><h2 class="title">1.1. What Is Red Hat Single Sign-On?</h2></div></div></div><p>
				Red Hat Single Sign-On is an integrated sign-on solution available as a Red Hat JBoss Middleware for OpenShift containerized image. The Red Hat Single Sign-On for OpenShift image provides an authentication server for users to centrally log in, log out, register, and manage user accounts for web applications, mobile applications, and RESTful web services.
			</p><p>
				Red Hat Single Sign-On for OpenShift on Eclipse OpenJ9 is only available on the following platforms: <span class="strong strong"><strong>IBM Z/IBM Power Systems</strong></span>. For other available platforms, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/red_hat_single_sign-on_for_openshift/">Red Hat Single Sign-On for OpenShift on OpenJDK</a>.
			</p><p id="sso-templates">
				Red Hat offers multiple OpenShift application templates utilizing the Red Hat Single Sign-On for OpenShift image version number 7.5.0. These define the resources needed to develop Red Hat Single Sign-On 7.5.0 server based deployment and can be split into the following two categories:
			</p><div class="itemizedlist" id="passthrough-templates"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Templates using HTTPS and JGroups keystores and a truststore for the Red Hat Single Sign-On server, all prepared beforehand. These secure the TLS communication using <a class="link" href="https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html#passthrough-termination">passthrough TLS termination</a>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-https</em></span></strong></span>: Red Hat Single Sign-On 7.5.0 backed by internal H2 database on the same pod.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span>: Red Hat Single Sign-On 7.5.0 backed by ephemeral PostgreSQL database on a separate pod.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>: Red Hat Single Sign-On 7.5.0 backed by persistent PostgreSQL database on a separate pod.
							</li></ul></div></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Templates for using Red Hat Single Sign-On with MySQL / MariaDB databases have been removed and are not available since Red Hat Single Sign-On version 7.4.
				</p></div></div><div class="itemizedlist" id="reencrypt-templates"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Templates using OpenShift’s internal <a class="link" href="https://docs.openshift.com/container-platform/latest/builds/creating-build-inputs.html#builds-service-serving-certificate-secrets_creating-build-inputs">service serving x509 certificate secrets</a> to automatically create the HTTPS keystore used for serving secure content. The JGroups cluster traffic is authenticated using the <code class="literal">AUTH</code> protocol and encrypted using the <code class="literal">ASYM_ENCRYPT</code> protocol. The Red Hat Single Sign-On server truststore is also created automatically, containing the <span class="strong strong"><strong>/var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt</strong></span> CA certificate file, which is used to sign the certificate for HTTPS keystore. Moreover, the truststore for the Red Hat Single Sign-On server is pre-populated with the all known, trusted CA certificate files found in the Java system path. These templates secure the TLS communication using <a class="link" href="https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html#re-encryption-termination">re-encryption TLS termination</a>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-https</em></span></strong></span>: Red Hat Single Sign-On 7.5.0 with auto-generated HTTPS keystore and Red Hat Single Sign-On truststore, backed by internal H2 database. The <code class="literal">ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span>: Red Hat Single Sign-On 7.5.0 with auto-generated HTTPS keystore and Red Hat Single Sign-On truststore, backed by persistent PostgreSQL database. The <code class="literal">ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.
							</li></ul></div></li></ul></div><p>
				Other templates that integrate with Red Hat Single Sign-On are also available:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span>: Red Hat Single Sign-On-enabled Red Hat JBoss Enterprise Application Platform 6.4.
					</li><li class="listitem">
						<span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span>: Red Hat Single Sign-On-enabled Red Hat JBoss Enterprise Application Platform 7.1.
					</li><li class="listitem">
						<span class="strong strong"><strong><span class="emphasis"><em>datavirt63-secure-s2i</em></span></strong></span>: Red Hat Single Sign-On-enabled Red Hat JBoss Data Virtualization 6.3.
					</li></ul></div><p>
				These templates contain environment variables specific to Red Hat Single Sign-On that enable automatic Red Hat Single Sign-On client registration when deployed.
			</p><p>
				See <a class="link" href="#Auto-Man-Client-Reg" title="4.8.1. Automatic and Manual Red Hat Single Sign-On Client Registration Methods">Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a> for more information.
			</p></section></section><section class="chapter" id="before_you_begin"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Before You Begin</h1></div></div></div><section class="section" id="comparison_red_hat_single_sign_on_for_openshift_image_and_red_hat_single_sign_on"><div class="titlepage"><div><div><h2 class="title">2.1. Comparison: Red Hat Single Sign-On for OpenShift Image and Red Hat Single Sign-On</h2></div></div></div><p>
				The Red Hat Single Sign-On for OpenShift image version number 7.5.0 is based on Red Hat Single Sign-On 7.5.0. There are some differences in functionality between the Red Hat Single Sign-On for OpenShift image and Red Hat Single Sign-On:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The Red Hat Single Sign-On for OpenShift image includes all of the functionality of Red Hat Single Sign-On. In addition, the Red Hat Single Sign-On-enabled JBoss EAP image automatically handles OpenID Connect or SAML client registration and configuration for <span class="strong strong"><strong><span class="emphasis"><em>.war</em></span></strong></span> deployments that contain <span class="strong strong"><strong>&lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;</strong></span> or <span class="strong strong"><strong>&lt;auth-method&gt;KEYCLOAK-SAML&lt;/auth-method&gt;</strong></span> in their respective <span class="strong strong"><strong>web.xml</strong></span> files.
					</li></ul></div></section><section class="section" id="version_compatibility_and_support"><div class="titlepage"><div><div><h2 class="title">2.2. Version Compatibility and Support</h2></div></div></div><p>
				See the xPaaS part of the <a class="link" href="https://access.redhat.com/articles/2176281">OpenShift and Atomic Platform Tested Integrations page</a> for details about OpenShift image version compatibility.
			</p></section><section class="section" id="deprecated_image_streams_and_application_templates_for_red_hat_single_sign_on_for_openshift"><div class="titlepage"><div><div><h2 class="title">2.3. Deprecated Image Streams and Application Templates for Red Hat Single Sign-On for OpenShift</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					The Red Hat Single Sign-On for OpenShift image version number between 7.0 and 7.3 are deprecated and they will no longer receive updates of image and application templates.
				</p><p>
					<span class="strong strong"><strong>To deploy new applications, it is recommended to use the version 7.4 or 7.5.0 of the Red Hat Single Sign-On for OpenShift image along with the application templates specific to these image versions.</strong></span>
				</p></div></div></section><section class="section" id="initial_setup"><div class="titlepage"><div><div><h2 class="title">2.4. Initial Setup</h2></div></div></div><p>
				The Tutorials in this guide follow on from and assume an OpenShift instance similar to that created by performing <a class="link" href="https://docs.openshift.com/container-platform/latest/architecture/architecture-installation.html">the installation of the OpenShift Container Platform cluster</a>.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					For information related to updating the existing database when migrating Red Hat Single Sign-On for OpenShift image from previous versions to version 7.5.0, see the <a class="link" href="#upgrading-sso-db-from-previous-version" title="5.1. Example Workflow: Updating Existing Database to Migrate to New Red Hat Single Sign-On for OpenShift Image Version">Updating Existing Database when Migrating Red Hat Single Sign-On for OpenShift Image to a new version</a> section.
				</p></div></div></section></section><section class="chapter" id="get_started"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Get Started</h1></div></div></div><section class="section" id="image-streams-applications-templates"><div class="titlepage"><div><div><h2 class="title">3.1. Using the Red Hat Single Sign-On for OpenShift Image Streams and Application Templates</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Red Hat JBoss Middleware for OpenShift images are pulled on demand from the secured Red Hat Registry: <a class="link" href="https://catalog.redhat.com">registry.redhat.io</a>, which requires authentication. To retrieve content, you will need to log into the registry using the Red Hat account.
				</p><p>
					To consume container images from <span class="strong strong"><strong><span class="emphasis"><em>registry.redhat.io</em></span></strong></span> in shared environments such as OpenShift, it is recommended for an administrator to use a Registry Service Account, also referred to as authentication tokens, in place of an individual person’s Red Hat Customer Portal credentials.
				</p><p>
					To create a Registry Service Account, navigate to the <a class="link" href="https://access.redhat.com/terms-based-registry/">Registry Service Account Management Application</a>, and log in if necessary.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							From the <span class="strong strong"><strong><span class="emphasis"><em>Registry Service Accounts</em></span></strong></span> page, click <span class="strong strong"><strong><span class="emphasis"><em>Create Service Account</em></span></strong></span>.
						</li><li class="listitem"><p class="simpara">
							Provide a name for the Service Account, for example <span class="strong strong"><strong><span class="emphasis"><em>registry.redhat.io-sa</em></span></strong></span>. It will be prepended with a fixed, random string.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Enter a description for the Service Account, for example <span class="strong strong"><strong><span class="emphasis"><em>Service account to consume container images from registry.redhat.io.</em></span></strong></span>.
								</li><li class="listitem">
									Click <span class="strong strong"><strong><span class="emphasis"><em>Create</em></span></strong></span>.
								</li></ol></div></li><li class="listitem">
							After the Service Account was created, click the <span class="strong strong"><strong><span class="emphasis"><em>registry.redhat.io-sa</em></span></strong></span> link in the <span class="strong strong"><strong><span class="emphasis"><em>Account name</em></span></strong></span> column of the table presented on the <span class="strong strong"><strong><span class="emphasis"><em>Registry Service Accounts</em></span></strong></span> page.
						</li><li class="listitem">
							Finally, click the <span class="strong strong"><strong><span class="emphasis"><em>OpenShift Secret</em></span></strong></span> tab, and perform all steps listed on that page.
						</li></ol></div><p>
					See the <a class="link" href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a> article for more information.
				</p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Ensure that you are logged in as a cluster administrator or a user with project administrator access to the global openshift project:
					</li><li class="listitem"><p class="simpara">
						Choose a command based on your version of OpenShift Container Platform.
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								If you are running an OpenShift Container Platform v3 based cluster instance on (some) of your master host(s), perform the following:
							</p><pre class="programlisting language-bash">$ oc login -u system:admin</pre></li><li class="listitem"><p class="simpara">
								If you are running an OpenShift Container Platform v4 based cluster instance, <a class="link" href="https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/getting-started-cli.html#cli-logging-in_cli-developer-commands">log in to the CLI</a> as the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/remove-kubeadmin.html#understanding-kubeadmin_removing-kubeadmin">kubeadmin</a> user:
							</p><pre class="programlisting language-bash">$ oc login -u kubeadmin -p password https://openshift.example.com:6443</pre></li></ol></div></li><li class="listitem"><p class="simpara">
						Run the following commands to update the core set of Red Hat Single Sign-On 7.5.0 resources for OpenShift in the <code class="literal">openshift</code> project:
					</p><pre class="programlisting language-bash">$ for resource in sso75-openj9-image-stream.json \
  sso75-openj9-https.json \
  sso75-openj9-postgresql.json \
  sso75-openj9-postgresql-persistent.json \
  sso75-openj9-x509-https.json \
  sso75-openj9-x509-postgresql-persistent.json
do
  oc replace -n openshift --force -f \
  https://raw.githubusercontent.com/jboss-container-images/redhat-sso-7-openshift-image/sso75-cpaas-dev/templates/openj9/${resource}
done</pre></li><li class="listitem"><p class="simpara">
						Run the following command to install the Red Hat Single Sign-On 7.5.0 OpenShift image streams in the <code class="literal">openshift</code> project:
					</p><pre class="programlisting language-bash">$ oc -n openshift import-image rh-sso-7/sso75-openj9-openshift-rhel8:7.5 --from=registry.redhat.io/rh-sso-7/sso75-openj9-openshift-rhel8:7.5 --confirm</pre></li></ol></div></section><section class="section" id="Example-Deploying-SSO"><div class="titlepage"><div><div><h2 class="title">3.2. Deploying the Red Hat Single Sign-On Image</h2></div></div></div><section class="section" id="Preparing-SSO-Authentication-for-OpenShift-Deployment"><div class="titlepage"><div><div><h3 class="title">3.2.1. Preparing the Deployment</h3></div></div></div><p>
					Log in to the OpenShift CLI with a user that holds the <span class="emphasis"><em>cluster:admin</em></span> role.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a new project:
						</p><pre class="programlisting language-bash">$ oc new-project sso-app-demo</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">view</code> role to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts"><code class="literal">default</code></a> service account. This enables the service account to view all the resources in the sso-app-demo namespace, which is necessary for managing the cluster.
						</p><pre class="programlisting language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre></li></ol></div></section><section class="section" id="deploying_the_red_hat_single_sign_on_image_using_the_application_template"><div class="titlepage"><div><div><h3 class="title">3.2.2. Deploying the Red Hat Single Sign-On Image using the Application Template</h3></div></div></div><section class="section" id="deploying_the_template_using_openshift_cli"><div class="titlepage"><div><div><h4 class="title">3.2.2.1. Deploying the Template using OpenShift CLI</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								List the available Red Hat Single Sign-On application templates:
							</p><pre class="programlisting language-bash">$ oc get templates -n openshift -o name | grep -o 'sso75-openj9.\+'
sso75-openj9-https
sso75-openj9-postgresql
sso75-openj9-postgresql-persistent
sso75-openj9-x509-https
sso75-openj9-x509-postgresql-persistent</pre></li><li class="listitem"><p class="simpara">
								Deploy the selected one:
							</p><pre class="programlisting language-bash">$ oc new-app --template=sso75-openj9-x509-https
--&gt; Deploying template "openshift/sso75-openj9-x509-https" to project sso-app-demo

     Red Hat Single Sign-On 7.5 (Ephemeral)
     ---------
     An example Red Hat Single Sign-On 7 application. For more information about using this template, see &lt;link xlink:href="https://github.com/jboss-openshift/application-templates"&gt;https://github.com/jboss-openshift/application-templates&lt;/link&gt;.

     A new Red Hat Single Sign-On service has been created in your project. The admin username/password for accessing the master realm using the Red Hat Single Sign-On console is IACfQO8v/nR7llVSVb4Dye3TNRbXoXhRpAKTmiCRc. The HTTPS keystore used for serving secure content, the JGroups keystore used for securing JGroups communications, and server truststore used for securing Red Hat Single Sign-On requests were automatically created using OpenShift's service serving x509 certificate secrets.

     * With parameters:
        * Application Name=sso
        * JGroups Cluster Password=jg0Rssom0gmHBnooDF3Ww7V4Mu5RymmB # generated
        * Datasource Minimum Pool Size=
        * Datasource Maximum Pool Size=
        * Datasource Transaction Isolation=
        * ImageStream Namespace=openshift
        * Red Hat Single Sign-On Administrator Username=IACfQO8v # generated
        * Red Hat Single Sign-On Administrator Password=nR7llVSVb4Dye3TNRbXoXhRpAKTmiCRc # generated
        * Red Hat Single Sign-On Realm=
        * Red Hat Single Sign-On Service Username=
        * Red Hat Single Sign-On Service Password=
        * Container Memory Limit=1Gi

--&gt; Creating resources ...
    service "sso" created
    service "secure-sso" created
    service "sso-ping" created
    route "sso" created
    route "secure-sso" created
    deploymentconfig "sso" created
--&gt; Success
    Run 'oc status' to view your app.</pre></li></ol></div><p>
						Alternatively, perform one of the following procedures to deploy the Red Hat Single Sign-On template by using the OpenShift 3.x or 4.x web console.
					</p></section><section class="section" id="deploying_the_template_using_the_openshift_3_x_web_console"><div class="titlepage"><div><div><h4 class="title">3.2.2.2. Deploying the Template using the OpenShift 3.x Web Console</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Log in to the OpenShift web console and select the <span class="emphasis"><em>sso-app-demo</em></span> project space.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add to Project</strong></span>, then <span class="strong strong"><strong>Browse Catalog</strong></span> to list the default image streams and templates.
							</li><li class="listitem">
								Use the <span class="strong strong"><strong>Filter by Keyword</strong></span> search bar to limit the list to those that match <span class="emphasis"><em>sso</em></span>. You may need to click <span class="strong strong"><strong>Middleware</strong></span>, then <span class="strong strong"><strong>Integration</strong></span> to show the desired application template.
							</li><li class="listitem">
								Select an Red Hat Single Sign-On application template. This example uses <span class="strong strong"><strong><span class="emphasis"><em>Red Hat Single Sign-On 7.5 (Ephemeral)</em></span></strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Next</strong></span> in the <span class="strong strong"><strong>Information</strong></span> step.
							</li><li class="listitem">
								From the <span class="strong strong"><strong>Add to Project</strong></span> drop-down menu, select the <span class="emphasis"><em>sso-app-demo</em></span> project space. Then click <span class="strong strong"><strong>Next</strong></span>.
							</li><li class="listitem">
								Select <span class="strong strong"><strong>Do not bind at this time</strong></span> radio button in the <span class="strong strong"><strong>Binding</strong></span> step. Click <span class="strong strong"><strong>Create</strong></span> to continue.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>Results</strong></span> step, click the <span class="strong strong"><strong>Continue to the project overview</strong></span> link to verify the status of the deployment.
							</li></ol></div></section><section class="section" id="deploying_the_template_using_the_openshift_4_x_web_console"><div class="titlepage"><div><div><h4 class="title">3.2.2.3. Deploying the Template using the OpenShift 4.x Web Console</h4></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
								Perform the steps described in <a class="link" href="#image-streams-applications-templates" title="3.1. Using the Red Hat Single Sign-On for OpenShift Image Streams and Application Templates">Using the Red Hat Single Sign-On for OpenShift Image Streams and Application Templates</a>.
							</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Log in to the OpenShift web console and select the <span class="emphasis"><em>sso-app-demo</em></span> project space.
							</li><li class="listitem"><p class="simpara">
								On the left sidebar, click the <code class="literal">Administrator</code> tab and then click <code class="literal">&lt;/&gt; Developer</code>.
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/choose_developer_role.png" alt="choose developer role"/></span>
							</p></li><li class="listitem"><p class="simpara">
								Click <code class="literal">From Catalog</code>.
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/add_from_catalog.png" alt="add from catalog"/></span>
							</p></li><li class="listitem"><p class="simpara">
								Search for <code class="literal">sso</code>.
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/sso_keyword.png" alt="sso keyword"/></span>
							</p></li><li class="listitem"><p class="simpara">
								Choose a template such as <code class="literal">Red Hat Single Sign-On 7.4 on OpenJDK (Ephemeral)</code>.
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/choose_template.png" alt="choose template"/></span>
							</p></li><li class="listitem"><p class="simpara">
								Click <code class="literal">Instantiate Template</code>.
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/instantiate_template.png" alt="instantiate template"/></span>
							</p></li><li class="listitem">
								Adjust the template parameters if necessary and click <code class="literal">Create</code>.
							</li><li class="listitem"><p class="simpara">
								Verify the Red Hat Single Sign-On for OpenShift image was deployed.
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/verify_deployment.png" alt="verify deployment"/></span>
							</p></li></ol></div></section></section><section class="section" id="accessing_the_administrator_console_of_the_red_hat_single_sign_on_pod"><div class="titlepage"><div><div><h3 class="title">3.2.3. Accessing the Administrator Console of the Red Hat Single Sign-On Pod</h3></div></div></div><p>
					After the template is deployed, identify the available routes:
				</p><pre class="programlisting language-bash">$ oc get routes
NAME     HOST/PORT
sso      sso-sso-app-demo.openshift.example.com</pre><p>
					and access the Red Hat Single Sign-On administrator console at:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>https://sso-sso-app-demo.openshift.example.com/auth/admin</strong></span>
						</li></ul></div><p>
					using the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">administrator account</a>.
				</p></section></section></section><section class="chapter" id="advanced_concepts"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Advanced Concepts</h1></div></div></div><p>
			These cover additional configuration topics, such as seting up keystores and a truststore for the Red Hat Single Sign-On server, creating an administrator account, an overview of available Red Hat Single Sign-On client registration methods, and guidance on configuring clustering.
		</p><section class="section" id="requirements_and_deploying_link_xl_href_introduction_introduction_xml_passthrough_templates_passthrough_tls_termination_link_red_hat_single_sign_on_templates"><div class="titlepage"><div><div><h2 class="title">4.1. Requirements and Deploying <a class="link" href="#passthrough-templates">Passthrough TLS Termination</a> Red Hat Single Sign-On Templates</h2></div></div></div><section class="section" id="preparing_the_deployment"><div class="titlepage"><div><div><h3 class="title">4.1.1. Preparing the Deployment</h3></div></div></div><p>
					Log in to the OpenShift CLI with a user that holds the <span class="emphasis"><em>cluster:admin</em></span> role.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a new project:
						</p><pre class="programlisting language-bash">$ oc new-project sso-app-demo</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">view</code> role to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts"><code class="literal">default</code></a> service account. This enables the service account to view all the resources in the sso-app-demo namespace, which is necessary for managing the cluster.
						</p><pre class="programlisting language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre></li></ol></div></section><section class="section" id="Configuring-Keystores"><div class="titlepage"><div><div><h3 class="title">4.1.2. Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server</h3></div></div></div><p>
					The Red Hat Single Sign-On application templates using <a class="link" href="#passthrough-templates">passthrough TLS termination</a> require:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							An <a class="link" href="#create-https-keystore">HTTPS keystore</a> used for encryption of https traffic,
						</li><li class="listitem">
							The <a class="link" href="#create-jgroups-keystore">JGroups keystore</a> used for encryption of JGroups communications between nodes in the cluster, and
						</li><li class="listitem">
							<a class="link" href="#create-server-truststore">Red Hat Single Sign-On server truststore</a> used for securing the Red Hat Single Sign-On requests
						</li></ul></div><p>
					the Red Hat Single Sign-On for OpenShift image to be deployed properly.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						The Red Hat Single Sign-On application templates using <a class="link" href="#reencrypt-templates">re-encryption TLS termination</a> do not <span class="strong strong"><strong>require</strong></span> or <span class="strong strong"><strong>expect</strong></span> the aforementioned HTTPS and JGroups keystores and Red Hat Single Sign-On server truststore to be prepared beforehand. The templates use OpenShift’s internal <a class="link" href="https://docs.openshift.com/container-platform/latest/builds/creating-build-inputs.html#builds-service-serving-certificate-secrets_creating-build-inputs">service serving x509 certificate secrets</a> to automatically create the HTTPS and JGroups keystores. The Red Hat Single Sign-On server truststore is also created automatically, containing the <span class="strong strong"><strong>/var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt</strong></span> CA certificate file, which is used to create these cluster certificates. Moreover, the truststore for the Red Hat Single Sign-On server is pre-populated with the all known, trusted CA certificate files found in the Java system path.
					</p></div></div><p>
					The <span class="strong strong"><strong><span class="emphasis"><em>openssl</em></span></strong></span> toolkit is used in the following example to generate a CA certificate to sign the HTTPS keystore, and create a truststore for the Red Hat Single Sign-On server. <span class="strong strong"><strong><span class="emphasis"><em>keytool</em></span></strong></span>, a package <span class="strong strong"><strong>included with the Java Development Kit</strong></span>, is then utilized to the generate self-signed certificates for these keystores.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						For production environments Red Hat recommends that you use your own SSL certificate purchased from a verified Certificate Authority (CA) for SSL-encrypted connections (HTTPS).
					</p><p>
						See the <a class="link" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/6.1/html-single/security_guide/index#Generate_a_SSL_Encryption_Key_and_Certificate">JBoss Enterprise Application Platform Security Guide</a> for more information on how to create a keystore with self-signed or purchased SSL certificates.
					</p></div></div><p id="create-https-keystore">
					<span class="strong strong"><strong><span class="emphasis"><em>Create the HTTPS keystore:</em></span></strong></span>
				</p><div class="orderedlist" id="generate-ca-certificate"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
							Generate a CA certificate. Pick and remember the password. Provide identical password, when <a class="link" href="#signing-csr-with-ca-certificate">signing the certificate sign request with the CA certificate</a> below:
						</p><pre class="programlisting language-bash">$ openssl req -new -newkey rsa:4096 -x509 -keyout xpaas.key -out xpaas.crt -days 365 -subj "/CN=xpaas-sso-demo.ca"</pre></li><li class="listitem"><p class="simpara">
							Generate a private key for the HTTPS keystore. Provide <code class="literal">mykeystorepass</code> as the keystore password:
						</p><pre class="programlisting language-bash">$ keytool -genkeypair -keyalg RSA -keysize 2048 -dname "CN=secure-sso-sso-app-demo.openshift.example.com" -alias jboss -keystore keystore.jks</pre></li><li class="listitem"><p class="simpara">
							Generate a certificate sign request for the HTTPS keystore. Provide <code class="literal">mykeystorepass</code> as the keystore password:
						</p><pre class="programlisting language-bash">$ keytool -certreq -keyalg rsa -alias jboss -keystore keystore.jks -file sso.csr</pre></li></ol></div><div class="orderedlist" id="signing-csr-with-ca-certificate"><ol class="orderedlist" start="4" type="a"><li class="listitem"><p class="simpara">
							Sign the certificate sign request with the CA certificate. Provide the same password that was used to <a class="link" href="#generate-ca-certificate">generate the CA certificate</a>:
						</p><pre class="programlisting language-bash">$ openssl x509 -req -CA xpaas.crt -CAkey xpaas.key -in sso.csr -out sso.crt -days 365 -CAcreateserial</pre></li><li class="listitem"><p class="simpara">
							Import the CA certificate into the HTTPS keystore. Provide <code class="literal">mykeystorepass</code> as the keystore password. Reply <code class="literal">yes</code> to <code class="literal">Trust this certificate? [no]:</code> question:
						</p><pre class="programlisting language-bash">$ keytool -import -file xpaas.crt -alias xpaas.ca -keystore keystore.jks</pre></li><li class="listitem"><p class="simpara">
							Import the signed certificate sign request into the HTTPS keystore. Provide <code class="literal">mykeystorepass</code> as the keystore password:
						</p><pre class="programlisting language-bash">$ keytool -import -file sso.crt -alias jboss -keystore keystore.jks</pre></li></ol></div><p id="create-jgroups-keystore">
					<span class="strong strong"><strong><span class="emphasis"><em>Generate a secure key for the JGroups keystore:</em></span></strong></span>
				</p><p>
					Provide <code class="literal">password</code> as the keystore password:
				</p><pre class="programlisting language-bash">$ keytool -genseckey -alias secret-key -storetype JCEKS -keystore jgroups.jceks</pre><p id="create-server-truststore">
					<span class="strong strong"><strong><span class="emphasis"><em>Import the CA certificate into a new Red Hat Single Sign-On server truststore:</em></span></strong></span>
				</p><p>
					Provide <code class="literal">mykeystorepass</code> as the truststore password. Reply <code class="literal">yes</code> to <code class="literal">Trust this certificate? [no]:</code> question:
				</p><pre class="programlisting language-bash">$ keytool -import -file xpaas.crt -alias xpaas.ca -keystore truststore.jks</pre></section><section class="section" id="Configuring-Secrets"><div class="titlepage"><div><div><h3 class="title">4.1.3. Secrets</h3></div></div></div><p>
					OpenShift uses objects called <a class="link" href="https://docs.openshift.com/container-platform/latest/builds/creating-build-inputs.html#builds-secrets-overview_creating-build-inputs">secrets</a> to hold sensitive information, such as passwords or keystores.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create the secrets for the HTTPS and JGroups keystores, and Red Hat Single Sign-On server truststore, generated in the <a class="link" href="#Configuring-Keystores" title="4.1.2. Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server">previous section</a>.
						</p><pre class="programlisting language-bash">$ oc create secret generic sso-app-secret --from-file=keystore.jks --from-file=jgroups.jceks --from-file=truststore.jks</pre></li><li class="listitem"><p class="simpara">
							Link these secrets to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts">default</a> service account, which is used to run Red Hat Single Sign-On pods.
						</p><pre class="programlisting language-bash">$ oc secrets link default sso-app-secret</pre></li></ol></div></section><section class="section" id="deploying_the_chosen_red_hat_single_sign_on_passthrough_tls_template_via_openshift_cli"><div class="titlepage"><div><div><h3 class="title">4.1.4. Deploying the Chosen Red Hat Single Sign-On Passthrough TLS Template via OpenShift CLI</h3></div></div></div><p>
					After the aforementioned <a class="link" href="#Configuring-Keystores" title="4.1.2. Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server">keystores</a> and <a class="link" href="#Configuring-Secrets" title="4.1.3. Secrets">secrets</a> are created, deploy some of the available <a class="link" href="#passthrough-templates">passthrough TLS termination</a> as follows:
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						For simplicity, the values of <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_PASSWORD</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_PASSWORD</em></span></strong></span> variables <a class="link" href="#advanced-topics-deploy-sso75-openj9-https-template">in the following command</a> have been chosen to match the default values of the respective parameters of the <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-https</em></span></strong></span> Red Hat Single Sign-On application template.
					</p><p>
						For production environments, Red Hat recommends that you consult the on-site policy, specific to your organization for guidance on how to generate sufficiently strong user name and password for the administrator user account of the Red Hat Single Sign-On server, and passwords for the HTTPS and JGroups keystores, and the truststore of the Red Hat Single Sign-On server.
					</p><p>
						Be aware that <span class="strong strong"><strong>the passwords provided when provisioning the template need to match the passwords provided when creating the keystores</strong></span>. If using different username and passwords, modify the values of respective <a class="link" href="#advanced-topics-deploy-sso75-openj9-https-template">template parameters</a> as appropriate for your environment.
					</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The following commands using the <span class="strong strong"><strong><span class="emphasis"><em>keytool</em></span></strong></span>, a package <span class="strong strong"><strong>included with the Java Development Kit</strong></span>, can be used to determine the names associated with the certificate:
					</p><pre class="programlisting language-bash">$ keytool -v -list -keystore keystore.jks | grep Alias
Enter keystore password:  mykeystorepass
Alias name: xpaas.ca
Alias name: jboss</pre><pre class="programlisting language-bash">$ keytool -v -list -keystore jgroups.jceks -storetype jceks | grep Alias
Enter keystore password:  password
Alias name: secret-key</pre><p>
						Finally, the <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span>, and the <span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span> template parameters in the following command are optional.
					</p></div></div><p>
					<span id="advanced-topics-deploy-sso75-openj9-https-template"/>
				</p><pre class="programlisting language-bash">$ oc new-app --template=sso75-openj9-https \
 -p HTTPS_SECRET="sso-app-secret" \
 -p HTTPS_KEYSTORE="keystore.jks" \
 -p HTTPS_NAME="jboss" \
 -p HTTPS_PASSWORD="mykeystorepass" \
 -p JGROUPS_ENCRYPT_SECRET="sso-app-secret" \
 -p JGROUPS_ENCRYPT_KEYSTORE="jgroups.jceks" \
 -p JGROUPS_ENCRYPT_NAME="secret-key" \
 -p JGROUPS_ENCRYPT_PASSWORD="password" \
 -p SSO_ADMIN_USERNAME="admin" \
 -p SSO_ADMIN_PASSWORD="redhat" \
 -p SSO_REALM="demorealm" \
 -p SSO_TRUSTSTORE="truststore.jks" \
 -p SSO_TRUSTSTORE_PASSWORD="mykeystorepass" \
 -p SSO_TRUSTSTORE_SECRET="sso-app-secret"
--&gt; Deploying template "openshift/sso75-openj9-https" to project sso-app-demo

     Red Hat Single Sign-On 7.5.0 (Ephemeral with passthrough TLS)
     ---------
     An example Red Hat Single Sign-On 7 application. For more information about using this template, see https://github.com/jboss-openshift/application-templates.

     A new Red Hat Single Sign-On service has been created in your project. The admin username/password for accessing the master realm via the Red Hat Single Sign-On console is admin/redhat. Please be sure to create the following secrets: "sso-app-secret" containing the keystore.jks file used for serving secure content; "sso-app-secret" containing the jgroups.jceks file used for securing JGroups communications; "sso-app-secret" containing the truststore.jks file used for securing Red Hat Single Sign-On requests.

     * With parameters:
        * Application Name=sso
        * Custom http Route Hostname=
        * Custom https Route Hostname=
        * Server Keystore Secret Name=sso-app-secret
        * Server Keystore Filename=keystore.jks
        * Server Keystore Type=
        * Server Certificate Name=jboss
        * Server Keystore Password=mykeystorepass
        * Datasource Minimum Pool Size=
        * Datasource Maximum Pool Size=
        * Datasource Transaction Isolation=
        * JGroups Secret Name=sso-app-secret
        * JGroups Keystore Filename=jgroups.jceks
        * JGroups Certificate Name=secret-key
        * JGroups Keystore Password=password
        * JGroups Cluster Password=yeSppLfp # generated
        * ImageStream Namespace=openshift
        * Red Hat Single Sign-On Administrator Username=admin
        * Red Hat Single Sign-On Administrator Password=redhat
        * Red Hat Single Sign-On Realm=demorealm
        * Red Hat Single Sign-On Service Username=
        * Red Hat Single Sign-On Service Password=
        * Red Hat Single Sign-On Trust Store=truststore.jks
        * Red Hat Single Sign-On Trust Store Password=mykeystorepass
        * Red Hat Single Sign-On Trust Store Secret=sso-app-secret
        * Container Memory Limit=1Gi

--&gt; Creating resources ...
    service "sso" created
    service "secure-sso" created
    service "sso-ping" created
    route "sso" created
    route "secure-sso" created
    deploymentconfig "sso" created
--&gt; Success
    Run 'oc status' to view your app.</pre></section></section><section class="section" id="advanced-concepts-sso-hostname-spi-setup"><div class="titlepage"><div><div><h2 class="title">4.2. Customizing the Hostname for the Red Hat Single Sign-On Server</h2></div></div></div><p>
				The hostname SPI introduced a flexible way to configure the hostname for the Red Hat Single Sign-On server. The default hostname provider one is <code class="literal">default</code>. This provider provides enhanced functionality over the original <code class="literal">request</code> provider which is now deprecated. Without additional settings, it uses the request headers to determine the hostname similarly to the original <code class="literal">request</code> provider.
			</p><p>
				For configuration options of the <code class="literal">default</code> provider, refer to the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#_hostname">Server Installation and Configuration Guide</a>. The <code class="literal">frontendUrl</code> option can be configured via <code class="literal">SSO_FRONTEND_URL</code> environment variable.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					For backward compatibility, <code class="literal">SSO_FRONTEND_URL</code> settings is ignored if <code class="literal">SSO_HOSTNAME</code> is also set.
				</p></div></div><p>
				Another option of hostname provider is <code class="literal">fixed</code>, which allows configuring a fixed hostname. The latter makes sure that only valid hostnames can be used and allows internal applications to invoke the Red Hat Single Sign-On server through an alternative URL.
			</p><p>
				Run the following commands to set the <code class="literal">fixed</code> hostname SPI provider for the Red Hat Single Sign-On server:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Deploy the Red Hat Single Sign-On for OpenShift image with <span class="strong strong"><strong><span class="emphasis"><em>SSO_HOSTNAME</em></span></strong></span> environment variable set to the desired hostname of the Red Hat Single Sign-On server.
					</p><pre class="programlisting language-yaml">$ oc new-app --template=sso75-openj9-x509-https \
  -p SSO_HOSTNAME="rh-sso-server.openshift.example.com"</pre></li><li class="listitem"><p class="simpara">
						Identify the name of the route for the Red Hat Single Sign-On service.
					</p><pre class="programlisting language-yaml">$ oc get routes
NAME     HOST/PORT
sso      sso-sso-app-demo.openshift.example.com</pre></li><li class="listitem"><p class="simpara">
						Change the <code class="literal">host:</code> field to match the hostname specified as the value of the <span class="strong strong"><strong><span class="emphasis"><em>SSO_HOSTNAME</em></span></strong></span> environment variable above.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Adjust the <code class="literal">rh-sso-server.openshift.example.com</code> value in the following command as necessary.
						</p></div></div><pre class="screen">$ oc patch route/sso --type=json -p '[{"op": "replace", "path": "/spec/host", "value": "rh-sso-server.openshift.example.com"}]'</pre><p class="simpara">
						If successful, the previous command will return the following output:
					</p><pre class="screen">route "sso" patched</pre></li></ol></div></section><section class="section" id="sso-connecting-to-an-external-database"><div class="titlepage"><div><div><h2 class="title">4.3. Connecting to an external database</h2></div></div></div><p>
				Red Hat Single Sign-On can be configured to connect to an external (to OpenShift cluster) database. In order to achieve this, you need to modify the <code class="literal">sso-{database name}</code> Endpoints object to point to the proper address. The procedure is described in the <a class="link" href="https://docs.openshift.com/container-platform/latest/networking/configuring_ingress_cluster_traffic/configuring-ingress-cluster-traffic-service-external-ip.html#nw-service-external-ip_configuring-ingress-cluster-traffic-service-external-ip">OpenShift manual</a>.
			</p><p>
				Tip: The easiest way to get started is to deploy Red Hat Single Sign-On from a template and then modify the Endpoints object. You might also need to update some of the datasource configuration variables in the DeploymentConfig. Once you’re done, just roll a new deployment out.
			</p></section><section class="section" id="sso-using-custom-jdbc-driver"><div class="titlepage"><div><div><h2 class="title">4.4. Using Custom JDBC Driver</h2></div></div></div><p>
				To connect to any database, the JDBC driver for that database must be present and Red Hat Single Sign-On configured properly. Currently, the only JDBC driver available in the image is the PostgreSQL JDBC driver. For any other database, you need to extend the Red Hat Single Sign-On image with a custom JDBC driver and a CLI script to register it and set up the connection properties. The following steps illustrate how to do that, taking MariaDB driver as an example. Update the example for other database drivers accordingly.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Create an empty directory.
					</li><li class="listitem">
						Download the JDBC driver binaries into this directory.
					</li><li class="listitem"><p class="simpara">
						Create a new <code class="literal">Dockerfile</code> file in this directory with the following contents. For other databases, replace <code class="literal">mariadb-java-client-2.5.4.jar</code> with the filename of the respective driver:
					</p><pre class="screen"><span class="strong strong"><strong>FROM</strong></span> rh-sso-7/sso75-openj9-openshift-rhel8:latest

<span class="strong strong"><strong>COPY</strong></span> sso-extensions.cli /opt/eap/extensions/
<span class="strong strong"><strong>COPY</strong></span> mariadb-java-client-2.5.4.jar /opt/eap/extensions/jdbc-driver.jar</pre></li><li class="listitem"><p class="simpara">
						Create a new <code class="literal">sso-extensions.cli</code> file in this directory with the following contents. Update the values of the variables in italics according to the deployment needs:
					</p><pre class="programlisting language-bash">batch

set DB_DRIVER_NAME=<span class="emphasis"><em>mariadb</em></span>
set DB_USERNAME=<span class="emphasis"><em>username</em></span>
set DB_PASSWORD=<span class="emphasis"><em>password</em></span>
set DB_DRIVER=<span class="emphasis"><em>org.mariadb.jdbc.Driver</em></span>
set DB_XA_DRIVER=<span class="emphasis"><em>org.mariadb.jdbc.MariaDbDataSource</em></span>
set DB_JDBC_URL=<span class="emphasis"><em>jdbc:mariadb://jdbc-host/keycloak</em></span>
set DB_EAP_MODULE=<span class="emphasis"><em>org.mariadb</em></span>

set FILE=/opt/eap/extensions/jdbc-driver.jar

module add --name=$DB_EAP_MODULE --resources=$FILE --dependencies=javax.api,javax.resource.api
/subsystem=datasources/jdbc-driver=$DB_DRIVER_NAME:add( \
  driver-name=$DB_DRIVER_NAME, \
  driver-module-name=$DB_EAP_MODULE, \
  driver-class-name=$DB_DRIVER, \
  driver-xa-datasource-class-name=$DB_XA_DRIVER \
)
/subsystem=datasources/data-source=KeycloakDS:remove()
/subsystem=datasources/data-source=KeycloakDS:add( \
  jndi-name=java:jboss/datasources/KeycloakDS, \
  enabled=true, \
  use-java-context=true, \
  connection-url=$DB_JDBC_URL, \
  driver-name=$DB_DRIVER_NAME, \
  user-name=$DB_USERNAME, \
  password=$DB_PASSWORD \
)

run-batch</pre></li><li class="listitem"><p class="simpara">
						In this directory, build your image by typing the following command, replacing the <code class="literal">project/name:tag</code> with arbitrary name. <code class="literal">docker</code> can be used instead of <code class="literal">podman</code>.
					</p><pre class="programlisting language-bash">podman build -t docker-registry-default/project/name:tag .</pre></li><li class="listitem">
						After the build finishes, push your image to the registry used by OpenShift to deploy your image. Refer to the <a class="link" href="https://docs.openshift.com/container-platform/latest/registry/accessing-the-registry.html#registry-accessing-directly_accessing-the-registry">OpenShift guide</a> for details.
					</li></ol></div></section><section class="section" id="sso-administrator-setup"><div class="titlepage"><div><div><h2 class="title">4.5. Creating the Administrator Account for Red Hat Single Sign-On Server</h2></div></div></div><p>
				Red Hat Single Sign-On does not provide any pre-configured management account out of the box. This administrator account is necessary for logging into the <code class="literal">master</code> realm’s management console and perform server maintenance operations such as, creating realms or users, or registering applications intended to be secured by Red Hat Single Sign-On.
			</p><p>
				The administrator account can be created:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						By providing values for the <a class="link" href="#sso-admin-template-parameters" title="4.5.1. Creating the Administrator Account Using Template Parameters"><span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span> parameters</a>, when deploying the Red Hat Single Sign-On application template, or
					</li><li class="listitem">
						By <a class="link" href="#sso-admin-remote-shell" title="4.5.2. Creating the Administrator Account via Remote Shell Session to Red Hat Single Sign-On Pod">a remote shell session to particular Red Hat Single Sign-On pod</a>, if the Red Hat Single Sign-On for OpenShift image is deployed without an application template.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On allows an initial administrator account to be created via the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/getting_started_guide/#creating_the_admin_account">Welcome Page</a> web form, but only if the Welcome Page is accessed from localhost; this method of administrator account creation is not applicable for the Red Hat Single Sign-On for OpenShift image.
				</p></div></div><section class="section" id="sso-admin-template-parameters"><div class="titlepage"><div><div><h3 class="title">4.5.1. Creating the Administrator Account Using Template Parameters</h3></div></div></div><p>
					When deploying Red Hat Single Sign-On application template, the <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span> parameters denote the username and password of the Red Hat Single Sign-On server’s administrator account to be created for the <code class="literal">master</code> realm.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						<span class="strong strong"><strong>Both of these parameters are required.</strong></span> If not specified, they are auto generated and displayed as an OpenShift instructional message when the template is instantiated.
					</p></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						The lifespan of the Red Hat Single Sign-On server’s administrator account depends upon the storage type used to store the Red Hat Single Sign-On server’s database:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								For an in-memory database mode (<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-https</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-https</em></span></strong></span> templates), the account exists throughout the lifecycle of the particular Red Hat Single Sign-On pod (stored account data is lost upon pod destruction),
							</li><li class="listitem">
								For an ephemeral database mode <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span> templates), the account exists throughout the lifecycle of the database pod. Even if the Red Hat Single Sign-On pod is destructed, the stored account data is preserved under the assumption that the database pod is still running,
							</li><li class="listitem">
								For persistent database mode (<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span> templates), the account exists throughout the lifecycle of the persistent medium used to hold the database data. This means that the stored account data is preserved even when both the Red Hat Single Sign-On and the database pods are destructed.
							</li></ul></div><p>
						It is a common practice to deploy an Red Hat Single Sign-On application template to get the corresponding OpenShift deployment config for the application, and then reuse that deployment config multiple times (every time a new Red Hat Single Sign-On application needs to be instantiated).
					</p></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						In the case of <span class="strong strong"><strong>ephemeral or persistent database mode</strong></span>, after creating the RH_SSO server’s administrator account, remove the <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span> variables from the deployment config before deploying new Red Hat Single Sign-On applications.
					</p></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Run the following commands to prepare the previously created deployment config of the Red Hat Single Sign-On application for reuse after the administrator account has been created:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Identify the deployment config of the Red Hat Single Sign-On application.
							</p><pre class="programlisting language-bash">$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-postgresql</pre></li><li class="listitem"><p class="simpara">
								Clear the <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span> variables setting.
							</p><pre class="programlisting language-bash">$ oc set env dc/sso \
  -e SSO_ADMIN_USERNAME="" \
  -e SSO_ADMIN_PASSWORD=""</pre></li></ol></div></div></div></section><section class="section" id="sso-admin-remote-shell"><div class="titlepage"><div><div><h3 class="title">4.5.2. Creating the Administrator Account via Remote Shell Session to Red Hat Single Sign-On Pod</h3></div></div></div><p>
					Run following commands to create an administrator account for the <code class="literal">master</code> realm of the Red Hat Single Sign-On server, when deploying the Red Hat Single Sign-On for OpenShift image directly from the image stream (without the <a class="link" href="#sso-templates">template</a>), after the Red Hat Single Sign-On application pod has been started:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify the Red Hat Single Sign-On application pod.
						</p><pre class="programlisting language-bash">$ oc get pods
NAME                     READY     STATUS    RESTARTS   AGE
sso-12-pt93n             1/1       Running   0          1m
sso-postgresql-6-d97pf   1/1       Running   0          2m</pre></li><li class="listitem"><p class="simpara">
							Open a remote shell session to the Red Hat Single Sign-On for OpenShift container.
						</p><pre class="programlisting language-bash">$ oc rsh sso-12-pt93n
sh-4.2$</pre></li><li class="listitem"><p class="simpara">
							Create the Red Hat Single Sign-On server administrator account for the <code class="literal">master</code> realm at the command line with the <code class="literal">add-user-keycloak.sh</code> script.
						</p><pre class="programlisting language-bash">sh-4.2$ cd /opt/eap/bin/
sh-4.2$ ./add-user-keycloak.sh \
        -r master \
        -u sso_admin \
        -p sso_password
Added 'sso_admin' to '/opt/eap/standalone/configuration/keycloak-add-user.json', restart server to load user</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The 'sso_admin' / 'sso_password' credentials in the example above are for demonstration purposes only. Refer to the password policy applicable within your organization for guidance on how to create a secure user name and password.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Restart the underlying JBoss EAP server instance to load the newly added user account. Wait for the server to restart properly.
						</p><pre class="programlisting language-bash">sh-4.2$ ./jboss-cli.sh --connect ':reload'
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</pre><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
								When restarting the server it is important to restart just the JBoss EAP process within the running Red Hat Single Sign-On container, and not the whole container. This is because restarting the whole container will recreate it from scratch, without the Red Hat Single Sign-On server administration account for the <code class="literal">master</code> realm.
							</p></div></div></li><li class="listitem">
							Log in to the <code class="literal">master</code> realm’s administration console of the Red Hat Single Sign-On server using the credentials created in the steps above. In the browser, navigate to <span class="strong strong"><strong>http://sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong></span> for the Red Hat Single Sign-On web server, or to <span class="strong strong"><strong>https://secure-sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong></span> for the encrypted Red Hat Single Sign-On web server, and specify the user name and password used to create the administrator user.
						</li></ol></div></section></section><section class="section" id="customizing_the_default_behavior_of_the_red_hat_single_sign_on_image"><div class="titlepage"><div><div><h2 class="title">4.6. Customizing the default behavior of the Red Hat Single Sign-On image</h2></div></div></div><p>
				You can change the default behavior of the Red Hat Single Sign-On image such as enabling TechPreview features or enabling debugging. This section describes how to make this change by using the JAVA_OPTS_APPEND variable.
			</p><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
					This procedure assumes that the Red Hat Single Sign-On for OpenShift image has been previously <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">deployed using one of the following templates:</a>
				</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span>
					</li></ul></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					You can use the OpenShift web console or the CLI to change the default behavior.
				</p></div><p>
				If you use the OpenShift web console, you add the JAVA_OPTS_APPEND variable to the sso deployment config. For example, to enable TechPreview features, you set the variable as follows:
			</p><pre class="programlisting language-bash">JAVA_OPTS_APPEND="-Dkeycloak.profile=preview"</pre><p>
				If you use the CLI, use the following commands to enable TechPreview features when the Red Hat Single Sign-On pod was deployed using a template that is mentioned under Prerequisites.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Scale down the Red Hat Single Sign-On pod:
					</p><pre class="programlisting language-bash">$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-postgresql

$ oc scale --replicas=0 dc sso
deploymentconfig "sso" scaled</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							In the preceding command, <code class="literal">sso-postgresql</code> appears because a PostgreSQL template was used to deploy the Red Hat Single Sign-On for OpenShift image.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Edit the deployment config to set the JAVA_OPTS_APPEND variable. For example, to enable TechPreview features, you set the variable as follows:
					</p><pre class="programlisting language-bash">oc env dc/sso -e "JAVA_OPTS_APPEND=-Dkeycloak.profile=preview"</pre></li><li class="listitem"><p class="simpara">
						Scale up the Red Hat Single Sign-On pod:
					</p><pre class="programlisting language-bash">$ oc scale --replicas=1 dc sso
deploymentconfig "sso" scaled</pre></li><li class="listitem">
						Test a TechPreview feature of your choice.
					</li></ol></div></section><section class="section" id="deployment_process"><div class="titlepage"><div><div><h2 class="title">4.7. Deployment Process</h2></div></div></div><p>
				Once deployed, the <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-https</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-https</em></span></strong></span> templates create a single pod that contains both the database and the Red Hat Single Sign-On servers. The <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span> templates create two pods, one for the database server and one for the Red Hat Single Sign-On web server.
			</p><p>
				After the Red Hat Single Sign-On web server pod has started, it can be accessed at its custom configured hostnames, or at the default hostnames:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong>http://sso-<span class="emphasis"><em>&lt;project-name&gt;</em></span>.<span class="emphasis"><em>&lt;hostname&gt;</em></span>/auth/admin</strong></span>: for the Red Hat Single Sign-On web server, and
					</li><li class="listitem">
						<span class="strong strong"><strong>https://secure-sso-<span class="emphasis"><em>&lt;project-name&gt;</em></span>.<span class="emphasis"><em>&lt;hostname&gt;</em></span>/auth/admin</strong></span>: for the encrypted Red Hat Single Sign-On web server.
					</li></ul></div><p>
				Use the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">administrator user credentials</a> to log in into the <code class="literal">master</code> realm’s administration console.
			</p></section><section class="section" id="SSO-Clients"><div class="titlepage"><div><div><h2 class="title">4.8. Red Hat Single Sign-On Clients</h2></div></div></div><p>
				Clients are Red Hat Single Sign-On entities that request user authentication. A client can be an application requesting Red Hat Single Sign-On to provide user authentication, or it can be making requests for access tokens to start services on behalf of an authenticated user. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients">Managing Clients chapter of the Red Hat Single Sign-On documentation</a> for more information.
			</p><p>
				Red Hat Single Sign-On provides <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients#oidc_clients">OpenID-Connect</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients#saml_clients">SAML</a> client protocols.<br/> OpenID-Connect is the preferred protocol and utilizes three different access types:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong>public</strong></span>: Useful for JavaScript applications that run directly in the browser and require no server configuration.
					</li><li class="listitem">
						<span class="strong strong"><strong>confidential</strong></span>: Useful for server-side clients, such as EAP web applications, that need to perform a browser login.
					</li><li class="listitem">
						<span class="strong strong"><strong>bearer-only</strong></span>: Useful for back-end services that allow bearer token requests.
					</li></ul></div><p>
				It is required to specify the client type in the <span class="strong strong"><strong>&lt;auth-method&gt;</strong></span> key of the application <span class="strong strong"><strong>web.xml</strong></span> file. This file is read by the image at deployment. Set the value of <span class="strong strong"><strong>&lt;auth-method&gt;</strong></span> element to:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong>KEYCLOAK</strong></span> for the OpenID Connect client.
					</li><li class="listitem">
						<span class="strong strong"><strong>KEYCLOAK-SAML</strong></span> for the SAML client.
					</li></ul></div><p>
				The following is an example snippet for the application <span class="strong strong"><strong>web.xml</strong></span> to configure an OIDC client:
			</p><pre class="programlisting language-bash">...
&lt;login-config&gt;
        &lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;
&lt;/login-config&gt;
...</pre><section class="section" id="Auto-Man-Client-Reg"><div class="titlepage"><div><div><h3 class="title">4.8.1. Automatic and Manual Red Hat Single Sign-On Client Registration Methods</h3></div></div></div><p>
					A client application can be automatically registered to an Red Hat Single Sign-On realm by using credentials passed in variables specific to the <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>datavirt63-secure-s2i</em></span></strong></span> templates.
				</p><p>
					Alternatively, you can manually register the client application by configuring and exporting the Red Hat Single Sign-On client adapter and including it in the client application configuration.
				</p><section class="section" id="automatic_red_hat_single_sign_on_client_registration"><div class="titlepage"><div><div><h4 class="title">4.8.1.1. Automatic Red Hat Single Sign-On Client Registration</h4></div></div></div><p>
						Automatic Red Hat Single Sign-On client registration is determined by Red Hat Single Sign-On environment variables specific to the <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>datavirt63-secure-s2i</em></span></strong></span> templates. The Red Hat Single Sign-On credentials supplied in the template are then used to register the client to the Red Hat Single Sign-On realm during deployment of the client application.
					</p><p>
						The Red Hat Single Sign-On environment variables included in the <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>datavirt63-secure-s2i</em></span></strong></span> templates are:
					</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078746135104" scope="col">Variable</th><th align="left" valign="top" id="idm140078746134016" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTP</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										Custom hostname for http service route. Leave blank for default hostname of &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTPS</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										Custom hostname for https service route. Leave blank for default hostname of &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_URL</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										The Red Hat Single Sign-On web server authentication address: https://secure-sso-<span class="emphasis"><em>&lt;project-name&gt;</em></span>.<span class="emphasis"><em>&lt;hostname&gt;</em></span>/auth
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										The Red Hat Single Sign-On realm created for this procedure.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_USERNAME</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										The name of the <span class="emphasis"><em>realm management user</em></span>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_PASSWORD</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										The password of the user.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_PUBLIC_KEY</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										The public key generated by the realm. It is located in the <span class="strong strong"><strong>Keys</strong></span> tab of the <span class="strong strong"><strong>Realm Settings</strong></span> in the Red Hat Single Sign-On console.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_BEARER_ONLY</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										If set to <span class="strong strong"><strong>true</strong></span>, the OpenID Connect client is registered as bearer-only.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746135104">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_ENABLE_CORS</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746134016">
									<p>
										If set to <span class="strong strong"><strong>true</strong></span>, the Red Hat Single Sign-On adapter enables Cross-Origin Resource Sharing (CORS).
									</p>
									</td></tr></tbody></table></div><p>
						If the Red Hat Single Sign-On client uses the SAML protocol, the following additional variables need to be configured:
					</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078746080560" scope="col">Variable</th><th align="left" valign="top" id="idm140078746079472" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078746080560">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_KEYSTORE_SECRET</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746079472">
									<p>
										Secret to use for access to SAML keystore. The default is <span class="emphasis"><em>sso-app-secret</em></span>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746080560">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_KEYSTORE</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746079472">
									<p>
										Keystore filename in the SAML keystore secret. The default is <span class="emphasis"><em>keystore.jks</em></span>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746080560">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_KEYSTORE_PASSWORD</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746079472">
									<p>
										Keystore password for SAML. The default is <span class="emphasis"><em>mykeystorepass</em></span>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140078746080560">
									<p>
										<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_CERTIFICATE_NAME</em></span></strong></span>
									</p>
									</td><td align="left" valign="top" headers="idm140078746079472">
									<p>
										Alias for keys/certificate to use for SAML. The default is <span class="emphasis"><em>jboss</em></span>.
									</p>
									</td></tr></tbody></table></div><p>
						See <a class="link" href="#Example-EAP-Auto" title="5.5. Example Workflow: Automatically Registering EAP Application in Red Hat Single Sign-On with OpenID-Connect Client">Example Workflow: Automatically Registering EAP Application in Red Hat Single Sign-On with OpenID-Connect Client</a> for an end-to-end example of the automatic client registration method using an OpenID-Connect client.
					</p></section><section class="section" id="manual_red_hat_single_sign_on_client_registration"><div class="titlepage"><div><div><h4 class="title">4.8.1.2. Manual Red Hat Single Sign-On Client Registration</h4></div></div></div><p>
						Manual Red Hat Single Sign-On client registration is determined by the presence of a deployment file in the client application’s <span class="emphasis"><em>../configuration/</em></span> directory. These files are exported from the client adapter in the Red Hat Single Sign-On web console. The name of this file is different for OpenID-Connect and SAML clients:
					</p><div class="horizontal"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 15%; "/><col style="width: 85%; "/></colgroup><tbody valign="top"><tr><td valign="top">
									<p>
										<span class="strong strong"><strong>OpenID-Connect</strong></span>
									</p>
									</td><td valign="top">
									<p>
										<span class="emphasis"><em>../configuration/secure-deployments</em></span>
									</p>
									</td></tr><tr><td valign="top">
									<p>
										<span class="strong strong"><strong>SAML</strong></span>
									</p>
									</td><td valign="top">
									<p>
										<span class="emphasis"><em>../configuration/secure-saml-deployments</em></span>
									</p>
									</td></tr></tbody></table></div><p>
						These files are copied to the Red Hat Single Sign-On adapter configuration section in the <span class="emphasis"><em>standalone-openshift.xml</em></span> at when the application is deployed.
					</p><p>
						There are two methods for passing the Red Hat Single Sign-On adapter configuration to the client application:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Modify the deployment file to contain the Red Hat Single Sign-On adapter configuration so that it is included in the <span class="emphasis"><em>standalone-openshift.xml</em></span> file at deployment, or
							</li><li class="listitem">
								Manually include the OpenID-Connect <span class="emphasis"><em>keycloak.json</em></span> file, or the SAML <span class="emphasis"><em>keycloak-saml.xml</em></span> file in the client application’s <span class="strong strong"><strong>../WEB-INF</strong></span> directory.
							</li></ul></div><p>
						See <a class="link" href="#Example-EAP-Manual" title="5.6. Example Workflow: Manually Registering EAP Application in Red Hat Single Sign-On with SAML Client">Example Workflow: Manually Configure an Application to Use Red Hat Single Sign-On Authentication, Using SAML Client</a> for an end-to-end example of the manual Red Hat Single Sign-On client registration method using a SAML client.
					</p></section></section></section><section class="section" id="using_red_hat_single_sign_on_vault_with_openshift_secrets"><div class="titlepage"><div><div><h2 class="title">4.9. Using Red Hat Single Sign-On vault with OpenShift secrets</h2></div></div></div><p>
				Several fields in the Red Hat Single Sign-On administration support obtaining the value of a secret from an external vault, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/#_vault-administration">Server Administration Guide</a>. The following example shows how to set up the files plaintext vault in OpenShift and set it up to be used for obtaining an SMTP password.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Specify a directory for the vault using the <span class="strong strong"><strong><span class="emphasis"><em>SSO_VAULT_DIR</em></span></strong></span> environment variable. You can introduce the <span class="strong strong"><strong><span class="emphasis"><em>SSO_VAULT_DIR</em></span></strong></span> environment variable directly in the environment in your deployment configuration. It can also be included in the template by addding the following snippets at the appropriate places in the template:
					</p><pre class="programlisting language-json">"parameters": [
    ...
    {
        "displayName": "RH-SSO Vault Secret directory",
        "description": "Path to the RH-SSO Vault directory.",
        "name": "SSO_VAULT_DIR",
        "value": "",
        "required": false
    }
    ...
]

env: [
    ...
    {
        "name": "SSO_VAULT_DIR",
        "value": "${SSO_VAULT_DIR}"
    }
    ...
]</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The files plaintext vault provider will be configured only when you set <span class="strong strong"><strong><span class="emphasis"><em>SSO_VAULT_DIR</em></span></strong></span> environment variable.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Create a secret in your OpenShift cluster:
					</p><pre class="programlisting language-bash">$ oc create secret generic rhsso-vault-secrets --from-literal=master_smtp-password=mySMTPPsswd</pre></li><li class="listitem"><p class="simpara">
						Mount a volume to your deployment config using the <code class="literal">${SSO_VAULT_DIR}</code> as the path. For a deployment that is already running:
					</p><pre class="programlisting language-bash">oc set volume dc/sso --add --mount-path=${SSO_VAULT_DIR} --secret-name=rhsso-vault-secrets</pre></li><li class="listitem">
						After a pod is created you can use a customized string within your Red Hat Single Sign-On configuration to refer to the secret. For example, for using <code class="literal">mySMTPPsswd</code> secret created in this tutorial, you can use <code class="literal">${vault.smtp-password}</code> within the <code class="literal">master</code> realm in the configuration of the smtp password and it will be replaced by <code class="literal">mySMTPPsswd</code> when used.
					</li></ol></div></section><section class="section" id="limitations"><div class="titlepage"><div><div><h2 class="title">4.10. Limitations</h2></div></div></div><p>
				OpenShift does not currently accept OpenShift role mapping from external providers. If Red Hat Single Sign-On is used as an authentication gateway for OpenShift, users created in Red Hat Single Sign-On must have the roles added using the OpenShift Administrator <code class="literal">oc adm policy</code> command.
			</p><p>
				For example, to allow an Red Hat Single Sign-On-created user to view a project namespace in OpenShift:
			</p><pre class="programlisting language-bash">$ oc adm policy add-role-to-user view &lt;<span class="emphasis"><em>user-name</em></span>&gt; -n &lt;<span class="emphasis"><em>project-name</em></span>&gt;</pre></section></section><section class="chapter" id="tutorials"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Tutorials</h1></div></div></div><section class="section" id="upgrading-sso-db-from-previous-version"><div class="titlepage"><div><div><h2 class="title">5.1. Example Workflow: Updating Existing Database to Migrate to New Red Hat Single Sign-On for OpenShift Image Version</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Rolling updates from previous versions of Red Hat Single Sign-On for OpenShift to version 7.5.0 are not supported as databases and caches are not backward compatible.
						</li><li class="listitem">
							Stop all instances running some of previous versions of the Red Hat Single Sign-On for OpenShift before upgrading. They cannot run concurrently against the same database.
						</li><li class="listitem">
							Pre-generated scripts are not available, they are generated dynamically depending on the database.
						</li></ul></div></div></div><p>
				Red Hat Single Sign-On 7.5.0 can <a class="link" href="#automatic-db-migration" title="5.1.1. Automatic Database Migration">automatically migrate the database schema</a>, or you can choose to do it <a class="link" href="#manual-db-migration" title="5.1.2. Manual Database Migration">manually</a>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					By default the database is automatically migrated when you start Red Hat Single Sign-On 7.5.0 for the first time.
				</p></div></div><section class="section" id="automatic-db-migration"><div class="titlepage"><div><div><h3 class="title">5.1.1. Automatic Database Migration</h3></div></div></div><p>
					This process assumes that you are <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/red_hat_single_sign-on_for_openshift_on_eclipse_openj9/#Example-Deploying-SSO">running</a> some previous version of the Red Hat Single Sign-On for OpenShift image, backed by a PostgreSQL database (deployed in ephemeral or persistent mode), running in a separate pod.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image before upgrading to Red Hat Single Sign-On 7.5.0, as they cannot run concurrently against the same database.
					</p></div></div><p>
					Use the following steps to automatically migrate the database schema:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify the deployment config used to deploy the containers, running previous version of the Red Hat Single Sign-On for OpenShift image.
						</p><pre class="programlisting language-bash">$ oc get dc -o name --selector=application=sso
deploymentconfig/sso
deploymentconfig/sso-postgresql</pre></li><li class="listitem"><p class="simpara">
							Stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image in the current namespace.
						</p><pre class="programlisting language-bash">$ oc scale --replicas=0 dc/sso
deploymentconfig "sso" scaled</pre></li><li class="listitem"><p class="simpara">
							Update the image change trigger in the existing deployment config to reference the Red Hat Single Sign-On 7.5.0 image.
						</p><pre class="programlisting language-bash">$ oc patch dc/sso --type=json -p '[{"op": "replace", "path": "/spec/triggers/0/imageChangeParams/from/name", "value": "sso75-openj9-openshift-rhel8:7.5"}]'
"sso" patched</pre></li><li class="listitem"><p class="simpara">
							Start rollout of the new Red Hat Single Sign-On 7.5.0 images based on the latest image defined in the image change triggers.
						</p><pre class="programlisting language-bash">$ oc rollout latest dc/sso
deploymentconfig "sso" rolled out</pre></li><li class="listitem"><p class="simpara">
							Deploy Red Hat Single Sign-On 7.5.0 containers using the modified deployment config.
						</p><pre class="programlisting language-bash">$ oc scale --replicas=1 dc/sso
deploymentconfig "sso" scaled</pre></li><li class="listitem"><p class="simpara">
							(Optional) Verify the database has been successfully updated.
						</p><pre class="programlisting language-bash">$ oc get pods --selector=application=sso
NAME                     READY     STATUS    RESTARTS   AGE
sso-4-vg21r              1/1       Running   0          1h
sso-postgresql-1-t871r   1/1       Running   0          2h</pre><pre class="programlisting language-bash">$ oc logs sso-4-vg21r | grep 'Updating'
11:23:45,160 INFO  [org.keycloak.connections.jpa.updater.liquibase.LiquibaseJpaUpdaterProvider] (ServerService Thread Pool -- 58) Updating database. Using changelog META-INF/jpa-changelog-master.xml</pre></li></ol></div></section><section class="section" id="manual-db-migration"><div class="titlepage"><div><div><h3 class="title">5.1.2. Manual Database Migration</h3></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Pre-generated scripts are not available. They are generated dynamically depending on the database. With Red Hat Single Sign-On 7.5.0 one can generate and export these to an SQL file that can be manually applied to the database afterwards. To dynamically generate the SQL migration file for the database:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Configure Red Hat Single Sign-On 7.5.0 with the correct datasource,
							</li><li class="listitem"><p class="simpara">
								Set following configuration options in the <code class="literal">standalone-openshift.xml</code> file:
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										<code class="literal">initializeEmpty=false</code>,
									</li><li class="listitem">
										<code class="literal">migrationStrategy=manual</code>, and
									</li><li class="listitem">
										<code class="literal">migrationExport</code> to the location on the file system of the pod, where the output SQL migration file should be stored (e.g. <code class="literal">migrationExport="${jboss.home.dir}/keycloak-database-update.sql"</code>).
									</li></ol></div></li></ol></div><p>
						See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_installation_and_configuration_guide/database-1#database_configuration">database configuration of Red Hat Single Sign-On 7.5.0</a> for further details.
					</p><p>
						The database migration process handles the data schema update and performs manipulation of the data, therefore, stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image before dynamic generation of the SQL migration file.
					</p></div></div><p>
					This process assumes that you are <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/red_hat_single_sign-on_for_openshift_on_eclipse_openj9/#Example-Deploying-SSO">running</a> some previous version of the Red Hat Single Sign-On for OpenShift image, backed by a PostgreSQL database (deployed in ephemeral or persistent mode), running on a separate pod.
				</p><p>
					Perform the following to generate and get the SQL migration file for the database:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Prepare template of OpenShift <a class="link" href="https://docs.openshift.com/container-platform/latest/nodes/jobs/nodes-nodes-jobs.html">database migration job</a> to generate the SQL file.
						</p><pre class="programlisting language-yaml">$ cat job-to-migrate-db-to-sso75-openj9.yaml.orig
apiVersion: batch/v1
kind: Job
metadata:
  name: job-to-migrate-db-to-sso75-openj9
spec:
  autoSelector: true
  parallelism: 0
  completions: 1
  template:
    metadata:
      name: job-to-migrate-db-to-sso75-openj9
    spec:
      containers:
      - env:
        - name: DB_SERVICE_PREFIX_MAPPING
          value: &lt;&lt;DB_SERVICE_PREFIX_MAPPING_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_JNDI
          value: &lt;&lt;PREFIX_JNDI_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_USERNAME
          value: &lt;&lt;PREFIX_USERNAME_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_PASSWORD
          value: &lt;&lt;PREFIX_PASSWORD_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_DATABASE
          value: &lt;&lt;PREFIX_DATABASE_VALUE&gt;&gt;
        - name: TX_DATABASE_PREFIX_MAPPING
          value: &lt;&lt;TX_DATABASE_PREFIX_MAPPING_VALUE&gt;&gt;
        - name: &lt;&lt;SERVICE_HOST&gt;&gt;
          value: &lt;&lt;SERVICE_HOST_VALUE&gt;&gt;
        - name: &lt;&lt;SERVICE_PORT&gt;&gt;
          value: &lt;&lt;SERVICE_PORT_VALUE&gt;&gt;
        image: &lt;&lt;SSO_IMAGE_VALUE&gt;&gt;
        imagePullPolicy: Always
        name: job-to-migrate-db-to-sso75-openj9
        # Keep the pod running after the SQL migration
        # file was generated, so we can retrieve it
        command:
          - "/bin/bash"
          - "-c"
          - "/opt/eap/bin/openshift-launch.sh || sleep 600"
      restartPolicy: Never</pre><pre class="programlisting language-bash">$ cp job-to-migrate-db-to-sso75-openj9.yaml.orig \
     job-to-migrate-db-to-sso75-openj9.yaml</pre></li><li class="listitem"><p class="simpara">
							From deployment config used to run the previous version of the Red Hat Single Sign-On for OpenShift image, copy the datasource definition and database access credentials to appropriate places of the template of the database migration job.
						</p><p class="simpara">
							Use the following script to copy <code class="literal">DB_SERVICE_PREFIX_MAPPING</code> and <code class="literal">TX_DATABASE_PREFIX_MAPPING</code> variable values, together with values of environment variables specific to particular datasource (<code class="literal">&lt;PREFIX&gt;_JNDI</code>, <code class="literal">&lt;PREFIX&gt;_USERNAME</code>, <code class="literal">&lt;PREFIX&gt;_PASSWORD</code>, and <code class="literal">&lt;PREFIX&gt;_DATABASE</code>) from the deployment config named <code class="literal">sso</code> to the database job migration template named <code class="literal">job-to-migrate-db-to-sso75-openj9.yaml</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Although the <code class="literal">DB_SERVICE_PREFIX_MAPPING</code> environment variable allows a <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/red_hat_jboss_enterprise_application_platform_for_openshift/#datasources">comma-separated list of <span class="strong strong"><strong>&lt;name&gt;-&lt;database_type&gt;=&lt;PREFIX&gt;</strong></span> triplets</a> as its value, this example script accepts only one datasource triplet definition for demonstration purposes. You can modify the script for handling multiple datasource definition triplets.
							</p></div></div><pre class="programlisting language-bash">$ cat mirror_sso_dc_db_vars.sh
#!/bin/bash

# IMPORTANT:
#
# If the name of the SSO deployment config differs from 'sso'
# or if the file name of the YAML definition of the migration
# job is different, update the following two variables
SSO_DC_NAME="sso"
JOB_MIGRATION_YAML="job-to-migrate-db-to-sso75-openj9.yaml"

# Get existing variables of the $SSO_DC_NAME deployment config
# in an array
declare -a SSO_DC_VARS=( \
  $(oc set env dc/${SSO_DC_NAME} --list \
  | sed '/^#/d') \
)

# Get the PREFIX used in the names of environment variables
PREFIX=$( \
  grep -oP 'DB_SERVICE_PREFIX_MAPPING=[^ ]+' \
  &lt;&lt;&lt; "${SSO_DC_VARS[@]}" \
)
PREFIX=${PREFIX##*=}

# Substitute:
# * &lt;&lt;PREFIX&gt;&gt; with actual $PREFIX value and
# * &lt;&lt;PREFIX with "&lt;&lt;$PREFIX" value
# The order in which these replacements are made is important!
sed -i "s#&lt;&lt;PREFIX&gt;&gt;#${PREFIX}#g" ${JOB_MIGRATION_YAML}
sed -i "s#&lt;&lt;PREFIX#&lt;&lt;${PREFIX}#g" ${JOB_MIGRATION_YAML}

# Construct the array of environment variables
# specific to the datasource
declare -a DB_VARS=(JNDI USERNAME PASSWORD DATABASE)

# Prepend $PREFIX to each item of the datasource array
DB_VARS=( "${DB_VARS[@]/#/${PREFIX}_}" )

# Add DB_SERVICE_PREFIX_MAPPING and TX_DATABASE_PREFIX_MAPPING
# variables to datasource array
DB_VARS=( \
  "${DB_VARS[@]}" \
  DB_SERVICE_PREFIX_MAPPING \
  TX_DATABASE_PREFIX_MAPPING \
)

# Construct the SERVICE from DB_SERVICE_PREFIX_MAPPING
SERVICE=$( \
  grep -oP 'DB_SERVICE_PREFIX_MAPPING=[^ ]' \
  &lt;&lt;&lt; "${SSO_DC_VARS[@]}" \
)
SERVICE=${SERVICE#*=}
SERVICE=${SERVICE%=*}
SERVICE=${SERVICE^^}
SERVICE=${SERVICE//-/_}

# If the deployment config contains &lt;&lt;SERVICE&gt;&gt;_SERVICE_HOST
# and &lt;&lt;SERVICE&gt;&gt;_SERVICE_PORT variables, add them to the
# datasource array. Their values also need to be propagated into
# yaml definition of the migration job.
HOST_PATTERN="${SERVICE}_SERVICE_HOST=[^ ]"
PORT_PATTERN="${SERVICE}_SERVICE_PORT=[^ ]"
if
  grep -Pq "${HOST_PATTERN}" &lt;&lt;&lt; "${SSO_DC_VARS[@]}" &amp;&amp;
  grep -Pq "${PORT_PATTERN}" &lt;&lt;&lt; "${SSO_DC_VARS[@]}"
then
  DB_VARS=( \
    "${DB_VARS[@]}" \
    "${SERVICE}_SERVICE_HOST" \
    "${SERVICE}_SERVICE_PORT" \
  )
# If they are not defined, delete their placeholder rows in
# yaml definition file (since if not defined they are not
# expanded which make the yaml definition invalid).
else
  for KEY in "HOST" "PORT"
  do
    sed -i "/SERVICE_${KEY}/d" ${JOB_MIGRATION_YAML}
  done
fi

# Substitute:
# * &lt;&lt;SERVICE_HOST&gt;&gt; with ${SERVICE}_SERVICE_HOST and
# * &lt;&lt;SERVICE_HOST_VALUE&gt;&gt; with &lt;&lt;${SERVICE}_SERVICE_HOST_VALUE&gt;&gt;
# The order in which replacements are made is important!
# Do this for both "HOST" and "PORT"
for KEY in "HOST" "PORT"
do
  PATTERN_1="&lt;&lt;SERVICE_${KEY}&gt;&gt;"
  REPL_1="${SERVICE}_SERVICE_${KEY}"
  sed -i "s#${PATTERN_1}#${REPL_1}#g" ${JOB_MIGRATION_YAML}
  PATTERN_2="&lt;&lt;SERVICE_${KEY}_VALUE&gt;&gt;"
  REPL_2="&lt;&lt;${SERVICE}_SERVICE_${KEY}_VALUE&gt;&gt;"
  sed -i "s#${PATTERN_2}#${REPL_2}#g" ${JOB_MIGRATION_YAML}
done

# Propagate the values of the datasource array items into
# yaml definition of the migration job
for VAR in "${SSO_DC_VARS[@]}"
do
  IFS=$'=' read KEY VALUE &lt;&lt;&lt; $VAR
  if grep -q $KEY &lt;&lt;&lt; ${DB_VARS[@]}
  then
    KEY+="_VALUE"
    # Enwrap integer port value with double quotes
    if [[ ${KEY} =~ ${SERVICE}_SERVICE_PORT_VALUE ]]
    then
      sed -i "s#&lt;&lt;${KEY}&gt;&gt;#\"${VALUE}\"#g" ${JOB_MIGRATION_YAML}
    # Character values do not need quotes
    else
      sed -i "s#&lt;&lt;${KEY}&gt;&gt;#${VALUE}#g" ${JOB_MIGRATION_YAML}
    fi
    # Verify that the value has been successfully propagated.
    if
      grep -q '(JNDI|USERNAME|PASSWORD|DATABASE)' &lt;&lt;&lt; "${KEY}" &amp;&amp;
      grep -q "&lt;&lt;PREFIX${KEY#${PREFIX}}" ${JOB_MIGRATION_YAML} ||
      grep -q "&lt;&lt;${KEY}&gt;&gt;" ${JOB_MIGRATION_YAML}
    then
      echo "Failed to update value of ${KEY%_VALUE}! Aborting."
      exit 1
    else
      printf '%-60s%-40s\n' \
             "Successfully updated ${KEY%_VALUE} to:" \
             "$VALUE"
    fi
  fi
done</pre><p id="get-db-credentials" class="simpara">
							Run the script.
						</p><pre class="programlisting language-bash">$ chmod +x ./mirror_sso_dc_db_vars.sh
$ ./mirror_sso_dc_db_vars.sh
Successfully updated DB_SERVICE_PREFIX_MAPPING to:          sso-postgresql=DB
Successfully updated DB_JNDI to:                            java:jboss/datasources/KeycloakDS
Successfully updated DB_USERNAME to:                        userxOp
Successfully updated DB_PASSWORD to:                        tsWNhQHK
Successfully updated DB_DATABASE to:                        root
Successfully updated TX_DATABASE_PREFIX_MAPPING to:         sso-postgresql=DB</pre></li><li class="listitem"><p class="simpara">
							Build the Red Hat Single Sign-On 7.5.0 database migration image using the <a class="link" href="https://github.com/iankko/openshift-examples/tree/KEYCLOAK-8500/sso-manual-db-migration">pre-configured source</a> and wait for the build to finish.
						</p><pre class="programlisting language-bash">$ oc get is -n openshift | grep sso75-openj9 | cut -d ' ' -f1
sso75-openj9-openshift-rhel8</pre><pre class="programlisting language-bash">$ oc new-build sso75-openj9-openshift-rhel8:7.5~https://github.com/iankko/openshift-examples.git#KEYCLOAK-8500 \
  --context-dir=sso-manual-db-migration \
  --name=sso75-openj9-db-migration-image
--&gt; Found image bf45ac2 (7 days old) in image stream "openshift/sso75-openj9-openshift-rhel8" under tag "7.5" for "sso75-openj9-openshift-rhel8:7.5"

    Red Hat SSO 7.5.0
    ---------------
    Platform for running Red Hat SSO

    Tags: sso, sso7, keycloak

    * A source build using source code from https://github.com/iankko/openshift-examples.git#KEYCLOAK-8500 will be created
      * The resulting image will be pushed to image stream "sso75-openj9-db-migration-image:latest"
      * Use 'start-build' to trigger a new build

--&gt; Creating resources with label build=sso75-openj9-db-migration-image ...
    imagestream "sso75-openj9-db-migration-image" created
    buildconfig "sso75-openj9-db-migration-image" created
--&gt; Success
    Build configuration "sso75-openj9-db-migration-image" created and build triggered.
    Run 'oc logs -f bc/sso75-openj9-db-migration-image' to stream the build progress.</pre><pre class="programlisting language-bash">$ oc logs -f bc/sso75-openj9-db-migration-image --follow
Cloning "https://github.com/iankko/openshift-examples.git#KEYCLOAK-8500" ...
...
Push successful</pre></li><li class="listitem"><p class="simpara">
							Update the template of the database migration job (<code class="literal">job-to-migrate-db-to-sso75-openj9.yaml</code>) with reference to the built <code class="literal">sso75-openj9-db-migration-image</code> image.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Get the docker pull reference for the image.
								</p><pre class="programlisting language-bash">$ PULL_REF=$(oc get istag -n $(oc project -q) --no-headers | grep sso75-openj9-db-migration-image | tr -s ' ' | cut -d ' ' -f 2)</pre></li><li class="listitem"><p class="simpara">
									Replace the &lt;&lt;SSO_IMAGE_VALUE&gt;&gt; field in the job template with the pull specification.
								</p><pre class="programlisting language-bash">$ sed -i "s#&lt;&lt;SSO_IMAGE_VALUE&gt;&gt;#$PULL_REF#g" job-to-migrate-db-to-sso75-openj9.yaml</pre></li><li class="listitem">
									Verify that the field is updated.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Instantiate database migration job from the job template.
						</p><pre class="programlisting language-bash">$ oc create -f job-to-migrate-db-to-sso75-openj9.yaml
job "job-to-migrate-db-to-sso75-openj9" created</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								The database migration process handles the data schema update and performs manipulation of the data, therefore, stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image before dynamic generation of the SQL migration file.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Identify the deployment config used to deploy the containers, running previous version of the Red Hat Single Sign-On for OpenShift image.
						</p><pre class="programlisting language-bash">$ oc get dc -o name --selector=application=sso
deploymentconfig/sso
deploymentconfig/sso-postgresql</pre></li><li class="listitem"><p class="simpara">
							Stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image in the current namespace.
						</p><pre class="programlisting language-bash">$ oc scale --replicas=0 dc/sso
deploymentconfig "sso" scaled</pre></li><li class="listitem"><p class="simpara">
							Run the database migration job and wait for the pod to be running correctly.
						</p><pre class="programlisting language-bash">$ oc get jobs
NAME                            DESIRED   SUCCESSFUL   AGE
job-to-migrate-db-to-sso75-openj9   1         0            3m</pre><pre class="programlisting language-bash">$ oc scale --replicas=1 job/job-to-migrate-db-to-sso75-openj9
job "job-to-migrate-db-to-sso75-openj9" scaled</pre><pre class="programlisting language-bash">$ oc get pods
NAME                                  READY     STATUS      RESTARTS   AGE
sso-postgresql-1-n5p16                1/1       Running     1          19h
job-to-migrate-db-to-sso75-openj9-b87bb   1/1       Running     0          1m
sso75-openj9-db-migration-image-1-build      0/1       Completed   0          27m</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								By default, the database migration job terminates automatically after <code class="literal">600 seconds</code> after the migration file is generated. You can adjust this time period.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Get the dynamically generated SQL database migration file from the pod.
						</p><pre class="programlisting language-bash">$ mkdir -p ./db-update
$ oc rsync job-to-migrate-db-to-sso75-openj9-b87bb:/opt/eap/keycloak-database-update.sql ./db-update
receiving incremental file list
keycloak-database-update.sql

sent 30 bytes  received 29,726 bytes  59,512.00 bytes/sec
total size is 29,621  speedup is 1.00</pre></li><li class="listitem">
							Inspect the <code class="literal">keycloak-database-update.sql</code> file for changes to be performed within manual database update to Red Hat Single Sign-On 7.5.0 version.
						</li><li class="listitem"><p class="simpara">
							Apply the database update manually.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									Run the following commands if running some previous version of the Red Hat Single Sign-On for OpenShift image, backed by the PostgreSQL database deployed in ephemeral or persistent mode, running on a separate pod:
								</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p class="simpara">
											Copy the generated SQL migration file to the PostgreSQL pod.
										</p><pre class="programlisting language-bash">$ oc rsync --no-perms=true ./db-update/ sso-postgresql-1-n5p16:/tmp
sending incremental file list

sent 77 bytes  received 11 bytes  176.00 bytes/sec
total size is 26,333  speedup is 299.24</pre></li><li class="listitem"><p class="simpara">
											Start a shell session to the PostgreSQL pod.
										</p><pre class="programlisting language-bash">$ oc rsh sso-postgresql-1-n5p16
sh-4.2$</pre></li><li class="listitem"><p class="simpara">
											Use the <code class="literal">psql</code> tool to apply database update manually.
										</p><pre class="programlisting language-bash">sh-4.2$ alias psql="/opt/rh/rh-postgresql95/root/bin/psql"
sh-4.2$ psql --version
psql (PostgreSQL) 9.5.4
sh-4.2$ psql -U &lt;PREFIX&gt;_USERNAME -d &lt;PREFIX&gt;_DATABASE -W -f /tmp/keycloak-database-update.sql
Password for user &lt;PREFIX&gt;_USERNAME:
INSERT 0 1
INSERT 0 1
...</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
												Replace <code class="literal">&lt;PREFIX&gt;_USERNAME</code> and <code class="literal">&lt;PREFIX&gt;_DATABASE</code> with the actual database credentials retrieved <a class="link" href="#get-db-credentials">in previous section</a>. Also use value of <code class="literal">&lt;PREFIX&gt;_PASSWORD</code> as the password for the database, when prompted.
											</p></div></div></li><li class="listitem">
											Close the shell session to the PostgreSQL pod. Continue with <a class="link" href="#image-change-trigger-update-step">updating image change trigger step</a>.
										</li></ol></div></li></ul></div></li></ol></div><div class="orderedlist" id="image-change-trigger-update-step"><ol class="orderedlist" start="12" type="1"><li class="listitem"><p class="simpara">
							Update the image change trigger in the existing deployment config to reference the Red Hat Single Sign-On 7.5.0 image.
						</p><pre class="programlisting language-bash">$ oc patch dc/sso --type=json -p '[{"op": "replace", "path": "/spec/triggers/0/imageChangeParams/from/name", "value": "sso75-openj9-openshift-rhel8:7.5"}]'
"sso" patched</pre></li><li class="listitem"><p class="simpara">
							Start rollout of the new Red Hat Single Sign-On 7.5.0 images based on the latest image defined in the image change triggers.
						</p><pre class="programlisting language-bash">$ oc rollout latest dc/sso
deploymentconfig "sso" rolled out</pre></li><li class="listitem"><p class="simpara">
							Deploy the Red Hat Single Sign-On 7.5.0 containers using the modified deployment config.
						</p><pre class="programlisting language-bash">$ oc scale --replicas=1 dc/sso
deploymentconfig "sso" scaled</pre></li></ol></div></section></section><section class="section" id="example_workflow_migrating_the_red_hat_single_sign_on_server_s_database_across_environments"><div class="titlepage"><div><div><h2 class="title">5.2. Example Workflow: Migrating The Red Hat Single Sign-On Server’s Database Across Environments</h2></div></div></div><p>
				This tutorial focuses on migrating the Red Hat Single Sign-On server database from one environment to another or migrating to a different database. It assumes steps described in <a class="link" href="#Preparing-SSO-Authentication-for-OpenShift-Deployment" title="3.2.1. Preparing the Deployment">Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</a> section have been performed already.
			</p><section class="section" id="deploying_the_red_hat_single_sign_on_postgresql_application_template"><div class="titlepage"><div><div><h3 class="title">5.2.1. Deploying the Red Hat Single Sign-On PostgreSQL Application Template</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the OpenShift web console and select the <span class="emphasis"><em>sso-app-demo</em></span> project space.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add to project</strong></span> to list the default image streams and templates.
						</li><li class="listitem">
							Use the <span class="strong strong"><strong>Filter by keyword</strong></span> search bar to limit the list to those that match <span class="emphasis"><em>sso</em></span>. You may need to click <span class="strong strong"><strong>See all</strong></span> to show the desired application template.
						</li><li class="listitem"><p class="simpara">
							Select <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span> Red Hat Single Sign-On application template. When deploying the template ensure to <span class="strong strong"><strong>keep the <span class="emphasis"><em>SSO_REALM</em></span> variable unset</strong></span> (default value).
						</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								Export and import of Red Hat Single Sign-On 7.5.0 database <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#export_import">is triggered at Red Hat Single Sign-On server boot time and its paramaters are passed in via Java system properties.</a> This means during one Red Hat Single Sign-On server boot only one of the possible migration actions (either <span class="strong strong"><strong><span class="emphasis"><em>export</em></span></strong></span>, or <span class="strong strong"><strong><span class="emphasis"><em>import</em></span></strong></span>) can be performed.
							</p></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
								When the <span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span> configuration variable is set on the Red Hat Single Sign-On for OpenShift image, a database import is performed in order to create the Red Hat Single Sign-On server realm requested in the variable. For the database export to be performed correctly, the <span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span> configuration variable cannot be simultaneously defined on such image.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Create</strong></span> to deploy the application template and start pod deployment. This may take a couple of minutes.
						</p><p class="simpara">
							Then access the Red Hat Single Sign-On web console at <span class="strong strong"><strong>https://secure-sso-<span class="emphasis"><em>&lt;sso-app-demo&gt;</em></span>.<span class="emphasis"><em>&lt;openshift32.example.com&gt;</em></span>/auth/admin</strong></span> using the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">administrator account</a>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								This example workflow uses a self-generated CA to provide an end-to-end workflow for demonstration purposes. Accessing the Red Hat Single Sign-On web console will prompt an insecure connection warning.<br/> For production environments, Red Hat recommends that you use an SSL certificate purchased from a verified Certificate Authority.
							</p></div></div></li></ol></div></section><section class="section" id="optional_creating_additional_red_hat_single_sign_on_link_xl_href_https_access_redhat_com_documentation_en_us_red_hat_single_sign_on_7_2_html_single_server_administration_guide_core_concepts_and_terms_realm_and_users_link_to_be_also_exported"><div class="titlepage"><div><div><h3 class="title">5.2.2. (Optional) Creating additional Red Hat Single Sign-On <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#core_concepts_and_terms">realm and users</a> to be also exported</h3></div></div></div><p>
					When performing <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#export_import">Red Hat Single Sign-On 7.5.0 server database export</a> only Red Hat Single Sign-On realms and users currently present in the database will be exported. If the exported JSON file should include also additional Red Hat Single Sign-On realms and users, these need to be created first:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#create-realm">Create a new realm</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#create-new-user">Create new users</a>
						</li></ol></div><p>
					Upon their creation <a class="link" href="#sso-export-the-database" title="5.2.3. Export the Red Hat Single Sign-On database as a JSON file on the OpenShift pod">the database can be exported.</a>
				</p></section><section class="section" id="sso-export-the-database"><div class="titlepage"><div><div><h3 class="title">5.2.3. Export the Red Hat Single Sign-On database as a JSON file on the OpenShift pod</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Get the Red Hat Single Sign-On deployment config and scale it down to zero.
						</p><pre class="programlisting language-bash">$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-postgresql

$ oc scale --replicas=0 dc sso
deploymentconfig "sso" scaled</pre></li><li class="listitem"><p class="simpara">
							Instruct the Red Hat Single Sign-On 7.5.0 server deployed on Red Hat Single Sign-On for OpenShift image to perform database export at Red Hat Single Sign-On server boot time.
						</p><pre class="programlisting language-bash">$ oc set env dc/sso \
  -e "JAVA_OPTS_APPEND= \
    -Dkeycloak.migration.action=export \
    -Dkeycloak.migration.provider=singleFile \
    -Dkeycloak.migration.file=/tmp/demorealm-export.json"</pre></li><li class="listitem"><p class="simpara">
							Scale the Red Hat Single Sign-On deployment config back up. This will start the Red Hat Single Sign-On server and export its database.
						</p><pre class="programlisting language-bash">$ oc scale --replicas=1 dc sso
deploymentconfig "sso" scaled</pre></li><li class="listitem"><p class="simpara">
							(Optional) Verify that the export was successful.
						</p><pre class="programlisting language-bash">$ oc get pods
NAME                     READY     STATUS    RESTARTS   AGE
sso-4-ejr0k              1/1       Running   0          27m
sso-postgresql-1-ozzl0   1/1       Running   0          4h

$ oc logs sso-4-ejr0k | grep 'Export'
09:24:59,503 INFO  [org.keycloak.exportimport.singlefile.SingleFileExportProvider] (ServerService Thread Pool -- 57) Exporting model into file /tmp/demorealm-export.json
09:24:59,998 INFO  [org.keycloak.services] (ServerService Thread Pool -- 57) KC-SERVICES0035: Export finished successfully</pre></li></ol></div></section><section class="section" id="retrieve_and_import_the_exported_json_file"><div class="titlepage"><div><div><h3 class="title">5.2.4. Retrieve and import the exported JSON file</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Retrieve the JSON file of the Red Hat Single Sign-On database from the pod.
						</p><pre class="programlisting language-bash">$ oc get pods
NAME                     READY     STATUS    RESTARTS   AGE
sso-4-ejr0k              1/1       Running   0          2m
sso-postgresql-1-ozzl0   1/1       Running   0          4h

$ oc rsync sso-4-ejr0k:/tmp/demorealm-export.json .</pre></li><li class="listitem"><p class="simpara">
							(Optional) Import the JSON file of the Red Hat Single Sign-On database into an Red Hat Single Sign-On server running in another environment.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								For importing into an Red Hat Single Sign-On server not running on OpenShift, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/export_import">Export and Import section</a> of the RH SSO Server Administration Guide.
							</p></div></div><p class="simpara">
							Use the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#admin_console_export_import">administration console</a> of the Red Hat Single Sign-On server to import the resources from previously exported JSON file into the Red Hat Single Sign-On server’s database, when the Red Hat Single Sign-On server is running as a Red Hat Single Sign-On 7.5.0 container on OpenShift:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Log into the <code class="literal">master</code> realm’s administration console of the Red Hat Single Sign-On server using the credentials used to create the administrator user. In the browser, navigate to <span class="strong strong"><strong>http://sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong></span> for the Red Hat Single Sign-On web server, or to <span class="strong strong"><strong>https://secure-sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong></span> for the encrypted Red Hat Single Sign-On web server.
								</li><li class="listitem">
									At the top of the sidebar choose the name of the Red Hat Single Sign-On realm, the users, clients, realm roles, and client roles should be imported to. This example uses <code class="literal">master</code> realm.
								</li><li class="listitem">
									Click the <span class="strong strong"><strong>Import</strong></span> link under <span class="strong strong"><strong>Manage</strong></span> section at the bottom of the sidebar.
								</li><li class="listitem">
									In the page that opens, click <span class="strong strong"><strong>Select file</strong></span> and then specify the location of the exported <code class="literal">demorealm-export.json</code> JSON file on the local file system.
								</li><li class="listitem">
									From the <span class="strong strong"><strong>Import from realm</strong></span> drop-down menu, select the name of the Red Hat Single Sign-On realm from which the data should be imported. This example uses <code class="literal">master</code> realm.
								</li><li class="listitem">
									Choose which of users, clients, realm roles, and client roles should be imported (all of them are imported by default).
								</li><li class="listitem"><p class="simpara">
									Choose a strategy to perform, when a resource already exists (one of <span class="strong strong"><strong>Fail</strong></span>, <span class="strong strong"><strong>Skip</strong></span>, or <span class="strong strong"><strong>Overwrite</strong></span>).
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										The attempt to import an object (user, client, realm role, or client role) fails if object with the same identifier already exists in the current database. Use <span class="strong strong"><strong>Skip</strong></span> strategy to import the objects that are present in the <code class="literal">demorealm-export.json</code> file, but do not exist in current database.
									</p></div></div></li><li class="listitem"><p class="simpara">
									Click <span class="strong strong"><strong>Import</strong></span> to perform the import.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										When importing objects from a non-master realm to <code class="literal">master</code> realm or vice versa, after clicking the <span class="strong strong"><strong>Import</strong></span> button, it is sometimes possible to encounter an error like the following one:
									</p><p id="realm-import-error-message" class="text-center text-center">
										<span class="inlinemediaobject"><img src="images/import_realm_error.png" alt="Example of Possible Error Message when Performing Partial Import from Previously Exported JSON File"/></span>
									</p><p>
										In such cases, it is necessary first to create the missing clients, having the <span class="strong strong"><strong>Access Type</strong></span> set to <span class="strong strong"><strong>bearer-only</strong></span>. These clients can be created by manual copy of their characteristics from the source Red Hat Single Sign-On server, on which the export JSON file was created, to the target Red Hat Single Sign-On server, where the JSON file is imported. After creation of the necessary clients, click the <span class="strong strong"><strong>Import</strong></span> button again.
									</p><p>
										To suppress the <a class="link" href="#realm-import-error-message">above</a> error message, it is needed to create the missing <code class="literal">realm-management</code> client, of the <span class="strong strong"><strong>bearer-only</strong></span> <span class="strong strong"><strong>Access Type</strong></span>, and click the <span class="strong strong"><strong>Import</strong></span> button again.
									</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										For <span class="strong strong"><strong>Skip</strong></span> import strategy, the newly added objects are marked as <span class="strong strong"><strong>ADDED</strong></span> and the object which were skipped are marked as <span class="strong strong"><strong>SKIPPED</strong></span>, in the <span class="strong strong"><strong>Action</strong></span> column on the import result page.
									</p></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
										The administration console import allows you to <span class="strong strong"><strong>overwrite</strong></span> resources if you choose (<span class="strong strong"><strong>Overwrite</strong></span> strategy). On a production system use this feature with caution.
									</p></div></div></li></ol></div></li></ol></div></section></section><section class="section" id="OSE-SSO-AUTH-TUTE"><div class="titlepage"><div><div><h2 class="title">5.3. Example Workflow: Configuring OpenShift 3.11 to use Red Hat Single Sign-On for Authentication</h2></div></div></div><p>
				Configure OpenShift 3.11 to use the Red Hat Single Sign-On deployment as the authorization gateway for OpenShift. This follows on from <a class="link" href="#Example-Deploying-SSO" title="3.2. Deploying the Red Hat Single Sign-On Image">Example Workflow: Preparing and Deploying the Red Hat Single Sign-On for OpenShift image</a>, in which Red Hat Single Sign-On was deployed on OpenShift.
			</p><p>
				This example adds Red Hat Single Sign-On as an authentication method alongside <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/understanding-identity-provider.html">the identity providers</a> configured during <a class="link" href="https://docs.openshift.com/container-platform/latest/architecture/architecture-installation.html">the installation of the OpenShift Container Platform cluster</a>. Once configured, the Red Hat Single Sign-On method will be also available (together with the configured identity providers) for the user login to your OpenShift web console.
			</p><section class="section" id="configuring_red_hat_single_sign_on_credentials"><div class="titlepage"><div><div><h3 class="title">5.3.1. Configuring Red Hat Single Sign-On Credentials</h3></div></div></div><p>
					Log in to the encrypted Red Hat Single Sign-On web server at <span class="strong strong"><strong>https://secure-sso-<span class="emphasis"><em>sso-app-demo</em></span>.<span class="emphasis"><em>openshift32.example.com</em></span>/auth/admin</strong></span> using the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">administrator account</a> created during the Red Hat Single Sign-On deployment.
				</p><p>
					<span class="strong strong"><strong>Create a Realm</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Hover your cursor over the realm namespace (default is <span class="strong strong"><strong>Master</strong></span>) at the top of the sidebar and click <span class="strong strong"><strong>Add Realm</strong></span>.
						</li><li class="listitem">
							Enter a realm name (this example uses <span class="emphasis"><em>OpenShift</em></span>) and click <span class="strong strong"><strong>Create</strong></span>.
						</li></ol></div><p>
					<span class="strong strong"><strong>Create a User</strong></span>
				</p><p>
					Create a test user that can be used to demonstrate the Red Hat Single Sign-On-enabled OpenShift login:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the realm.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add User</strong></span>.
						</li><li class="listitem">
							Enter a valid <span class="strong strong"><strong>Username</strong></span> (this example uses <span class="emphasis"><em>testuser</em></span>) and any additional optional information and click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Edit the user configuration:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click the <span class="strong strong"><strong>Credentials</strong></span> tab in the user space and enter a password for the user.
								</li><li class="listitem">
									Ensure the <span class="strong strong"><strong>Temporary Password</strong></span> option is set to <span class="strong strong"><strong>Off</strong></span> so that it does not prompt for a password change later on, and click <span class="strong strong"><strong>Reset Password</strong></span> to set the user password. A pop-up window prompts for additional confirmation.
								</li></ol></div></li></ol></div><p>
					<span class="strong strong"><strong>Create and Configure an OpenID-Connect Client</strong></span>
				</p><p>
					See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#clients">Managing Clients</a> chapter of the Red Hat Single Sign-On Server Administration Guide for more information.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Clients</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar and click <span class="strong strong"><strong>Create</strong></span>.
						</li><li class="listitem">
							Enter the <span class="strong strong"><strong>Client ID</strong></span>. This example uses <span class="emphasis"><em>openshift-demo</em></span>.
						</li><li class="listitem">
							Select a <span class="strong strong"><strong>Client Protocol</strong></span> from the drop-down menu (this example uses <span class="strong strong"><strong>openid-connect</strong></span>) and click <span class="strong strong"><strong>Save</strong></span>. You will be taken to the configuration <span class="strong strong"><strong>Settings</strong></span> page of the <span class="emphasis"><em>openshift-demo</em></span> client.
						</li><li class="listitem">
							From the <span class="strong strong"><strong>Access Type</strong></span> drop-down menu, select <span class="strong strong"><strong>confidential</strong></span>. This is the access type for server-side applications.
						</li><li class="listitem">
							In the <span class="strong strong"><strong>Valid Redirect URIs</strong></span> dialog, enter the URI for the OpenShift web console, which is <span class="emphasis"><em>https://openshift.example.com:8443/*</em></span> in this example.
						</li></ol></div><p>
					The client <span class="strong strong"><strong>Secret</strong></span> is needed to configure OpenID-Connect on the OpenShift master in the next section. You can copy it now from under the <span class="strong strong"><strong>Credentials</strong></span> tab. The secret is &lt;<span class="emphasis"><em>7b0384a2-b832-16c5-9d73-2957842e89h7</em></span>&gt; for this example.
				</p></section><section class="section" id="configuring_openshift_master_for_red_hat_single_sign_on_authentication"><div class="titlepage"><div><div><h3 class="title">5.3.2. Configuring OpenShift Master for Red Hat Single Sign-On Authentication</h3></div></div></div><p>
					Log in to the OpenShift master CLI. You must have the required permissions to edit the <span class="strong strong"><strong>/etc/origin/master/master-config.yaml</strong></span> file.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Edit the <span class="strong strong"><strong>/etc/origin/master/master-config.yaml</strong></span> file and find the <span class="strong strong"><strong>identityProviders</strong></span>. For example, in the case the OpenShift master is configured with the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/identity_providers/configuring-htpasswd-identity-provider.html">HTPassword identity provider</a>, the <span class="strong strong"><strong>identityProviders</strong></span> section will look similar to the following one:
						</p><pre class="programlisting language-bash">identityProviders:
- challenge: true
  login: true
  name: htpasswd_auth
  provider:
    apiVersion: v1
    file: /etc/origin/openshift-passwd
    kind: HTPasswdPasswordIdentityProvider</pre><p class="simpara">
							Add Red Hat Single Sign-On as a secondary identity provider with content similar to the following snippet:
						</p><pre class="programlisting language-bash">- name: rh_sso
  challenge: false
  login: true
  mappingMethod: add
  provider:
    apiVersion: v1
    kind: OpenIDIdentityProvider
    clientID: <span class="emphasis"><em>openshift-demo</em></span>
    clientSecret: <span class="emphasis"><em>7b0384a2-b832-16c5-9d73-2957842e89h7</em></span>
    <span class="emphasis"><em>ca: xpaas.crt</em></span>
    urls:
      authorize: <span class="emphasis"><em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/auth</em></span>
      token: <span class="emphasis"><em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/token</em></span>
      userInfo: <span class="emphasis"><em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/userinfo</em></span>
    claims:
      id:
      - sub
      preferredUsername:
      - preferred_username
      name:
      - name
      email:
      - email</pre><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									The Red Hat Single Sign-On <span class="strong strong"><strong>Secret</strong></span> hash for the <span class="strong strong"><strong>clientSecret</strong></span> can be found in the Red Hat Single Sign-On web console: <span class="strong strong"><strong>Clients</strong></span> → <span class="strong strong"><strong><span class="emphasis"><em>openshift-demo</em></span></strong></span> → <span class="strong strong"><strong>Credentials</strong></span>
								</li><li class="listitem"><p class="simpara">
									The endpoints for the <span class="strong strong"><strong>urls</strong></span> can be found by making a request with the Red Hat Single Sign-On application. For example:
								</p><pre class="programlisting language-bash">&lt;<span class="emphasis"><em>curl -k https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/.well-known/openid-configuration | python -m json.tool</em></span>&gt;</pre><p class="simpara">
									The response includes the <span class="strong strong"><strong>authorization_endpoint</strong></span>, <span class="strong strong"><strong>token_endpoint</strong></span>, and <span class="strong strong"><strong>userinfo_endpoint</strong></span>.
								</p></li><li class="listitem">
									This example workflow uses a self-generated CA to provide an end-to-end workflow for demonstration purposes. For this reason, the <span class="strong strong"><strong>ca</strong></span> is provided as &lt;<span class="emphasis"><em>ca: xpaas.crt</em></span>&gt;. This CA certificate must also be copied into the <span class="strong strong"><strong>/etc/origin/master</strong></span> folder. This is not necessary if using a certificate purchased from a verified Certificate Authority.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Save the configuration and restart the OpenShift master:
						</p><pre class="programlisting language-bash">$ systemctl restart atomic-openshift-master</pre></li></ol></div></section><section class="section" id="logging_in_to_openshift"><div class="titlepage"><div><div><h3 class="title">5.3.3. Logging in to OpenShift</h3></div></div></div><p>
					Navigate to the OpenShift web console, which in this example is <span class="emphasis"><em><a class="link" href="https://openshift.example.com:8443/console">https://openshift.example.com:8443/console</a></em></span>. The OpenShift login page now has the option to use either <span class="strong strong"><strong>htpasswd_auth</strong></span> or <span class="strong strong"><strong>rh-sso</strong></span>. The former is still available because it is present in the <span class="strong strong"><strong>/etc/origin/master/master-config.yaml</strong></span>.
				</p><p>
					Select <span class="strong strong"><strong>rh-sso</strong></span> and log in to OpenShift with the <span class="emphasis"><em>testuser</em></span> user created earlier in Red Hat Single Sign-On. No projects are visible to <span class="emphasis"><em>testuser</em></span> until they are added in the OpenShift CLI. This is the only way to provide user privileges in OpenShift because it currently does not accept external role mapping.
				</p><p>
					To provide <span class="emphasis"><em>testuser</em></span> <code class="literal">view</code> privileges for the <span class="emphasis"><em>sso-app-demo</em></span>, use the OpenShift CLI:
				</p><pre class="programlisting language-bash">$ oc adm policy add-role-to-user view testuser -n sso-app-demo</pre></section></section><section class="section" id="binary-builds"><div class="titlepage"><div><div><h2 class="title">5.4. Example Workflow: Creating OpenShift Application from Existing Maven Binaries and Securing it Using Red Hat Single Sign-On</h2></div></div></div><p>
				To deploy existing applications on OpenShift, you can use the <a class="link" href="https://docs.openshift.com/container-platform/latest/builds/creating-build-inputs.html#builds-binary-source_creating-build-inputs">binary source</a> capability.
			</p><section class="section" id="deploy_binary_build_of_eap_6_4_7_1_jsp_service_invocation_application_and_secure_it_using_red_hat_single_sign_on"><div class="titlepage"><div><div><h3 class="title">5.4.1. Deploy Binary Build of EAP 6.4 / 7.1 JSP Service Invocation Application and Secure it Using Red Hat Single Sign-On</h3></div></div></div><p>
					The following example uses both <a class="link" href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> and <a class="link" href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstarts to deploy EAP 6.4 / 7.1 JSP service application that authenticates using the Red Hat Single Sign-On.
				</p><p>
					<span class="strong strong"><strong>Prerequisite:</strong></span>
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						This guide assumes the Red Hat Single Sign-On for OpenShift image has been previously <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/red_hat_single_sign-on_for_openshift_on_eclipse_openj9/#Example-Deploying-SSO">deployed using one of the following templates:</a>
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span>
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span>
							</li></ul></div></div></div><section class="section" id="create_red_hat_single_sign_on_realm_roles_and_user_for_the_eap_6_4_7_1_jsp_application"><div class="titlepage"><div><div><h4 class="title">5.4.1.1. Create Red Hat Single Sign-On Realm, Roles, and User for the EAP 6.4 / 7.1 JSP Application</h4></div></div></div><p>
						The EAP 6.4 / 7.1 JSP service application requires dedicated Red Hat Single Sign-On realm, username, and password to be able to authenticate using Red Hat Single Sign-On. Perform the following steps after the Red Hat Single Sign-On for OpenShift image has been deployed:
					</p><p>
						<span class="strong strong"><strong>Create the Red Hat Single Sign-On Realm</strong></span>
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Login to the administration console of the Red Hat Single Sign-On server.
							</p><p class="simpara">
								<span class="strong strong"><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong></span>
							</p><p class="simpara">
								Use the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">credentials of the Red Hat Single Sign-On administrator user</a>.
							</p></li><li class="listitem">
								Hover your cursor over the realm namespace (default is <span class="strong strong"><strong>Master</strong></span>) at the top of the sidebar and click <span class="strong strong"><strong>Add Realm</strong></span>.
							</li><li class="listitem">
								Enter a realm name (this example uses <code class="literal">demo</code>) and click <span class="strong strong"><strong>Create</strong></span>.
							</li></ol></div><p id="copy-rsa-public-key">
						<span class="strong strong"><strong>Copy the Public Key</strong></span>
					</p><p>
						In the newly created <code class="literal">demo</code> realm, click the <span class="strong strong"><strong>Keys</strong></span> tab, then select <span class="strong strong"><strong>Active</strong></span> tab, and copy the public key of type <span class="strong strong"><strong>RSA</strong></span> that has been generated.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The Red Hat Single Sign-On for OpenShift image version 7.5.0 generates multiple keys by default, for example <span class="strong strong"><strong>HS256</strong></span>, <span class="strong strong"><strong>RS256</strong></span>, or <span class="strong strong"><strong>AES</strong></span>. To copy the public key information for the Red Hat Single Sign-On for OpenShift 7.5.0 image, click the <span class="strong strong"><strong>Keys</strong></span> tab, then select <span class="strong strong"><strong>Active</strong></span> tab, and click the <span class="strong strong"><strong>Public key</strong></span> button of that row in the keys table, where type of the key matches <span class="strong strong"><strong>RSA</strong></span>. Then select and copy the content of the pop-up window that appears.
						</p></div></div><p>
						The information about the public key is necessary <a class="link" href="#sso-public-key-details">later to deploy</a> the Red Hat Single Sign-On-enabled EAP 6.4 / 7.1 JSP application.
					</p><p>
						<span class="strong strong"><strong>Create Red Hat Single Sign-On Roles</strong></span>
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The <a class="link" href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstart exposes three endpoints by the service:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">public</code> - Requires no authentication.
								</li><li class="listitem">
									<code class="literal">secured</code> - Can be invoked by users with the <code class="literal">user</code> role.
								</li><li class="listitem">
									<code class="literal">admin</code> - Can be invoked by users with the <code class="literal">admin</code> role.
								</li></ul></div></div></div><p>
						Create <code class="literal">user</code> and <code class="literal">admin</code> roles in Red Hat Single Sign-On. These roles will be assigned to an Red Hat Single Sign-On application user to authenticate access to user applications.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Roles</strong></span> in the <span class="strong strong"><strong>Configure</strong></span> sidebar to list the roles for this realm.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									This is a new realm, so there should only be the default (<code class="literal">offline_access</code> and <code class="literal">uma_authorization</code>) roles.
								</p></div></div></li><li class="listitem">
								Click <span class="strong strong"><strong>Add Role</strong></span>.
							</li><li class="listitem">
								Enter the role name (<code class="literal">user</code>) and click <span class="strong strong"><strong>Save</strong></span>.
							</li></ol></div><p>
						Repeat these steps for the <code class="literal">admin</code> role.
					</p><p>
						<span class="strong strong"><strong>Create the Red Hat Single Sign-On Realm Management User</strong></span>
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the realm.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add User.</strong></span>
							</li><li class="listitem">
								Enter a valid <span class="strong strong"><strong>Username</strong></span> (this example uses the user <code class="literal">appuser</code>) and click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Edit the user configuration:
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Click the <span class="strong strong"><strong>Credentials</strong></span> tab in the user space and enter a password for the user (this example uses the password <code class="literal">apppassword</code>).
									</li><li class="listitem">
										Ensure the <span class="strong strong"><strong>Temporary Password</strong></span> option is set to <span class="strong strong"><strong>Off</strong></span> so that it does not prompt for a password change later on, and click <span class="strong strong"><strong>Reset Password</strong></span> to set the user password. A pop-up window will prompt you to confirm.
									</li></ol></div></li></ol></div></section><section class="section" id="assign_literal_user_literal_red_hat_single_sign_on_role_to_the_realm_management_user"><div class="titlepage"><div><div><h4 class="title">5.4.1.2. Assign <code class="literal">user</code> Red Hat Single Sign-On Role to the Realm Management User</h4></div></div></div><p>
						Perform the following steps to tie the previously created <code class="literal">appuser</code> with the <code class="literal">user</code> Red Hat Single Sign-On role:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>Role Mappings</strong></span> to list the realm and client role configuration. In <span class="strong strong"><strong>Available Roles</strong></span>, select the <code class="literal">user</code> role created earlier, and click <span class="strong strong"><strong>Add selected&gt;</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Client Roles</strong></span>, select <span class="strong strong"><strong>realm-management</strong></span> entry from the list, select each record in the <span class="strong strong"><strong>Available Roles</strong></span> list.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									You can select multiple items at once by holding the <span class="strong strong"><strong>Ctrl</strong></span> key and simultaneously clicking the first <code class="literal">impersonation</code> entry. While keeping the <span class="strong strong"><strong>Ctrl</strong></span> key and the left mouse button pressed, move to the end of the list to the <code class="literal">view-clients</code> entry and ensure each record is selected.
								</p></div></div></li><li class="listitem">
								Click <span class="strong strong"><strong>Add selected&gt;</strong></span> to assign the roles to the client.
							</li></ol></div></section><section class="section" id="prepare_red_hat_single_sign_on_authentication_for_openshift_deployment_of_the_eap_6_4_7_1_jsp_application"><div class="titlepage"><div><div><h4 class="title">5.4.1.3. Prepare Red Hat Single Sign-On Authentication for OpenShift Deployment of the EAP 6.4 / 7.1 JSP Application</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Create a new project for the EAP 6.4 / 7.1 JSP application.
							</p><pre class="programlisting language-bash">$ oc new-project eap-app-demo</pre></li><li class="listitem"><p class="simpara">
								Add the <code class="literal">view</code> role to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts"><code class="literal">default</code></a> service account. This enables the service account to view all the resources in the <code class="literal">eap-app-demo</code> namespace, which is necessary for managing the cluster.
							</p><pre class="programlisting language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre></li><li class="listitem"><p class="simpara">
								The EAP template requires an <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/red_hat_single_sign-on_for_openshift_on_eclipse_openj9/#Configuring-Keystores">SSL keystore and a JGroups keystore</a>. This example uses <code class="literal">keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores.
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
										Generate a secure key for the SSL keystore (this example uses <code class="literal">password</code> as password for the keystore).
									</p><pre class="programlisting language-bash">$ keytool -genkeypair \
-dname "CN=secure-eap-app-eap-app-demo.openshift.example.com" \
-alias https \
-storetype JKS \
-keystore eapkeystore.jks</pre></li><li class="listitem"><p class="simpara">
										Generate a secure key for the JGroups keystore (this example uses <code class="literal">password</code> as password for the keystore).
									</p><pre class="programlisting language-bash">$ keytool -genseckey \
-alias jgroups \
-storetype JCEKS \
-keystore eapjgroups.jceks</pre></li><li class="listitem"><p class="simpara">
										Generate the EAP 6.4 / 7.1 for OpenShift secrets with the SSL and JGroup keystore files.
									</p><pre class="programlisting language-bash">$ oc create secret generic eap-ssl-secret --from-file=eapkeystore.jks</pre><pre class="programlisting language-bash">$ oc create secret generic eap-jgroup-secret --from-file=eapjgroups.jceks</pre></li><li class="listitem"><p class="simpara">
										Add the EAP application secret to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts"><code class="literal">default</code></a> service account.
									</p><pre class="programlisting language-bash">$ oc secrets link default eap-ssl-secret eap-jgroup-secret</pre></li></ol></div></li></ol></div></section><section class="section" id="deploy_binary_build_of_the_eap_6_4_7_1_jsp_application"><div class="titlepage"><div><div><h4 class="title">5.4.1.4. Deploy Binary Build of the EAP 6.4 / 7.1 JSP Application</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Clone the source code.
							</p><pre class="programlisting language-bash">$ git clone https://github.com/keycloak/keycloak-quickstarts.git</pre></li><li class="listitem">
								<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/development_guide/#use_the_maven_repository">Configure</a> the <a class="link" href="https://access.redhat.com/maven-repository">Red Hat JBoss Middleware Maven repository</a>.
							</li><li class="listitem"><p class="simpara">
								Build both the <a class="link" href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> and <a class="link" href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> applications.
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
										Build the <code class="literal">service-jee-jaxrs</code> application.
									</p><pre class="programlisting language-bash">$ cd keycloak-quickstarts/service-jee-jaxrs/</pre><pre class="programlisting language-bash">$ mvn clean package -DskipTests
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Keycloak Quickstart: service-jee-jaxrs 3.1.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.153 s
[INFO] Finished at: 2017-06-26T12:06:12+02:00
[INFO] Final Memory: 25M/241M
[INFO] ------------------------------------------------------------------------</pre></li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Comment out</strong></span> the <code class="literal">app-jee-jsp/config/keycloak.json</code> requirement of the <code class="literal">maven-enforcer-plugin</code> plugin and build the <code class="literal">app-jee-jsp</code> application.
									</p><pre class="programlisting language-bash">service-jee-jaxrs]$ cd ../app-jee-jsp/</pre><pre class="programlisting language-bash">app-jee-jsp]$ sed -i /\&lt;executions\&gt;/s/^/\&lt;\!--/ pom.xml</pre><pre class="programlisting language-bash">app-jee-jsp]$ sed -i '/\(&lt;\/executions&gt;\)/a\--&gt;' pom.xml</pre><pre class="programlisting language-bash">app-jee-jsp]$ mvn clean package -DskipTests
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Keycloak Quickstart: app-jee-jsp 3.1.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] Building war: /tmp/github/keycloak-quickstarts/app-jee-jsp/target/app-jsp.war
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.018 s
[INFO] Finished at: 2017-06-26T12:22:25+02:00
[INFO] Final Memory: 35M/310M
[INFO] ------------------------------------------------------------------------</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
											The <a class="link" href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> quickstart requires you to configure the adapter, and that the adapter configuration file (<code class="literal">keycloak.json</code>) is present in the <code class="literal">config/</code> directory in the root of the quickstart to successfully build the quickstart. But since this example configures the adapter later via selected environment variables available for the EAP 6.4 / 7.1 for OpenShift image, it is not necessary to specify the form of <code class="literal">keycloak.json</code> adapter configuration file at this moment.
										</p></div></div></li></ol></div></li></ol></div><div class="orderedlist" id="directory-structure-binary-builds"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
								Prepare the directory structure on the local file system.
							</p><p class="simpara">
								Application archives in the <span class="strong strong"><strong>deployments/</strong></span> subdirectory of the main binary build directory are copied directly to the <a class="link" href="#standard-deployments-directory" title="Note">standard deployments directory</a> of the image being built on OpenShift. For the application to deploy, the directory hierarchy containing the web application data must be correctly structured.
							</p><p class="simpara">
								Create the main directory for the binary build on the local file system and <span class="strong strong"><strong>deployments/</strong></span> subdirectory within it. Copy the previously built WAR archives of both the <span class="strong strong"><strong>service-jee-jaxrs</strong></span> and <span class="strong strong"><strong>app-jee-jsp</strong></span> quickstarts to the <span class="strong strong"><strong>deployments/</strong></span> subdirectory:
							</p><pre class="programlisting language-bash">app-jee-jsp]$ ls
config  pom.xml  README.md  src  target</pre><pre class="programlisting language-bash">app-jee-jsp]$ mkdir -p sso-eap7-bin-demo/deployments</pre><pre class="programlisting language-bash">app-jee-jsp]$ cp target/app-jsp.war sso-eap7-bin-demo/deployments/</pre><pre class="programlisting language-bash">app-jee-jsp]$ cp ../service-jee-jaxrs/target/service.war sso-eap7-bin-demo/deployments/</pre><pre class="programlisting language-bash">app-jee-jsp]$ tree sso-eap7-bin-demo/
sso-eap7-bin-demo/
|__ deployments
    |__ app-jsp.war
    |__ service.war

1 directory, 2 files</pre><div class="admonition note" id="standard-deployments-directory"><div class="admonition_header">Note</div><div><p>
									The location of the standard deployments directory depends on the underlying base image, that was used to deploy the application. See the following table:
								</p><div class="table" id="idm140078764832016"><p class="title"><strong>Table 5.1. Standard Location of the Deployments Directory</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th style="text-align: left; vertical-align: top; " id="idm140078764827152" scope="col">Name of the Underlying Base Image(s)</th><th style="text-align: left; vertical-align: top; " id="idm140078764826096" scope="col">Standard Location of the Deployments Directory</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; " headers="idm140078764827152">
												<p>
													EAP for OpenShift 6.4 and 7.1
												</p>
												</td><td style="text-align: left; vertical-align: top; " headers="idm140078764826096">
												<p>
													<span class="strong strong"><strong><span class="emphasis"><em>$JBOSS_HOME/standalone/deployments</em></span></strong></span>
												</p>
												</td></tr><tr><td style="text-align: left; vertical-align: top; " headers="idm140078764827152">
												<p>
													Java S2I for OpenShift
												</p>
												</td><td style="text-align: left; vertical-align: top; " headers="idm140078764826096">
												<p>
													<span class="strong strong"><strong><span class="emphasis"><em>/deployments</em></span></strong></span>
												</p>
												</td></tr><tr><td style="text-align: left; vertical-align: top; " headers="idm140078764827152">
												<p>
													JWS for OpenShift
												</p>
												</td><td style="text-align: left; vertical-align: top; " headers="idm140078764826096">
												<p>
													<span class="strong strong"><strong><span class="emphasis"><em>$JWS_HOME/webapps</em></span></strong></span>
												</p>
												</td></tr></tbody></table></div></div></div></div></li><li class="listitem"><p class="simpara">
								Identify the image stream for EAP 6.4 / 7.1 image.
							</p><pre class="programlisting language-bash">$ oc get is -n openshift | grep eap | cut -d ' ' -f 1
jboss-eap64-openshift
jboss-eap71-openshift</pre></li></ol></div><div class="orderedlist" id="eap-new-binary-build"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
								Create new binary build, specifying image stream and application name.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Replace <code class="literal">--image-stream=jboss-eap71-openshift</code> parameter with the <code class="literal">--image-stream=jboss-eap64-openshift</code> one in the following oc command to deploy the JSP application on top of JBoss EAP 6.4 for OpenShift image.
								</p></div></div><pre class="programlisting language-bash">$ oc new-build --binary=true \
--image-stream=jboss-eap71-openshift \
--name=eap-app
--&gt; Found image 31895a4 (3 months old) in image stream "openshift/jboss-eap71-openshift" under tag "latest" for "jboss-eap71-openshift"

    JBoss EAP 7.4
    -------------
    Platform for building and running JavaEE applications on JBoss EAP 7.4

    Tags: builder, javaee, eap, eap7

    * A source build using binary input will be created
      * The resulting image will be pushed to image stream "eap-app:latest"
      * A binary build was created, use 'start-build --from-dir' to trigger a new build

--&gt; Creating resources with label build=eap-app ...
    imagestream "eap-app" created
    buildconfig "eap-app" created
--&gt; Success</pre></li><li class="listitem"><p class="simpara">
								Start the binary build. Instruct <code class="literal">oc</code> executable to use main directory of the binary build we created <a class="link" href="#directory-structure-binary-builds">in previous step</a> as the directory containing binary input for the OpenShift build. In the working directory of <span class="strong strong"><strong>app-jee-jsp</strong></span> issue the following command.
							</p><pre class="programlisting language-bash">app-jee-jsp]$ oc start-build eap-app \
--from-dir=./sso-eap7-bin-demo/ \
--follow
Uploading directory "sso-eap7-bin-demo" as binary input for the build ...
build "eap-app-1" started
Receiving source from STDIN as archive ...
Copying all war artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all ear artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all war artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
'/home/jboss/source/deployments/app-jsp.war' -&gt; '/opt/eap/standalone/deployments/app-jsp.war'
'/home/jboss/source/deployments/service.war' -&gt; '/opt/eap/standalone/deployments/service.war'
Copying all ear artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Pushing image 172.30.82.129:5000/eap-app-demo/eap-app:latest ...
Pushed 6/7 layers, 86% complete
Pushed 7/7 layers, 100% complete
Push successful</pre></li><li class="listitem"><p class="simpara">
								Create a new OpenShift application based on the build.
							</p><pre class="programlisting language-bash">$ oc new-app eap-app
--&gt; Found image 6b13d36 (2 minutes old) in image stream "eap-app-demo/eap-app" under tag "latest" for "eap-app"

    eap-app-demo/eap-app-1:aa2574d9
    -------------------------------
    Platform for building and running JavaEE applications on JBoss EAP 7.4

    Tags: builder, javaee, eap, eap7

    * This image will be deployed in deployment config "eap-app"
    * Ports 8080/tcp, 8443/tcp, 8778/tcp will be load balanced by service "eap-app"
      * Other containers can access this service through the hostname "eap-app"

--&gt; Creating resources ...
    deploymentconfig "eap-app" created
    service "eap-app" created
--&gt; Success
    Run 'oc status' to view your app.</pre></li><li class="listitem"><p class="simpara">
								Stop all running containers of the EAP 6.4 / 7.1 JSP application in the current namespace.
							</p><pre class="programlisting language-bash">$ oc get dc -o name
deploymentconfig/eap-app</pre><pre class="programlisting language-bash">$ oc scale dc/eap-app --replicas=0
deploymentconfig "eap-app" scaled</pre></li><li class="listitem"><p class="simpara">
								Further configure the EAP 6.4 / 7.1 JSP application prior the deployment.
							</p><div class="orderedlist" id="sso-public-key-details"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
										Configure the application with proper details about the Red Hat Single Sign-On server instance.
									</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
											Ensure to replace the value of <span class="strong strong"><strong><span class="emphasis"><em>SSO_PUBLIC_KEY</em></span></strong></span> variable below with the actual content of the RSA public key for the <code class="literal">demo</code> realm, that has been <a class="link" href="#copy-rsa-public-key">copied</a>.
										</p></div></div><pre class="programlisting language-bash">$ oc set env dc/eap-app \
-e HOSTNAME_HTTP="eap-app-eap-app-demo.openshift.example.com" \
-e HOSTNAME_HTTPS="secure-eap-app-eap-app-demo.openshift.example.com" \
-e SSO_DISABLE_SSL_CERTIFICATE_VALIDATION="true" \
-e SSO_USERNAME="appuser" \
-e SSO_PASSWORD="apppassword" \
-e SSO_REALM="demo" \
-e SSO_URL="https://secure-sso-sso-app-demo.openshift.example.com/auth" \
-e SSO_PUBLIC_KEY="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkdhXyKx97oIoO6HwnV/MiX2EHO55Sn+ydsPzbjJevI5F31UvUco9uA8dGl6oM8HrnaWWv+i8PvmlaRMhhl6Xs68vJTEc6d0soP+6A+aExw0coNRp2PDwvzsXVWPvPQg3+iytStxu3Icndx+gC0ZYnxoRqL7rY7zKcQBScGEr78Nw6vZDwfe6d/PQ6W4xVErNytX9KyLFVAE1VvhXALyqEM/EqYGLmpjw5bMGVKRXnhmVo9E88CkFDH8E+aPiApb/gFul1GJOv+G8ySLoR1c8Y3L29F7C81odkVBp2yMm3RVFIGSPTjHqjO/nOtqYIfY4Wyw9mRIoY5SyW7044dZXRwIDAQAB" \
-e SSO_SECRET="0bb8c399-2501-4fcd-a183-68ac5132868d"
deploymentconfig "eap-app" updated</pre></li><li class="listitem"><p class="simpara">
										Configure the application with details about both the SSL and JGroups keystore.
									</p><pre class="programlisting language-bash">$ oc set env dc/eap-app \
-e HTTPS_KEYSTORE_DIR="/etc/eap-secret-volume" \
-e HTTPS_KEYSTORE="eapkeystore.jks" \
-e HTTPS_PASSWORD="password" \
-e JGROUPS_ENCRYPT_SECRET="eap-jgroup-secret" \
-e JGROUPS_ENCRYPT_KEYSTORE_DIR="/etc/jgroups-encrypt-secret-volume" \
-e JGROUPS_ENCRYPT_KEYSTORE="eapjgroups.jceks" \
-e JGROUPS_ENCRYPT_PASSWORD="password"
deploymentconfig "eap-app" updated</pre></li><li class="listitem"><p class="simpara">
										Define OpenShift volumes for both the SSL and JGroups secrets created earlier.
									</p><pre class="programlisting language-bash">$ oc volume dc/eap-app --add \
--name="eap-keystore-volume" \
--type=secret \
--secret-name="eap-ssl-secret" \
--mount-path="/etc/eap-secret-volume"
deploymentconfig "eap-app" updated</pre><pre class="programlisting language-bash">$ oc volume dc/eap-app --add \
--name="eap-jgroups-keystore-volume" \
--type=secret \
--secret-name="eap-jgroup-secret" \
--mount-path="/etc/jgroups-encrypt-secret-volume"
deploymentconfig "eap-app" updated</pre></li><li class="listitem"><p class="simpara">
										Configure the deployment config of the application to run application pods under the <code class="literal">default</code> OpenShift service account (default setting).
									</p><pre class="programlisting language-bash">$ oc patch dc/eap-app --type=json \
-p '[{"op": "add", "path": "/spec/template/spec/serviceAccountName", "value": "default"}]'
"eap-app" patched</pre></li></ol></div></li><li class="listitem"><p class="simpara">
								Deploy container of the EAP 6.4 / 7.1 JSP application using the modified deployment config.
							</p><pre class="programlisting language-bash">$ oc scale dc/eap-app --replicas=1
deploymentconfig "eap-app" scaled</pre></li><li class="listitem"><p class="simpara">
								Expose the service as route.
							</p><pre class="programlisting language-bash">$ oc get svc -o name
service/eap-app</pre><pre class="programlisting language-bash">$ oc get route
No resources found.</pre><pre class="programlisting language-bash">$ oc expose svc/eap-app
route "eap-app" exposed</pre><pre class="programlisting language-bash">$ oc get route
NAME      HOST/PORT                                    PATH      SERVICES   PORT       TERMINATION   WILDCARD
eap-app   eap-app-eap-app-demo.openshift.example.com             eap-app    8080-tcp                 None</pre></li></ol></div></section><section class="section" id="access_the_application"><div class="titlepage"><div><div><h4 class="title">5.4.1.5. Access the Application</h4></div></div></div><p>
						Access the application in your browser using the URL <span class="strong strong"><strong>http://eap-app-eap-app-demo.openshift.example.com/app-jsp</strong></span>. You should see output like on the following image:
					</p><p class="text-center text-center">
						<span class="inlinemediaobject"><img src="images/sso_app_jee_jsp.png" alt="Red Hat Single Sign-On Example JSP Application"/></span>
					</p><p>
						Perform the following to test the application:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Click the <span class="strong strong"><strong>INVOKE PUBLIC</strong></span> button to access the <code class="literal">public</code> endpoint that doesn’t require authentication.
							</p><p class="simpara">
								You should see the <span class="strong strong"><strong>Message: public</strong></span> output.
							</p></li><li class="listitem"><p class="simpara">
								Click the <span class="strong strong"><strong>LOGIN</strong></span> button to be redirected for user authentication to the Red Hat Single Sign-On server instance against the <code class="literal">demo</code> realm.
							</p><p class="simpara">
								Specify the username and password of the Red Hat Single Sign-On user configured earlier (<code class="literal">appuser</code> / <code class="literal">apppassword</code>). Click <span class="strong strong"><strong>Log in</strong></span>. The look of the application changes as detailed in the following image:
							</p><p class="text-center text-center">
								<span class="inlinemediaobject"><img src="images/sso_app_jee_jsp_logged_in.png" alt="sso app jee jsp logged in"/></span>
							</p></li><li class="listitem"><p class="simpara">
								Click the <span class="strong strong"><strong>INVOKE SECURED</strong></span> button to access the <code class="literal">secured</code> endpoint.
							</p><p class="simpara">
								You should see the <span class="strong strong"><strong>Message: secured</strong></span> output.
							</p></li><li class="listitem"><p class="simpara">
								Click the <span class="strong strong"><strong>INVOKE ADMIN</strong></span> button to access the <code class="literal">admin</code> endpoint.
							</p><p class="simpara">
								You should see <span class="strong strong"><strong>403 Forbidden</strong></span> output.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									The <code class="literal">admin</code> endpoint requires users with <code class="literal">admin</code> Red Hat Single Sign-On role to invoke properly. Access for the <code class="literal">appuser</code> is forbidden because they only have <code class="literal">user</code> role privilege, which allows them to access the <code class="literal">secured</code> endpoint.
								</p></div></div><p class="simpara">
								Perform the following steps to add the <code class="literal">appuser</code> to the <code class="literal">admin</code> Red Hat Single Sign-On role:
							</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
										Access the administration console of the Red Hat Single Sign-On server’s instance.
									</p><p class="simpara">
										<span class="strong strong"><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong></span>.
									</p><p class="simpara">
										Use the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">credentials of the Red Hat Single Sign-On administrator user</a>.
									</p></li><li class="listitem">
										Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the <code class="literal">demo</code> realm.
									</li><li class="listitem">
										Click <span class="strong strong"><strong>View all users</strong></span> button.
									</li><li class="listitem">
										Click the ID link for the <span class="strong strong"><strong>appuser</strong></span> or alternatively click the <span class="strong strong"><strong>Edit</strong></span> button in the <span class="strong strong"><strong>Actions</strong></span> column.
									</li><li class="listitem">
										Click the <span class="strong strong"><strong>Role Mappings</strong></span> tab.
									</li><li class="listitem">
										Select <code class="literal">admin</code> entry from the <span class="strong strong"><strong>Available Roles</strong></span> list in the <span class="strong strong"><strong>Realm Roles</strong></span> row.
									</li><li class="listitem">
										Click <span class="strong strong"><strong>Add selected&gt;</strong></span> button to add the <code class="literal">admin</code> role to the user.
									</li><li class="listitem"><p class="simpara">
										Return to EAP 6.4 / 7.1 JSP service application.
									</p><p class="simpara">
										<span class="strong strong"><strong>http://eap-app-eap-app-demo.openshift.example.com/app-jsp</strong></span>.
									</p></li><li class="listitem">
										Click the <span class="strong strong"><strong>LOGOUT</strong></span> button to reload role mappings for the <code class="literal">appuser</code>.
									</li><li class="listitem">
										Click the <span class="strong strong"><strong>LOGIN</strong></span> button again and provider <code class="literal">appuser</code> credentials.
									</li><li class="listitem"><p class="simpara">
										Click the <span class="strong strong"><strong>INVOKE ADMIN</strong></span> button again.
									</p><p class="simpara">
										You should see the <span class="strong strong"><strong>Message: admin</strong></span> output already.
									</p></li></ol></div></li></ul></div></section></section></section><section class="section" id="Example-EAP-Auto"><div class="titlepage"><div><div><h2 class="title">5.5. Example Workflow: Automatically Registering EAP Application in Red Hat Single Sign-On with OpenID-Connect Client</h2></div></div></div><p>
				This follows on from <a class="link" href="#Example-Deploying-SSO" title="3.2. Deploying the Red Hat Single Sign-On Image">Example Workflow: Preparing and Deploying the Red Hat Single Sign-On for OpenShift image</a>, in which Red Hat Single Sign-On was deployed on OpenShift. This example prepares Red Hat Single Sign-On realm, role, and user credentials for an EAP project using an OpenID-Connect client adapter. These credentials are then provided in the EAP for OpenShift template for automatic Red Hat Single Sign-On client registration. Once deployed, the Red Hat Single Sign-On user can be used to authenticate and access JBoss EAP.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					This example uses a OpenID-Connect client but an SAML client could also be used. See <a class="link" href="#SSO-Clients" title="4.8. Red Hat Single Sign-On Clients">Red Hat Single Sign-On Clients</a> and <a class="link" href="#Auto-Man-Client-Reg" title="4.8.1. Automatic and Manual Red Hat Single Sign-On Client Registration Methods">Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a> for more information on the differences between OpenID-Connect and SAML clients.
				</p></div></div><section class="section" id="preparing_red_hat_single_sign_on_authentication_for_openshift_deployment"><div class="titlepage"><div><div><h3 class="title">5.5.1. Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</h3></div></div></div><p>
					Log in to the OpenShift CLI with a user that holds the <span class="emphasis"><em>cluster:admin</em></span> role.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a new project:
						</p><pre class="programlisting language-bash">$ oc new-project eap-app-demo</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">view</code> role to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts"><code class="literal">default</code></a> service account. This enables the service account to view all the resources in the <code class="literal">eap-app-demo</code> namespace, which is necessary for managing the cluster.
						</p><pre class="programlisting language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre></li><li class="listitem"><p class="simpara">
							The EAP template requires an <a class="link" href="#Configuring-Keystores" title="4.1.2. Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server">SSL keystore and a JGroups keystore</a>.<br/> This example uses <code class="literal">keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores. The following commands will prompt for passwords.<br/>
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Generate a secure key for the SSL keystore:
								</p><pre class="programlisting language-bash">$ keytool -genkeypair -alias https -storetype JKS -keystore eapkeystore.jks</pre></li><li class="listitem"><p class="simpara">
									Generate a secure key for the JGroups keystore:
								</p><pre class="programlisting language-bash">$ keytool -genseckey -alias jgroups -storetype JCEKS -keystore eapjgroups.jceks</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Generate the EAP for OpenShift secrets with the SSL and JGroup keystore files:
						</p><pre class="programlisting language-bash">$ oc create secret generic eap-ssl-secret --from-file=eapkeystore.jks
$ oc create secret generic eap-jgroup-secret --from-file=eapjgroups.jceks</pre></li><li class="listitem"><p class="simpara">
							Add the EAP secret to the <code class="literal">default</code> service account:
						</p><pre class="programlisting language-bash">$ oc secrets link default eap-ssl-secret eap-jgroup-secret</pre></li></ol></div></section><section class="section" id="preparing_the_red_hat_single_sign_on_credentials"><div class="titlepage"><div><div><h3 class="title">5.5.2. Preparing the Red Hat Single Sign-On Credentials</h3></div></div></div><p>
					Log in to the encrypted Red Hat Single Sign-On web server at <span class="strong strong"><strong>https://secure-sso-<span class="emphasis"><em>&lt;project-name&gt;</em></span>.<span class="emphasis"><em>&lt;hostname&gt;</em></span>/auth/admin</strong></span> using the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">administrator account</a> created during the Red Hat Single Sign-On deployment.
				</p><p>
					<span class="strong strong"><strong>Create a Realm</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Hover your cursor over the realm namespace at the top of the sidebar and click <span class="strong strong"><strong>Add Realm</strong></span>.
						</li><li class="listitem">
							Enter a realm name (this example uses <span class="emphasis"><em>eap-demo</em></span>) and click <span class="strong strong"><strong>Create</strong></span>.
						</li></ol></div><p>
					<span class="strong strong"><strong>Copy the Public Key</strong></span>
				</p><p>
					In the newly created <span class="emphasis"><em>eap-demo</em></span> realm, click the <span class="strong strong"><strong>Keys</strong></span> tab and copy the generated public key. This example uses the variable <span class="emphasis"><em>&lt;realm-public-key&gt;</em></span> for brevity. This is used later to deploy the Red Hat Single Sign-On-enabled JBoss EAP image.
				</p><p>
					<span class="strong strong"><strong>Create a Role</strong></span>
				</p><p>
					Create a role in Red Hat Single Sign-On with a name that corresponds to the JEE role defined in the <span class="strong strong"><strong>web.xml</strong></span> of the example EAP application. This role is assigned to an Red Hat Single Sign-On <span class="emphasis"><em>application user</em></span> to authenticate access to user applications.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Roles</strong></span> in the <span class="strong strong"><strong>Configure</strong></span> sidebar to list the roles for this realm. This is a new realm, so there should only be the default <span class="emphasis"><em>offline_access</em></span> role.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add Role</strong></span>.
						</li><li class="listitem">
							Enter the role name (this example uses the role <span class="emphasis"><em>eap-user-role</em></span>) and click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					<span class="strong strong"><strong>Create Users and Assign Roles</strong></span>
				</p><p>
					Create two users: - Assign the <span class="emphasis"><em>realm management user</em></span> the <span class="strong strong"><strong>realm-management</strong></span> roles to handle automatic Red Hat Single Sign-On client registration in the Red Hat Single Sign-On server. - Assign the <span class="emphasis"><em>application user</em></span> the JEE role, created in the previous step, to authenticate access to user applications.
				</p><p>
					Create the <span class="emphasis"><em>realm management user</em></span>:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the realm.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add User</strong></span>.
						</li><li class="listitem">
							Enter a valid <span class="strong strong"><strong>Username</strong></span> (this example uses the user <span class="emphasis"><em>eap-mgmt-user</em></span>) and click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Edit the user configuration. Click the <span class="strong strong"><strong>Credentials</strong></span> tab in the user space and enter a password for the user. After the password has been confirmed you can click <span class="strong strong"><strong>Reset Password</strong></span> to set the user password. A pop-up window prompts for additional confirmation.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Role Mappings</strong></span> to list the realm and client role configuration. In the <span class="strong strong"><strong>Client Roles</strong></span> drop-down menu, select <span class="strong strong"><strong>realm-management</strong></span> and add all of the available roles to the user. This provides the user Red Hat Single Sign-On server rights that can be used by the JBoss EAP image to create clients.
						</li></ol></div><p>
					Create the <span class="emphasis"><em>application user</em></span>:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the realm.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add User</strong></span>.
						</li><li class="listitem">
							Enter a valid <span class="strong strong"><strong>Username</strong></span> and any additional optional information for the <span class="emphasis"><em>application user</em></span> and click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Edit the user configuration. Click the <span class="strong strong"><strong>Credentials</strong></span> tab in the user space and enter a password for the user. After the password has been confirmed you can click <span class="strong strong"><strong>Reset Password</strong></span> to set the user password. A pop-up window prompts for additional confirmation.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Role Mappings</strong></span> to list the realm and client role configuration. In <span class="strong strong"><strong>Available Roles</strong></span>, add the role created earlier.
						</li></ol></div></section><section class="section" id="deploy_the_red_hat_single_sign_on_enabled_jboss_eap_image"><div class="titlepage"><div><div><h3 class="title">5.5.3. Deploy the Red Hat Single Sign-On-enabled JBoss EAP Image</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Return to the OpenShift web console and click <span class="strong strong"><strong>Add to project</strong></span> to list the default image streams and templates.
						</li><li class="listitem">
							Use the <span class="strong strong"><strong>Filter by keyword</strong></span> search bar to limit the list to those that match <span class="emphasis"><em>sso</em></span>. You may need to click <span class="strong strong"><strong>See all</strong></span> to show the desired application template.
						</li><li class="listitem"><p class="simpara">
							Select the <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span> image to list all of the deployment parameters. Include the following Red Hat Single Sign-On parameters to configure the Red Hat Single Sign-On credentials during the EAP build:
						</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078740336640" scope="col">Variable</th><th align="left" valign="top" id="idm140078740335552" scope="col">Example Value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>APPLICATION_NAME</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>sso</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTPS</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>secure-sample-jsp.eap-app-demo.openshift32.example.com</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTP</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>sample-jsp.eap-app-demo.openshift32.example.com</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>SOURCE_REPOSITORY_URL</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>https://repository-example.com/developer/application</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>SSO_URL</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>https://secure-sso-sso-app-demo.openshift32.example.com/auth</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>eap-demo</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>SSO_USERNAME</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>eap-mgmt-user</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>SSO_PASSWORD</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>password</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>SSO_PUBLIC_KEY</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>&lt;realm-public-key&gt;</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>eapkeystore.jks</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>password</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_SECRET</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>eap-ssl-secret</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_KEYSTORE</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>eapjgroups.jceks</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_PASSWORD</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>password</em></span>
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140078740336640">
										<p>
											<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_SECRET</em></span></strong></span>
										</p>
										</td><td align="left" valign="top" headers="idm140078740335552">
										<p>
											<span class="emphasis"><em>eap-jgroup-secret</em></span>
										</p>
										</td></tr></tbody></table></div></li><li class="listitem">
							Click <span class="strong strong"><strong>Create</strong></span> to deploy the JBoss EAP image.
						</li></ol></div><p>
					It may take several minutes for the JBoss EAP image to deploy.
				</p></section><section class="section" id="log_in_to_the_jboss_eap_server_using_red_hat_single_sign_on"><div class="titlepage"><div><div><h3 class="title">5.5.4. Log in to the JBoss EAP Server Using Red Hat Single Sign-On</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Access the JBoss EAP application server and click <span class="strong strong"><strong>Login</strong></span>. You are redirected to the Red Hat Single Sign-On login.
						</li><li class="listitem">
							Log in using the Red Hat Single Sign-On user created in the example. You are authenticated against the Red Hat Single Sign-On server and returned to the JBoss EAP application server.
						</li></ol></div></section></section><section class="section" id="Example-EAP-Manual"><div class="titlepage"><div><div><h2 class="title">5.6. Example Workflow: Manually Registering EAP Application in Red Hat Single Sign-On with SAML Client</h2></div></div></div><p>
				This follows on from <a class="link" href="#Example-Deploying-SSO" title="3.2. Deploying the Red Hat Single Sign-On Image">Example Workflow: Preparing and Deploying the Red Hat Single Sign-On for OpenShift image</a>, in which Red Hat Single Sign-On was deployed on OpenShift.
			</p><p>
				This example prepares Red Hat Single Sign-On realm, role, and user credentials for an EAP project and configures an EAP for OpenShift deployment. Once deployed, the Red Hat Single Sign-On user can be used to authenticate and access JBoss EAP.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					This example uses a SAML client but an OpenID-Connect client could also be used. See <a class="link" href="#SSO-Clients" title="4.8. Red Hat Single Sign-On Clients">Red Hat Single Sign-On Clients</a> and <a class="link" href="#Auto-Man-Client-Reg" title="4.8.1. Automatic and Manual Red Hat Single Sign-On Client Registration Methods">Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a> for more information on the differences between SAML and OpenID-Connect clients.
				</p></div></div><section class="section" id="preparing_the_red_hat_single_sign_on_credentials_2"><div class="titlepage"><div><div><h3 class="title">5.6.1. Preparing the Red Hat Single Sign-On Credentials</h3></div></div></div><p>
					Log in to the encrypted Red Hat Single Sign-On web server at <span class="strong strong"><strong>https://secure-sso-<span class="emphasis"><em>&lt;project-name&gt;</em></span>.<span class="emphasis"><em>&lt;hostname&gt;</em></span>/auth/admin</strong></span> using the <a class="link" href="#sso-administrator-setup" title="4.5. Creating the Administrator Account for Red Hat Single Sign-On Server">administrator account</a> created during the Red Hat Single Sign-On deployment.
				</p><p>
					<span class="strong strong"><strong>Create a Realm</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Hover your cursor over the realm namespace (default is <span class="strong strong"><strong>Master</strong></span>) at the top of the sidebar and click <span class="strong strong"><strong>Add Realm</strong></span>.
						</li><li class="listitem">
							Enter a realm name (this example uses <span class="emphasis"><em>saml-demo</em></span>) and click <span class="strong strong"><strong>Create</strong></span>.
						</li></ol></div><p>
					<span class="strong strong"><strong>Copy the Public Key</strong></span>
				</p><p>
					In the newly created <span class="emphasis"><em>saml-demo</em></span> realm, click the <span class="strong strong"><strong>Keys</strong></span> tab and copy the generated public key. This example uses the variable <span class="emphasis"><em>realm-public-key</em></span> for brevity. This is needed later to deploy the Red Hat Single Sign-On-enabled JBoss EAP image.
				</p><p>
					<span class="strong strong"><strong>Create a Role</strong></span>
				</p><p>
					Create a role in Red Hat Single Sign-On with a name that corresponds to the JEE role defined in the <span class="strong strong"><strong>web.xml</strong></span> of the example EAP application. This role will be assigned to an Red Hat Single Sign-On <span class="emphasis"><em>application user</em></span> to authenticate access to user applications.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Roles</strong></span> in the <span class="strong strong"><strong>Configure</strong></span> sidebar to list the roles for this realm. This is a new realm, so there should only be the default <span class="emphasis"><em>offline_access</em></span> role.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add Role</strong></span>.
						</li><li class="listitem">
							Enter the role name (this example uses the role <span class="emphasis"><em>saml-user-role</em></span>) and click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					<span class="strong strong"><strong>Create Users and Assign Roles</strong></span>
				</p><p>
					Create two users: - Assign the <span class="emphasis"><em>realm management user</em></span> the <span class="strong strong"><strong>realm-management</strong></span> roles to handle automatic Red Hat Single Sign-On client registration in the Red Hat Single Sign-On server. - Assign the <span class="emphasis"><em>application user</em></span> the JEE role, created in the previous step, to authenticate access to user applications.
				</p><p>
					Create the <span class="emphasis"><em>realm management user</em></span>:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the realm.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add User</strong></span>.
						</li><li class="listitem">
							Enter a valid <span class="strong strong"><strong>Username</strong></span> (this example uses the user <span class="emphasis"><em>app-mgmt-user</em></span>) and click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Edit the user configuration. Click the <span class="strong strong"><strong>Credentials</strong></span> tab in the user space and enter a password for the user. After the password has been confirmed you can click <span class="strong strong"><strong>Reset Password</strong></span> to set the user password. A pop-up window prompts for additional confirmation.
						</li></ol></div><p>
					Create the <span class="emphasis"><em>application user</em></span>:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the <span class="strong strong"><strong>Manage</strong></span> sidebar to view the user information for the realm.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add User</strong></span>.
						</li><li class="listitem">
							Enter a valid <span class="strong strong"><strong>Username</strong></span> and any additional optional information for the <span class="emphasis"><em>application user</em></span> and click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Edit the user configuration. Click the <span class="strong strong"><strong>Credentials</strong></span> tab in the user space and enter a password for the user. After the password has been confirmed you can click <span class="strong strong"><strong>Reset Password</strong></span> to set the user password. A pop-up window prompts for additional confirmation.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Role Mappings</strong></span> to list the realm and client role configuration. In <span class="strong strong"><strong>Available Roles</strong></span>, add the role created earlier.
						</li></ol></div><p>
					<span class="strong strong"><strong>Create and Configure a SAML Client</strong></span>:
				</p><p>
					Clients are Red Hat Single Sign-On entities that request user authentication. This example configures a SAML client to handle authentication for the EAP application. This section saves two files, <span class="strong strong"><strong>keystore.jks</strong></span> and <span class="strong strong"><strong>keycloak-saml-subsystem.xml</strong></span> that are needed later in the procedure.
				</p><p>
					Create the SAML Client:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Clients</strong></span> in the <span class="strong strong"><strong>Configure</strong></span> sidebar to list the clients in the realm. Click <span class="strong strong"><strong>Create</strong></span>.
						</li><li class="listitem">
							Enter a valid <span class="strong strong"><strong>Client ID</strong></span>. This example uses <span class="emphasis"><em>sso-saml-demo</em></span>.
						</li><li class="listitem">
							In the <span class="strong strong"><strong>Client Protocol</strong></span> drop-down menu, select <span class="strong strong"><strong>saml</strong></span>.
						</li><li class="listitem">
							Enter the <span class="strong strong"><strong>Root URL</strong></span> for the application. This example uses <span class="emphasis"><em>https://demoapp-eap-app-demo.openshift32.example.com</em></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					Configure the SAML Client:
				</p><p>
					In the <span class="strong strong"><strong>Settings</strong></span> tab, set the <span class="strong strong"><strong>Root URL</strong></span> and the <span class="strong strong"><strong>Valid Redirect URLs</strong></span> for the new <span class="strong strong"><strong><span class="emphasis"><em>sso-saml-demo</em></span></strong></span> client:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							For the <span class="strong strong"><strong>Root URL</strong></span>, enter the same address used when creating the client. This example uses <span class="emphasis"><em>https://demoapp-eap-app-demo.openshift32.example.com</em></span>.
						</li><li class="listitem">
							For the <span class="strong strong"><strong>Valid Redirect URLs</strong></span>, enter an address for users to be redirected to at when they log in or out. This example uses a redirect address relative to the root <span class="emphasis"><em>https://demoapp-eap-app-demo.openshift32.example.com/*</em></span>.
						</li></ol></div><p>
					Export the SAML Keys:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click the <span class="strong strong"><strong>SAML Keys</strong></span> tab in the <span class="emphasis"><em>sso-saml-demo</em></span> client space and click <span class="strong strong"><strong>Export</strong></span>.
						</li><li class="listitem">
							For this example, leave the <span class="strong strong"><strong>Archive Format</strong></span> as <span class="strong strong"><strong>JKS</strong></span>. This example uses the default <span class="strong strong"><strong>Key Alias</strong></span> of <span class="emphasis"><em>sso-saml-demo</em></span> and default <span class="strong strong"><strong>Realm Certificate Alias</strong></span> of <span class="emphasis"><em>saml-demo</em></span>.
						</li><li class="listitem">
							Enter the <span class="strong strong"><strong>Key Password</strong></span> and the <span class="strong strong"><strong>Store Password</strong></span>. This example uses <span class="emphasis"><em>password</em></span> for both.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Download</strong></span> and save the <span class="strong strong"><strong>keystore-saml.jks</strong></span> file for use later.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong><span class="emphasis"><em>sso-saml-demo</em></span></strong></span> client to return to the client space ready for the next step.
						</li></ol></div><p>
					Download the Client Adapter:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Installation</strong></span>.
						</li><li class="listitem">
							Use the <span class="strong strong"><strong>Format Option</strong></span> drop-down menu to select a format. This example uses <span class="strong strong"><strong>Keycloak SAML Wildfly/JBoss Subsystem</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Download</strong></span> and save the file <span class="strong strong"><strong>keycloak-saml-subsystem.xml</strong></span>.
						</li></ol></div><p>
					The <span class="strong strong"><strong>keystore-saml.jks</strong></span> will be used with the other EAP keystores in the next section to create an OpenShift secret for the EAP application project. Copy the <span class="strong strong"><strong>keystore-saml.jks</strong></span> file to an OpenShift node.<br/> The <span class="strong strong"><strong>keycloak-saml-subsystem.xml</strong></span> will be modified and used in the application deployment. Copy it into the <span class="strong strong"><strong>/configuration</strong></span> folder of the application as <span class="strong strong"><strong>secure-saml-deployments</strong></span>.
				</p></section><section class="section" id="preparing_red_hat_single_sign_on_authentication_for_openshift_deployment_2"><div class="titlepage"><div><div><h3 class="title">5.6.2. Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</h3></div></div></div><p>
					Log in to the OpenShift CLI with a user that holds the <span class="emphasis"><em>cluster:admin</em></span> role.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a new project:
						</p><pre class="programlisting language-bash">$ oc new-project eap-app-demo</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">view</code> role to the <a class="link" href="https://docs.openshift.com/container-platform/latest/authentication/using-service-accounts-in-applications.html#default-service-accounts-and-roles_using-service-accounts"><code class="literal">default</code></a> service account. This enables the service account to view all the resources in the <code class="literal">eap-app-demo</code> namespace, which is necessary for managing the cluster.
						</p><pre class="programlisting language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre></li><li class="listitem"><p class="simpara">
							The EAP template requires an <a class="link" href="#Configuring-Keystores" title="4.1.2. Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server">SSL keystore and a JGroups keystore</a>.<br/> This example uses <code class="literal">keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores. The following commands will prompt for passwords.<br/>
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Generate a secure key for the SSL keystore:
								</p><pre class="programlisting language-bash">$ keytool -genkeypair -alias https -storetype JKS -keystore eapkeystore.jks</pre></li><li class="listitem"><p class="simpara">
									Generate a secure key for the JGroups keystore:
								</p><pre class="programlisting language-bash">$ keytool -genseckey -alias jgroups -storetype JCEKS -keystore eapjgroups.jceks</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Generate the EAP for OpenShift secrets with the SSL and JGroup keystore files:
						</p><pre class="programlisting language-bash">$ oc create secret generic eap-ssl-secret --from-file=eapkeystore.jks
$ oc create secret generic eap-jgroup-secret --from-file=eapjgroups.jceks</pre></li><li class="listitem"><p class="simpara">
							Add the EAP application secret to the EAP service account created earlier:
						</p><pre class="programlisting language-bash">$ oc secrets link default eap-ssl-secret eap-jgroup-secret</pre></li></ol></div></section><section class="section" id="modified-saml-xml"><div class="titlepage"><div><div><h3 class="title">5.6.3. Modifying the <span class="strong strong"><strong>secure-saml-deployments</strong></span> File</h3></div></div></div><p>
					The <span class="strong strong"><strong>keycloak-saml-subsystem.xml</strong></span>, exported from the Red Hat Single Sign-On client in a previous section, should have been copied into the <span class="strong strong"><strong>/configuration</strong></span> folder of the application and renamed <span class="strong strong"><strong>secure-saml-deployments</strong></span>. EAP searches for this file when it starts and copies it to the <span class="strong strong"><strong>standalone-openshift.xml</strong></span> file inside the Red Hat Single Sign-On SAML adapter configuration.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Open the <span class="strong strong"><strong>/configuration/secure-saml-deployments</strong></span> file in a text editor.
						</li><li class="listitem">
							Replace the <span class="strong strong"><strong>YOUR-WAR.war</strong></span> value of the <span class="strong strong"><strong>secure-deployment name</strong></span> tag with the application <span class="strong strong"><strong>.war</strong></span> file. This example uses <span class="emphasis"><em>sso-saml-demo.war</em></span>.
						</li><li class="listitem">
							Replace the <span class="strong strong"><strong>SPECIFY YOUR LOGOUT PAGE!</strong></span> value of the <span class="strong strong"><strong>logout page</strong></span> tag with the url to redirect users when they log out of the application. This example uses <span class="strong strong"><strong>/index.jsp</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Delete the <span class="strong strong"><strong>&lt;PrivateKeyPem&gt;</strong></span> and <span class="strong strong"><strong>&lt;CertificatePem&gt;</strong></span> tags and keys and replace it with keystore information:
						</p><pre class="programlisting language-bash">...
&lt;Keys&gt;
  &lt;Key signing="true"&gt;
    &lt;KeyStore file= "/etc/eap-secret-volume/keystore-saml.jks" password="password"&gt;
      &lt;PrivateKey alias="sso-saml-demo" password="password"/&gt;
      &lt;Certificate alias="sso-saml-demo"/&gt;
    &lt;/KeyStore&gt;
  &lt;/Key&gt;
&lt;/Keys&gt;</pre><p class="simpara">
							The mount path of the <span class="strong strong"><strong>keystore-saml.jks</strong></span> (in this example <span class="strong strong"><strong><span class="emphasis"><em>/etc/eap-secret-volume/keystore-saml.jks</em></span></strong></span>) can be specified in the application template with the parameter <span class="strong strong"><strong>EAP_HTTPS_KEYSTORE_DIR</strong></span>.<br/> The aliases and passwords for the <span class="strong strong"><strong>PrivateKey</strong></span> and the <span class="strong strong"><strong>Certificate</strong></span> were configured when the SAML Keys were exported from the Red Hat Single Sign-On client.
						</p></li><li class="listitem"><p class="simpara">
							Delete the second <span class="strong strong"><strong>&lt;CertificatePem&gt;</strong></span> tag and key and replace it with the the realm certificate information:
						</p><pre class="programlisting language-bash">...
&lt;Keys&gt;
  &lt;Key signing="true"&gt;
    &lt;KeyStore file="/etc/eap-secret-volume/keystore-saml.jks" password="password"&gt;
      &lt;Certificate alias="saml-demo"/&gt;
    &lt;/KeyStore&gt;
  &lt;/Key&gt;
&lt;/Keys&gt;
...</pre><p class="simpara">
							The certificate alias and password were configured when the SAML Keys were exported from the Red Hat Single Sign-On client.
						</p></li><li class="listitem">
							Save and close the <span class="strong strong"><strong>/configuration/secure-saml-deployments</strong></span> file.
						</li></ol></div></section><section class="section" id="configuring_saml_client_registration_in_the_application_emphasis_role_strong_web_xml_emphasis"><div class="titlepage"><div><div><h3 class="title">5.6.4. Configuring SAML Client Registration in the Application <span class="strong strong"><strong>web.xml</strong></span></h3></div></div></div><p>
					The client type must also be specified by the <span class="strong strong"><strong>&lt;auth-method&gt;</strong></span> key in the application <span class="strong strong"><strong>web.xml</strong></span>. This file is read by the image at deployment.
				</p><p>
					Open the application <span class="strong strong"><strong>web.xml</strong></span> file and ensure it includes the following:
				</p><pre class="programlisting language-bash">...
&lt;login-config&gt;
  &lt;auth-method&gt;KEYCLOAK-SAML&lt;/auth-method&gt;
&lt;/login-config&gt;
...</pre></section><section class="section" id="deploying_the_application"><div class="titlepage"><div><div><h3 class="title">5.6.5. Deploying the Application</h3></div></div></div><p>
					You do not need to include any Red Hat Single Sign-On configuration for the image because that has been configured in the application itself. Navigating to the application login page redirects you to the Red Hat Single Sign-On login. Log in to the application through Red Hat Single Sign-On using the <span class="emphasis"><em>application user</em></span> user created earlier.
				</p></section></section></section><section class="chapter" id="reference"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Reference</h1></div></div></div><section class="section" id="sso-artifact-repository-mirrors-section"><div class="titlepage"><div><div><h2 class="title">6.1. Artifact Repository Mirrors</h2></div></div></div><p>
				A repository in Maven holds build artifacts and dependencies of various types (all the project jars, library jar, plugins or any other project specific artifacts). It also specifies locations from where to download artifacts from, while performing the S2I build. Besides using central repositories, it is a common practice for organizations to deploy a local custom repository (mirror).
			</p><p>
				Benefits of using a mirror are:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Availability of a synchronized mirror, which is geographically closer and faster.
					</li><li class="listitem">
						Ability to have greater control over the repository content.
					</li><li class="listitem">
						Possibility to share artifacts across different teams (developers, CI), without the need to rely on public servers and repositories.
					</li><li class="listitem">
						Improved build times.
					</li></ul></div><p>
				Often, a repository manager can serve as local cache to a mirror. Assuming that the repository manager is already deployed and reachable externally at <span class="strong strong"><strong><span class="emphasis"><em>http://10.0.0.1:8080/repository/internal/</em></span></strong></span>, the S2I build can then use this manager by supplying the <code class="literal">MAVEN_MIRROR_URL</code> environment variable to the build configuration of the application as follows:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Identify the name of the build configuration to apply <code class="literal">MAVEN_MIRROR_URL</code> variable against:
					</p><pre class="programlisting language-bash">$ oc get bc -o name
buildconfig/sso</pre></li><li class="listitem"><p class="simpara">
						Update build configuration of <code class="literal">sso</code> with a <code class="literal">MAVEN_MIRROR_URL</code> environment variable
					</p><pre class="programlisting language-bash">$ oc set env bc/sso \
  -e MAVEN_MIRROR_URL="http://10.0.0.1:8080/repository/internal/"
buildconfig "sso" updated</pre></li><li class="listitem"><p class="simpara">
						Verify the setting
					</p><pre class="programlisting language-bash">$ oc set env bc/sso --list
# buildconfigs sso
MAVEN_MIRROR_URL=http://10.0.0.1:8080/repository/internal/</pre></li><li class="listitem">
						Schedule new build of the application
					</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					During application build, you will notice that Maven dependencies are pulled from the repository manager, instead of the default public repositories. Also, after the build is finished, you will see that the mirror is filled with all the dependencies that were retrieved and used during the build.
				</p></div></div></section><section class="section" id="env_vars"><div class="titlepage"><div><div><h2 class="title">6.2. Environment Variables</h2></div></div></div><section class="section" id="information_environment_variables"><div class="titlepage"><div><div><h3 class="title">6.2.1. Information Environment Variables</h3></div></div></div><p>
					The following information environment variables are designed to convey information about the image and should not be modified by the user:
				</p><div class="table" id="idm140078744035936"><p class="title"><strong>Table 6.1. Information Environment Variables</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078744030160" scope="col">Variable Name</th><th align="left" valign="top" id="idm140078744029072" scope="col">Description</th><th align="left" valign="top" id="idm140078744027984" scope="col">Example Value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078744030160">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_AUTH_OPENSHIFT</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744029072">
								<p>
									-
								</p>
								</td><td align="left" valign="top" headers="idm140078744027984">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744030160">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_HTTPS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744029072">
								<p>
									-
								</p>
								</td><td align="left" valign="top" headers="idm140078744027984">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744030160">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_PASSWORD_RANDOM</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744029072">
								<p>
									-
								</p>
								</td><td align="left" valign="top" headers="idm140078744027984">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744030160">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JBOSS_IMAGE_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744029072">
								<p>
									Image name, same as "name" label.
								</p>
								</td><td align="left" valign="top" headers="idm140078744027984">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>rh-sso-7/sso75-openj9-openshift-rhel8</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744030160">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JBOSS_IMAGE_VERSION</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744029072">
								<p>
									Image version, same as "version" label.
								</p>
								</td><td align="left" valign="top" headers="idm140078744027984">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>7.5</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744030160">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JBOSS_MODULES_SYSTEM_PKGS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744029072">
								<p>
									-
								</p>
								</td><td align="left" valign="top" headers="idm140078744027984">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>org.jboss.logmanager,jdk.nashorn.api</em></span></strong></span>
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="configuration_environment_variables"><div class="titlepage"><div><div><h3 class="title">6.2.2. Configuration Environment Variables</h3></div></div></div><p>
					Configuration environment variables are designed to conveniently adjust the image without requiring a rebuild, and should be set by the user as desired.
				</p><div class="table" id="conf_env_vars"><p class="title"><strong>Table 6.2. Configuration Environment Variables</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078743974512" scope="col">Variable Name</th><th align="left" valign="top" id="idm140078743973424" scope="col">Description</th><th align="left" valign="top" id="idm140078743972336" scope="col">Example Value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_AUTH_OPENSHIFT</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Switch on client authentication for OpenShift TLS communication. The value of this parameter can be a relative distinguished name which must be contained in a presented client’s certificate. Enabling this parameter will automatically switch Jolokia into https communication mode. The default CA cert is set to <code class="literal">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_CONFIG</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									If set uses this file (including path) as Jolokia JVM agent properties (as described in Jolokia’s <a class="link" href="https://jolokia.org/reference/html/agents.html#agents-jvm">reference manual</a>). If not set, the <code class="literal">/opt/jolokia/etc/jolokia.properties</code> file will be created using the settings as defined in this document, otherwise the rest of the settings in this document are ignored.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>/opt/jolokia/custom.properties</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_DISCOVERY_ENABLED</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Enable Jolokia discovery. Defaults to <span class="strong strong"><strong><span class="emphasis"><em>false</em></span></strong></span>.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_HOST</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Host address to bind to. Defaults to <span class="strong strong"><strong><span class="emphasis"><em>0.0.0.0</em></span></strong></span>.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>127.0.0.1</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_HTTPS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Switch on secure communication with https. By default self-signed server certificates are generated if no serverCert configuration is given in <span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_OPTS</em></span></strong></span>. <span class="emphasis"><em>NOTE: If the values is set to an empty string, https is turned <code class="literal">off</code>. If the value is set to a non empty string, https is turned <code class="literal">on</code>.</em></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_ID</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Agent ID to use ($HOSTNAME by default, which is the container id).
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>openjdk-app-1-xqlsj</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_OFF</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									If set disables activation of Jolokia (i.e. echos an empty value). By default, Jolokia is enabled. <span class="emphasis"><em>NOTE: If the values is set to an empty string, https is turned <code class="literal">off</code>. If the value is set to a non empty string, https is turned <code class="literal">on</code>.</em></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_OPTS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Additional options to be appended to the agent configuration. They should be given in the format <code class="literal">"key=value, key=value, …&lt;200b&gt; "</code>
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>backlog=20</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Password for basic authentication. By default authentication is switched off.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>mypassword</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_PASSWORD_RANDOM</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									If set, a random value is generated for <span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_PASSWORD</em></span></strong></span>, and it is saved in the <span class="strong strong"><strong><span class="emphasis"><em>/opt/jolokia/etc/jolokia.pw</em></span></strong></span> file.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_PORT</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Port to use (Default: <span class="strong strong"><strong><span class="emphasis"><em>8778</em></span></strong></span>).
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>5432</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AB_JOLOKIA_USER</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									User for basic authentication. Defaults to <span class="strong strong"><strong><span class="emphasis"><em>jolokia</em></span></strong></span>.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>myusername</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>CONTAINER_CORE_LIMIT</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									A calculated core limit as described in <a class="link" href="https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt">CFS Bandwidth Control.</a>
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>2</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GC_ADAPTIVE_SIZE_POLICY_WEIGHT</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The weighting given to the current Garbage Collection (GC) time versus previous GC times.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>90</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GC_MAX_HEAP_FREE_RATIO</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Maximum percentage of heap free after GC to avoid shrinking.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>40</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GC_MAX_METASPACE_SIZE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The maximum metaspace size.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>100</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GC_TIME_RATIO_MIN_HEAP_FREE_RATIO</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Minimum percentage of heap free after GC to avoid expansion.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>20</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GC_TIME_RATIO</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Specifies the ratio of the time spent outside the garbage collection (for example, the time spent for application execution) to the time spent in the garbage collection.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>4</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JAVA_DIAGNOSTICS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Set this to get some diagnostics information to standard out when things are happening.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JAVA_INITIAL_MEM_RATIO</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									This is used to calculate a default initial heap memory based the maximal heap memory. The default is 100 which means 100% of the maximal heap is used for the initial heap size. You can skip this mechanism by setting this value to 0 in which case no <code class="literal">-Xms</code> option is added.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>100</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JAVA_MAX_MEM_RATIO</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									It is used to calculate a default maximal heap memory based on a containers restriction. If used in a Docker container without any memory constraints for the container then this option has no effect. If there is a memory constraint then <code class="literal">-Xmx</code> is set to a ratio of the container available memory as set here. The default is 50 which means 50% of the available memory is used as an upper boundary. You can skip this mechanism by setting this value to 0 in which case no <code class="literal">-Xmx</code> option is added.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>40</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JAVA_OPTS_APPEND</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Server startup options.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>-Dkeycloak.migration.action=export -Dkeycloak.migration.provider=dir -Dkeycloak.migration.dir=/tmp</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>MQ_SIMPLE_DEFAULT_PHYSICAL_DESTINATION</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									For backwards compatability, set to true to use <code class="literal">MyQueue</code> and <code class="literal">MyTopic</code> as physical destination name defaults instead of <code class="literal">queue/MyQueue</code> and <code class="literal">topic/MyTopic</code>.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>false</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>OPENSHIFT_KUBE_PING_LABELS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Clustering labels selector.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>app=sso-app</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>OPENSHIFT_KUBE_PING_NAMESPACE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Clustering project namespace.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>myproject</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SCRIPT_DEBUG</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									If set to <code class="literal">true</code>, ensurses that the bash scripts are executed with the <code class="literal">-x</code> option, printing the commands and their arguments as they are executed.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Password of the administrator account for the <code class="literal">master</code> realm of the Red Hat Single Sign-On server. <span class="strong strong"><strong>Required.</strong></span> If no value is specified, it is auto generated and displayed as an OpenShift Instructional message when the template is instantiated.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>adm-password</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Username of the administrator account for the <code class="literal">master</code> realm of the Red Hat Single Sign-On server. <span class="strong strong"><strong>Required.</strong></span> If no value is specified, it is auto generated and displayed as an OpenShift Instructional message when the template is instantiated.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>admin</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_HOSTNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Custom hostname for the Red Hat Single Sign-On server. <span class="strong strong"><strong>Not set by default</strong></span>. If not set, the <code class="literal">request</code> hostname SPI provider, which uses the request headers to determine the hostname of the Red Hat Single Sign-On server is used. If set, the <code class="literal">fixed</code> hostname SPI provider, with the hostname of the Red Hat Single Sign-On server set to the provided variable value, is used. See dedicated <a class="link" href="#advanced-concepts-sso-hostname-spi-setup" title="4.2. Customizing the Hostname for the Red Hat Single Sign-On Server">Customizing Hostname for the Red Hat Single Sign-On Server</a> section for additional steps to be performed, when <span class="strong strong"><strong><span class="emphasis"><em>SSO_HOSTNAME</em></span></strong></span> variable is set.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>rh-sso-server.openshift.example.com</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Name of the realm to be created in the Red Hat Single Sign-On server if this environment variable is provided.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>demo</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SERVICE_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The password for the Red Hat Single Sign-On service user.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>mgmt-password</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SERVICE_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The username used to access the Red Hat Single Sign-On service. This is used by clients to create the application client(s) within the specified Red Hat Single Sign-On realm. This user is created if this environment variable is provided.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>sso-mgmtuser</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The name of the truststore file within the secret.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>truststore.jks</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_DIR</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									Truststore directory.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>/etc/sso-secret-volume</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The password for the truststore and certificate.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>mykeystorepass</em></span></strong></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078743974512">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078743973424">
								<p>
									The name of the secret containing the truststore file. Used for <span class="emphasis"><em>sso-truststore-volume</em></span> volume.
								</p>
								</td><td align="left" valign="top" headers="idm140078743972336">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>truststore-secret</em></span></strong></span>
								</p>
								</td></tr></tbody></table></div></div><p>
					Available <a class="link" href="https://docs.openshift.com/container-platform/latest/openshift_images/using-templates.html">application templates</a> for Red Hat Single Sign-On for OpenShift can combine the <a class="link" href="#conf_env_vars" title="Table 6.2. Configuration Environment Variables">aforementioned configuration variables</a> with common OpenShift variables (for example <span class="strong strong"><strong><span class="emphasis"><em>APPLICATION_NAME</em></span></strong></span> or <span class="strong strong"><strong><span class="emphasis"><em>SOURCE_REPOSITORY_URL</em></span></strong></span>), product specific variables (e.g. <span class="strong strong"><strong><span class="emphasis"><em>HORNETQ_CLUSTER_PASSWORD</em></span></strong></span>), or configuration variables typical to database images (e.g. <span class="strong strong"><strong><span class="emphasis"><em>POSTGRESQL_MAX_CONNECTIONS</em></span></strong></span>) yet. All of these different types of configuration variables can be adjusted as desired to achieve the deployed Red Hat Single Sign-On-enabled application will align with the intended use case as much as possible. The list of configuration variables, available for each category of application templates for Red Hat Single Sign-On-enabled applications, is described below.
				</p></section><section class="section" id="template_variables_for_all_red_hat_single_sign_on_images"><div class="titlepage"><div><div><h3 class="title">6.2.3. Template variables for all Red Hat Single Sign-On images</h3></div></div></div><div class="table" id="idm140078744833712"><p class="title"><strong>Table 6.3. Configuration Variables Available For All Red Hat Single Sign-On Images</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078744828832" scope="col">Variable</th><th align="left" valign="top" id="idm140078744827744" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>APPLICATION_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name for the application.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>DB_MAX_POOL_SIZE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Sets xa-pool/max-pool-size for the configured datasource.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>DB_TX_ISOLATION</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Sets transaction-isolation for the configured datasource.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>DB_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Database user name.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTP</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Custom hostname for http service route. Leave blank for default hostname, e.g.: <span class="emphasis"><em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em></span>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTPS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Custom hostname for https service route. Leave blank for default hostname, e.g.: <span class="emphasis"><em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em></span>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name of the keystore file within the secret. If defined along with <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_NAME</em></span></strong></span>, enable HTTPS and set the SSL certificate key file to a relative path under <span class="emphasis"><em>$JBOSS_HOME/standalone/configuration</em></span>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE_TYPE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The type of the keystore file (JKS or JCEKS).
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name associated with the server certificate (e.g. <span class="emphasis"><em>jboss</em></span>). If defined along with <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>, enable HTTPS and set the SSL name.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The password for the keystore and certificate (e.g. <span class="emphasis"><em>mykeystorepass</em></span>). If defined along with <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_NAME</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>, enable HTTPS and set the SSL key password.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name of the secret containing the keystore file.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>IMAGE_STREAM_NAMESPACE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Namespace in which the ImageStreams for Red Hat Middleware images are installed. These ImageStreams are normally installed in the <span class="emphasis"><em>openshift</em></span> namespace. You should only need to modify this if you’ve installed the ImageStreams in a different namespace/project.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_CLUSTER_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									JGroups cluster password.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_KEYSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name of the keystore file within the secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name associated with the server certificate (e.g. <span class="emphasis"><em>secret-key</em></span>).
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The password for the keystore and certificate (e.g. <span class="emphasis"><em>password</em></span>).
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name of the secret containing the keystore file.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Username of the administrator account for the <code class="literal">master</code> realm of the Red Hat Single Sign-On server. <span class="strong strong"><strong>Required.</strong></span> If no value is specified, it is auto generated and displayed as an OpenShift instructional message when the template is instantiated.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_ADMIN_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Password of the administrator account for the <code class="literal">master</code> realm of the Red Hat Single Sign-On server. <span class="strong strong"><strong>Required.</strong></span> If no value is specified, it is auto generated and displayed as an OpenShift instructional message when the template is instantiated.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									Name of the realm to be created in the Red Hat Single Sign-On server if this environment variable is provided.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SERVICE_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The username used to access the Red Hat Single Sign-On service. This is used by clients to create the application client(s) within the specified Red Hat Single Sign-On realm. This user is created if this environment variable is provided.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SERVICE_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The password for the Red Hat Single Sign-On service user.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name of the truststore file within the secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The name of the secret containing the truststore file. Used for <span class="strong strong"><strong><span class="emphasis"><em>sso-truststore-volume</em></span></strong></span> volume.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744828832">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744827744">
								<p>
									The password for the truststore and certificate.
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="template_variables_specific_to_emphasis_role_strong_emphasis_sso75_openj9_postgresql_emphasis_emphasis_emphasis_role_strong_emphasis_sso75_openj9_postgresql_persistent_emphasis_emphasis_and_emphasis_role_strong_emphasis_sso75_openj9_x509_postgresql_persistent_emphasis_emphasis"><div class="titlepage"><div><div><h3 class="title">6.2.4. Template variables specific to <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql</em></span></strong></span>, <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-postgresql-persistent</em></span></strong></span>, and <span class="strong strong"><strong><span class="emphasis"><em>sso75-openj9-x509-postgresql-persistent</em></span></strong></span></h3></div></div></div><div class="table" id="idm140078744690528"><p class="title"><strong>Table 6.4. Configuration Variables Specific To Red Hat Single Sign-On-enabled PostgreSQL Applications With Ephemeral Or Persistent Storage</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078744685584" scope="col">Variable</th><th align="left" valign="top" id="idm140078744684496" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078744685584">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>DB_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744684496">
								<p>
									Database user name.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744685584">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>DB_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744684496">
								<p>
									Database user password.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744685584">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>DB_JNDI</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744684496">
								<p>
									Database JNDI name used by application to resolve the datasource, e.g. <span class="emphasis"><em>java:/jboss/datasources/postgresql</em></span>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744685584">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>POSTGRESQL_MAX_CONNECTIONS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744684496">
								<p>
									The maximum number of client connections allowed. This also sets the maximum number of prepared transactions.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078744685584">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>POSTGRESQL_SHARED_BUFFERS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078744684496">
								<p>
									Configures how much memory is dedicated to PostgreSQL for caching data.
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="template_variables_for_general_emphasis_role_strong_eap64_emphasis_and_emphasis_role_strong_eap71_emphasis_s2i_images"><div class="titlepage"><div><div><h3 class="title">6.2.5. Template variables for general <span class="strong strong"><strong>eap64</strong></span> and <span class="strong strong"><strong>eap71</strong></span> S2I images</h3></div></div></div><div class="table" id="idm140078742175616"><p class="title"><strong>Table 6.5. Configuration Variables For EAP 6.4 and EAP 7 Applications Built Via S2I</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078742170720" scope="col">Variable</th><th align="left" valign="top" id="idm140078742169632" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>APPLICATION_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name for the application.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>ARTIFACT_DIR</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Artifacts directory.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>AUTO_DEPLOY_EXPLODED</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Controls whether exploded deployment content should be automatically deployed.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>CONTEXT_DIR</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Path within Git project to build; empty for root project directory.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GENERIC_WEBHOOK_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Generic build trigger secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>GITHUB_WEBHOOK_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									GitHub trigger secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HORNETQ_CLUSTER_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									HornetQ cluster administrator password.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HORNETQ_QUEUES</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Queue names.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HORNETQ_TOPICS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Topic names.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTP</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Custom host name for http service route. Leave blank for default host name, e.g.: <span class="emphasis"><em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em></span>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HOSTNAME_HTTPS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Custom host name for https service route. Leave blank for default host name, e.g.: <span class="emphasis"><em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em></span>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE_TYPE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The type of the keystore file (JKS or JCEKS).
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name of the keystore file within the secret. If defined along with <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_NAME</em></span></strong></span>, enable HTTPS and set the SSL certificate key file to a relative path under <span class="emphasis"><em>$JBOSS_HOME/standalone/configuration</em></span>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name associated with the server certificate (e.g. <span class="emphasis"><em>jboss</em></span>). If defined along with <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>, enable HTTPS and set the SSL name.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The password for the keystore and certificate (e.g. <span class="emphasis"><em>mykeystorepass</em></span>). If defined along with <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_NAME</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>HTTPS_KEYSTORE</em></span></strong></span>, enable HTTPS and set the SSL key password.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>HTTPS_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name of the secret containing the keystore file.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>IMAGE_STREAM_NAMESPACE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Namespace in which the ImageStreams for Red Hat Middleware images are installed. These ImageStreams are normally installed in the <span class="emphasis"><em>openshift</em></span> namespace. You should only need to modify this if you’ve installed the ImageStreams in a different namespace/project.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_CLUSTER_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									JGroups cluster password.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_KEYSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name of the keystore file within the secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name associated with the server certificate (e.g. <span class="emphasis"><em>secret-key</em></span>).
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The password for the keystore and certificate (e.g. <span class="emphasis"><em>password</em></span>).
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>JGROUPS_ENCRYPT_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									The name of the secret containing the keystore file.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SOURCE_REPOSITORY_REF</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Git branch/tag reference.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742170720">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SOURCE_REPOSITORY_URL</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742169632">
								<p>
									Git source URI for application.
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="template_variables_specific_to_emphasis_role_strong_emphasis_eap64_sso_s2i_emphasis_emphasis_and_emphasis_role_strong_emphasis_eap71_sso_s2i_emphasis_emphasis_for_automatic_client_registration"><div class="titlepage"><div><div><h3 class="title">6.2.6. Template variables specific to <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span> for automatic client registration</h3></div></div></div><div class="table" id="idm140078742042320"><p class="title"><strong>Table 6.6. Configuration Variables For EAP 6.4 and EAP 7 Red Hat Single Sign-On-enabled Applications Built Via S2I</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078742037408" scope="col">Variable</th><th align="left" valign="top" id="idm140078742036320" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_URL</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									Red Hat Single Sign-On server location.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_REALM</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									Name of the realm to be created in the Red Hat Single Sign-On server if this environment variable is provided.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_USERNAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									The username used to access the Red Hat Single Sign-On service. This is used to create the application client(s) within the specified Red Hat Single Sign-On realm. This should match the <span class="strong strong"><strong><span class="emphasis"><em>SSO_SERVICE_USERNAME</em></span></strong></span> specified through one of the <span class="strong strong"><strong>sso75-openj9-</strong></span> templates.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									The password for the Red Hat Single Sign-On service user.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_PUBLIC_KEY</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									Red Hat Single Sign-On public key. Public key is recommended to be passed into the template to avoid man-in-the-middle security attacks.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									The Red Hat Single Sign-On client secret for confidential access.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SERVICE_URL</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									Red Hat Single Sign-On service location.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									The name of the secret containing the truststore file. Used for <span class="strong strong"><strong><span class="emphasis"><em>sso-truststore-volume</em></span></strong></span> volume.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									The name of the truststore file within the secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_TRUSTSTORE_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									The password for the truststore and certificate.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_BEARER_ONLY</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									Red Hat Single Sign-On client access type.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_DISABLE_SSL_CERTIFICATE_VALIDATION</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									If true SSL communication between EAP and the Red Hat Single Sign-On Server is insecure (i.e. certificate validation is disabled with curl)
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078742037408">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_ENABLE_CORS</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078742036320">
								<p>
									Enable CORS for Red Hat Single Sign-On applications.
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="template_variables_specific_to_emphasis_role_strong_emphasis_eap64_sso_s2i_emphasis_emphasis_and_emphasis_role_strong_emphasis_eap71_sso_s2i_emphasis_emphasis_for_automatic_client_registration_with_saml_clients"><div class="titlepage"><div><div><h3 class="title">6.2.7. Template variables specific to <span class="strong strong"><strong><span class="emphasis"><em>eap64-sso-s2i</em></span></strong></span> and <span class="strong strong"><strong><span class="emphasis"><em>eap71-sso-s2i</em></span></strong></span> for automatic client registration with SAML clients</h3></div></div></div><div class="table" id="idm140078746053072"><p class="title"><strong>Table 6.7. Configuration Variables For EAP 6.4 and EAP 7 Red Hat Single Sign-On-enabled Applications Built Via S2I Using SAML Protocol</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078746048128" scope="col">Variable</th><th align="left" valign="top" id="idm140078746047040" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078746048128">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_CERTIFICATE_NAME</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078746047040">
								<p>
									The name associated with the server certificate.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078746048128">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_KEYSTORE_PASSWORD</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078746047040">
								<p>
									The password for the keystore and certificate.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078746048128">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_KEYSTORE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078746047040">
								<p>
									The name of the keystore file within the secret.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078746048128">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_KEYSTORE_SECRET</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078746047040">
								<p>
									The name of the secret containing the keystore file.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140078746048128">
								<p>
									<span class="strong strong"><strong><span class="emphasis"><em>SSO_SAML_LOGOUT_PAGE</em></span></strong></span>
								</p>
								</td><td align="left" valign="top" headers="idm140078746047040">
								<p>
									Red Hat Single Sign-On logout page for SAML applications.
								</p>
								</td></tr></tbody></table></div></div></section></section><section class="section" id="exposed_ports"><div class="titlepage"><div><div><h2 class="title">6.3. Exposed Ports</h2></div></div></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140078746015520" scope="col">Port Number</th><th align="left" valign="top" id="idm140078746014432" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140078746015520">
							<p>
								<span class="strong strong"><strong><span class="emphasis"><em>8443</em></span></strong></span>
							</p>
							</td><td align="left" valign="top" headers="idm140078746014432">
							<p>
								HTTPS
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140078746015520">
							<p>
								<span class="strong strong"><strong><span class="emphasis"><em>8778</em></span></strong></span>
							</p>
							</td><td align="left" valign="top" headers="idm140078746014432">
							<p>
								Jolokia monitoring
							</p>
							</td></tr></tbody></table></div></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm140078750986432"><h1 class="legalnotice">Legal Notice</h1><div class="para">
				Copyright <span class="trademark"/>© 2020 Red Hat, Inc.
			</div><div class="para">
				Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
			</div><div class="para">
				<a class="ulink" href="http://www.apache.org/licenses/LICENSE-2.0"> http://www.apache.org/licenses/LICENSE-2.0</a>
			</div><div class="para">
				Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
			</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>