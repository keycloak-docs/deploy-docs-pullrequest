<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Server Administration Guide</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.4"/><meta name="description" content="This guide consists of information for administrators to configure Red Hat Single Sign-On 7.5"/><link rel="next" href="#making-open-source-more-inclusive" title="Making open source more inclusive"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm140556204459728"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat Single Sign-On</span> <span class="productnumber">7.5</span></div><div><h1 class="title">Server Administration Guide</h1></div><div><h2 class="subtitle">For Use with Red Hat Single Sign-On 7.5</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm140556191107216">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This guide consists of information for administrators to configure Red Hat Single Sign-On 7.5
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="preface"><a href="#making-open-source-more-inclusive">Making open source more inclusive</a></span></li><li><span class="chapter"><a href="#red_hat_single_sign_on_features_and_concepts">1. Red Hat Single Sign-On features and concepts</a></span><ul><li><span class="section"><a href="#features">1.1. Features</a></span></li><li><span class="section"><a href="#basic_red_hat_single_sign_on_operations">1.2. Basic Red Hat Single Sign-On operations</a></span></li><li><span class="section"><a href="#core_concepts_and_terms">1.3. Core concepts and terms</a></span></li></ul></li><li><span class="chapter"><a href="#creating-first-admin_server_administration_guide">2. Creating the first administrator</a></span><ul><li><span class="section"><a href="#creating_the_account_on_the_local_host">2.1. Creating the account on the local host</a></span></li><li><span class="section"><a href="#creating_the_account_remotely">2.2. Creating the account remotely</a></span></li></ul></li><li><span class="chapter"><a href="#configuring_realms">3. Configuring realms</a></span><ul><li><span class="section"><a href="#using_the_admin_console">3.1. Using the Admin Console</a></span></li><li><span class="section"><a href="#the_master_realm">3.2. The master realm</a></span></li><li><span class="section"><a href="#proc-creating-a-realm_server_administration_guide">3.3. Creating a realm</a></span></li><li><span class="section"><a href="#ssl_modes">3.4. Configuring SSL for a realm</a></span></li><li><span class="section"><a href="#clear-cache">3.5. Clearing server caches</a></span></li><li><span class="section"><a href="#email">3.6. Configuring email for a realm</a></span></li><li><span class="section"><a href="#themes">3.7. Configuring themes and internationalization</a></span><ul><li><span class="section"><a href="#enabling_internationalization">3.7.1. Enabling internationalization</a></span></li><li><span class="section"><a href="#user_locale_selection">3.7.2. User locale selection</a></span></li></ul></li><li><span class="section"><a href="#controlling_login_options">3.8. Controlling login options</a></span><ul><li><span class="section"><a href="#enabling_forgot_password">3.8.1. Enabling forgot password</a></span></li><li><span class="section"><a href="#enabling_remember_me">3.8.2. Enabling Remember Me</a></span></li></ul></li><li><span class="section"><a href="#realm_keys">3.9. Configuring realm keys</a></span><ul><li><span class="section"><a href="#rotating_keys">3.9.1. Rotating keys</a></span></li><li><span class="section"><a href="#adding_a_generated_keypair">3.9.2. Adding a generated keypair</a></span></li><li><span class="section"><a href="#adding_an_existing_keypair_and_certificate">3.9.3. Adding an existing keypair and certificate</a></span></li><li><span class="section"><a href="#loading_keys_from_a_java_keystore">3.9.4. Loading keys from a Java Keystore</a></span></li><li><span class="section"><a href="#making_keys_passive">3.9.5. Making keys passive</a></span></li><li><span class="section"><a href="#disabling_keys">3.9.6. Disabling keys</a></span></li><li><span class="section"><a href="#compromised_keys">3.9.7. Compromised keys</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#user-storage-federation">4. Using external storage</a></span><ul><li><span class="section"><a href="#adding_a_provider">4.1. Adding a provider</a></span></li><li><span class="section"><a href="#dealing_with_provider_failures">4.2. Dealing with provider failures</a></span></li><li><span class="section"><a href="#ldap">4.3. Lightweight Directory Access Protocol (LDAP) and Active Directory</a></span><ul><li><span class="section"><a href="#configuring_federated_ldap_storage">4.3.1. Configuring federated LDAP storage</a></span></li><li><span class="section"><a href="#storage_mode">4.3.2. Storage mode</a></span></li><li><span class="section"><a href="#edit_mode">4.3.3. Edit mode</a></span></li><li><span class="section"><a href="#other_configuration_options">4.3.4. Other configuration options</a></span></li><li><span class="section"><a href="#connecting_to_ldap_over_ssl">4.3.5. Connecting to LDAP over SSL</a></span></li><li><span class="section"><a href="#synchronizing_ldap_users_to_red_hat_single_sign_on">4.3.6. Synchronizing LDAP users to Red Hat Single Sign-On</a></span></li><li><span class="section"><a href="#ldap_mappers">4.3.7. LDAP mappers</a></span></li><li><span class="section"><a href="#ldap_password_hashing">4.3.8. Password hashing</a></span></li><li><span class="section"><a href="#ldap_troubleshooting">4.3.9. Troubleshooting</a></span></li></ul></li><li><span class="section"><a href="#sssd">4.4. SSSD and FreeIPA Identity Management integration</a></span><ul><li><span class="section"><a href="#freeipa_idm_server">4.4.1. FreeIPA/IdM server</a></span></li><li><span class="section"><a href="#sssd_and_d_bus">4.4.2. SSSD and D-Bus</a></span></li><li><span class="section"><a href="#enabling_the_sssd_federation_provider">4.4.3. Enabling the SSSD federation provider</a></span></li></ul></li><li><span class="section"><a href="#configuring_a_federated_sssd_store">4.5. Configuring a federated SSSD store</a></span></li><li><span class="section"><a href="#custom_providers">4.6. Custom providers</a></span></li></ul></li><li><span class="chapter"><a href="#assembly-managing-users_server_administration_guide">5. Managing users</a></span><ul><li><span class="section"><a href="#proc-searching-user_server_administration_guide">5.1. Searching for a user</a></span></li><li><span class="section"><a href="#proc-creating-user_server_administration_guide">5.2. Creating a user</a></span></li><li><span class="section"><a href="#proc-deleting-user_server_administration_guide">5.3. Deleting a user</a></span></li><li><span class="section"><a href="#proc-allow-user-to-delete-account_server_administration_guide">5.4. Enabling account deletion by users</a></span><ul><li><span class="section"><a href="#enabling_the_delete_account_capability">5.4.1. Enabling the Delete Account Capability</a></span></li><li><span class="section"><a href="#giving_a_user_the_emphasis_role_strong_delete_account_emphasis_role">5.4.2. Giving a user the <span class="strong strong"><strong>delete-account</strong></span> role</a></span></li><li><span class="section"><a href="#deleting_your_account">5.4.3. Deleting your account</a></span></li></ul></li><li><span class="section"><a href="#proc-configuring-user-attributes_server_administration_guide">5.5. Configuring user attributes</a></span></li><li><span class="section"><a href="#ref-user-credentials_server_administration_guide">5.6. User credentials</a></span><ul><li><span class="section"><a href="#proc-setting-password-user_server_administration_guide">5.6.1. Setting a password for a user</a></span></li><li><span class="section"><a href="#proc_creating-otp_server_administration_guide">5.6.2. Creating an OTP</a></span></li></ul></li><li><span class="section"><a href="#con-required-actions_server_administration_guide">5.7. Required actions</a></span><ul><li><span class="section"><a href="#proc-setting-required-actions_server_administration_guide">5.7.1. Setting required actions for one user</a></span></li><li><span class="section"><a href="#proc-setting-default-required-actions_server_administration_guide">5.7.2. Setting required actions for all users</a></span></li><li><span class="section"><a href="#proc-enabling-terms-conditions_server_administration_guide">5.7.3. Enabling terms and conditions as a required action</a></span></li></ul></li><li><span class="section"><a href="#con-user-impersonation_server_administration_guide">5.8. User impersonation</a></span></li><li><span class="section"><a href="#con-user-registration_server_administration_guide">5.9. User registration</a></span><ul><li><span class="section"><a href="#proc-enabling-user-registration_server_administration_guide">5.9.1. Enabling user registration</a></span></li><li><span class="section"><a href="#proc-registering-new-user_server_administration_guide">5.9.2. Registering as a new user</a></span></li></ul></li><li><span class="section"><a href="#proc-enabling-recaptcha_server_administration_guide">5.10. Enabling reCAPTCHA</a></span></li><li><span class="section"><a href="#ref-personal-data-collected_server_administration_guide">5.11. Personal data collected by Red Hat Single Sign-On</a></span></li><li><span class="section"><a href="#user_profile">5.12. User Profile</a></span><ul><li><span class="section"><a href="#enabling_the_user_profile">5.12.1. Enabling the User Profile</a></span></li><li><span class="section"><a href="#managing_the_user_profile">5.12.2. Managing the User Profile</a></span></li><li><span class="section"><a href="#managing_attributes">5.12.3. Managing Attributes</a></span></li><li><span class="section"><a href="#managing_attribute_groups">5.12.4. Managing Attribute Groups</a></span></li><li><span class="section"><a href="#using_the_json_configuration">5.12.5. Using the JSON configuration</a></span></li><li><span class="section"><a href="#using_dynamic_forms">5.12.6. Using dynamic forms</a></span></li><li><span class="section"><a href="#forcing_user_profile_compliance">5.12.7. Forcing User Profile compliance</a></span></li><li><span class="section"><a href="#migrating_to_user_profile">5.12.8. Migrating to User Profile</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#managing_user_sessions">6. Managing user sessions</a></span><ul><li><span class="section"><a href="#administering_sessions">6.1. Administering sessions</a></span><ul><li><span class="section"><a href="#the_emphasis_role_strong_logout_all_emphasis_operation">6.1.1. The <span class="strong strong"><strong>Logout all</strong></span> Operation</a></span></li><li><span class="section"><a href="#application_navigation">6.1.2. Application navigation</a></span></li><li><span class="section"><a href="#user_navigation">6.1.3. User navigation</a></span></li></ul></li><li><span class="section"><a href="#revocation-policy">6.2. Revocation policies</a></span></li><li><span class="section"><a href="#timeouts">6.3. Session and token timeouts</a></span></li><li><span class="section"><a href="#offline-access">6.4. Offline access</a></span></li><li><span class="section"><a href="#transient-session">6.5. Transient sessions</a></span></li></ul></li><li><span class="chapter"><a href="#assigning_permissions_and_access_using_roles_and_groups">7. Assigning permissions and access using roles and groups</a></span><ul><li><span class="section"><a href="#proc-creating-realm-roles_server_administration_guide">7.1. Creating a realm role</a></span></li><li><span class="section"><a href="#con-client-roles_server_administration_guide">7.2. Client roles</a></span></li><li><span class="section"><a href="#composite-roles">7.3. Converting a role to a composite role</a></span></li><li><span class="section"><a href="#proc-assigning-role-mappings_server_administration_guide">7.4. Assigning role mappings</a></span></li><li><span class="section"><a href="#default_roles">7.5. Using default roles</a></span></li><li><span class="section"><a href="#role_scope_mappings">7.6. Role scope mappings</a></span></li><li><span class="section"><a href="#proc-managing-groups_server_administration_guide">7.7. Groups</a></span><ul><li><span class="section"><a href="#con-comparing-groups-roles_server_administration_guide">7.7.1. Groups compared to roles</a></span></li><li><span class="section"><a href="#proc-specifying-default-groups_server_administration_guide">7.7.2. Using default groups</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#configuring_authentication">8. Configuring authentication</a></span><ul><li><span class="section"><a href="#password-policies">8.1. Password policies</a></span><ul><li><span class="section"><a href="#password_policy_types">8.1.1. Password policy types</a></span></li></ul></li><li><span class="section"><a href="#one_time_password_otp_policies">8.2. One Time Password (OTP) policies</a></span><ul><li><span class="section"><a href="#time_based_or_counter_based_one_time_passwords">8.2.1. Time-based or counter-based one time passwords</a></span></li><li><span class="section"><a href="#totp_configuration_options">8.2.2. TOTP configuration options</a></span></li><li><span class="section"><a href="#hotp_configuration_options">8.2.3. HOTP configuration options</a></span></li></ul></li><li><span class="section"><a href="#authentication-flows">8.3. Authentication flows</a></span><ul><li><span class="section"><a href="#built_in_flows">8.3.1. Built-in flows</a></span></li><li><span class="section"><a href="#creating_flows">8.3.2. Creating flows</a></span></li><li><span class="section"><a href="#creating_a_password_less_browser_login_flow">8.3.3. Creating a password-less browser login flow</a></span></li></ul></li><li><span class="section"><a href="#kerberos">8.4. Kerberos</a></span><ul><li><span class="section"><a href="#setup_of_kerberos_server">8.4.1. Setup of Kerberos server</a></span></li><li><span class="section"><a href="#setup_and_configuration_of_red_hat_single_sign_on_server">8.4.2. Setup and configuration of Red Hat Single Sign-On server</a></span></li><li><span class="section"><a href="#setup_and_configuration_of_client_machines">8.4.3. Setup and configuration of client machines</a></span></li><li><span class="section"><a href="#credential_delegation">8.4.4. Credential delegation</a></span></li><li><span class="section"><a href="#cross_realm_trust">8.4.5. Cross-realm trust</a></span></li><li><span class="section"><a href="#troubleshooting">8.4.6. Troubleshooting</a></span></li></ul></li><li><span class="section"><a href="#x509">8.5. X.509 client certificate user authentication</a></span><ul><li><span class="section"><a href="#features_2">8.5.1. Features</a></span></li><li><span class="section"><a href="#enable_x_509_client_certificate_user_authentication">8.5.2. Enable X.509 client certificate user authentication</a></span></li><li><span class="section"><a href="#browser_flow">8.5.3. Adding X.509 client certificate authentication to browser flows</a></span></li><li><span class="section"><a href="#configuring_x_509_client_certificate_authentication">8.5.4. Configuring X.509 client certificate authentication</a></span></li><li><span class="section"><a href="#adding_x_509_client_certificate_authentication_to_a_direct_grant_flow">8.5.5. Adding X.509 Client Certificate Authentication to a Direct Grant Flow</a></span></li><li><span class="section"><a href="#client_certificate_lookup">8.5.6. Client certificate lookup</a></span></li><li><span class="section"><a href="#troubleshooting_2">8.5.7. Troubleshooting</a></span></li></ul></li><li><span class="section"><a href="#webauthn">8.6. W3C Web Authentication (WebAuthn)</a></span><ul><li><span class="section"><a href="#setup">8.6.1. Setup</a></span></li><li><span class="section"><a href="#authenticate_with_webauthn_authenticator">8.6.2. Authenticate with WebAuthn authenticator</a></span></li><li><span class="section"><a href="#managing_webauthn_as_an_administrator">8.6.3. Managing WebAuthn as an administrator</a></span></li><li><span class="section"><a href="#attestation_statement_verification">8.6.4. Attestation statement verification</a></span></li><li><span class="section"><a href="#managing_webauthn_credentials_as_a_user">8.6.5. Managing WebAuthn credentials as a user</a></span></li><li><span class="section"><a href="#webauthn_passwordless">8.6.6. Passwordless WebAuthn together with Two-Factor</a></span></li><li><span class="section"><a href="#available_conditions">8.6.7. Available conditions</a></span></li><li><span class="section"><a href="#explicitly_deny_allow_access_in_conditional_flows">8.6.8. Explicitly deny/allow access in conditional flows</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#identity_broker">9. Integrating identity providers</a></span><ul><li><span class="section"><a href="#identity_broker_overview">9.1. Brokering overview</a></span></li><li><span class="section"><a href="#default_identity_provider">9.2. Default Identity Provider</a></span></li><li><span class="section"><a href="#general-idp-config">9.3. General configuration</a></span></li><li><span class="section"><a href="#social_identity_providers">9.4. Social Identity Providers</a></span><ul><li><span class="section"><a href="#bitbucket">9.4.1. Bitbucket</a></span></li><li><span class="section"><a href="#facebook">9.4.2. Facebook</a></span></li><li><span class="section"><a href="#github">9.4.3. GitHub</a></span></li><li><span class="section"><a href="#gitlab">9.4.4. GitLab</a></span></li><li><span class="section"><a href="#google">9.4.5. Google</a></span></li><li><span class="section"><a href="#linkedin">9.4.6. LinkedIn</a></span></li><li><span class="section"><a href="#microsoft">9.4.7. Microsoft</a></span></li><li><span class="section"><a href="#openshift_3">9.4.8. OpenShift 3</a></span></li><li><span class="section"><a href="#openshift_4">9.4.9. OpenShift 4</a></span></li><li><span class="section"><a href="#paypal">9.4.10. PayPal</a></span></li><li><span class="section"><a href="#stackoverflow">9.4.11. Stack overflow</a></span></li><li><span class="section"><a href="#twitter">9.4.12. Twitter</a></span></li><li><span class="section"><a href="#instagram">9.4.13. Instagram</a></span></li></ul></li><li><span class="section"><a href="#identity_broker_oidc">9.5. OpenID Connect v1.0 identity providers</a></span></li><li><span class="section"><a href="#saml_v2_0_identity_providers">9.6. SAML v2.0 Identity Providers</a></span><ul><li><span class="section"><a href="#identity_broker_saml_requested_authncontext">9.6.1. Requesting specific AuthnContexts</a></span></li><li><span class="section"><a href="#identity_broker_saml_sp_descriptor">9.6.2. SP Descriptor</a></span></li><li><span class="section"><a href="#identity_broker_saml_login_hint">9.6.3. Send subject in SAML requests</a></span></li></ul></li><li><span class="section"><a href="#client_suggested_idp">9.7. Client-suggested Identity Provider</a></span></li><li><span class="section"><a href="#mappers">9.8. Mapping claims and assertions</a></span></li><li><span class="section"><a href="#available_user_session_data">9.9. Available user session data</a></span></li><li><span class="section"><a href="#identity_broker_first_login">9.10. First login flow</a></span><ul><li><span class="section"><a href="#default_first_login_flow_authenticators">9.10.1. Default first login flow authenticators</a></span></li><li><span class="section"><a href="#automatically_link_existing_first_login_flow">9.10.2. Automatically link existing first login flow</a></span></li><li><span class="section"><a href="#disabling_automatic_user_creation">9.10.3. Disabling automatic user creation</a></span></li><li><span class="section"><a href="#detect_existing_user_first_loging_flow">9.10.4. Detect existing user first login flow</a></span></li></ul></li><li><span class="section"><a href="#retrieving_external_idp_tokens">9.11. Retrieving external IDP tokens</a></span></li><li><span class="section"><a href="#identity_broker_logout">9.12. Identity broker logout</a></span></li></ul></li><li><span class="chapter"><a href="#sso_protocols">10. SSO protocols</a></span><ul><li><span class="section"><a href="#con-oidc_server_administration_guide">10.1. OpenID Connect</a></span><ul><li><span class="section"><a href="#con-oidc-auth-flows_server_administration_guide">10.1.1. OIDC auth flows</a></span></li><li><span class="section"><a href="#oidc-logout">10.1.2. OIDC Logout</a></span></li><li><span class="section"><a href="#con-server-oidc-uri-endpoints_server_administration_guide">10.1.3. Red Hat Single Sign-On server OIDC URI endpoints</a></span></li></ul></li><li><span class="section"><a href="#saml">10.2. SAML</a></span><ul><li><span class="section"><a href="#con-saml-bindings_server_administration_guide">10.2.1. SAML bindings</a></span></li><li><span class="section"><a href="#red_hat_single_sign_on_server_saml_uri_endpoints">10.2.2. Red Hat Single Sign-On Server SAML URI Endpoints</a></span></li></ul></li><li><span class="section"><a href="#ref-saml-vs-oidc_server_administration_guide">10.3. OpenID Connect compared to SAML</a></span></li><li><span class="section"><a href="#docker">10.4. Docker registry v2 authentication</a></span><ul><li><span class="section"><a href="#docker_authentication_flow">10.4.1. Docker authentication flow</a></span></li><li><span class="section"><a href="#red_hat_single_sign_on_docker_registry_v2_authentication_server_uri_endpoints">10.4.2. Red Hat Single Sign-On Docker Registry v2 Authentication Server URI Endpoints</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#admin_permissions">11. Controlling access to the Admin Console</a></span><ul><li><span class="section"><a href="#master_realm_access_control">11.1. Master realm access control</a></span><ul><li><span class="section"><a href="#global_roles">11.1.1. Global roles</a></span></li><li><span class="section"><a href="#realm_specific_roles">11.1.2. Realm specific roles</a></span></li></ul></li><li><span class="section"><a href="#per_realm_admin_permissions">11.2. Dedicated realm admin consoles</a></span></li><li><span class="section"><a href="#fine_grain_permissions">11.3. Fine grain admin permissions</a></span><ul><li><span class="section"><a href="#managing_one_specific_client">11.3.1. Managing one specific client</a></span></li><li><span class="section"><a href="#restrict_user_role_mapping">11.3.2. Restrict user role mapping</a></span></li><li><span class="section"><a href="#full_list_of_permissions">11.3.3. Full list of permissions</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly-managing-clients_server_administration_guide">12. Managing OpenID Connect and SAML Clients</a></span><ul><li><span class="section"><a href="#oidc_clients">12.1. OIDC clients</a></span><ul><li><span class="section"><a href="#proc-creating-oidc-client_server_administration_guide">12.1.1. Creating an OpenID Connect Client</a></span></li><li><span class="section"><a href="#con-basic-settings_server_administration_guide">12.1.2. Basic settings</a></span></li><li><span class="section"><a href="#con-advanced-settings_server_administration_guide">12.1.3. Advanced settings</a></span></li><li><span class="section"><a href="#client-credentials">12.1.4. Confidential client credentials</a></span></li><li><span class="section"><a href="#service_accounts">12.1.5. Using a service account</a></span></li><li><span class="section"><a href="#audience-support">12.1.6. Audience support</a></span></li></ul></li><li><span class="section"><a href="#client-saml-configuration">12.2. Creating a SAML client</a></span><ul><li><span class="section"><a href="#idp_initiated_login">12.2.1. IDP Initiated login</a></span></li><li><span class="section"><a href="#proc-using-an-entity-descriptors_server_administration_guide">12.2.2. Using an entity descriptor to create a client</a></span></li></ul></li><li><span class="section"><a href="#con-client-links_server_administration_guide">12.3. Client links</a></span></li><li><span class="section"><a href="#protocol-mappers">12.4. OIDC token and SAML assertion mappings</a></span><ul><li><span class="section"><a href="#priority_order">12.4.1. Priority order</a></span></li><li><span class="section"><a href="#protocol-mappers_oidc-user-session-note-mappers">12.4.2. OIDC user session note mappers</a></span></li><li><span class="section"><a href="#script_mapper">12.4.3. Script mapper</a></span></li></ul></li><li><span class="section"><a href="#client_installation">12.5. Generating client adapter config</a></span></li><li><span class="section"><a href="#client_scopes">12.6. Client scopes</a></span><ul><li><span class="section"><a href="#protocol">12.6.1. Protocol</a></span></li><li><span class="section"><a href="#consent_related_settings">12.6.2. Consent related settings</a></span></li><li><span class="section"><a href="#client_scopes_linking">12.6.3. Link client scope with the client</a></span></li><li><span class="section"><a href="#client_scopes_evaluate">12.6.4. Evaluating Client Scopes</a></span></li><li><span class="section"><a href="#client_scopes_permissions">12.6.5. Client scopes permissions</a></span></li><li><span class="section"><a href="#realm_default_client_scopes">12.6.6. Realm default client scopes</a></span></li><li><span class="section"><a href="#scopes_explained">12.6.7. Scopes explained</a></span></li></ul></li><li><span class="section"><a href="#client_policies">12.7. Client Policies</a></span><ul><li><span class="section"><a href="#use_cases">12.7.1. Use-cases</a></span></li><li><span class="section"><a href="#protocol_2">12.7.2. Protocol</a></span></li><li><span class="section"><a href="#architecture">12.7.3. Architecture</a></span></li><li><span class="section"><a href="#configuration">12.7.4. Configuration</a></span></li><li><span class="section"><a href="#backward_compatibility">12.7.5. Backward Compatibility</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#vault-administration">13. Using a vault to obtain secrets</a></span><ul><li><span class="section"><a href="#providers">13.1. Kubernetes / OpenShift files plain-text vault provider</a></span></li><li><span class="section"><a href="#elytron_credential_store_vault_provider">13.2. Elytron credential store vault provider</a></span></li><li><span class="section"><a href="#key_resolvers">13.3. Key resolvers</a></span></li><li><span class="section"><a href="#sample_configuration">13.4. Sample Configuration</a></span><ul><li><span class="section"><a href="#configuring_the_credential_store_and_vault_without_a_mask">13.4.1. Configuring the credential store and vault without a mask</a></span></li><li><span class="section"><a href="#masking_the_password_in_the_credential_store_and_vault">13.4.2. Masking the password in the credential store and vault</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#configuring_auditing_to_track_events">14. Configuring auditing to track events</a></span><ul><li><span class="section"><a href="#login_events">14.1. Login events</a></span><ul><li><span class="section"><a href="#event_types">14.1.1. Event types</a></span></li><li><span class="section"><a href="#event_listener">14.1.2. Event listener</a></span></li></ul></li><li><span class="section"><a href="#admin_events">14.2. Admin events</a></span></li></ul></li><li><span class="chapter"><a href="#assembly-exporting-importing_server_administration_guide">15. Importing and exporting the database</a></span><ul><li><span class="section"><a href="#admin_console_export_import">15.1. Admin console export/import</a></span></li></ul></li><li><span class="chapter"><a href="#mitigating_security_threats">16. Mitigating security threats</a></span><ul><li><span class="section"><a href="#host">16.1. Host</a></span></li><li><span class="section"><a href="#admin_endpoints_and_admin_console">16.2. Admin endpoints and Admin Console</a></span><ul><li><span class="section"><a href="#ip_restriction">16.2.1. IP restriction</a></span></li><li><span class="section"><a href="#port_restriction">16.2.2. Port restriction</a></span></li></ul></li><li><span class="section"><a href="#password-guess-brute-force-attacks">16.3. Brute force attacks</a></span><ul><li><span class="section"><a href="#password_policies">16.3.1. Password policies</a></span></li></ul></li><li><span class="section"><a href="#read_only_user_attributes">16.4. Read-only user attributes</a></span></li><li><span class="section"><a href="#clickjacking">16.5. Clickjacking</a></span></li><li><span class="section"><a href="#ssl_https_requirement">16.6. SSL/HTTPS requirement</a></span></li><li><span class="section"><a href="#csrf_attacks">16.7. CSRF attacks</a></span></li><li><span class="section"><a href="#unspecific-redirect-uris_server_administration_guide">16.8. Unspecific redirect URIs</a></span></li><li><span class="section"><a href="#fapi_compliance">16.9. FAPI compliance</a></span></li><li><span class="section"><a href="#compromised_access_and_refresh_tokens">16.10. Compromised access and refresh tokens</a></span></li><li><span class="section"><a href="#compromised_authorization_code">16.11. Compromised authorization code</a></span></li><li><span class="section"><a href="#open_redirectors">16.12. Open redirectors</a></span></li><li><span class="section"><a href="#password_database_compromised">16.13. Password database compromised</a></span></li><li><span class="section"><a href="#limiting_scope">16.14. Limiting scope</a></span></li><li><span class="section"><a href="#limit_token_audience">16.15. Limit token audience</a></span></li><li><span class="section"><a href="#limit-authentication-sessions">16.16. Limit Authentication Sessions</a></span></li><li><span class="section"><a href="#sql_injection_attacks">16.17. SQL injection attacks</a></span></li></ul></li><li><span class="chapter"><a href="#account-service">17. Account Console</a></span><ul><li><span class="section"><a href="#accessing_the_account_console">17.1. Accessing the Account Console</a></span></li><li><span class="section"><a href="#configuring_ways_to_sign_in">17.2. Configuring ways to sign in</a></span><ul><li><span class="section"><a href="#two_factor_authentication_with_otp">17.2.1. Two-factor authentication with OTP</a></span></li><li><span class="section"><a href="#two_factor_authentication_with_webauthn">17.2.2. Two-factor authentication with WebAuthn</a></span></li><li><span class="section"><a href="#passwordless_authentication_with_webauthn">17.2.3. Passwordless authentication with WebAuthn</a></span></li></ul></li><li><span class="section"><a href="#viewing_device_activity">17.3. Viewing device activity</a></span></li><li><span class="section"><a href="#adding_an_identity_provider_acccount">17.4. Adding an identity provider acccount</a></span></li><li><span class="section"><a href="#accessing_other_applications">17.5. Accessing other applications</a></span></li></ul></li><li><span class="chapter"><a href="#admin_cli">18. Admin CLI</a></span><ul><li><span class="section"><a href="#installing_the_admin_cli">18.1. Installing the Admin CLI</a></span></li><li><span class="section"><a href="#using_the_admin_cli">18.2. Using the Admin CLI</a></span></li><li><span class="section"><a href="#authenticating">18.3. Authenticating</a></span></li><li><span class="section"><a href="#working_with_alternative_configurations">18.4. Working with alternative configurations</a></span></li><li><span class="section"><a href="#basic_operations_and_resource_uris">18.5. Basic operations and resource URIs</a></span></li><li><span class="section"><a href="#realm_operations">18.6. Realm operations</a></span></li><li><span class="section"><a href="#role_operations">18.7. Role operations</a></span></li><li><span class="section"><a href="#client_operations">18.8. Client operations</a></span></li><li><span class="section"><a href="#user_operations">18.9. User operations</a></span></li><li><span class="section"><a href="#group_operations">18.10. Group operations</a></span></li><li><span class="section"><a href="#identity_provider_operations">18.11. Identity provider operations</a></span></li><li><span class="section"><a href="#storage_provider_operations">18.12. Storage provider operations</a></span></li><li><span class="section"><a href="#adding_mappers">18.13. Adding mappers</a></span></li><li><span class="section"><a href="#authentication_operations">18.14. Authentication operations</a></span></li></ul></li></ul></div><section class="preface" id="making-open-source-more-inclusive"><div class="titlepage"><div><div><h1 class="title">Making open source more inclusive</h1></div></div></div><p>
			Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see <a class="link" href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright’s message</a>.
		</p></section><section class="chapter" id="red_hat_single_sign_on_features_and_concepts"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Red Hat Single Sign-On features and concepts</h1></div></div></div><p>
			Red Hat Single Sign-On is a single sign on solution for web apps and RESTful web services. The goal of Red Hat Single Sign-On is to make security simple so that it is easy for application developers to secure the apps and services they have deployed in their organization. Security features that developers normally have to write for themselves are provided out of the box and are easily tailorable to the individual requirements of your organization. Red Hat Single Sign-On provides customizable user interfaces for login, registration, administration, and account management. You can also use Red Hat Single Sign-On as an integration platform to hook it into existing LDAP and Active Directory servers. You can also delegate authentication to third party identity providers like Facebook and Google.
		</p><section class="section" id="features"><div class="titlepage"><div><div><h2 class="title">1.1. Features</h2></div></div></div><p>
				Red Hat Single Sign-On provides the following features:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Single-Sign On and Single-Sign Out for browser applications.
					</li><li class="listitem">
						OpenID Connect support.
					</li><li class="listitem">
						OAuth 2.0 support.
					</li><li class="listitem">
						SAML support.
					</li><li class="listitem">
						Identity Brokering - Authenticate with external OpenID Connect or SAML Identity Providers.
					</li><li class="listitem">
						Social Login - Enable login with Google, GitHub, Facebook, Twitter, and other social networks.
					</li><li class="listitem">
						User Federation - Sync users from LDAP and Active Directory servers.
					</li><li class="listitem">
						Kerberos bridge - Automatically authenticate users that are logged-in to a Kerberos server.
					</li><li class="listitem">
						Admin Console for central management of users, roles, role mappings, clients and configuration.
					</li><li class="listitem">
						Account Management console that allows users to centrally manage their account.
					</li><li class="listitem">
						Theme support - Customize all user facing pages to integrate with your applications and branding.
					</li><li class="listitem">
						Two-factor Authentication - Support for TOTP/HOTP via Google Authenticator or FreeOTP.
					</li><li class="listitem">
						Login flows - optional user self-registration, recover password, verify email, require password update, etc.
					</li><li class="listitem">
						Session management - Admins and users themselves can view and manage user sessions.
					</li><li class="listitem">
						Token mappers - Map user attributes, roles, etc. how you want into tokens and statements.
					</li><li class="listitem">
						Not-before revocation policies per realm, application and user.
					</li><li class="listitem">
						CORS support - Client adapters have built-in support for CORS.
					</li><li class="listitem">
						Client adapters for JavaScript applications, JBoss EAP, Fuse, etc.
					</li><li class="listitem">
						Supports any platform/language that has an OpenID Connect Relying Party library or SAML 2.0 Service Provider library.
					</li></ul></div></section><section class="section" id="basic_red_hat_single_sign_on_operations"><div class="titlepage"><div><div><h2 class="title">1.2. Basic Red Hat Single Sign-On operations</h2></div></div></div><p>
				Red Hat Single Sign-On is a separate server that you manage on your network. Applications are configured to point to and be secured by this server. Red Hat Single Sign-On uses open protocol standards like <a class="link" href="https://openid.net/connect/">OpenID Connect</a> or <a class="link" href="http://saml.xml.org/saml-specifications">SAML 2.0</a> to secure your applications. Browser applications redirect a user’s browser from the application to the Red Hat Single Sign-On authentication server where they enter their credentials. This redirection is important because users are completely isolated from applications and applications never see a user’s credentials. Applications instead are given an identity token or assertion that is cryptographically signed. These tokens can have identity information like username, address, email, and other profile data. They can also hold permission data so that applications can make authorization decisions. These tokens can also be used to make secure invocations on REST-based services.
			</p></section><section class="section" id="core_concepts_and_terms"><div class="titlepage"><div><div><h2 class="title">1.3. Core concepts and terms</h2></div></div></div><p>
				Consider these core concepts and terms before attempting to use Red Hat Single Sign-On to secure your web applications and REST services.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">users</span></dt><dd>
							Users are entities that are able to log into your system. They can have attributes associated with themselves like email, username, address, phone number, and birth day. They can be assigned group membership and have specific roles assigned to them.
						</dd><dt><span class="term">authentication</span></dt><dd>
							The process of identifying and validating a user.
						</dd><dt><span class="term">authorization</span></dt><dd>
							The process of granting access to a user.
						</dd><dt><span class="term">credentials</span></dt><dd>
							Credentials are pieces of data that Red Hat Single Sign-On uses to verify the identity of a user. Some examples are passwords, one-time-passwords, digital certificates, or even fingerprints.
						</dd><dt><span class="term">roles</span></dt><dd>
							Roles identify a type or category of user. <code class="literal">Admin</code>, <code class="literal">user</code>, <code class="literal">manager</code>, and <code class="literal">employee</code> are all typical roles that may exist in an organization. Applications often assign access and permissions to specific roles rather than individual users as dealing with users can be too fine grained and hard to manage.
						</dd><dt><span class="term">user role mapping</span></dt><dd>
							A user role mapping defines a mapping between a role and a user. A user can be associated with zero or more roles. This role mapping information can be encapsulated into tokens and assertions so that applications can decide access permissions on various resources they manage.
						</dd><dt><span class="term">composite roles</span></dt><dd>
							A composite role is a role that can be associated with other roles. For example a <code class="literal">superuser</code> composite role could be associated with the <code class="literal">sales-admin</code> and <code class="literal">order-entry-admin</code> roles. If a user is mapped to the <code class="literal">superuser</code> role they also inherit the <code class="literal">sales-admin</code> and <code class="literal">order-entry-admin</code> roles.
						</dd><dt><span class="term">groups</span></dt><dd>
							Groups manage groups of users. Attributes can be defined for a group. You can map roles to a group as well. Users that become members of a group inherit the attributes and role mappings that group defines.
						</dd><dt><span class="term">realms</span></dt><dd>
							A realm manages a set of users, credentials, roles, and groups. A user belongs to and logs into a realm. Realms are isolated from one another and can only manage and authenticate the users that they control.
						</dd><dt><span class="term">clients</span></dt><dd>
							Clients are entities that can request Red Hat Single Sign-On to authenticate a user. Most often, clients are applications and services that want to use Red Hat Single Sign-On to secure themselves and provide a single sign-on solution. Clients can also be entities that just want to request identity information or an access token so that they can securely invoke other services on the network that are secured by Red Hat Single Sign-On.
						</dd><dt><span class="term">client adapters</span></dt><dd>
							Client adapters are plugins that you install into your application environment to be able to communicate and be secured by Red Hat Single Sign-On. Red Hat Single Sign-On has a number of adapters for different platforms that you can download. There are also third-party adapters you can get for environments that we don’t cover.
						</dd><dt><span class="term">consent</span></dt><dd>
							Consent is when you as an admin want a user to give permission to a client before that client can participate in the authentication process. After a user provides their credentials, Red Hat Single Sign-On will pop up a screen identifying the client requesting a login and what identity information is requested of the user. User can decide whether or not to grant the request.
						</dd><dt><span class="term">client scopes</span></dt><dd>
							When a client is registered, you must define protocol mappers and role scope mappings for that client. It is often useful to store a client scope, to make creating new clients easier by sharing some common settings. This is also useful for requesting some claims or roles to be conditionally based on the value of <code class="literal">scope</code> parameter. Red Hat Single Sign-On provides the concept of a client scope for this.
						</dd><dt><span class="term">client role</span></dt><dd>
							Clients can define roles that are specific to them. This is basically a role namespace dedicated to the client.
						</dd><dt><span class="term">identity token</span></dt><dd>
							A token that provides identity information about the user. Part of the OpenID Connect specification.
						</dd><dt><span class="term">access token</span></dt><dd>
							A token that can be provided as part of an HTTP request that grants access to the service being invoked on. This is part of the OpenID Connect and OAuth 2.0 specification.
						</dd><dt><span class="term">assertion</span></dt><dd>
							Information about a user. This usually pertains to an XML blob that is included in a SAML authentication response that provided identity metadata about an authenticated user.
						</dd><dt><span class="term">service account</span></dt><dd>
							Each client has a built-in service account which allows it to obtain an access token.
						</dd><dt><span class="term">direct grant</span></dt><dd>
							A way for a client to obtain an access token on behalf of a user via a REST invocation.
						</dd><dt><span class="term">protocol mappers</span></dt><dd>
							For each client you can tailor what claims and assertions are stored in the OIDC token or SAML assertion. You do this per client by creating and configuring protocol mappers.
						</dd><dt><span class="term">session</span></dt><dd>
							When a user logs in, a session is created to manage the login session. A session contains information like when the user logged in and what applications have participated within single-sign on during that session. Both admins and users can view session information.
						</dd><dt><span class="term">user federation provider</span></dt><dd>
							Red Hat Single Sign-On can store and manage users. Often, companies already have LDAP or Active Directory services that store user and credential information. You can point Red Hat Single Sign-On to validate credentials from those external stores and pull in identity information.
						</dd><dt><span class="term">identity provider</span></dt><dd>
							An identity provider (IDP) is a service that can authenticate a user. Red Hat Single Sign-On is an IDP.
						</dd><dt><span class="term">identity provider federation</span></dt><dd>
							Red Hat Single Sign-On can be configured to delegate authentication to one or more IDPs. Social login via Facebook or Google+ is an example of identity provider federation. You can also hook Red Hat Single Sign-On to delegate authentication to any other OpenID Connect or SAML 2.0 IDP.
						</dd><dt><span class="term">identity provider mappers</span></dt><dd>
							When doing IDP federation you can map incoming tokens and assertions to user and session attributes. This helps you propagate identity information from the external IDP to your client requesting authentication.
						</dd><dt><span class="term">required actions</span></dt><dd>
							Required actions are actions a user must perform during the authentication process. A user will not be able to complete the authentication process until these actions are complete. For example, an admin may schedule users to reset their passwords every month. An <code class="literal">update password</code> required action would be set for all these users.
						</dd><dt><span class="term">authentication flows</span></dt><dd>
							Authentication flows are work flows a user must perform when interacting with certain aspects of the system. A login flow can define what credential types are required. A registration flow defines what profile information a user must enter and whether something like reCAPTCHA must be used to filter out bots. Credential reset flow defines what actions a user must do before they can reset their password.
						</dd><dt><span class="term">events</span></dt><dd>
							Events are audit streams that admins can view and hook into.
						</dd><dt><span class="term">themes</span></dt><dd>
							Every screen provided by Red Hat Single Sign-On is backed by a theme. Themes define HTML templates and stylesheets which you can override as needed.
						</dd></dl></div></section></section><section class="chapter" id="creating-first-admin_server_administration_guide"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Creating the first administrator</h1></div></div></div><p>
			After installing Red Hat Single Sign-On, you need an administrator account that can act as a <span class="emphasis"><em>super</em></span> admin with full permisions to manage all parts of Red Hat Single Sign-On. With this account, you can log into the Red Hat Single Sign-On Admin Console where you create realms and users and register applications that are secured by Red Hat Single Sign-On.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					Perform the installation and configuration tasks defined in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/">Server Installation and Configuration Guide</a> to the point that the Red Hat Single Sign-On server is running.
				</li></ul></div><section class="section" id="creating_the_account_on_the_local_host"><div class="titlepage"><div><div><h2 class="title">2.1. Creating the account on the local host</h2></div></div></div><p>
				If your server is accessible from <code class="literal">localhost</code>, perform these steps.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In a web browser, go to the <a class="link" href="http://localhost:8080/auth">http://localhost:8080/auth</a> URL.
					</li><li class="listitem"><p class="simpara">
						Supply a username and password that you can recall.
					</p><div class="formalpara"><p class="title"><strong>Welcome page</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/initial-welcome-page.png" alt="Welcome Page"/></span>
						</p></div></li></ol></div></section><section class="section" id="creating_the_account_remotely"><div class="titlepage"><div><div><h2 class="title">2.2. Creating the account remotely</h2></div></div></div><p>
				If you cannot access the server from a <code class="literal">localhost</code> address, or just want to start Red Hat Single Sign-On from the command line, use the <code class="literal">…​/bin/add-user-keycloak</code> script.
			</p><div class="formalpara"><p class="title"><strong>Add-user-keycloak script</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/add-user-script.png" alt="add user script"/></span>
				</p></div><p>
				The parameters are a little different depending if you are using the standalone operation mode or domain operation mode. For standalone mode, here is how you use the script.
			</p><div class="formalpara"><p class="title"><strong>Linux/Unix</strong></p><p>
					
<pre class="screen">$ .../bin/add-user-keycloak.sh -r master -u &lt;username&gt; -p &lt;password&gt;</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Windows</strong></p><p>
					
<pre class="screen">&gt; ...\bin\add-user-keycloak.bat -r master -u &lt;username&gt; -p &lt;password&gt;</pre>
				</p></div><p>
				For domain mode, you have to point the script to one of your server hosts using the <code class="literal">-sc</code> switch.
			</p><div class="formalpara"><p class="title"><strong>Linux/Unix</strong></p><p>
					
<pre class="screen">$ .../bin/add-user-keycloak.sh --sc domain/servers/server-one/configuration -r master -u &lt;username&gt; -p &lt;password&gt;</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Windows</strong></p><p>
					
<pre class="screen">&gt; ...\bin\add-user-keycloak.bat --sc domain/servers/server-one/configuration -r master -u &lt;username&gt; -p &lt;password&gt;</pre>
				</p></div></section></section><section class="chapter" id="configuring_realms"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Configuring realms</h1></div></div></div><p>
			Once you have an administrative account for the Admin Console, you can configure realms. A realm is a space where you manage objects, including users, applications, roles, and groups. A user belongs to and logs into a realm. One Red Hat Single Sign-On deployment can define, store, and manage as many realms as there is space for in the database.
		</p><section class="section" id="using_the_admin_console"><div class="titlepage"><div><div><h2 class="title">3.1. Using the Admin Console</h2></div></div></div><p>
				You configure realms and perform most administrative tasks in the Red Hat Single Sign-On Admin Console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You need an administrator account. See <a class="link" href="#creating-first-admin_server_administration_guide" title="Chapter 2. Creating the first administrator">Creating the first administrator</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Go the the URL for the Admin Console.
					</p><p class="simpara">
						For example, for localhost, use this URL: <a class="link" href="http://localhost:8080/auth/admin/">http://localhost:8080/auth/admin/</a>
					</p><div class="formalpara"><p class="title"><strong>Login page</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/login-page.png" alt="Login page"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Enter the username and password you created on the Welcome Page or the <code class="literal">add-user-keycloak</code> script in the bin directory. This action displays the Admin Console.
					</p><div class="formalpara"><p class="title"><strong>Admin Console</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/admin-console.png" alt="Admin Console"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Note the menus and other options that you can use:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Click the menu labeled <span class="strong strong"><strong>Master</strong></span> to pick a realm you want to manage or to create a new one.
							</li><li class="listitem">
								Click the top right list to view your account or log out.
							</li><li class="listitem">
								Hover over a question mark <span class="strong strong"><strong>?</strong></span> icon to show a tooltip text that describes that field. The image above shows the tooltip in action.
							</li></ul></div></li></ol></div></section><section class="section" id="the_master_realm"><div class="titlepage"><div><div><h2 class="title">3.2. The master realm</h2></div></div></div><p>
				In the Admin Console, two types of realms exist:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">Master realm</code> - This realm was created for you when you first started Red Hat Single Sign-On. It contains the administrator account you created at the first login. Use the <span class="emphasis"><em>master</em></span> realm only to create and manage the realms in your system.
					</li><li class="listitem">
						<code class="literal">Other realms</code> - These realms are created by the administrator in the master realm. In these realms, administrators manage the users in your organization and the applications they need. The applications are owned by the users.
					</li></ul></div><div class="formalpara"><p class="title"><strong>Realms and applications</strong></p><p>
					<span class="inlinemediaobject"><img src="images/master_realm.png" alt="Realms and applications"/></span>
				</p></div><p>
				Realms are isolated from one another and can only manage and authenticate the users that they control. Following this security model helps prevent accidental changes and follows the tradition of permitting user accounts access to only those privileges and powers necessary for the successful completion of their current task.
			</p><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						See <a class="link" href="#per_realm_admin_permissions" title="11.2. Dedicated realm admin consoles">Dedicated Realm Admin Consoles</a> if you want to disable the <span class="emphasis"><em>master</em></span> realm and define administrator accounts within any new realm you create. Each realm has its own dedicated Admin Console that you can log into with local accounts.
					</li></ul></div></section><section class="section" id="proc-creating-a-realm_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">3.3. Creating a realm</h2></div></div></div><p class="_abstract _abstract">
				You create a realm to provide a management space where you can create users and give them permissions to use applications. At first login, you are typically in the <span class="emphasis"><em>master</em></span> realm, the top-level realm from which you create other realms.
			</p><p>
				When deciding what realms you need, consider the kind of isolation you want to have for your users and applications. For example, you might create a realm for the employees of your company and a separate realm for your customers. Your employees would log into the employee realm and only be able to visit internal company applications. Customers would log into the customer realm and only be able to interact with customer-facing apps.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Point to the top of the left pane.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Add Realm</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Add realm menu</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/add-realm-menu.png" alt="Add realm menu"/></span>
						</p></div></li><li class="listitem">
						Enter a name for the realm.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Create realm</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/create-realm.png" alt="Create realm"/></span>
						</p></div></li></ol></div><p>
				The current realm is now set to the realm you just created. You can switch between managing different realms by pointing to the top left corner to click <span class="strong strong"><strong>Select Realm</strong></span>.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						Alternatively you can import a JSON document that defines your new realm. For more detail, see the <a class="link" href="#assembly-exporting-importing_server_administration_guide" title="Chapter 15. Importing and exporting the database">Export and Import</a> chapter.
					</li></ul></div></section><section class="section" id="ssl_modes"><div class="titlepage"><div><div><h2 class="title">3.4. Configuring SSL for a realm</h2></div></div></div><p>
				Each realm has an associated SSL Mode, which defines the SSL/HTTPS requirements for interacting with the realm. Browsers and applications that interact with the realm honor the SSL/HTTPS requirements defined by the SSL Mode or they cannot interact with the server.
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Red Hat Single Sign-On generates a self-signed certificate the first time it runs. Please note that self-signed certificates are not secure, and should only be used for testing purposes. It is highly recommended that you install a CA-signed certificate on the Red Hat Single Sign-On server itself or on a reverse proxy in front of the Red Hat Single Sign-On server. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/">Server Installation and Configuration Guide</a>.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Login</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Login tab</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/login-tab.png" alt="Login tab"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Set <span class="strong strong"><strong>Require SSL</strong></span> to one of the following SSL modes:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								external requests:: Users can interact with Red Hat Single Sign-On without SSL so long as they stick to private IP addresses such as <code class="literal">localhost</code>, <code class="literal">127.0.0.1</code>, <code class="literal">10.x.x.x</code>, <code class="literal">192.168.x.x</code>, and <code class="literal">172.16.x.x</code>. If you try to access Red Hat Single Sign-On without SSL from a non-private IP address, you will get an error.
							</li><li class="listitem">
								none:: Red Hat Single Sign-On does not require SSL. This choice applies only in development when you are experimenting and do not plan to support this deployment.
							</li><li class="listitem">
								all requests:: Red Hat Single Sign-On requires SSL for all IP addresses.
							</li></ul></div></li></ol></div></section><section class="section" id="clear-cache"><div class="titlepage"><div><div><h2 class="title">3.5. Clearing server caches</h2></div></div></div><p>
				Red Hat Single Sign-On caches everything it can in memory within the limits of your JVM and the limits you have configured. If the Red Hat Single Sign-On database is modified by a third party, such as a DBA, outside the scope of the server’s REST APIs or Admin Console, parts of the in-memory cache could be stale. You can clear the realm cache, user cache or cache of external public keys, such as Public keys of external clients or Identity providers, which Red Hat Single Sign-On may use to verify signatures of particular external entity.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Cache</strong></span> tab.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Clear</strong></span> for the cache you want to evict.
					</p><div class="formalpara"><p class="title"><strong>Cache tab</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/cache-tab.png" alt="Cache tab"/></span>
						</p></div></li></ol></div></section><section class="section" id="email"><div class="titlepage"><div><div><h2 class="title">3.6. Configuring email for a realm</h2></div></div></div><p>
				Red Hat Single Sign-On sends emails to users to verify their email addresses, when they forget their passwords, or when an administrator needs to receive notifications about a server event. To enable Red Hat Single Sign-On to send emails, you provide Red Hat Single Sign-On with your SMTP server settings.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Email</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Email tab</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/email-tab.png" alt="Email Tab"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Fill in the fields and toggle the switches as needed.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Host</span></dt><dd>
									<span class="strong strong"><strong>Host</strong></span> denotes the SMTP server hostname used for sending emails.
								</dd><dt><span class="term">Port</span></dt><dd>
									<span class="strong strong"><strong>Port</strong></span> denotes the SMTP server port.
								</dd><dt><span class="term">From</span></dt><dd>
									<span class="strong strong"><strong>From</strong></span> denotes the address used for the <span class="strong strong"><strong>From</strong></span> SMTP-Header for the emails sent.
								</dd><dt><span class="term">From Display Name</span></dt><dd>
									<span class="strong strong"><strong>From Display Name</strong></span> allows to configure a user friendly email address aliases (optional). If not set the plain <span class="strong strong"><strong>From</strong></span> email address will be displayed in email clients.
								</dd><dt><span class="term">Reply To</span></dt><dd>
									<span class="strong strong"><strong>Reply To</strong></span> denotes the address used for the <span class="strong strong"><strong>Reply-To</strong></span> SMTP-Header for the mails sent (optional). If not set the plain <span class="strong strong"><strong>From</strong></span> email address will be used.
								</dd><dt><span class="term">Reply To Display Name</span></dt><dd>
									<span class="strong strong"><strong>Reply To Display Name</strong></span> allows to configure a user friendly email address aliases (optional). If not set the plain <span class="strong strong"><strong>Reply To</strong></span> email address will be displayed.
								</dd><dt><span class="term">Envelope From</span></dt><dd>
									<span class="strong strong"><strong>Envelope From</strong></span> denotes the <a class="link" href="https://en.wikipedia.org/wiki/Bounce_address">Bounce Address</a> used for the <span class="strong strong"><strong>Return-Path</strong></span> SMTP-Header for the mails sent (optional).
								</dd><dt><span class="term">Enable SSL and Enable StartTSL</span></dt><dd>
									Toggle one of these switches to <span class="strong strong"><strong>ON</strong></span> to support sending emails for recovering usernames and passwords, especially if the SMTP server is on an external network. You will most likely need to change the <span class="strong strong"><strong>Port</strong></span> to 465, the default port for SSL/TLS.
								</dd><dt><span class="term">Enable Authentication</span></dt><dd>
									Set this switch to <span class="strong strong"><strong>ON</strong></span> if your SMTP server requires authentication. When prompted, supply the <span class="strong strong"><strong>Username</strong></span> and <span class="strong strong"><strong>Password</strong></span>. The value of the <span class="strong strong"><strong>Password</strong></span> field can refer a value from an external <a class="link" href="#vault-administration" title="Chapter 13. Using a vault to obtain secrets">vault</a>.
								</dd></dl></div></li></ol></div></section><section class="section" id="themes"><div class="titlepage"><div><div><h2 class="title">3.7. Configuring themes and internationalization</h2></div></div></div><p>
				For a given realm, you can change the appearance of any UI, including the language that appears, in Red Hat Single Sign-On by using themes.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Realm Setting</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Themes</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Themes tab</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/themes-tab.png" alt="Themes tab"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Pick the theme you want for each UI category and click <span class="strong strong"><strong>Save</strong></span>.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Login Theme</span></dt><dd>
									Username password entry, OTP entry, new user registration, and other similar screens related to login.
								</dd><dt><span class="term">Account Theme</span></dt><dd>
									Each user has an User Account Management UI.
								</dd><dt><span class="term">Admin Console Theme</span></dt><dd>
									The skin of the Red Hat Single Sign-On Admin Console.
								</dd><dt><span class="term">Email Theme</span></dt><dd>
									Whenever Red Hat Single Sign-On has to send out an email, it uses templates defined in this theme to craft the email.
								</dd></dl></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> describes how to create a new theme or modify existing ones.
					</li></ul></div><section class="section" id="enabling_internationalization"><div class="titlepage"><div><div><h3 class="title">3.7.1. Enabling internationalization</h3></div></div></div><p>
					Every UI screen is internationalized in Red Hat Single Sign-On. The default language is English, but you can choose which locales you want to support and what the default locale will be.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Theme</strong></span> tab.
						</li><li class="listitem">
							Set <span class="strong strong"><strong>Internationalization</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
						</li></ol></div><p>
					The next time a user logs in, that user can choose a language on the login page to use for the login screens, Account Console, and Admin Console.
				</p><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> explains how you can offer additional languages. All internationalized texts which are provided by the theme can be overwritten by realm-specific texts on the <span class="strong strong"><strong>Localization</strong></span> tab.
						</li></ul></div></section><section class="section" id="user_locale_selection"><div class="titlepage"><div><div><h3 class="title">3.7.2. User locale selection</h3></div></div></div><p>
					A locale selector provider suggests the best locale on the information available. However, it is often unknown who the user is. For this reason, the previously authenticated user’s locale is remembered in a persisted cookie.
				</p><p>
					The logic for selecting the locale uses the first of the following that is available:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							User selected - when the user has selected a locale using the drop-down locale selector
						</li><li class="listitem">
							User profile - when there is an authenticated user and the user has a preferred locale set
						</li><li class="listitem">
							Client selected - passed by the client using for example ui_locales parameter
						</li><li class="listitem">
							Cookie - last locale selected on the browser
						</li><li class="listitem">
							Accepted language - locale from <span class="strong strong"><strong>Accept-Language</strong></span> header
						</li><li class="listitem">
							Realm default
						</li><li class="listitem">
							If none of the above, fall back to English
						</li></ul></div><p>
					When a user is authenticated an action is triggered to update the locale in the persisted cookie mentioned earlier. If the user has actively switched the locale through the locale selector on the login pages the users locale is also updated at this point.
				</p><p>
					If you want to change the logic for selecting the locale, you have an option to create custom <code class="literal">LocaleSelectorProvider</code>. For details, please refer to the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/#_locale_selector">Server Developer Guide</a>. When a user is authenticated, an action is triggered to update the locale in the persisted cookie mentioned earlier. If the user has actively switched the locale through the locale selector on the login pages, the user’s locale is also updated at this point.
				</p><p>
					If you want to change the logic for selecting the locale, you have an option to create a custom <code class="literal">LocaleSelectorProvider</code>. For details, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/#_locale_selector">Server Developer Guide</a>.
				</p></section></section><section class="section" id="controlling_login_options"><div class="titlepage"><div><div><h2 class="title">3.8. Controlling login options</h2></div></div></div><p>
				Red Hat Single Sign-On includes several built-in login page features.
			</p><section class="section" id="enabling_forgot_password"><div class="titlepage"><div><div><h3 class="title">3.8.1. Enabling forgot password</h3></div></div></div><p>
					If you enable <code class="literal">Forgot Password</code>, users can reset their login credentials if they forget their passwords or lose their OTP generator.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							Click the <span class="strong strong"><strong>Login</strong></span> tab.
						</p><div class="formalpara"><p class="title"><strong>Login tab</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/login-tab.png" alt="Login Tab"/></span>
							</p></div></li><li class="listitem"><p class="simpara">
							Toggle <span class="strong strong"><strong>Forgot Password</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
						</p><p class="simpara">
							A <code class="literal">forgot password</code> link displays in your login pages.
						</p><div class="formalpara"><p class="title"><strong>Forgot password link</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/forgot-password-link.png" alt="Forgot Password Link"/></span>
							</p></div></li><li class="listitem"><p class="simpara">
							Click this link to bring users where they can enter their username or email address and receive an email with a link to reset their credentials.
						</p><div class="formalpara"><p class="title"><strong>Forgot password page</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/forgot-password-page.png" alt="Forgot Password Page"/></span>
							</p></div></li></ol></div><p>
					The text sent in the email is configurable. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more information.
				</p><p>
					When users click the email link, Red Hat Single Sign-On asks them to update their password, and if they have set up an OTP generator, Red Hat Single Sign-On asks them to reconfigure the OTP generator. Depending on security requirements of your organization, you may not want users to reset their OTP generator through email.
				</p><p>
					To change this behavior, perform these steps:
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Flows</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							Select the <span class="strong strong"><strong>Reset Credentials</strong></span> flow.
						</p><div class="formalpara"><p class="title"><strong>Reset credentials flow</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/reset-credentials-flow.png" alt="Reset Credentials Flow"/></span>
							</p></div><p class="simpara">
							If you do not want to reset the OTP, set the <code class="literal">Reset OTP</code> requirement to <span class="strong strong"><strong>Disabled</strong></span>.
						</p></li><li class="listitem">
							Click the <span class="strong strong"><strong>Required Actions</strong></span> tab. Ensure <span class="emphasis"><em>Update Password</em></span> is enabled.
						</li></ol></div></section><section class="section" id="enabling_remember_me"><div class="titlepage"><div><div><h3 class="title">3.8.2. Enabling Remember Me</h3></div></div></div><p>
					A logged-in user closing their browser destroys their session, and that user must log in again. You can set Red Hat Single Sign-On to keep the user’s login session open if that user clicks the <span class="emphasis"><em>Remember Me</em></span> checkbox upon login. This action turns the login cookie from a session-only cookie to a persistence cookie.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Login</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							Toggle the <span class="strong strong"><strong>Remember Me</strong></span> switch to <span class="strong strong"><strong>ON</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>Login tab</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/login-tab.png" alt="login tab"/></span>
							</p></div></li></ol></div><p>
					When you save this setting, a <code class="literal">remember me</code> checkbox displays on the realm’s login page.
				</p><div class="formalpara"><p class="title"><strong>Remember Me</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/remember-me.png" alt="remember me"/></span>
					</p></div></section></section><section class="section" id="realm_keys"><div class="titlepage"><div><div><h2 class="title">3.9. Configuring realm keys</h2></div></div></div><p>
				The authentication protocols that are used by Red Hat Single Sign-On require cryptographic signatures and sometimes encryption. Red Hat Single Sign-On uses asymmetric key pairs, a private and public key, to accomplish this.
			</p><p>
				Red Hat Single Sign-On has a single active keypair at a time, but can have several passive keys as well. The active keypair is used to create new signatures, while the passive keypairs can be used to verify previous signatures. This makes it possible to regularly rotate the keys without any downtime or interruption to users.
			</p><p>
				When a realm is created a key pair and a self-signed certificate is automatically generated.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Select the realm in the Admin Console.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Realm settings</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Keys</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Passive</strong></span> to view passive keys.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Disabled</strong></span> to view disabled keys.
					</li></ol></div><p>
				A keypair can have the status <code class="literal">Active</code>, but still not be selected as the currently active keypair for the realm. The selected active pair which is used for signatures is selected based on the first key provider sorted by priority that is able to provide an active keypair.
			</p><section class="section" id="rotating_keys"><div class="titlepage"><div><div><h3 class="title">3.9.1. Rotating keys</h3></div></div></div><p>
					We recommend that you regularly rotate keys. To do so, start by creating new keys with a higher priority than the existing active keys. Or create new keys with the same priority and making the previous keys passive.
				</p><p>
					Once new keys are available all new tokens and cookies will be signed with the new keys. When a user authenticates to an application the SSO cookie is updated with the new signature. When OpenID Connect tokens are refreshed new tokens are signed with the new keys. This means that over time all cookies and tokens will use the new keys and after a while the old keys can be removed.
				</p><p>
					The frequency of deleting old keys is a tradeoff between security and making sure all cookies and tokens are updated. Consider creating new keys every three to six months and deleting old keys one to two months after you create the new keys. If a user was inactive in the period between the new keys being added and the old keys being removed, that user will have to re-authenticate.
				</p><p>
					Rotating keys also applies to offline tokens. To make sure they are updated, the applications need to refresh the tokens before the old keys are removed.
				</p></section><section class="section" id="adding_a_generated_keypair"><div class="titlepage"><div><div><h3 class="title">3.9.2. Adding a generated keypair</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Select the realm in the Admin Console.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Realm settings</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Keys</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Providers</strong></span> tab.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add keystore</strong></span> and select <span class="strong strong"><strong>rsa-generated</strong></span>.
						</li><li class="listitem">
							Enter a number in the <span class="strong strong"><strong>Priority</strong></span> field. This number determines if the new key pair becomes the active key pair.
						</li><li class="listitem">
							Select a value for <span class="strong strong"><strong>keysize</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					This action will generated a new keypair including a self-signed certificate.
				</p><p>
					Changing the priority for a provider will not cause the keys to be re-generated, but if you want to change the keysize you can edit the provider and new keys will be generated.
				</p></section><section class="section" id="adding_an_existing_keypair_and_certificate"><div class="titlepage"><div><div><h3 class="title">3.9.3. Adding an existing keypair and certificate</h3></div></div></div><p>
					To add a keypair and certificate obtained elsewhere select <code class="literal">Providers</code> and choose <code class="literal">rsa</code> from the dropdown. You can change the priority to make sure the new keypair becomes the active keypair.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							A private key file. The file must be PEM formatted.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Select the realm in the Admin Console.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Realm settings</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Keys</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Providers</strong></span> tab.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add keystore</strong></span> and select <span class="strong strong"><strong>rsa</strong></span>.
						</li><li class="listitem">
							Enter a number in the <span class="strong strong"><strong>Priority</strong></span> field. This number determines if the new key pair becomes the active key pair.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Select file</strong></span> beside <span class="strong strong"><strong>Private RSA Key</strong></span> to upload the private key file.
						</li><li class="listitem">
							If you have a signed certificate for your private key, click <span class="strong strong"><strong>Select file</strong></span> beside <span class="strong strong"><strong>X509 Certificate</strong></span> to upload the certificate file. Red Hat Single Sign-On autmatically generates a self-signed certificate if you do not upload a certificate.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="loading_keys_from_a_java_keystore"><div class="titlepage"><div><div><h3 class="title">3.9.4. Loading keys from a Java Keystore</h3></div></div></div><p>
					To add a keypair and certificate stored in a Java Keystore file on the host select <code class="literal">Providers</code> and choose <code class="literal">java-keystore</code> from the dropdown. You can change the priority to make sure the new keypair becomes the active keypair.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Select the realm in the Admin Console.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Realm settings</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Keys</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Providers</strong></span> tab.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add keystore</strong></span> and select <span class="strong strong"><strong>java-keystore</strong></span>.
						</li><li class="listitem">
							Enter a number in the <span class="strong strong"><strong>Priority</strong></span> field. This number determines if the new key pair becomes the active key pair.
						</li><li class="listitem">
							Enter a value for <span class="strong strong"><strong>Keystore</strong></span>.
						</li><li class="listitem">
							Enter a value for <span class="strong strong"><strong>Keystore Password</strong></span>.
						</li><li class="listitem">
							Enter a value for <span class="strong strong"><strong>Key Alias</strong></span>.
						</li><li class="listitem">
							Enter a value for <span class="strong strong"><strong>Key Password</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="making_keys_passive"><div class="titlepage"><div><div><h3 class="title">3.9.5. Making keys passive</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Select the realm in the Admin Console.
						</li><li class="listitem">
							Click Realm settings.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Keys</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Active</strong></span> tab.
						</li><li class="listitem">
							Click the provider of the key you want to make passive.
						</li><li class="listitem">
							Toggle <span class="strong strong"><strong>Active</strong></span> to <span class="strong strong"><strong>OFF</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="disabling_keys"><div class="titlepage"><div><div><h3 class="title">3.9.6. Disabling keys</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Select the realm in the Admin Console.
						</li><li class="listitem">
							Click Realm settings.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Keys</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Active</strong></span> tab.
						</li><li class="listitem">
							Click the provider of the key you want to make passive.
						</li><li class="listitem">
							Toggle <span class="strong strong"><strong>Enabled</strong></span> to <span class="strong strong"><strong>OFF</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="compromised_keys"><div class="titlepage"><div><div><h3 class="title">3.9.7. Compromised keys</h3></div></div></div><p>
					Red Hat Single Sign-On has the signing keys stored just locally and they are never shared with the client applications, users or other entities. However, if you think that your realm signing key was compromised, you should first generate new keypair as described above and then immediately remove the compromised keypair.
				</p><p>
					Alternatively, you can delete the provider from the <code class="literal">Providers</code> table.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Clients</strong></span> in the menu.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>security-admin-console</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Revocation</strong></span> tab.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Set to now</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Push</strong></span>.
						</li></ol></div><p>
					Pushing the not-before policy ensures that client applications do not accept the existing tokens signed by the compromised key. The client application is forced to download new key pairs from Red Hat Single Sign-On also so the tokens signed by the compromised key will be invalid.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						REST and confidential clients must set <span class="strong strong"><strong>Admin URL</strong></span> so Red Hat Single Sign-On can send clients the pushed not-before policy request.
					</p></div></div></section></section></section><section class="chapter" id="user-storage-federation"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Using external storage</h1></div></div></div><p class="_abstract _abstract">
			Organizations can have databases containing information, passwords, and other credentials. Typically, you cannot migrate existing data storage to a Red Hat Single Sign-On deployment so Red Hat Single Sign-On can federate existing external user databases. Red Hat Single Sign-On supports LDAP and Active Directory, but you can also code extensions for any custom user database by using the Red Hat Single Sign-On User Storage SPI.
		</p><p>
			When a user attempts to log in, Red Hat Single Sign-On examines that user’s storage to find that user. If Red Hat Single Sign-On does not find the user, Red Hat Single Sign-On iterates over each User Storage provider for the realm until it finds a match. Data from the external data storage then maps into a standard user model the Red Hat Single Sign-On runtime consumes. This user model then maps to OIDC token claims and SAML assertion attributes.
		</p><p>
			External user databases rarely have the data necessary to support all the features of Red Hat Single Sign-On, so the User Storage Provider can opt to store items locally in Red Hat Single Sign-On user data storage. Providers can import users locally and sync periodically with external data storage. This approach depends on the capabilities of the provider and the configuration of the provider. For example, your external user data storage may not support OTP. The OTP can be handled and stored by Red Hat Single Sign-On, depending on the provider.
		</p><section class="section" id="adding_a_provider"><div class="titlepage"><div><div><h2 class="title">4.1. Adding a provider</h2></div></div></div><p>
				To add a storage provider, perform the following procedure:
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>User Federation</strong></span> in the menu.
					</p><div class="formalpara"><p class="title"><strong>User federation</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/user-federation.png" alt="User federation"/></span>
						</p></div></li><li class="listitem">
						Select the provider type from the <span class="strong strong"><strong>Add Provider</strong></span> list. Red Hat Single Sign-On brings you to that provider’s configuration page.
					</li></ol></div></section><section class="section" id="dealing_with_provider_failures"><div class="titlepage"><div><div><h2 class="title">4.2. Dealing with provider failures</h2></div></div></div><p>
				If a User Storage Provider fails, you may not be able to log in and view users in the Admin Console. Red Hat Single Sign-On does not detect failures when using a Storage Provider to look up a user, so it cancels the invocation. If you have a Storage Provider with a high priority that fails during user lookup, the login or user query fails with an exception and will not fail over to the next configured provider.
			</p><p>
				Red Hat Single Sign-On searches the local Red Hat Single Sign-On user database first to resolve users before any LDAP or custom User Storage Provider. Consider creating an administrator account stored in the local Red Hat Single Sign-On user database in case of problems connecting to your LDAP and back ends.
			</p><p>
				Each LDAP and custom User Storage Provider has an <code class="literal">enable</code> toggle on its Admin Console page. Disabling the User Storage Provider skips the provider when performing queries, so you can view and log in with user accounts in a different provider with lower priority. If your provider uses an <code class="literal">import</code> strategy and is disabled, imported users are still available for lookup in read-only mode.
			</p><p>
				When a Storage Provider lookup fails, Red Hat Single Sign-On does not fail over because user databases often have duplicate usernames or duplicate emails between them. Duplicate usernames and emails can cause problems because the user loads from one external data store when the admin expects them to load from another data store.
			</p></section><section class="section" id="ldap"><div class="titlepage"><div><div><h2 class="title">4.3. Lightweight Directory Access Protocol (LDAP) and Active Directory</h2></div></div></div><p>
				Red Hat Single Sign-On includes an LDAP/AD provider. You can federate multiple different LDAP servers in one Red Hat Single Sign-On realm and map LDAP user attributes into the Red Hat Single Sign-On common user model.
			</p><p>
				By default, Red Hat Single Sign-On maps the username, email, first name, and last name of the user account, but you can also configure additional <a class="link" href="#ldap_mappers" title="4.3.7. LDAP mappers">mappings</a>. Red Hat Single Sign-On’s LDAP/AD provider supports password validation using LDAP/AD protocols and storage, edit, and synchronization modes.
			</p><section class="section" id="configuring_federated_ldap_storage"><div class="titlepage"><div><div><h3 class="title">4.3.1. Configuring federated LDAP storage</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>User Federation</strong></span> in the menu.
						</p><div class="formalpara"><p class="title"><strong>User federation</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/user-federation.png" alt="User federation"/></span>
							</p></div></li><li class="listitem">
							Select <span class="emphasis"><em>ldap</em></span> from the <span class="strong strong"><strong>Add Provider</strong></span> list. Red Hat Single Sign-On brings you to the LDAP configuration page.
						</li></ol></div></section><section class="section" id="storage_mode"><div class="titlepage"><div><div><h3 class="title">4.3.2. Storage mode</h3></div></div></div><p>
					Red Hat Single Sign-On imports users from LDAP into the local Red Hat Single Sign-On user database. This copy of the user database synchronizes on-demand or through a periodic background task. An exception exists for synchronizing passwords. Red Hat Single Sign-On never imports passwords. Password validation always occurs on the LDAP server.
				</p><p>
					The advantage of synchronization is that all Red Hat Single Sign-On features work efficiently because any required extra per-user data is stored locally. The disadvantage is that each time Red Hat Single Sign-On queries a specific user for the first time, Red Hat Single Sign-On performs a corresponding database insert.
				</p><p>
					You can synchronize the import with your LDAP server. Import synchronization is unnecessary when LDAP mappers always read particular attributes from the LDAP rather than the database.
				</p><p>
					You can use LDAP with Red Hat Single Sign-On without importing users into the Red Hat Single Sign-On user database. The LDAP server backs up the common user model that the Red Hat Single Sign-On runtime uses. If LDAP does not support data that a Red Hat Single Sign-On feature requires, that feature will not work. The advantage of this approach is that you do not have the resource usage of importing and synchronizing copies of LDAP users into the Red Hat Single Sign-On user database.
				</p><p>
					The <span class="strong strong"><strong>Import Users</strong></span> switch on the LDAP configuration page controls this storage mode. To import users, toggle this switch to <span class="strong strong"><strong>ON</strong></span>.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						If you disable <span class="strong strong"><strong>Import Users</strong></span>, you cannot save user profile attributes into the Red Hat Single Sign-On database. Also, you cannot save metadata except for user profile metadata mapped to the LDAP. This metadata can include role mappings, group mappings, and other metadata based on the LDAP mappers' configuration.
					</p><p>
						When you attempt to change the non-LDAP mapped user data, the user update is not possible. For example, you cannot disable the LDAP mapped user unless the user’s <code class="literal">enabled</code> flag maps to an LDAP attribute.
					</p></div></div></section><section class="section" id="edit_mode"><div class="titlepage"><div><div><h3 class="title">4.3.3. Edit mode</h3></div></div></div><p>
					Users and admins can modify user metadata, users through the <a class="link" href="#account-service" title="Chapter 17. Account Console">Account Console</a>, and administrators through the Admin Console. The <code class="literal">Edit Mode</code> configuration on the LDAP configuration page defines the user’s LDAP update privileges.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">READONLY</span></dt><dd>
								You cannot change the username, email, first name, last name, and other mapped attributes. Red Hat Single Sign-On shows an error anytime a user attempts to update these fields. Password updates are not supported.
							</dd><dt><span class="term">WRITABLE</span></dt><dd>
								You cannot change the username, email, first name, last name, and other mapped attributes and passwords and synchronize them automatically with the LDAP store.
							</dd><dt><span class="term">UNSYNCED</span></dt><dd>
								Red Hat Single Sign-On stores changes to the username, email, first name, last name, and passwords in Red Hat Single Sign-On local storage, so the administrator must synchronize this data back to LDAP. In this mode, Red Hat Single Sign-On deployments can update user metadata on read-only LDAP servers. This option also applies when importing users from LDAP into the local Red Hat Single Sign-On user database.
							</dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						When Red Hat Single Sign-On creates the LDAP provider, Red Hat Single Sign-On also creates a set of initial <a class="link" href="#ldap_mappers" title="4.3.7. LDAP mappers">LDAP mappers</a>. Red Hat Single Sign-On configures these mappers based on a combination of the <span class="strong strong"><strong>Vendor</strong></span>, <span class="strong strong"><strong>Edit Mode</strong></span>, and <span class="strong strong"><strong>Import Users</strong></span> switches. For example, when edit mode is UNSYNCED, Red Hat Single Sign-On configures the mappers to read a particular user attribute from the database and not from the LDAP server. However, if you later change the edit mode, the mapper’s configuration does not change because it is impossible to detect if the configuration changes changed in UNSYNCED mode. Decide the <span class="strong strong"><strong>Edit Mode</strong></span> when creating the LDAP provider. This note applies to <span class="strong strong"><strong>Import Users</strong></span> switch also.
					</p></div></div></section><section class="section" id="other_configuration_options"><div class="titlepage"><div><div><h3 class="title">4.3.4. Other configuration options</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Console Display Name</span></dt><dd>
								The name of the provider to display in the admin console.
							</dd><dt><span class="term">Priority</span></dt><dd>
								The priority of the provider when looking up users or adding a user.
							</dd><dt><span class="term">Sync Registrations</span></dt><dd>
								Toggle this switch to <span class="strong strong"><strong>ON</strong></span> if you want new users created by Red Hat Single Sign-On added to LDAP.
							</dd><dt><span class="term">Allow Kerberos authentication</span></dt><dd>
								Enable Kerberos/SPNEGO authentication in the realm with user data provisioned from LDAP. For more information, see the <a class="link" href="#kerberos" title="8.4. Kerberos">Kerberos section</a>.
							</dd><dt><span class="term">Other options</span></dt><dd>
								Hover the mouse pointer over the tooltips in the Admin Console to see more details about these options.
							</dd></dl></div></section><section class="section" id="connecting_to_ldap_over_ssl"><div class="titlepage"><div><div><h3 class="title">4.3.5. Connecting to LDAP over SSL</h3></div></div></div><p>
					When you configure a secure connection URL to your LDAP store (for example,<code class="literal">ldaps://myhost.com:636</code>), Red Hat Single Sign-On uses SSL to communicate with the LDAP server. Configure a truststore on the Red Hat Single Sign-On server side so that Red Hat Single Sign-On can trust the SSL connection to LDAP.
				</p><p>
					Configure the global truststore for Red Hat Single Sign-On with the Truststore SPI. For more information about configuring the global truststore, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/">Server Installation and Configuration Guide</a>. If you do not configure the Truststore SPI, the truststore falls back to the default mechanism provided by Java, which can be the file supplied by the <code class="literal">javax.net.ssl.trustStore</code> system property or the cacerts file from the JDK if the system property is unset.
				</p><p>
					The <code class="literal">Use Truststore SPI</code> configuration property, in the LDAP federation provider configuration, controls the truststore SPI. By default, Red Hat Single Sign-On sets the property to <code class="literal">Only for ldaps</code>, which is adequate for most deployments. Red Hat Single Sign-On uses the Truststore SPI if the connection URL to LDAP starts with <code class="literal">ldaps</code> only.
				</p></section><section class="section" id="synchronizing_ldap_users_to_red_hat_single_sign_on"><div class="titlepage"><div><div><h3 class="title">4.3.6. Synchronizing LDAP users to Red Hat Single Sign-On</h3></div></div></div><p>
					If you set the <span class="strong strong"><strong>Import Users</strong></span> option, the LDAP Provider handles importing LDAP users into the Red Hat Single Sign-On local database. The first time a user logs in, the LDAP provider imports the LDAP user into the Red Hat Single Sign-On database and validates the LDAP password. This first time a user logs in is the only time Red Hat Single Sign-On imports the user. If you click the <span class="strong strong"><strong>Users</strong></span> menu in the Admin Console and click the <span class="strong strong"><strong>View all users</strong></span> button, you only see the LDAP users authenticated at least once by Red Hat Single Sign-On. Red Hat Single Sign-On imports users this way, so this operation does not trigger an import of the entire LDAP user database.
				</p><p>
					If you want to sync all LDAP users into the Red Hat Single Sign-On database, configure and enable the <span class="strong strong"><strong>Sync Settings</strong></span> on the LDAP provider configuration page.
				</p><p>
					Two types of synchronization exist:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Periodic Full sync</span></dt><dd>
								This type synchronizes all LDAP users into the Red Hat Single Sign-On database. The LDAP users already in Red Hat Single Sign-On, but different in LDAP, directly update in the Red Hat Single Sign-On database.
							</dd><dt><span class="term">Periodic Changed users sync</span></dt><dd>
								When synchronizing, Red Hat Single Sign-On creates or updates users created or updated after the last sync only.
							</dd></dl></div><p>
					The best way to synchronize is to click <span class="strong strong"><strong>Synchronize all users</strong></span> when you first create the LDAP provider, then set up periodic synchronization of changed users.
				</p></section><section class="section" id="ldap_mappers"><div class="titlepage"><div><div><h3 class="title">4.3.7. LDAP mappers</h3></div></div></div><p>
					LDAP mappers are <code class="literal">listeners</code> triggered by the LDAP Provider. They provide another extension point to LDAP integration. LDAP mappers are triggered when:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Users log in by using LDAP.
						</li><li class="listitem">
							Users initially register.
						</li><li class="listitem">
							The Admin Console queries a user.
						</li></ul></div><p>
					When you create an LDAP Federation provider, Red Hat Single Sign-On automatically provides a set of <code class="literal">mappers</code> for this provider. This set is changeable by users, who can also develop mappers or update/delete existing ones.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">User Attribute Mapper</span></dt><dd>
								This mapper specifies which LDAP attribute maps to the attribute of the Red Hat Single Sign-On user. For example, you can configure the <code class="literal">mail</code> LDAP attribute to the <code class="literal">email</code> attribute in the Red Hat Single Sign-On database. For this mapper implementation, a one-to-one mapping always exists.
							</dd><dt><span class="term">FullName Mapper</span></dt><dd>
								This mapper specifies the full name of the user. Red Hat Single Sign-On saves the name in an LDAP attribute (usually <code class="literal">cn</code>) and maps the name to the <code class="literal">firstName</code> and <code class="literal">lastname</code> attributes in the Red Hat Single Sign-On database. Having <code class="literal">cn</code> to contain the full name of the user is common for LDAP deployments.
							</dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						When you register new users in Red Hat Single Sign-On and <code class="literal">Sync Registrations</code> is ON for the LDAP provider, the fullName mapper permits falling back to the username. This fallback is useful when using Microsoft Active Directory (MSAD). The common setup for MSAD is to configure the <code class="literal">cn</code> LDAP attribute as fullName and, at the same time, use the <code class="literal">cn</code> LDAP attribute as the <code class="literal">RDN LDAP Attribute</code> in the LDAP provider configuration. With this setup, Red Hat Single Sign-On falls back to the username. For example, if you create Red Hat Single Sign-On user "john123" and leave firstName and lastName empty, then the fullname mapper saves "john123" as the value of the <code class="literal">cn</code> in LDAP. When you enter "John Doe" for firstName and lastName later, the fullname mapper updates LDAP <code class="literal">cn</code> to the "John Doe" value as falling back to the username is unnecessary.
					</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Hardcoded Attribute Mapper</span></dt><dd>
								This mapper adds a hardcoded attribute value to each Red Hat Single Sign-On user linked with LDAP. This mapper can also force values for the <code class="literal">enabled</code> or <code class="literal">emailVerified</code> user properties.
							</dd><dt><span class="term">Role Mapper</span></dt><dd>
								This mapper configures role mappings from LDAP into Red Hat Single Sign-On role mappings. A single role mapper can map LDAP roles (usually groups from a particular branch of the LDAP tree) into roles corresponding to a specified client’s realm roles or client roles. You can configure more Role mappers for the same LDAP provider. For example, you can specify that role mappings from groups under <code class="literal">ou=main,dc=example,dc=org</code> map to realm role mappings, and role mappings from groups under <code class="literal">ou=finance,dc=example,dc=org</code> map to client role mappings of client <code class="literal">finance</code>.
							</dd><dt><span class="term">Hardcoded Role Mapper</span></dt><dd>
								This mapper grants a specified Red Hat Single Sign-On role to each Red Hat Single Sign-On user from the LDAP provider.
							</dd><dt><span class="term">Group Mapper</span></dt><dd>
								This mapper maps LDAP groups from a branch of an LDAP tree into groups within Red Hat Single Sign-On. This mapper also propagates user-group mappings from LDAP into user-group mappings in Red Hat Single Sign-On.
							</dd><dt><span class="term">MSAD User Account Mapper</span></dt><dd>
								This mapper is specific to Microsoft Active Directory (MSAD). It can integrate the MSAD user account state into the Red Hat Single Sign-On account state, such as enabled account or expired password. This mapper uses the <code class="literal">userAccountControl</code>, and <code class="literal">pwdLastSet</code> LDAP attributes, specific to MSAD and are not the LDAP standard. For example, if the value of <code class="literal">pwdLastSet</code> is <code class="literal">0</code>, the Red Hat Single Sign-On user must update their password. The result is an UPDATE_PASSWORD required action added to the user. If the value of <code class="literal">userAccountControl</code> is <code class="literal">514</code> (disabled account), the Red Hat Single Sign-On user is disabled.
							</dd><dt><span class="term">Certificate Mapper</span></dt><dd>
								This mapper maps X.509 certificates. Red Hat Single Sign-On uses it in conjunction with X.509 authentication and <code class="literal">Full certificate in PEM format</code> as an identity source. This mapper behaves similarly to the <code class="literal">User Attribute Mapper</code>, but Red Hat Single Sign-On can filter for an LDAP attribute storing a PEM or DER format certificate. Enable <code class="literal">Always Read Value From LDAP</code> with this mapper.
							</dd></dl></div><p>
					User Attribute mappers that map basic Red Hat Single Sign-On user attributes, such as username, firstname, lastname, and email, to corresponding LDAP attributes. You can extend these and provide your own additional attribute mappings. The Admin Console provides tooltips to help with configuring the corresponding mappers.
				</p></section><section class="section" id="ldap_password_hashing"><div class="titlepage"><div><div><h3 class="title">4.3.8. Password hashing</h3></div></div></div><p>
					When Red Hat Single Sign-On updates a password, Red Hat Single Sign-On sends the password in plain-text format. This action is different from updating the password in the built-in Red Hat Single Sign-On database, where Red Hat Single Sign-On hashes and salts the password before sending it to the database. For LDAP, Red Hat Single Sign-On relies on the LDAP server to hash and salt the password.
				</p><p>
					By default, LDAP servers such as MSAD, RHDS, or FreeIPA hash and salt passwords. Other LDAP servers such as OpenLDAP or ApacheDS store the passwords in plain-text unless you use the <span class="emphasis"><em>LDAPv3 Password Modify Extended Operation</em></span> as described in <a class="link" href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.3">RFC3062</a>. Enable the LDAPv3 Password Modify Extended Operation in the LDAP configuration page. See the documentation of your LDAP server for more details.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Always verify that user passwords are properly hashed and not stored as plaintext by inspecting a changed directory entry using <code class="literal">ldapsearch</code> and base64 decode the <code class="literal">userPassword</code> attribute value.
					</p></div></div></section><section class="section" id="ldap_troubleshooting"><div class="titlepage"><div><div><h3 class="title">4.3.9. Troubleshooting</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							It is useful to increase the logging level to TRACE for the category <code class="literal">org.keycloak.storage.ldap</code>. You increase this level in the logging
						</li></ul></div><p>
					It is useful to increase the logging level to TRACE for the category <code class="literal">org.keycloak.storage.ldap</code>. You increase this level in the logging subsystem in the <code class="literal">standalone(-ha).xml</code> file. With this setting, many logging messages are sent to the <code class="literal">server.log</code> file in the <code class="literal">TRACE</code> level, including the logging for all queries to the LDAP server and the parameters, which were used to send the queries. When you are creating any LDAP question on user forum or JIRA, consider attaching the server log with enabled TRACE logging. If it is too big, the good alternative is to include just the snippet from server log with the messages, which were added to the log during the operation, which causes the issues to you.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							When you create LDAP provider, message appear in the server log in the INFO level starting with:
						</p><pre class="literallayout">When you create LDAP provider, message appear in the server log in the INFO level starting with:</pre></li></ul></div><pre class="screen">Creating new LDAP Store for the LDAP storage provider: ...</pre><p>
					It shows the configuration of your LDAP provider. Before you are asking the questions or reporting bugs, it will be nice to include this message to show your LDAP configuration. Eventually feel free to replace some config changes, which you do not want to include, with some placeholder values. One example is <code class="literal">bindDn=some-placeholder</code> . For <code class="literal">connectionUrl</code>, feel free to replace it as well, but it is generally useful to include at least the protocol, which was used (<code class="literal">ldap</code> vs <code class="literal">ldaps</code>)`. Similarly it can be useful to include the details for configuration of your LDAP mappers, which are displayed with the message like this at the DEBUG level:
				</p><pre class="screen">Mapper for provider: XXX, Mapper name: YYY, Provider: ZZZ ...</pre><p>
					Note those messages are displayed just with the enabled DEBUG logging.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							For tracking the performance or connection pooling issues, consider setting the value of property <code class="literal">Connection Pool Debug Level</code> of
						</li></ul></div><p>
					For tracking the performance or connection pooling issues, consider setting the value of property <code class="literal">Connection Pool Debug Level</code> of the LDAP provider to value <code class="literal">all</code>. This will add lots of additional messages to server log with the included logging for the LDAP connection pooling. This can be used to track the issues related to connection pooling or performance.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						After changing the configuration of connection pooling, you may need to restart the Keycloak server to enforce re-initialization of the LDAP provider connection.
					</p></div></div><p>
					If no more messages appear for connection pooling even after server restart, it can indicate that connection pooling does not work with your LDAP server.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							For the case of reporting LDAP issue, you may consider to attach some part of your LDAP tree with the target data, which causes issues in your environment. For example if login of some user takes lot of time, you can consider attach his LDAP entry showing count of <code class="literal">member</code> attributes of various "group" entries. In this case, it might be useful to add if those group entries are mapped to some Group LDAP mapper (or Role LDAP Mapper) in Red Hat Single Sign-On etc.
						</li></ul></div><p>
					For the case of reporting LDAP issue, you may consider to attach some part of your LDAP tree with the target data, which causes issues in your environment. For example if login of some user takes lot of time, you can consider attach his LDAP entry showing count of <code class="literal">member</code> attributes of various "group" entries. In this case, it might be useful to add if those group entries are mapped to some Group LDAP mapper (or Role LDAP Mapper) in Red Hat Single Sign-On and so on.
				</p></section></section><section class="section" id="sssd"><div class="titlepage"><div><div><h2 class="title">4.4. SSSD and FreeIPA Identity Management integration</h2></div></div></div><p>
				Red Hat Single Sign-On includes the <a class="link" href="https://fedoraproject.org/wiki/Features/SSSD">System Security Services Daemon (SSSD)</a> plugin. SSSD is part of the Fedora and Red Hat Enterprise Linux (RHEL), and it provides access to multiple identities and authentication providers. SSSD also provides benefits such as failover and offline support. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/sssd">the Red Hat Enterprise Linux Identity Management documentation</a>.
			</p><p>
				SSSD integrates with the FreeIPA identity management (IdM) server, providing authentication and access control. With this integration, Red Hat Single Sign-On can authenticate against privileged access management (PAM) services and retrieve user data from SSSD. For more information about using Red Hat Identity Management in Linux environments, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/index">the Red Hat Enterprise Linux Identity Management documentation</a>.
			</p><p>
				<span class="inlinemediaobject"><img src="images/rhsso-images/keycloak-sssd-freeipa-integration-overview.png" alt="keycloak sssd freeipa integration overview"/></span>
			</p><p>
				Red Hat Single Sign-On and SSSD communicate through read-only D-Bus interfaces. For this reason, the way to provision and update users is to use the FreeIPA/IdM administration interface. By default, the interface imports the username, email, first name, and last name.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On registers groups and roles automatically but does not synchronize them. Any changes made by the Red Hat Single Sign-On administrator in Red Hat Single Sign-On do not synchronize with SSSD.
				</p></div></div><section class="section" id="freeipa_idm_server"><div class="titlepage"><div><div><h3 class="title">4.4.1. FreeIPA/IdM server</h3></div></div></div><p>
					The <a class="link" href="https://hub.docker.com/r/freeipa/freeipa-server/">FreeIPA Docker image</a> is available in Docker Hub. To set up the FreeIPA server, see the <a class="link" href="https://www.freeipa.org/page/Quick_Start_Guide">FreeIPA documentation</a>.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Run your FreeIPA server using this command:
						</p><pre class="programlisting language-bash"> docker run --name freeipa-server-container -it \
 -h server.freeipa.local -e PASSWORD=YOUR_PASSWORD \
 -v /sys/fs/cgroup:/sys/fs/cgroup:ro \
 -v /var/lib/ipa-data:/data:Z freeipa/freeipa-server</pre><p class="simpara">
							The parameter <code class="literal">-h</code> with <code class="literal">server.freeipa.local</code> represents the FreeIPA/IdM server hostname. Change <code class="literal">YOUR_PASSWORD</code> to a password of your own.
						</p></li><li class="listitem"><p class="simpara">
							After the container starts, change the <code class="literal">/etc/hosts</code> file to include:
						</p><pre class="programlisting language-bash">x.x.x.x     server.freeipa.local</pre><p class="simpara">
							If you do not make this change, you must set up a DNS server.
						</p></li><li class="listitem"><p class="simpara">
							Use the following command to enroll your Linux server in the IPA domain so that the SSSD federation provider starts and runs on Red Hat Single Sign-On:
						</p><pre class="programlisting language-bash"> ipa-client-install --mkhomedir -p admin -w password</pre></li><li class="listitem"><p class="simpara">
							Run the following command on the client to verify the installation is working:
						</p><pre class="programlisting language-bash"> kinit admin</pre></li><li class="listitem">
							Enter your password.
						</li><li class="listitem"><p class="simpara">
							Add users to the IPA server using this command:
						</p><pre class="programlisting language-bash">$ ipa user-add &lt;username&gt; --first=&lt;first name&gt; --last=&lt;surname&gt; --email=&lt;email address&gt; --phone=&lt;telephoneNumber&gt; --street=&lt;street&gt; \      --city=&lt;city&gt; --state=&lt;state&gt; --postalcode=&lt;postal code&gt; --password</pre></li><li class="listitem"><p class="simpara">
							Force set the user’s password using kinit.
						</p><pre class="programlisting language-bash"> kinit &lt;username&gt;</pre></li><li class="listitem"><p class="simpara">
							Enter the following to restore normal IPA operation:
						</p><pre class="programlisting language-bash">kdestroy -A
kinit admin</pre></li></ol></div></section><section class="section" id="sssd_and_d_bus"><div class="titlepage"><div><div><h3 class="title">4.4.2. SSSD and D-Bus</h3></div></div></div><p>
					The federation provider obtains the data from SSSD using D-BUS. It authenticates the data using PAM.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Install the sssd-dbus RPM.
						</p><pre class="programlisting language-bash">$ sudo yum install sssd-dbus</pre><p class="simpara">
							This provisioning script makes the following changes to <code class="literal">/etc/sssd/sssd.conf</code>:
						</p><pre class="programlisting language-bash">  [domain/your-hostname.local]
  ...
  ldap_user_extra_attrs = mail:mail, sn:sn, givenname:givenname, telephoneNumber:telephoneNumber
  ...
  [sssd]
  services = nss, sudo, pam, ssh, ifp
  ...
  [ifp]
  allowed_uids = root, yourOSUsername
  user_attributes = +mail, +telephoneNumber, +givenname, +sn</pre></li><li class="listitem"><p class="simpara">
							Run <code class="literal">dbus-send</code> to ensure the setup is successful.
						</p><pre class="programlisting language-bash">sudo dbus-send --print-reply --system --dest=org.freedesktop.sssd.infopipe /org/freedesktop/sssd/infopipe org.freedesktop.sssd.infopipe.GetUserGroups string:john</pre><p class="simpara">
							If the setup is successful, you see the user’s group. If this command returns a timeout or an error, the federation provider running on Red Hat Single Sign-On cannot retrieve any data. This error usually happens because the server is not enrolled in the FreeIPA IdM server, or does not have permission to access the SSSD service.
						</p><p class="simpara">
							If you do not have permission to access the SSSD service, ensure that the user running the Red Hat Single Sign-On server is in the <code class="literal">/etc/sssd/sssd.conf</code> file in the following section:
						</p><pre class="programlisting language-bash">[ifp]
allowed_uids = root, your_username</pre></li></ol></div></section><section class="section" id="enabling_the_sssd_federation_provider"><div class="titlepage"><div><div><h3 class="title">4.4.3. Enabling the SSSD federation provider</h3></div></div></div><p>
					Red Hat Single Sign-On uses DBus-Java to communicate at a low level with D-Bus. D-Bus depends on the <a class="link" href="http://www.matthew.ath.cx/projects/java/">Unix Sockets Library</a>.
				</p><p>
					Before enabling the SSSD Federation provider, install the RPM for this library:
				</p><pre class="programlisting language-bash">$ sudo yum install rh-sso7-libunix-dbus-java</pre><p>
					Red Hat Single Sign-On uses JNA to authenticate with PAM. Ensure you have the JAN package installed.
				</p><pre class="programlisting language-bash">$ sudo yum install jna</pre><p>
					Use the <code class="literal">sssctl user-checks</code> command to validate your setup:
				</p><pre class="screen">  $ sudo sssctl user-checks admin -s keycloak</pre></section></section><section class="section" id="configuring_a_federated_sssd_store"><div class="titlepage"><div><div><h2 class="title">4.5. Configuring a federated SSSD store</h2></div></div></div><p>
				After the installation, configure a federated SSSD store.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>User Federation</strong></span> in the menu.
					</li><li class="listitem">
						From the <span class="strong strong"><strong>Add Provider</strong></span> list select <span class="emphasis"><em>sssd</em></span>. Red Hat Single Sign-On brings you to the sssd configuration page.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div><p>
				You can now authenticate against Red Hat Single Sign-On using FreeIPA/IdM credentials.
			</p></section><section class="section" id="custom_providers"><div class="titlepage"><div><div><h2 class="title">4.6. Custom providers</h2></div></div></div><p>
				Red Hat Single Sign-On does have a Service Provider Interface (SPI) for User Storage Federation to develop custom providers. You can find documentation on developing customer providers in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a>.
			</p></section></section><section class="chapter" id="assembly-managing-users_server_administration_guide"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Managing users</h1></div></div></div><p>
			From the Admin Console, you have a wide range of actions you can perform to manage users.
		</p><section class="section" id="proc-searching-user_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.1. Searching for a user</h2></div></div></div><p>
				Search for a user to view detailed information about the user, such as the user’s groups and roles.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisite</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You are in the realm where the user exists.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Users</strong></span> in the main menu. This <span class="strong strong"><strong>Users</strong></span> page is displayed.
					</li><li class="listitem">
						Type the full name, last name, first name, or email address of the user you want to search for in the search box. The search returns all users who match your criteria.
					</li><li class="listitem"><p class="simpara">
						Alternatively, you can click <span class="strong strong"><strong>View all users</strong></span> to list every user in the system.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							This action searches only the local Red Hat Single Sign-On database and not the federated database, such as LDAP. The backends for federated databases do not have a pagination mechanism that enables searching for users.
						</p></div></div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								To search users from a federated backend, the user list must be synced into the Red Hat Single Sign-On database. Adjust the search criteria to sync the backend users to the Red Hat Single Sign-On database.
							</li><li class="listitem"><p class="simpara">
								Alternatively, click the <span class="strong strong"><strong>User Federation</strong></span> in the left menu.
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										To apply changes to a selected user, click <span class="strong strong"><strong>Sync changed users</strong></span> on the page with your federation provider.
									</li><li class="listitem">
										To apply changes to all users in the database, click <span class="strong strong"><strong>Sync all users</strong></span> on the page with your federation provider.
									</li></ol></div></li></ol></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						For more information on user federation, see <a class="link" href="#user-storage-federation" title="Chapter 4. Using external storage">User Federation</a>.
					</li></ul></div></section><section class="section" id="proc-creating-user_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.2. Creating a user</h2></div></div></div><p class="_abstract _abstract">
				You create users in the realm where you intend to have applications needed by those users. Avoid creating users in the master realm, which is only intended for creating other realms.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisite</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You are in a realm other than the master realm.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Users</strong></span> in the menu.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Add User</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Enter the details for the new user.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							<span class="strong strong"><strong>Username</strong></span> is the only required field.
						</p></div></div></li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>. After saving the details, the <span class="strong strong"><strong>Management</strong></span> page for the new user is displayed.
					</li></ol></div></section><section class="section" id="proc-deleting-user_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.3. Deleting a user</h2></div></div></div><p>
				You can delete a user, who no longer needs access to applications. If a user is deleted, the user profile and data is also deleted.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Users</strong></span> in the menu. The <span class="strong strong"><strong>Users</strong></span> page is displayed.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>View all users</strong></span> to find a user to delete.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Alternatively, you can use the search bar to find a user.
						</p></div></div></li><li class="listitem">
						Click <span class="strong strong"><strong>Delete</strong></span> next to the user you want to remove and confirm deletion.
					</li></ol></div></section><section class="section" id="proc-allow-user-to-delete-account_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.4. Enabling account deletion by users</h2></div></div></div><p>
				End users and applications can delete their accounts in the Account Console if you enable this capability in the Admin Console. Once you enable this capability, you can give that capability to specific users.
			</p><section class="section" id="enabling_the_delete_account_capability"><div class="titlepage"><div><div><h3 class="title">5.4.1. Enabling the Delete Account Capability</h3></div></div></div><p>
					You enable this capability on the <span class="strong strong"><strong>Required Actions</strong></span> tab.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Required Actions</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							Select <span class="strong strong"><strong>Enabled</strong></span> on the <span class="strong strong"><strong>Delete Account</strong></span> row.
						</p><div class="formalpara"><p class="title"><strong>Delete account on required actions tab</strong></p><p>
								<span class="inlinemediaobject"><img src="images/enable-delete-account-action.png" alt="enable delete account action"/></span>
							</p></div></li></ol></div></section><section class="section" id="giving_a_user_the_emphasis_role_strong_delete_account_emphasis_role"><div class="titlepage"><div><div><h3 class="title">5.4.2. Giving a user the <span class="strong strong"><strong>delete-account</strong></span> role</h3></div></div></div><p>
					You can give specific users a role that allows account deletion.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the menu.
						</li><li class="listitem">
							Select a user.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Role Mappings</strong></span> tab.
						</li><li class="listitem">
							From the <span class="strong strong"><strong>Client Roles</strong></span> list, select <span class="strong strong"><strong>account</strong></span>.
						</li><li class="listitem">
							Under <span class="strong strong"><strong>Available Roles</strong></span>, select <span class="strong strong"><strong>delete-account</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Add selected</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>Delete-account role</strong></p><p>
								<span class="inlinemediaobject"><img src="images/delete-account-client-role.png" alt="delete-account role"/></span>
							</p></div></li></ol></div></section><section class="section" id="deleting_your_account"><div class="titlepage"><div><div><h3 class="title">5.4.3. Deleting your account</h3></div></div></div><p>
					Once you have the <span class="strong strong"><strong>delete-account</strong></span> role, you can delete your own account.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Log into the Account Console.
						</li><li class="listitem"><p class="simpara">
							At the bottom of the <span class="strong strong"><strong>Personal Info</strong></span> page, click <span class="strong strong"><strong>Delete Account</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>Delete account page</strong></p><p>
								<span class="inlinemediaobject"><img src="images/delete-account-page.png" alt="delete account page"/></span>
							</p></div></li><li class="listitem"><p class="simpara">
							Enter your credentials and confirm the deletion.
						</p><div class="formalpara"><p class="title"><strong>Delete confirmation</strong></p><p>
								<span class="inlinemediaobject"><img src="images/delete-account-confirm.png" alt="delete account confirm"/></span>
							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								This action is irreversible. All your data in Red Hat Single Sign-On will be removed.
							</p></div></div></li></ol></div></section></section><section class="section" id="proc-configuring-user-attributes_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.5. Configuring user attributes</h2></div></div></div><p>
				User attributes provide a customized experience for each user. You can create a personalized identity for each user in the console by configuring user attributes.
			</p><div class="formalpara"><p class="title"><strong>Users</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/user-attributes.png" alt="user attributes"/></span>
				</p></div><div class="itemizedlist"><p class="title"><strong>Prerequisite</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You are in the realm where the user exists.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Users</strong></span> in the menu.
					</li><li class="listitem">
						Select a user to manage.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Attributes</strong></span> tab.
					</li><li class="listitem">
						Enter the attribute name in the <span class="strong strong"><strong>Key</strong></span> field.
					</li><li class="listitem">
						Enter the attribute value in the <span class="strong strong"><strong>Value</strong></span> field.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Add</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Some read-only attributes are not supposed to be updated by the administrators. This includes attributes that are read-only by design like for example <code class="literal">LDAP_ID</code>, which is filled automatically by the LDAP provider. Some other attributes should be read-only for typical user administrators due to security reasons. See the details in the <a class="link" href="#read_only_user_attributes" title="16.4. Read-only user attributes">Mitigating security threats</a> chapter.
				</p></div></div></section><section class="section" id="ref-user-credentials_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.6. User credentials</h2></div></div></div><p>
				You can manage credentials of a user in the <span class="strong strong"><strong>Credentials</strong></span> tab.
			</p><div class="formalpara"><p class="title"><strong>Credential management</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/user-credentials.png" alt="user credentials"/></span>
				</p></div><p>
				This tab includes the following fields:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Position</span></dt><dd>
							The arrow buttons in the <span class="strong strong"><strong>Position</strong></span> column allow you to shift the priority of the credential for the user. The topmost credential has the highest priority. The priority determines which credential is displayed first after a user logs in.
						</dd><dt><span class="term">Type</span></dt><dd>
							This column displays the type of credential, for example <span class="strong strong"><strong>password</strong></span> or <span class="strong strong"><strong>OTP</strong></span>.
						</dd><dt><span class="term">User Label</span></dt><dd>
							This is an assignable label to recognize the credential when presented as a selection option during login. It can be set to any value to describe the credential.
						</dd><dt><span class="term">Data</span></dt><dd>
							This is the non-confidential technical information about the credential. It is hidden, by default. You can click <span class="strong strong"><strong>Show data…​</strong></span> to display the data for a credential.
						</dd><dt><span class="term">Actions</span></dt><dd>
							This column has two actions. Click <span class="strong strong"><strong>Save</strong></span> to record the value or the user field. Click <span class="strong strong"><strong>Delete</strong></span> to remove the credential.
						</dd></dl></div><p>
				You cannot configure other types of credentials for a specific user in the admin console; that task is the user’s responsibility.
			</p><p>
				You can delete the credentials of a user in the event a user loses an OTP device or if credentials have been compromised. You can only delete credentials of a user in the <span class="strong strong"><strong>Credentials</strong></span> tab.
			</p><section class="section" id="proc-setting-password-user_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.6.1. Setting a password for a user</h3></div></div></div><p class="_abstract _abstract">
					If a user does not have a password, or if the password has been deleted, the <span class="strong strong"><strong>Set Password</strong></span> section is displayed.
				</p><p>
					If a user already has a password, it can be reset in the <span class="strong strong"><strong>Reset Password</strong></span> section.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the menu. The <span class="strong strong"><strong>Users</strong></span> page is displayed.
						</li><li class="listitem">
							Select a user.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Credentials</strong></span> tab.
						</li><li class="listitem">
							Type a new password in the <span class="strong strong"><strong>Set Password</strong></span> section.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Set Password</strong></span>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If <span class="strong strong"><strong>Temporary</strong></span> is <span class="strong strong"><strong>ON</strong></span>, the user must change the password at the first login. To allow users to keep the password supplied, set <span class="strong strong"><strong>Temporary</strong></span> to <span class="strong strong"><strong>OFF.</strong></span> The user must click <span class="strong strong"><strong>Set Password</strong></span> to change the password.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Alternatively, you can send an email to the user that requests the user reset the password.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Navigate to the <span class="strong strong"><strong>Reset Actions</strong></span> list under <span class="strong strong"><strong>Credential Reset</strong></span>.
								</li><li class="listitem">
									Select <span class="strong strong"><strong>Update Password</strong></span> from the list.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Send Email</strong></span>. The sent email contains a link that directs the user to the <span class="strong strong"><strong>Update Password</strong></span> window.
								</li><li class="listitem">
									Optionally, you can set the validity of the email link. This is set to the default preset in the <span class="strong strong"><strong>Tokens</strong></span> tab in <span class="strong strong"><strong>Realm Settings</strong></span>.
								</li></ol></div></li></ol></div></section><section class="section" id="proc_creating-otp_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.6.2. Creating an OTP</h3></div></div></div><p class="_abstract _abstract">
					If OTP is conditional in your realm, the user must navigate to Red Hat Single Sign-On Account Console to reconfigure a new OTP generator. If OTP is required, then the user must reconfigure a new OTP generator when logging in.
				</p><p>
					Alternatively, you can send an email to the user that requests the user reset the OTP generator. The following procedure also applies if the user already has an OTP credential.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisite</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You are logged in to the appropriate realm.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the main menu. The <span class="strong strong"><strong>Users</strong></span> page is displayed.
						</li><li class="listitem">
							Select a user.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Credentials</strong></span> tab.
						</li><li class="listitem">
							Navigate to the <span class="strong strong"><strong>Reset Actions</strong></span> list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Configure OTP</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Send Email</strong></span>. The sent email contains a link that directs the user to the <span class="strong strong"><strong>OTP setup page</strong></span>.
						</li></ol></div></section></section><section class="section" id="con-required-actions_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.7. Required actions</h2></div></div></div><p>
				You can set the actions that a user must perform at the first login. These actions are required after the user provides credentials. After the first login, these actions are no longer required. You add required actions on the <span class="strong strong"><strong>Details</strong></span> tab of that user.
			</p><p>
				The following are examples of required action types:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Update Password</span></dt><dd>
							The user must change their password.
						</dd><dt><span class="term">Configure OTP</span></dt><dd>
							The user must configure a one-time password generator on their mobile device using either the Free OTP or Google Authenticator application.
						</dd><dt><span class="term">Verify Email</span></dt><dd>
							The user must verify their email account. An email will be sent to the user with a validation link that they must click. Once this workflow is successfully completed, the user will be allowed to log in.
						</dd><dt><span class="term">Update Profile</span></dt><dd>
							The user must update profile information, such as name, address, email, and phone number.
						</dd></dl></div><section class="section" id="proc-setting-required-actions_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.7.1. Setting required actions for one user</h3></div></div></div><p>
					You can set the actions that are required for any user.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Users</strong></span> in the menu.
						</li><li class="listitem">
							Select a user from the list.
						</li><li class="listitem"><p class="simpara">
							Navigate to the <span class="strong strong"><strong>Required User Actions</strong></span> list.
						</p><p class="simpara">
							<span class="inlinemediaobject"><img src="images/rhsso-images/user-required-action.png" alt="user required action"/></span>
						</p></li><li class="listitem">
							Select all the actions you want to add to the account.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>X</strong></span> next to the action name to remove it.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span> after you select which actions to add.
						</li></ol></div></section><section class="section" id="proc-setting-default-required-actions_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.7.2. Setting required actions for all users</h3></div></div></div><p>
					You can specify what actions are required before the first login of all new users. The requirements apply to a user created by the <span class="strong strong"><strong>Add User</strong></span> button on the <span class="strong strong"><strong>Users</strong></span> page or the <span class="strong strong"><strong>Register</strong></span> link on the login page.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Required Actions</strong></span> tab.
						</li><li class="listitem">
							Click the checkbox in the <span class="strong strong"><strong>Default Action</strong></span> column for one or more required actions. When a new user logs in for the first time, the selected actions must be executed.
						</li></ol></div></section><section class="section" id="proc-enabling-terms-conditions_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.7.3. Enabling terms and conditions as a required action</h3></div></div></div><p>
					You can enable a required action that new users must accept the terms and conditions before logging in to Red Hat Single Sign-On for the first time.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Required Actions</strong></span> tab.
						</li><li class="listitem">
							Enable the <span class="strong strong"><strong>Terms and Conditions</strong></span> action.
						</li><li class="listitem">
							Edit the <code class="literal">terms.ftl</code> file in the base login theme.
						</li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							For more information on extending and creating themes, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a>.
						</li></ul></div></section></section><section class="section" id="con-user-impersonation_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.8. User impersonation</h2></div></div></div><p>
				An administrator with the appropriate permissions can impersonate a user. For example, if a user experiences a bug in an application, an administrator can impersonate the user to investigate or duplicate the issue.
			</p><p>
				Any user with the <code class="literal">impersonation</code> role in the realm can impersonate a user.
			</p><p>
				Image:rhsso-images/user-details.png[]
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						If the administrator and the user are in the same realm, then the administrator will be logged out and automatically logged in as the user being impersonated.
					</li><li class="listitem">
						If the administrator and user are in different realms, the administrator will remain logged in, and additionally will be logged in as the user in that user’s realm.
					</li></ul></div><p>
				In both instances, the <span class="strong strong"><strong>User Account Management</strong></span> page of the impersonated user is displayed.
			</p><p>
				You can access the <span class="strong strong"><strong>Impersonate</strong></span> button from the <span class="strong strong"><strong>Details</strong></span> tab on the <span class="strong strong"><strong>Users</strong></span> page.
			</p><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						For more information on assigning administration permissions, see the <a class="link" href="#admin_permissions" title="Chapter 11. Controlling access to the Admin Console">Admin Console Access Control</a> chapter.
					</li></ul></div></section><section class="section" id="con-user-registration_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.9. User registration</h2></div></div></div><p class="_abstract _abstract">
				You can use Red Hat Single Sign-On as a third-party authorization server to manage application users, including users who self-register. If you enable self-registration, the login page displays a registration link so that user can create an account.
			</p><div class="formalpara"><p class="title"><strong>Registration link</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/registration-link.png" alt="registration link"/></span>
				</p></div><p>
				A user must add profile information to the registration form to complete registration. The registration form can be customized by removing or adding the fields that must be completed by a user.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						For more information on customizing user registration, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a>.
					</li></ul></div><section class="section" id="proc-enabling-user-registration_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.9.1. Enabling user registration</h3></div></div></div><p class="_abstract _abstract">
					Enable users to self-register.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Realm Settings</strong></span> in the main menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Login</strong></span> tab.
						</li><li class="listitem">
							Toggle <span class="strong strong"><strong>User Registration</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					After you enable this setting, a <span class="strong strong"><strong>Register</strong></span> link displays on the login page of the Admin Console.
				</p></section><section class="section" id="proc-registering-new-user_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">5.9.2. Registering as a new user</h3></div></div></div><p class="_abstract _abstract">
					As a new user, you must complete a registration form to log in for the first time. You add profile information and a password to register.
				</p><div class="formalpara"><p class="title"><strong>Registration form</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/registration-form.png" alt="registration form"/></span>
					</p></div><div class="itemizedlist"><p class="title"><strong>Prerequisite</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							User registration is enabled.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click the <span class="strong strong"><strong>Register</strong></span> link on the login page. The registration page is displayed.
						</li><li class="listitem">
							Enter the user profile information.
						</li><li class="listitem">
							Enter the new password.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section></section><section class="section" id="proc-enabling-recaptcha_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.10. Enabling reCAPTCHA</h2></div></div></div><p class="_abstract _abstract">
				To safeguard registration against bots, Red Hat Single Sign-On has integration with Google reCAPTCHA.
			</p><p>
				Once reCAPTCHA is enabled, you can edit <code class="literal">register.ftl</code> in your login theme to configure the placement and styling of the reCAPTCHA button on the registration page.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Enter the following URL in a browser:
					</p><pre class="programlisting language-bash">https://developers.google.com/recaptcha/</pre></li><li class="listitem"><p class="simpara">
						Create an API key to get your reCAPTCHA site key and secret. Note the reCAPTCHA site key and secret for future use in this procedure.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The localhost works by default. You do not have to specify a domain.
						</p></div></div></li><li class="listitem">
						Navigate to the Red Hat Single Sign-On admin console.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Flows</strong></span> tab.
					</li><li class="listitem">
						Select <span class="strong strong"><strong>Registration</strong></span> from the drop down menu.
					</li><li class="listitem">
						Set the <span class="strong strong"><strong>reCAPTCHA</strong></span> requirement to <span class="strong strong"><strong>Required</strong></span>. This enables reCAPTCHA.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Actions</strong></span> to the right of the reCAPTCHA flow entry.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Config</strong></span> link.
					</p><div class="formalpara"><p class="title"><strong>Recaptcha config page</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/recaptcha-config.png" alt="recaptcha config"/></span>
						</p></div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Enter the <span class="strong strong"><strong>Recaptcha Site Key</strong></span> generated from the Google reCAPTCHA website.
							</li><li class="listitem">
								Enter the <span class="strong strong"><strong>Recaptcha Secret</strong></span> generated from the Google reCAPTCHA website.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Authorize Google to use the registration page as an iframe.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							In Red Hat Single Sign-On, websites cannot include a login page dialog in an iframe. This restriction is to prevent clickjacking attacks. You need to change the default HTTP response headers that is set in Red Hat Single Sign-On.
						</p></div></div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Security Defenses</strong></span> tab.
							</li><li class="listitem">
								Enter <code class="literal"><a class="link" href="https://www.google.com">https://www.google.com</a></code> in the field for the <span class="strong strong"><strong>X-Frame-Options</strong></span> header.
							</li><li class="listitem">
								Enter <code class="literal"><a class="link" href="https://www.google.com">https://www.google.com</a></code> in the field for the <span class="strong strong"><strong>Content-Security-Policy</strong></span> header.
							</li></ol></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						For more information on extending and creating themes, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a>.
					</li></ul></div></section><section class="section" id="ref-personal-data-collected_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">5.11. Personal data collected by Red Hat Single Sign-On</h2></div></div></div><p>
				By default, Red Hat Single Sign-On collects the following data:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Basic user profile data, such as the user email, first name, and last name.
					</li><li class="listitem">
						Basic user profile data used for social accounts and references to the social account when using a social login.
					</li><li class="listitem">
						Device information collected for audit and security purposes, such as the IP address, operating system name, and the browser name.
					</li></ul></div><p>
				The information collected in Red Hat Single Sign-On is highly customizable. The following guidelines apply when making customizations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Registration and account forms can contain custom fields, such as birthday, gender, and nationality. An administrator can configure Red Hat Single Sign-On to retrieve data from a social provider or a user storage provider such as LDAP.
					</li><li class="listitem">
						Red Hat Single Sign-On collects user credentials, such as password, OTP codes, and WebAuthn public keys. This information is encrypted and saved in a database, so it is not visible to Red Hat Single Sign-On administrators. Each type of credential can include non-confidential metadata that is visible to administrators such as the algorithm that is used to hash the password and the number of hash iterations used to hash the password.
					</li><li class="listitem">
						With authorization services and UMA support enabled, Red Hat Single Sign-On can hold information about some objects for which a particular user is the owner.
					</li></ul></div></section><section class="section" id="user_profile"><div class="titlepage"><div><div><h2 class="title">5.12. User Profile</h2></div></div></div><p>
				In Red Hat Single Sign-On a user is associated with a set of attributes. These attributes are used to better describe and identify users within Red Hat Single Sign-On as well as to pass over additional information about them to applications.
			</p><p>
				A user profile defines a well-defined schema for representing user attributes and how they are managed within a realm. By providing a consistent view over user information, it allows administrators to control the different aspects on how attributes are managed as well as to make a lot easier to extend Red Hat Single Sign-On to support additional attributes.
			</p><p>
				Among other capabilities, user profile enables administrators to:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Define a schema for user attributes
					</li><li class="listitem">
						Define whether an attribute is required based on contextual information (e.g.: if required only for users, or admins, or both, or depending on the scope being requested.)
					</li><li class="listitem">
						Define specific permissions for viewing and editing user attributes, making possible to adhere to strong privacy requirements where some attributes can not be seen or be changed by third-parties (including administrators)
					</li><li class="listitem">
						Dynamically enforce user profile compliance so that user information is always updated and in compliance with the metadata and rules associated with attributes
					</li><li class="listitem">
						Define validation rules on a per-attribute basis by leveraging the built-in validators or writing custom ones
					</li><li class="listitem">
						Dynamically render forms that users interact with like registration, update profile, brokering, and personal information in the account console, according to the attribute definitions and without any need to manually change themes.
					</li></ul></div><p>
				The User Profile capabilities are backed by the User Profile SPI. By default, these capabilities are disabled and realms are configured to use a default configuration that keeps backward compatibility with the legacy behavior.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The legacy behavior is about keeping the default constraints used by Red Hat Single Sign-On when managing users root attributes such as username, email, first and last name, without any restriction on how custom attributes are managed. Regarding user flows such as registration, profile update, brokering, and managing accounts through the account console, users are restricted to use the attributes aforementioned with the possibility to change theme templates to support additional attributes.
				</p><p>
					If you are already using Red Hat Single Sign-On, the legacy behavior is what you have been using so far.
				</p></div></div><p>
				Differently than the legacy behavior, the declarative provider gives you a lot more flexibility to define the user profile configuration to a realm through the administration console and a well-defined JSON schema.
			</p><p>
				In the next sections, we’ll be looking at how to use the declarative provider to define your own user profile configuration.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					In the future, the legacy behavior will no longer be supported in Red Hat Single Sign-On. Ideally, you should start looking at the new capabilities provided by the User Profile and migrate your realms accordingly.
				</p></div></div><section class="section" id="enabling_the_user_profile"><div class="titlepage"><div><div><h3 class="title">5.12.1. Enabling the User Profile</h3></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Declarative User Profile is <span class="strong strong"><strong>Technology Preview</strong></span> and is not fully supported. This feature is disabled by default.
					</p><p>
						To enable start the server with <code class="literal">-Dkeycloak.profile=preview</code> or <code class="literal">-Dkeycloak.profile.feature.declarative_user_profile=enabled</code> . For more details see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#profiles">Profiles</a>.
					</p></div></div><p>
					In addition to enabling the <code class="literal">declarative_user_profile</code> feature, you should enable User Profile for a realm. To do that, click on the <code class="literal">Realm Settings</code> link on the left side menu and turn on the <code class="literal">User Profile Enabled</code> switch.
				</p><p>
					<span class="inlinemediaobject"><img src="images/user-profile-enabling.png" alt="user profile enabling"/></span>
				</p><p>
					Once you enable it and click on the <code class="literal">Save</code> button, you can access the <code class="literal">User Profile</code> tab from where you can manage the configuration for user attributes.
				</p><p>
					By enabling the user profile for a realm, Red Hat Single Sign-On is going to impose additional constraints on how attributes are managed based on the user profile configuration. In summary, here is the list of what you should expect when the feature is enabled:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							From an administration point of view, the <code class="literal">Attributes</code> tab at the user details page will only show the attributes defined in the user profile configuration. The conditions defined on a per-attribute basis will also be taken into account when managing attributes.
						</li><li class="listitem">
							User facing forms like registration, update profile, brokering, and personal info in the account console, are going to be rendered dynamically based on the user profile configuration. For that, Red Hat Single Sign-On is going to rely on different templates to render these forms dynamically.
						</li></ul></div><p>
					In the next topics, we’ll be exploring how to manage the user profile configuration and how it affects your realm.
				</p></section><section class="section" id="managing_the_user_profile"><div class="titlepage"><div><div><h3 class="title">5.12.2. Managing the User Profile</h3></div></div></div><p>
					The user profile configuration is managed on a per-realm basis. For that, click on the <code class="literal">Realm Settings</code> link on the left side menu and then click on the <code class="literal">User Profile</code> tab.
				</p><div class="formalpara"><p class="title"><strong>User Profile Tab</strong></p><p>
						<span class="inlinemediaobject"><img src="images/user-profile-tab.png" alt="user profile tab"/></span>
					</p></div><p>
					In the <code class="literal">Attributes</code> sub-tab you have a list of the attributes currently associated with the user profile. By default, the configuration is created based on the user root attributes and each attribute is configured with some defaults in terms of validation and permissioning.
				</p><p>
					In the <code class="literal">Attribute Groups</code> sub-tab you can manage attribute groups. An attribute group allows you to correlate attributes so that they are displayed together when rendering user facing forms.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						For now, attribute groups are only used for rendering purposes but in the future they should also enable defining top-level configurations to the attributes they are linked to.
					</p></div></div><p>
					In the <code class="literal">JSON Editor</code> sub-tab you can view and edit the configuration using a well-defined JSON schema. Any change you make when at any other tab are reflected in the JSON configuration shown at this tab.
				</p><p>
					In the next section, you are going to learn how to manage the configuration from the <code class="literal">Attributes</code> sub-tab.
				</p></section><section class="section" id="managing_attributes"><div class="titlepage"><div><div><h3 class="title">5.12.3. Managing Attributes</h3></div></div></div><p>
					At the <code class="literal">Attributes</code> sub-tab you can create, edit, and delete the attributes associated with the user profile.
				</p><p>
					To define a new attribute and associate it with the user profile, click on the <code class="literal">Create</code> button in the top-right corner of the attribute listing.
				</p><div class="formalpara"><p class="title"><strong>Attribute Configuration</strong></p><p>
						<span class="inlinemediaobject"><img src="images/user-profile-create-attribute.png" alt="user profile create attribute"/></span>
					</p></div><p>
					When configuring the attribute you can define the following settings:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd>
								The name of the attribute.
							</dd><dt><span class="term">Display name</span></dt><dd>
								A user-friendly name for the attribute, mainly used when rendering user-facing forms. It supports internationalization so that values can be loaded from message bundles.
							</dd><dt><span class="term">Attribute Group</span></dt><dd>
								The attribute group to which the attribute belongs to, if any.
							</dd><dt><span class="term">Enabled when scope</span></dt><dd>
								Allows you to define a list of scopes to dynamically enable an attribute. If not set, the attribute is always enabled and its constraints are always enforced when managing user profiles as well as when rendering user-facing forms. Otherwise, the same constraints only apply when any of the scopes in the list is requested by clients.
							</dd><dt><span class="term">Required</span></dt><dd>
								Set the attribute as required. If not enabled, the attribute is optional. Otherwise, the attribute must be provided by users and administrators with the possibility to also make the attribute required only for users or administrators as well as based on the scopes requested by clients.
							</dd><dt><span class="term">Permission</span></dt><dd>
								In this section, you can define read and write permissions for users and administrators.
							</dd><dt><span class="term">Validation</span></dt><dd>
								In this section, you can define the validations that will be performed when managing the attribute value. Red Hat Single Sign-On provides a set of built-in validators you can choose from with the possibility to add your own.
							</dd><dt><span class="term">Annotation</span></dt><dd>
								In this section, you can associate annotations to the attribute. Annotations are mainly useful to pass over additional metadata to frontends for rendering purposes.
							</dd></dl></div><section class="section" id="managing_permissions"><div class="titlepage"><div><div><h4 class="title">5.12.3.1. Managing Permissions</h4></div></div></div><p>
						In the <code class="literal">Permission</code> section, you can define the level of access users and administrators have to read and write to an attribute.
					</p><div class="formalpara"><p class="title"><strong>Attribute Permission</strong></p><p>
							<span class="inlinemediaobject"><img src="images/user-profile-permission.png" alt="user profile permission"/></span>
						</p></div><p>
						For that, you can use the following settings:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Can user view?</span></dt><dd>
									If enabled, users can view the attribute. Otherwise, users don’t have access to the attribute.
								</dd><dt><span class="term">Can user edit?</span></dt><dd>
									If enabled, users can view and edit the attribute. Otherwise, users don’t have access to write to the attribute.
								</dd><dt><span class="term">Can admin view?</span></dt><dd>
									If enabled, administrators can view the attribute. Otherwise, administrators don’t have access to the attribute.
								</dd><dt><span class="term">Can admin edit?</span></dt><dd>
									If enabled, administrators can view and edit the attribute. Otherwise, administrators don’t have access to write to the attribute.
								</dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							When you create an attribute, no permission is set to the attribute. Effectively, the attribute won’t be accessible by either users or administrators. Once you create the attribute, make sure to set the permissions accordingly to that the attribute is only visible by the target audience.
						</p></div></div><p>
						Permissioning has a direct impact on how and who can manage the attribute, as well as on how the attribute is rendered in user-facing forms.
					</p><p>
						For instance, by marking an attribute as only viewable by users, the administrators won’t have access to the attribute when managing users through the administration console (neither from the User API). Also, users won’t be able to change the attribute when updating their profiles. An interesting configuration if user attributes are fetched from an existing identity store (federation) and you just want to make attributes visible to users without any possibility to update the attribute other than through the source identity store.
					</p><p>
						Similarly, you can also mark an attribute as writable only for administrators with read-only access for users. In this case, only administrators are going to be allowed to manage the attribute.
					</p><p>
						Depending on your privacy requirements, you might also want attributes inaccessible to administrators but with read-write permissions for users.
					</p><p>
						Make sure to set the correct permissions whenever you add a new attribute to the user profile configuration.
					</p></section><section class="section" id="managing_validations"><div class="titlepage"><div><div><h4 class="title">5.12.3.2. Managing validations</h4></div></div></div><p>
						In the <code class="literal">Validation</code> section, you can choose from different forms of validation to make sure the attribute value conforms to specific rules.
					</p><div class="formalpara"><p class="title"><strong>Attribute Validation</strong></p><p>
							<span class="inlinemediaobject"><img src="images/user-profile-validation.png" alt="user profile validation"/></span>
						</p></div><p>
						Red Hat Single Sign-On provides different validators out of the box:
					</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556190094576" scope="col">Name</th><th align="left" valign="top" id="idm140556190661648" scope="col">Description</th><th align="left" valign="top" id="idm140556190660560" scope="col">Configuration</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										length
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check the length of a string value based on a minimum and maximum length.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										<span class="strong strong"><strong>min</strong></span>: an integer to define the minimum allowed length.
									</p>
									<p>
										<span class="strong strong"><strong>max</strong></span>: an integer to define the maximum allowed length.
									</p>
									<p>
										<span class="strong strong"><strong>trim-disabled</strong></span>: a boolean to define whether the value is trimmed prior to validation.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										integer
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value is an integer and within a lower and/or upper range. If no range is defined, the validator only checks whether the value is a valid number.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										<span class="strong strong"><strong>min</strong></span>: an integer to define the lower range.
									</p>
									<p>
										<span class="strong strong"><strong>max</strong></span>: an integer to define the upper range.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										double
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value is a double and within a lower and/or upper range. If no range is defined, the validator only checks whether the value is a valid number.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										<span class="strong strong"><strong>min</strong></span>: an integer to define the lower range.
									</p>
									<p>
										<span class="strong strong"><strong>max</strong></span>: an integer to define the upper range.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										uri
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value is a valid URI.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										None
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										pattern
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value matches a specific RegEx pattern.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										<span class="strong strong"><strong>pattern</strong></span>: the RegEx pattern to use when validating values.
									</p>
									<p>
										<span class="strong strong"><strong>error-message</strong></span>: the key of the error message in i18n bundle. If not set a generic message is used.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										email
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value has a valid e-mail format.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										None
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										local-date
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value has a valid format based on the realm and/or user locale.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										None
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										person-name-prohibited-characters
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value is a valid person name as an additional barrier for attacks such as script injection. The validation is based on a default RegEx pattern that blocks characters not common in person names.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										<span class="strong strong"><strong>error-message</strong></span>: the key of the error message in i18n bundle. If not set a generic message is used.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556190094576">
									<p>
										username-prohibited-characters
									</p>
									</td><td align="left" valign="top" headers="idm140556190661648">
									<p>
										Check if the value is a valid username as an additional barrier for attacks such as script injection. The validation is based on a default RegEx pattern that blocks characters not common in usernames.
									</p>
									</td><td align="left" valign="top" headers="idm140556190660560">
									<p>
										<span class="strong strong"><strong>error-message</strong></span>: the key of the error message in i18n bundle. If not set a generic message is used.
									</p>
									</td></tr></tbody></table></div><section class="section" id="managing_annotations"><div class="titlepage"><div><div><h5 class="title">5.12.3.2.1. Managing annotations</h5></div></div></div><p>
							In order to pass additional information to frontends, attributes can be decorated with annotations to dictate how attributes are rendered. This capability is mainly useful when extending Red Hat Single Sign-On themes to render pages dynamically based on the annotations associated with attributes.
						</p><div class="formalpara"><p class="title"><strong>Attribute Annotation</strong></p><p>
								<span class="inlinemediaobject"><img src="images/user-profile-annotation.png" alt="user profile annotation"/></span>
							</p></div></section></section></section><section class="section" id="managing_attribute_groups"><div class="titlepage"><div><div><h3 class="title">5.12.4. Managing Attribute Groups</h3></div></div></div><p>
					At the <code class="literal">Attribute Groups</code> sub-tab you can create, edit, and delete attribute groups. An attribute group allows you to define a container for correlated attributes so that they are rendered together when at the user-facing forms.
				</p><div class="formalpara"><p class="title"><strong>Attribute Group List</strong></p><p>
						<span class="inlinemediaobject"><img src="images/user-profile-attribute-group-list.png" alt="user profile attribute group list"/></span>
					</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can’t delete attribute groups that are bound to attributes. For that, you should first update the attributes to remove the binding.
					</p></div></div><p>
					To create a new group, click on the <code class="literal">Create</code> button in the top-right corner of the attribute groups listing.
				</p><div class="formalpara"><p class="title"><strong>Attribute Group Configuration</strong></p><p>
						<span class="inlinemediaobject"><img src="images/user-profile-create-attribute-group.png" alt="user profile create attribute group"/></span>
					</p></div><p>
					When configuring the group you can define the following settings:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd>
								The name of the group.
							</dd><dt><span class="term">Display name</span></dt><dd>
								A user-friendly name for the group, mainly used when rendering user-facing forms. It supports internationalization so that values can be loaded from message bundles.
							</dd><dt><span class="term">Display description</span></dt><dd>
								A user-friendly text that will be displayed as a tooltip when rendering user-facing forms.
							</dd><dt><span class="term">Annotation</span></dt><dd>
								In this section, you can associate annotations to the attribute. Annotations are mainly useful to pass over additional metadata to frontends for rendering purposes.
							</dd></dl></div></section><section class="section" id="using_the_json_configuration"><div class="titlepage"><div><div><h3 class="title">5.12.5. Using the JSON configuration</h3></div></div></div><p>
					The user profile configuration is stored using a well-defined JSON schema. You can choose from editing the user profile configuration directly by clicking on the <code class="literal">JSON Editor</code> sub-tab.
				</p><div class="formalpara"><p class="title"><strong>JSON Configuration</strong></p><p>
						<span class="inlinemediaobject"><img src="images/user-profile-json-config.png" alt="user profile json config"/></span>
					</p></div><p>
					The JSON schema is defined as follows:
				</p><pre class="programlisting language-json">{
  "attributes": [
    {
      "name": "myattribute",
      "required": {
        "roles": [ "user", "admin" ],
        "scopes": [ "foo", "bar" ]
      },
      "permissions": {
        "view": [ "admin", "user" ],
        "edit": [ "admin", "user" ]
      },
      "validations": {
        "email": {},
        "length": {
          "max": 255
        }
      },
      "annotations": {
        "myannotation": "myannotation-value"
      }
    }
  ],
  "groups": [
    {
      "name": "personalInfo",
      "displayHeader": "Personal Information"
    }
  ]
}</pre><p>
					The schema supports as many attributes as you need.
				</p><p>
					For each attribute you should define a <code class="literal">name</code> and, optionally, the <code class="literal">required</code>, <code class="literal">permission</code>, and the <code class="literal">annotations</code> settings.
				</p><section class="section" id="required_property"><div class="titlepage"><div><div><h4 class="title">5.12.5.1. Required property</h4></div></div></div><p>
						The <code class="literal">required</code> setting defines whether an attribute is required. Red Hat Single Sign-On allows you to set an attribute as required based on different conditions.
					</p><p>
						When the <code class="literal">required</code> setting is defined as an empty object, the attribute is always required.
					</p><pre class="programlisting language-json">{
  "attributes": [
    {
      "name": "myattribute",
      "required": {}
  ]
}</pre><p>
						On the other hand, you can choose to make the attribute required only for users, or administrators, or both. As well as mark the attribute as required only in case a specific scope is requested when the user is authenticating in Red Hat Single Sign-On.
					</p><p>
						To mark an attribute as required for a user and/or administrator, set the <code class="literal">roles</code> property as follows:
					</p><pre class="programlisting language-json">{
  "attributes": [
    {
      "name": "myattribute",
      "required": {
        "roles": ["user"]
      }
  ]
}</pre><p>
						The <code class="literal">roles</code> property expects an array whose values can be either <code class="literal">user</code> or <code class="literal">admin</code>, depending on whether the attribute is required by the user or the administrator, respectively.
					</p><p>
						Similarly, you can choose to make the attribute required when a set of one or more scopes is requested by a client when authenticating a user. For that, you can use the <code class="literal">scopes</code> property as follows:
					</p><pre class="programlisting language-json">{
  "attributes": [
    {
      "name": "myattribute",
      "required": {
        "scopes": ["foo"]
      }
  ]
}</pre><p>
						The <code class="literal">scopes</code> property is an array whose values can be any string representing a client scope.
					</p></section><section class="section" id="permissions_property"><div class="titlepage"><div><div><h4 class="title">5.12.5.2. Permissions property</h4></div></div></div><p>
						The attribute-level <code class="literal">permissions</code> property can be used to define the read and write permissions to an attribute. The permissions are set based on whether these operations can be performed on the attribute by a user, or administrator, or both.
					</p><pre class="programlisting language-json">{
  "attributes": [
    {
      "name": "myattribute",
      "permissions": {
        "view": ["admin"],
        "edit": ["user"]
      }
  ]
}</pre><p>
						Both <code class="literal">view</code> and <code class="literal">edit</code> properties expect an array whose values can be either <code class="literal">user</code> or <code class="literal">admin</code>, depending on whether the attribute is viewable or editable by the user or the administrator, respectively.
					</p><p>
						When the <code class="literal">edit</code> permission is granted, the <code class="literal">view</code> permission is implicitly granted.
					</p></section><section class="section" id="annotations_property"><div class="titlepage"><div><div><h4 class="title">5.12.5.3. Annotations property</h4></div></div></div><p>
						The attribute-level <code class="literal">annotation</code> property can be used to associate additional metadata to attributes. Annotations are mainly useful for passing over additional information about attributes to frontends rendering user attributes based on the user profile configuration. Each annotation is a key/value pair.
					</p><pre class="programlisting language-json">{
  "attributes": [
    {
      "name": "myattribute",
      "annotations": {
        "foo": ["foo-value"],
        "bar": ["bar-value"]
      }
  ]
}</pre></section></section><section class="section" id="using_dynamic_forms"><div class="titlepage"><div><div><h3 class="title">5.12.6. Using dynamic forms</h3></div></div></div><p>
					One of the main capabilities of User Profile is the possibility to dynamically render user-facing forms based on attributes metadata. When you have the feature enabled to your realm, forms like registration and update profile are rendered using specific theme templates to dynamically render pages based on the user profile configuration.
				</p><p>
					That said, you shouldn’t need to customize templates at all if the default rendering mechanisms serves to your needs. In case you still need customizations to themes, here are the templates you should be looking at:
				</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556194583952" scope="col">Template</th><th align="left" valign="top" id="idm140556194582864" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556194583952">
								<p>
									base/login/update-user-profile.ftl
								</p>
								</td><td align="left" valign="top" headers="idm140556194582864">
								<p>
									The template that renders the update profile page.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556194583952">
								<p>
									base/login/register-user-profile.ftl
								</p>
								</td><td align="left" valign="top" headers="idm140556194582864">
								<p>
									The template that renders the registration page.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556194583952">
								<p>
									base/login/idp-review-user-profile.ftl
								</p>
								</td><td align="left" valign="top" headers="idm140556194582864">
								<p>
									The template that renders the page to review/update the user profile when federating users through brokering.
								</p>
								</td></tr></tbody></table></div><p>
					The default rendering mechanism provides the following capabilities:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Dynamically display fields based on the permissions set to attributes.
						</li><li class="listitem">
							Dynamically render markers for required fields based on the constraints set to the attributes.
						</li><li class="listitem">
							Dynamically render read-only fields depending on the permissions set to an attribute.
						</li><li class="listitem">
							Dynamically order fields depending on the order set to the attributes.
						</li><li class="listitem">
							Dynamically group fields that belong to a same attribute group.
						</li></ul></div><section class="section" id="ordering_attributes"><div class="titlepage"><div><div><h4 class="title">5.12.6.1. Ordering attributes</h4></div></div></div><p>
						The attributes order is set by clicking on the up and down arrows when at the attribute listing page.
					</p><div class="formalpara"><p class="title"><strong>Ordering Attributes</strong></p><p>
							<span class="inlinemediaobject"><img src="images/user-profile-attribute-list-order.png" alt="user profile attribute list order"/></span>
						</p></div><p>
						The order you set in this page is respected when fields are rendered in dynamic forms.
					</p></section><section class="section" id="grouping_attributes"><div class="titlepage"><div><div><h4 class="title">5.12.6.2. Grouping attributes</h4></div></div></div><p>
						When dynamic forms are rendered, they will try to group together attributes that belong to a same attribute group.
					</p><div class="formalpara"><p class="title"><strong>Dynamic Update Profile Form</strong></p><p>
							<span class="inlinemediaobject"><img src="images/user-profile-update-profile.png" alt="user profile update profile"/></span>
						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							When attributes are linked to an attribute group, the attribute order is also important to make sure attributes within the same group are close together, within a same group header. Otherwise, if attributes within a group do not have a sequential order you might have the same group header rendered multiple times in the dynamic form.
						</p></div></div></section></section><section class="section" id="forcing_user_profile_compliance"><div class="titlepage"><div><div><h3 class="title">5.12.7. Forcing User Profile compliance</h3></div></div></div><p>
					In order to make sure user profiles are in compliance with the configuration, administrators may use the <code class="literal">VerifyProfile</code> required action to eventually force users to update their profiles when authenticating to Red Hat Single Sign-On.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The <code class="literal">VerifyProfile</code> action is similar to the <code class="literal">UpdateProfile</code> action. However, it leverages all the capabilities provided by the user profile to automatically enforce compliance with the user profile configuration.
					</p></div></div><p>
					When enabled, the <code class="literal">VerifyProfile</code> action is going to perform the following steps when the user is authenticating:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Check whether the user profile is fully compliant with the user profile configuration set to the realm.
						</li><li class="listitem">
							If not, perform an additional step during the authentication so that the user can update any missing or invalid attribute.
						</li><li class="listitem">
							If the user profile is compliant with the configuration, no additional step is performed, and the user continues with the authentication process.
						</li></ul></div><p>
					By default, the <code class="literal">VerifyProfile</code> action is disabled. To enabled it, click on the <code class="literal">Authentication</code> link on the left side menu and then click on the <code class="literal">Required Actions</code> tab. At this tab, click on the <code class="literal">Register</code> button and select the <code class="literal">VerifyProfile</code> action.
				</p><div class="formalpara"><p class="title"><strong>Registring the VerifyProfile Required Action</strong></p><p>
						<span class="inlinemediaobject"><img src="images/user-profile-register-verify-profile-action.png" alt="user profile register verify profile action"/></span>
					</p></div></section><section class="section" id="migrating_to_user_profile"><div class="titlepage"><div><div><h3 class="title">5.12.8. Migrating to User Profile</h3></div></div></div><p>
					Before enabling the User Profile capabilities to a realm, there are some important considerations you should be aware of. By providing a single place to manage attribute metadata, the feature is very strict about the attributes that can be set to users and how they are managed.
				</p><p>
					In terms of user management, administrators are able to manage only the attributes defined in the user profile configuration. Any other attribute set to the user and not yet defined in the user profile configuration won’t be accessible. It is recommended to update your user profile configuration with all the user attributes you want to expose either to users or administrators.
				</p><p>
					The same recommendation applies for those accessing the User REST API to query user information.
				</p><p>
					In regards to Red Hat Single Sign-On internal user attributes such as <code class="literal">LDAP_ID</code>, <code class="literal">LDAP_ENTRY_DN</code>, or <code class="literal">KERBEROS_PRINCIPAL</code>, if you want to be able to access those attributes you should have them as attributes in your user profile configuration. The recommendation is to mark these attributes as viewable only to administrators so that you can look at them when managing the user attributes through the administration console or querying users via User API.
				</p><p>
					In regards to theming, if you already have customizations to the legacy templates (those hardcoded with user root attributes) your custom templates won’t be used when rendering user-facing forms but the new templates that render these forms dynamically. Ideally, you should avoid having any customizations to templates and try to stick with the behavior provided by these new templates to dynamically render forms for you. If they are still not enough to address your requirements, you can either customize them or provide us with any feedback so that we discuss whether it makes sense to enhance the new templates.
				</p></section></section></section><section class="chapter" id="managing_user_sessions"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Managing user sessions</h1></div></div></div><p>
			When users log into realms, Red Hat Single Sign-On maintains a user session for each user and remembers each client visited by the user within the session. Realm administrators can perform multiple actions on each user session:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					View login statistics for the realm.
				</li><li class="listitem">
					View active users and where they logged in.
				</li><li class="listitem">
					Log a user out of their session.
				</li><li class="listitem">
					Revoke tokens.
				</li><li class="listitem">
					Set up token timeouts.
				</li><li class="listitem">
					Set up session timeouts.
				</li></ul></div><section class="section" id="administering_sessions"><div class="titlepage"><div><div><h2 class="title">6.1. Administering sessions</h2></div></div></div><p>
				To see a top-level view of the active clients and sessions in Red Hat Single Sign-On, click <span class="strong strong"><strong>Sessions</strong></span> from the menu.
			</p><div class="formalpara"><p class="title"><strong>Sessions</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/sessions.png" alt="Sessions"/></span>
				</p></div><section class="section" id="the_emphasis_role_strong_logout_all_emphasis_operation"><div class="titlepage"><div><div><h3 class="title">6.1.1. The <span class="strong strong"><strong>Logout all</strong></span> Operation</h3></div></div></div><p>
					You can log out all users in the realm by clicking the <span class="strong strong"><strong>Logout all</strong></span> button.
				</p><p>
					When you click the <span class="strong strong"><strong>Logout all</strong></span> button, all SSO cookies become invalid, and clients requesting authentication within active browser sessions must log in again. Red Hat Single Sign-On notifies clients by using the Red Hat Single Sign-On OIDC client adapter of the logout event. Client types such as SAML do not receive a back-channel logout request.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Clicking <span class="strong strong"><strong>Logout all</strong></span> does not revoke outstanding access tokens. Outstanding tokens must expire naturally. For clients using the Red Hat Single Sign-On OIDC client adapter, you can push a <a class="link" href="#revocation-policy" title="6.2. Revocation policies">revocation policy</a> to revoke the token, but this does not work for other adapters.
					</p></div></div></section><section class="section" id="application_navigation"><div class="titlepage"><div><div><h3 class="title">6.1.2. Application navigation</h3></div></div></div><p>
					On the <code class="literal">Sessions</code> page, you can click on each client to go to that client’s <code class="literal">Sessions</code> tab. Click the <span class="strong strong"><strong>Show Sessions</strong></span> button there to see which users are in the application.
				</p><div class="formalpara"><p class="title"><strong>Application sessions</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/application-sessions.png" alt="application sessions"/></span>
					</p></div></section><section class="section" id="user_navigation"><div class="titlepage"><div><div><h3 class="title">6.1.3. User navigation</h3></div></div></div><p>
					If you go to the <code class="literal">Sessions</code> tab of an individual user, you can also view the user’s session information.
				</p><div class="formalpara"><p class="title"><strong>User Sessions</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/user-sessions.png" alt="user sessions"/></span>
					</p></div></section></section><section class="section" id="revocation-policy"><div class="titlepage"><div><div><h2 class="title">6.2. Revocation policies</h2></div></div></div><p class="_abstract _abstract">
				If your system is compromised, you can revoke all active sessions and access tokens by clicking the <code class="literal">Sessions</code> screen <span class="strong strong"><strong>Revocation</strong></span> tab.
			</p><div class="formalpara"><p class="title"><strong>Revocation</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/revocation.png" alt="revocation"/></span>
				</p></div><p>
				You can specify a time and date where sessions or tokens issued before that time and date are invalid using this console. Click <span class="strong strong"><strong>Set to now</strong></span> to set the policy to the current time and date. Click <span class="strong strong"><strong>Push</strong></span> to push this revocation policy to any registered OIDC client with the Red Hat Single Sign-On OIDC client adapter.
			</p></section><section class="section" id="timeouts"><div class="titlepage"><div><div><h2 class="title">6.3. Session and token timeouts</h2></div></div></div><p class="_abstract _abstract">
				Red Hat Single Sign-On includes control of the session, cookie, and token timeouts through the <span class="strong strong"><strong>Tokens</strong></span> tab in the <span class="strong strong"><strong>Realm Settings</strong></span> menu.
			</p><div class="formalpara"><p class="title"><strong>Tokens tab</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/tokens-tab.png" alt="tokens tab"/></span>
				</p></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556191918400" scope="col">Configuration</th><th align="left" valign="top" id="idm140556203915824" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Default Signature Algorithm
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The default algorithm used to assign tokens for the realm.
							</p>
							<p>
								<span id="revoke-refresh-token"/>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Revoke Refresh Token
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On revokes refresh tokens and issues another token that the client must use. This action applies to OIDC clients performing the refresh token flow.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								SSO Session Idle
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is for OIDC clients only. If a user is inactive for longer than this timeout, the user session is invalidated. This timeout value resets when clients request authentication or send a refresh token request. Red Hat Single Sign-On adds a window of time to the idle timeout before the session invalidation takes effect. See the <a class="link" href="#idle_timeouts_note" title="Note">note</a> later in this section.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								SSO Session Max
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The maximum time before a user session expires.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								SSO Session Idle Remember Me
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is similar to the standard SSO Session Idle configuration but specific to logins with <span class="strong strong"><strong>Remember Me</strong></span> enabled. Users can specify longer session idle timeouts when they click <span class="strong strong"><strong>Remember Me</strong></span> when logging in. This setting is an optional configuration and, if its value is not greater than zero, it uses the same idle timeout as the SSO Session Idle configuration.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								SSO Session Max Remember Me
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is similar to the standard SSO Session Max but specific to <span class="strong strong"><strong>Remember Me</strong></span> logins. Users can specify longer sessions when they click <span class="strong strong"><strong>Remember Me</strong></span> when logging in. This setting is an optional configuration and, if its value is not greater than zero, it uses the same session lifespan as the SSO Session Max configuration.
							</p>
							<p>
								<span id="offline-session-idle"/>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Offline Session Idle
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is for <a class="link" href="#offline-access" title="6.4. Offline access">offline access</a>. The amount of time the session remains idle before Red Hat Single Sign-On revokes its offline token. Red Hat Single Sign-On adds a window of time to the idle timeout before the session invalidation takes effect. See the <a class="link" href="#idle_timeouts_note" title="Note">note</a> later in this section.
							</p>
							<p>
								<span id="offline-session-max-limited"/>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Offline Session Max Limited
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is for <a class="link" href="#offline-access" title="6.4. Offline access">offline access</a>. If this flag is <span class="strong strong"><strong>ON</strong></span>, Offline Session Max can control the maximum time the offline token remains active, regardless of user activity. Client Offline Session Idle and Client Offline Session Max are enabled.
							</p>
							<p>
								<span id="offline-session-max"/>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Offline Session Max
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is for <a class="link" href="#offline-access" title="6.4. Offline access">offline access</a>, and it is the maximum time before Red Hat Single Sign-On revokes the corresponding offline token. This option controls the maximum amount of time the offline token remains active, regardless of user activity.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Client Offline Session Idle
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is for <a class="link" href="#offline-access" title="6.4. Offline access">offline access</a>. If a user is inactive for longer than this timeout, offline token requests bump the idle timeout. This setting specifies a shorter idle timeout of an offline token than the offline session idle. Users can override this setting for individual clients. This setting is an optional configuration and, when set to zero, uses the same idle timeout in the Offline Session Idle configuration.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Client Offline Session Max
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								This setting is for <a class="link" href="#offline-access" title="6.4. Offline access">offline access</a>. The maximum time before an offline token expires and invalidates. This setting specifies a shorter token timeout than an offline session timeout, but users can override it for individual clients. This setting is an optional configuration and, when set to zero, uses the same idle timeout in the Offline Session Max configuration.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Client Session Idle
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								If the user is inactive for longer than this timeout, refresh token requests bump the idle timeout. This setting specifies a shorter idle timeout of refresh tokens than the session idle timeout, but users can override it for individual clients. This setting is an optional configuration and, when set to zero, uses the same idle timeout in the SSO Session Idle configuration.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Client Session Max
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The maximum time before a refresh token expires and invalidates. This setting specifies a shorter timeout of refresh tokens than the session timeout, but users can override it for individual clients. This setting is an optional configuration and, when set to zero, uses the same idle timeout in the SSO Session Max configuration.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Access Token Lifespan
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								When Red Hat Single Sign-On creates an OIDC access token, this value controls the lifetime of the token.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Access Token Lifespan For Implicit Flow
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								With the Implicit Flow, Red Hat Single Sign-On does not provide a refresh token. A separate timeout exists for access tokens created by the Implicit Flow.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Client login timeout
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The maximum time before clients must finish the Authorization Code Flow in OIDC.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Login timeout
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The total time a logging in must take. If authentication takes longer than this time, the user must start the authentication process again.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Login action timeout
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The Maximum time users can spend on any one page during the authentication process.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								User-Initiated Action Lifespan
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The maximum time before a user’s action permission expires. Keep this value short because users generally react to self-created actions quickly.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Default Admin-Initiated Action Lifespan
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								The maximum time before an action permission sent to a user by an administrator expires. Keep this value long to allow administrators to send e-mails to offline users. An administrator can override the default timeout before issuing the token.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556191918400">
							<p>
								Override User-Initiated Action Lifespan
							</p>
							</td><td align="left" valign="top" headers="idm140556203915824">
							<p>
								Specifies independent timeouts per individual operation (for example, e-mail verification, forgot password, user actions, and Identity Provider E-mail Verification). This value defaults to the value configured at <span class="emphasis"><em>User-Initiated Action Lifespan</em></span>.
							</p>
							</td></tr></tbody></table></div><div class="admonition note" id="idle_timeouts_note"><div class="admonition_header">Note</div><div><p>
					For idle timeouts, a two-minute window of time exists that the session is active. For example, when you have the timeout set to 30 minutes, it will be 32 minutes before the session expires.
				</p><p>
					This action is necessary for some scenarios in cluster and cross-data center environments where the token refreshes on one cluster node a short time before the expiration and the other cluster nodes incorrectly consider the session as expired because they have not yet received the message about a successful refresh from the refreshing node.
				</p></div></div></section><section class="section" id="offline-access"><div class="titlepage"><div><div><h2 class="title">6.4. Offline access</h2></div></div></div><p class="_abstract _abstract">
				During <a class="link" href="https://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess">offline access</a> logins, the client application requests an offline token instead of a refresh token. The client application saves this offline token and can use it for future logins if the user logs out. This action is useful if your application needs to perform offline actions on behalf of the user even when the user is not online. For example, a regular data backup.
			</p><p>
				The client application is responsible for persisting the offline token in storage and then using it to retrieve new access tokens from the Red Hat Single Sign-On server.
			</p><p>
				The difference between a refresh token and an offline token is that an offline token never expires and is not subject to the <code class="literal">SSO Session Idle</code> timeout and <code class="literal">SSO Session Max</code> lifespan. The offline token is valid after a user logout or server restart. You must use the offline token for a refresh token action at least once per thirty days or for the value of the <a class="link" href="#offline-session-idle">Offline Session Idle</a>.
			</p><p>
				If you enable <a class="link" href="#offline-session-max-limited">Offline Session Max Limited</a>, offline tokens expire after 60 days even if you use the offline token for a refresh token action. You can change this value, <a class="link" href="#offline-session-max">Offline Session Max</a>, in the Admin Console.
			</p><p>
				If you enable the <a class="link" href="#revoke-refresh-token">Revoke Refresh Token</a> option, you can use each offline token once only. After refresh, you must store the new offline token from the refresh response instead of the previous one.
			</p><p>
				Users can view and revoke offline tokens that Red Hat Single Sign-On grants them in the <a class="link" href="#account-service" title="Chapter 17. Account Console">User Account Console</a>. Administrators can revoke offline tokens for individual users in the Admin Console in the <code class="literal">Consents</code> tab. Administrators can view all offline tokens issued in the <code class="literal">Offline Access</code> tab of each client. Administrators can revoke offline tokens by setting a <a class="link" href="#revocation-policy" title="6.2. Revocation policies">revocation policy</a>.
			</p><p>
				To issue an offline token, users must have the role mapping for the realm-level <code class="literal">offline_access</code> role. Clients must also have that role in their scope. Clients must add an <code class="literal">offline_access</code> client scope as an <code class="literal">Optional client scope</code> to the role, which is done by default.
			</p><p>
				Clients can request an offline token by adding the parameter <code class="literal">scope=offline_access</code> when sending their authorization request to Red Hat Single Sign-On. The Red Hat Single Sign-On OIDC client adapter automatically adds this parameter when you use it to access your application’s secured URL (such as, http://localhost:8080/customer-portal/secured?scope=offline_access). The Direct Access Grant and Service Accounts support offline tokens if you include <code class="literal">scope=offline_access</code> in the authentication request body.
			</p></section><section class="section" id="transient-session"><div class="titlepage"><div><div><h2 class="title">6.5. Transient sessions</h2></div></div></div><p>
				You can conduct transient sessions in Red Hat Single Sign-On. When using transient sessions, Red Hat Single Sign-On does not create a user session after successful authentication. Red Hat Single Sign-On creates a temporary, transient session for the scope of the current request that successfully authenticates the user. Red Hat Single Sign-On can run <a class="link" href="#protocol-mappers" title="12.4. OIDC token and SAML assertion mappings">protocol mappers</a> using transient sessions after authentication.
			</p><p>
				During transient sessions, the client application cannot refresh tokens, introspect tokens, or validate a specific session. Sometimes these actions are unnecessary, so you can avoid the additional resource use of persisting user sessions. This session saves performance, memory, and network communication (in cluster and cross-data center environments) resources.
			</p></section></section><section class="chapter" id="assigning_permissions_and_access_using_roles_and_groups"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Assigning permissions and access using roles and groups</h1></div></div></div><p>
			Roles and groups have a similar purpose, which is to give users access and permissions to use applications. Groups are a collection of users to which you apply roles and attributes. Roles define specific applications permissions and access control.
		</p><p>
			A role typically applies to one type of user. For example, an organization may include <code class="literal">admin</code>, <code class="literal">user</code>, <code class="literal">manager</code>, and <code class="literal">employee</code> roles. An application can assign access and permissions to a role and then assign multiple users to that role so the users have the same access and permissions. For example, the Admin Console has roles that give permission to users to access different parts of the Admin Console.
		</p><p>
			There is a global namespace for roles and each client also has its own dedicated namespace where roles can be defined.
		</p><section class="section" id="proc-creating-realm-roles_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">7.1. Creating a realm role</h2></div></div></div><p class="_abstract _abstract">
				Realm-level roles are a namespace for defining your roles. To see the list of roles, click <span class="strong strong"><strong>Roles</strong></span> in the menu.
			</p><p>
				<span class="inlinemediaobject"><img src="images/rhsso-images/roles.png" alt="roles"/></span>
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Add Role</strong></span>.
					</li><li class="listitem">
						Enter a <span class="strong strong"><strong>Role Name</strong></span>.
					</li><li class="listitem">
						Enter a <span class="strong strong"><strong>Description</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Add role</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/role.png" alt="Add role"/></span>
				</p></div><p>
				The <span class="strong strong"><strong>description</strong></span> field can be localizable by specifying a substitution variable with <code class="literal">${var-name}</code> strings. The localized value is configured to your theme within the themes property files. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more details.
			</p></section><section class="section" id="con-client-roles_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">7.2. Client roles</h2></div></div></div><p class="_abstract _abstract">
				Client roles are namespaces dedicated to clients. Each client gets its own namespace. Client roles are managed under the <span class="strong strong"><strong>Roles</strong></span> tab for each client. You interact with this UI the same way you do for realm-level roles.
			</p></section><section class="section" id="composite-roles"><div class="titlepage"><div><div><h2 class="title">7.3. Converting a role to a composite role</h2></div></div></div><p class="_abstract _abstract">
				Any realm or client level role can become a <span class="emphasis"><em>composite role</em></span>. A <span class="emphasis"><em>composite role</em></span> is a role that has one or more additional roles associated with it. When a composite role is mapped to a user, the user gains the roles associated with the composite role. This inheritance is recursive so users also inherit any composite of composites. However, we recommend that composite roles are not overused.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Roles</strong></span> in the menu.
					</li><li class="listitem">
						Click the role that you want to convert.
					</li><li class="listitem">
						Toggle <span class="strong strong"><strong>Composite Roles</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Composite role</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/composite-role.png" alt="Composite role"/></span>
				</p></div><p>
				The role selection UI is displayed on the page and you can associate realm level and client level roles to the composite role you are creating.
			</p><p>
				In this example, the <span class="strong strong"><strong>employee</strong></span> realm-level role is associated with the <span class="strong strong"><strong>developer</strong></span> composite role. Any user with the <span class="strong strong"><strong>developer</strong></span> role also inherits the <span class="strong strong"><strong>employee</strong></span> role.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					When creating tokens and SAML assertions, any composite also has its associated roles added to the claims and assertions of the authentication response sent back to the client.
				</p></div></div></section><section class="section" id="proc-assigning-role-mappings_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">7.4. Assigning role mappings</h2></div></div></div><p class="_abstract _abstract">
				You can assign role mappings to a user through the <span class="strong strong"><strong>Role Mappings</strong></span> tab for that user.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Users</strong></span> in the menu.
					</li><li class="listitem">
						Click the user that you want to perform a role mapping on. If the user is not displayed, click <span class="strong strong"><strong>View all users</strong></span>.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Role Mappings</strong></span> tab.
					</li><li class="listitem">
						Click the role you want to assign to the user in the <span class="strong strong"><strong>Available Roles</strong></span> box.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Add selected</strong></span>.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Role mappings</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/user-role-mappings.png" alt="Role mappings"/></span>
				</p></div><p>
				In the preceding example, we are assigning the composite role <span class="strong strong"><strong>developer</strong></span> to a user. That role was created in the <a class="link" href="#composite-roles" title="7.3. Converting a role to a composite role">Composite Roles</a> topic.
			</p><div class="formalpara"><p class="title"><strong>Effective role mappings</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/effective-role-mappings.png" alt="Effective role mappings"/></span>
				</p></div><p>
				When the <span class="strong strong"><strong>developer</strong></span> role is assigned, the <span class="strong strong"><strong>employee</strong></span> role associated with the <span class="strong strong"><strong>developer</strong></span> composite is displayed in the <span class="strong strong"><strong>Effective Roles</strong></span> box. <span class="strong strong"><strong>Effective Roles</strong></span> are the roles explicitly assigned to users and roles that are inherited from composites.
			</p></section><section class="section" id="default_roles"><div class="titlepage"><div><div><h2 class="title">7.5. Using default roles</h2></div></div></div><p class="_abstract _abstract">
				Use default roles to automatically assign user role mappings when a user is created or imported through <a class="link" href="#identity_broker" title="Chapter 9. Integrating identity providers">Identity Brokering</a>.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Roles</strong></span> in the menu
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Default Roles</strong></span> tab.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Default roles</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/default-roles.png" alt="Default roles"/></span>
				</p></div><p>
				This screenshot shows that some <span class="emphasis"><em>default roles</em></span> already exist.
			</p></section><section class="section" id="role_scope_mappings"><div class="titlepage"><div><div><h2 class="title">7.6. Role scope mappings</h2></div></div></div><p class="_abstract _abstract">
				On creation of an OIDC access token or SAML assertion, the user role mappings become claims within the token or assertion. Applications use these claims to make access decisions on the resources controlled by the application. Red Hat Single Sign-On digitally signs access tokens and applications re-use them to invoke remotely secured REST services. However, these tokens have an associated risk. An attacker can obtain these tokens and use their permissions to compromise your networks. To prevent this situation, use <span class="emphasis"><em>Role Scope Mappings</em></span>.
			</p><p>
				<span class="emphasis"><em>Role Scope Mappings</em></span> limit the roles declared inside an access token. When a client requests a user authentication, the access token they receive contains only the role mappings that are explicitly specified for the client’s scope. The result is that you limit the permissions of each individual access token instead of giving the client access to all the users permissions.
			</p><p>
				By default, each client gets all the role mappings of the user. You can view the role mappings in the <span class="strong strong"><strong>Scope</strong></span> tab of each client.
			</p><div class="formalpara"><p class="title"><strong>Full scope</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/full-client-scope.png" alt="Full scope"/></span>
				</p></div><p>
				By default, the effective roles of scopes are every declared role in the realm. To change this default behavior, toggle <span class="strong strong"><strong>Full Scope Allowed</strong></span> to <span class="strong strong"><strong>ON</strong></span> and declare the specific roles you want in each client. You can also use <a class="link" href="#client_scopes" title="12.6. Client scopes">client scopes</a> to define the same role scope mappings for a set of clients.
			</p><div class="formalpara"><p class="title"><strong>Partial scope</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/client-scope.png" alt="Partial scope"/></span>
				</p></div></section><section class="section" id="proc-managing-groups_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">7.7. Groups</h2></div></div></div><p class="_abstract _abstract">
				Groups in Red Hat Single Sign-On manage a common set of attributes and role mappings for each user. Users can be members of any number of groups and inherit the attributes and role mappings assigned to each group.
			</p><p>
				To manage groups, click <span class="strong strong"><strong>Groups</strong></span> in the menu.
			</p><div class="formalpara"><p class="title"><strong>Groups</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/groups.png" alt="groups"/></span>
				</p></div><p>
				Groups are hierarchical. A group can have multiple subgroups but a group can have only one parent. Subgroups inherit the attributes and role mappings from their parent. Users inherit the attributes and role mappings from their parent as well.
			</p><p>
				If you have a parent group and a child group, and a user that belongs only to the child group, the user in the child group inherits the attributes and role mappings of both the parent group and the child group.
			</p><p>
				The following example includes a top-level <span class="strong strong"><strong>Sales</strong></span> group and a child <span class="strong strong"><strong>North America</strong></span> subgroup.
			</p><p>
				To add a group:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Click the group.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>New</strong></span>.
					</li><li class="listitem">
						Select the <span class="strong strong"><strong>Groups</strong></span> icon in the tree to make a top-level group.
					</li><li class="listitem">
						Enter a group name in the <span class="strong strong"><strong>Create Group</strong></span> screen.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</p><p class="simpara">
						The group management page is displayed.
					</p><div class="formalpara"><p class="title"><strong>Group</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/group.png" alt="group"/></span>
						</p></div></li></ol></div><p>
				Attributes and role mappings you define are inherited by the groups and users that are members of the group.
			</p><p>
				To add a user to a group:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Users</strong></span> in the menu.
					</li><li class="listitem">
						Click the user that you want to perform a role mapping on. If the user is not displayed, click <span class="strong strong"><strong>View all users</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Groups</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>User groups</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/user-groups.png" alt="user groups"/></span>
						</p></div></li><li class="listitem">
						Select a group from the <span class="strong strong"><strong>Available Groups</strong></span> tree.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Join</strong></span>.
					</li></ol></div><p>
				To remove a group from a user:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Select the group from the <span class="strong strong"><strong>Group Membership</strong></span> tree.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Leave</strong></span>.
					</li></ol></div><p>
				In this example, the user <span class="emphasis"><em>jimlincoln</em></span> is in the <span class="emphasis"><em>North America</em></span> group. You can see <span class="emphasis"><em>jimlincoln</em></span> displayed under the <span class="strong strong"><strong>Members</strong></span> tab for the group.
			</p><div class="formalpara"><p class="title"><strong>Group membership</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/group-membership.png" alt="group membership"/></span>
				</p></div><section class="section" id="con-comparing-groups-roles_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">7.7.1. Groups compared to roles</h3></div></div></div><p class="_abstract _abstract">
					Groups and roles have some similarities and differences. In Red Hat Single Sign-On, groups are a collection of users to which you apply roles and attributes. Roles define types of users and applications assign permissions and access control to roles.
				</p><p>
					<a class="link" href="#composite-roles" title="7.3. Converting a role to a composite role">Composite Roles</a> are similar to Groups as they provide the same functionality. The difference between them is conceptual. Composite roles apply the permission model to a set of services and applications. Use composite roles to manage applications and services.
				</p><p>
					Groups focus on collections of users and their roles in an organization. Use groups to manage users.
				</p></section><section class="section" id="proc-specifying-default-groups_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">7.7.2. Using default groups</h3></div></div></div><p class="_abstract _abstract">
					To automatically assign group membership to any users who is created or who is imported through <a class="link" href="#identity_broker" title="Chapter 9. Integrating identity providers">Identity Brokering</a>, you use default groups.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Groups</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Default Groups</strong></span> tab.
						</li></ol></div><div class="formalpara"><p class="title"><strong>Default groups</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/default-groups.png" alt="Default groups"/></span>
					</p></div><p>
					This screenshot shows that some <span class="emphasis"><em>default groups</em></span> already exist.
				</p></section></section></section><section class="chapter" id="configuring_authentication"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Configuring authentication</h1></div></div></div><p>
			This chapter covers several authentication topics. These topics include:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Enforcing strict password and One Time Password (OTP) policies.
				</li><li class="listitem">
					Managing different credential types.
				</li><li class="listitem">
					Logging in with Kerberos.
				</li><li class="listitem">
					Disabling and enabling built-in credential types.
				</li></ul></div><section class="section" id="password-policies"><div class="titlepage"><div><div><h2 class="title">8.1. Password policies</h2></div></div></div><p>
				When Red Hat Single Sign-On creates a realm, it does not associate password policies with the realm. You can set a simple password with no restrictions on its length, security, or complexity. Simple passwords are unacceptable in production environments. Red Hat Single Sign-On has a set of password policies available through the Admin Console.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Password Policy</strong></span> tab.
					</li><li class="listitem">
						Select the policy to add in the <span class="strong strong"><strong>Add policy</strong></span> drop-down box.
					</li><li class="listitem">
						Enter a value for the <span class="strong strong"><strong>Policy Value</strong></span> corresponding with the policy chosen.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</p><p class="simpara">
						Password policy 
						<span class="inlinemediaobject"><img src="images/rhsso-images/password-policy.png" alt="Password Policy"/></span>
					</p></li></ol></div><p>
				After saving the policy, Red Hat Single Sign-On enforces the policy for new users and sets an Update Password action for existing users to ensure they change their password the next time they log in. For example:
			</p><div class="formalpara"><p class="title"><strong>Failed password policy</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/failed-password-policy.png" alt="Failed Password Policy"/></span>
				</p></div><section class="section" id="password_policy_types"><div class="titlepage"><div><div><h3 class="title">8.1.1. Password policy types</h3></div></div></div><section class="section" id="hashing_algorithm"><div class="titlepage"><div><div><h4 class="title">8.1.1.1. Hashing algorithm</h4></div></div></div><p>
						Passwords are not stored in clear text. Before storage or validation, Red Hat Single Sign-On hashes passwords using standard hashing algorithms Red Hat Single Sign-On that support the PBKDF2, PBKDF2-SHA256 and PBKDF-SHA512 hashing algorithms.
					</p></section><section class="section" id="hashing_iterations"><div class="titlepage"><div><div><h4 class="title">8.1.1.2. Hashing iterations</h4></div></div></div><p>
						Specifies the number of times Red Hat Single Sign-On hashes passwords before storage or verification. The default value is 27,500.
					</p><p>
						Red Hat Single Sign-On hashes passwords to ensure that hostile actors with access to the password database cannot read passwords through reverse engineering.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							A high hashing iteration value can impact performance as it requires higher CPU power.
						</p></div></div></section><section class="section" id="digits"><div class="titlepage"><div><div><h4 class="title">8.1.1.3. Digits</h4></div></div></div><p>
						The number of numerical digits required in the password string.
					</p></section><section class="section" id="lowercase_characters"><div class="titlepage"><div><div><h4 class="title">8.1.1.4. Lowercase characters</h4></div></div></div><p>
						The number of lower case letters required in the password string.
					</p></section><section class="section" id="uppercase_characters"><div class="titlepage"><div><div><h4 class="title">8.1.1.5. Uppercase characters</h4></div></div></div><p>
						The number of upper case letters required in the password string.
					</p></section><section class="section" id="special_characters"><div class="titlepage"><div><div><h4 class="title">8.1.1.6. Special characters</h4></div></div></div><p>
						The number of special characters required in the password string.
					</p></section><section class="section" id="not_username"><div class="titlepage"><div><div><h4 class="title">8.1.1.7. Not username</h4></div></div></div><p>
						The password cannot be the same as the username.
					</p></section><section class="section" id="not_email"><div class="titlepage"><div><div><h4 class="title">8.1.1.8. Not email</h4></div></div></div><p>
						The password cannot be the same as the email address of the user.
					</p></section><section class="section" id="regular_expression"><div class="titlepage"><div><div><h4 class="title">8.1.1.9. Regular expression</h4></div></div></div><p>
						Password must match one or more defined regular expression patterns.
					</p></section><section class="section" id="expire_password"><div class="titlepage"><div><div><h4 class="title">8.1.1.10. Expire password</h4></div></div></div><p>
						The number of days the password is valid. When the number of days has expired, the user must change their password.
					</p></section><section class="section" id="not_recently_used"><div class="titlepage"><div><div><h4 class="title">8.1.1.11. Not recently used</h4></div></div></div><p>
						Password cannot be already used by the user. Red Hat Single Sign-On stores a history of used passwords. The number of old passwords stored is configurable in Red Hat Single Sign-On.
					</p></section><section class="section" id="password_blacklist"><div class="titlepage"><div><div><h4 class="title">8.1.1.12. Password blacklist</h4></div></div></div><p>
						Password must not be in a blacklist file.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Blacklist files are UTF-8 plain-text files with Unix line endings. Every line represents a blacklisted password.
							</li><li class="listitem">
								Red Hat Single Sign-On compares passwords in a case-insensitive manner. All passwords in the blacklist must be lowercase.
							</li><li class="listitem">
								The value of the blacklist file must be the name of the blacklist file.
							</li><li class="listitem"><p class="simpara">
								Blacklist files resolve against <code class="literal">${jboss.server.data.dir}/password-blacklists/</code> by default. Customize this path using:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The <code class="literal">keycloak.password.blacklists.path</code> property.
									</li><li class="listitem">
										The <code class="literal">blacklistsPath</code> property of the <code class="literal">passwordBlacklist</code> policy SPI configuration.
									</li></ul></div></li></ul></div></section></section></section><section class="section" id="one_time_password_otp_policies"><div class="titlepage"><div><div><h2 class="title">8.2. One Time Password (OTP) policies</h2></div></div></div><p>
				Red Hat Single Sign-On has several policies for setting up a FreeOTP or Google Authenticator One-Time Password generator. Click the <span class="strong strong"><strong>Authentication</strong></span> menu and click the <span class="strong strong"><strong>OTP Policy</strong></span> tab.
			</p><div class="formalpara"><p class="title"><strong>Otp policy</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/otp-policy.png" alt="OTP Policy"/></span>
				</p></div><p>
				Red Hat Single Sign-On generates a QR code on the OTP set-up page, based on information configured in the <span class="strong strong"><strong>OTP Policy</strong></span> tab. FreeOTP and Google Authenticator scan the QR code when configuring OTP.
			</p><section class="section" id="time_based_or_counter_based_one_time_passwords"><div class="titlepage"><div><div><h3 class="title">8.2.1. Time-based or counter-based one time passwords</h3></div></div></div><p>
					The algorithms available in Red Hat Single Sign-On for your OTP generators are time-based and counter-based.
				</p><p>
					With Time-Based One Time Passwords (TOTP), the token generator will hash the current time and a shared secret. The server validates the OTP by comparing the hashes within a window of time to the submitted value. TOTPs are valid for a short window of time.
				</p><p>
					With Counter-Based One Time Passwords (HOTP), Red Hat Single Sign-On uses a shared counter rather than the current time. The Red Hat Single Sign-On server increments the counter with each successful OTP login. Valid OTPs change after a successful login.
				</p><p>
					TOTP is more secure than HOTP because the matchable OTP is valid for a short window of time, while the OTP for HOTP is valid for an indeterminate amount of time. HOTP is more user-friendly than TOTP because no time limit exists to enter the OTP.
				</p><p>
					HOTP requires a database update every time the server increments the counter. This update is a performance drain on the authentication server during heavy load. To increase efficiency, TOTP does not remember passwords used, so there is no need to perform database updates. The drawback is that it is possible to re-use TOTPs in the valid time interval.
				</p></section><section class="section" id="totp_configuration_options"><div class="titlepage"><div><div><h3 class="title">8.2.2. TOTP configuration options</h3></div></div></div><section class="section" id="otp_hash_algorithm"><div class="titlepage"><div><div><h4 class="title">8.2.2.1. OTP hash algorithm</h4></div></div></div><p>
						The default algorithm is SHA1. The other, more secure options are SHA256 and SHA512.
					</p></section><section class="section" id="number_of_digits"><div class="titlepage"><div><div><h4 class="title">8.2.2.2. Number of digits</h4></div></div></div><p>
						The length of the OTP. Short OTP’s are user-friendly, easier to type, and easier to remember. Longer OTP’s are more secure than shorter OTP’s.
					</p></section><section class="section" id="look_ahead_window"><div class="titlepage"><div><div><h4 class="title">8.2.2.3. Look ahead window</h4></div></div></div><p>
						The number of intervals the server attempts to match the hash. This option is present in Red Hat Single Sign-On if the clock of the TOTP generator or authentication server become out-of-sync. The default value of 1 is adequate. For example, if the time interval for a token is 30 seconds, the default value of 1 means it will accept valid tokens in the 30-second window. Every increment of this value increases the valid window by 30 seconds.
					</p></section><section class="section" id="otp_token_period"><div class="titlepage"><div><div><h4 class="title">8.2.2.4. OTP token period</h4></div></div></div><p>
						The time interval in seconds the server matches a hash. Each time the interval passes, the token generator generates a TOTP.
					</p></section></section><section class="section" id="hotp_configuration_options"><div class="titlepage"><div><div><h3 class="title">8.2.3. HOTP configuration options</h3></div></div></div><section class="section" id="otp_hash_algorithm_2"><div class="titlepage"><div><div><h4 class="title">8.2.3.1. OTP hash algorithm</h4></div></div></div><p>
						The default algorithm is SHA1. The other, more secure options are SHA256 and SHA512.
					</p></section><section class="section" id="number_of_digits_2"><div class="titlepage"><div><div><h4 class="title">8.2.3.2. Number of digits</h4></div></div></div><p>
						The length of the OTP. Short OTPs are user-friendly, easier to type, and easier to remember. Longer OTPs are more secure than shorter OTPs.
					</p></section><section class="section" id="look_ahead_window_2"><div class="titlepage"><div><div><h4 class="title">8.2.3.3. Look ahead window</h4></div></div></div><p>
						The number of intervals the server attempts to match the hash. This option is present in Red Hat Single Sign-On if the clock of the TOTP generator or authentication server become out-of-sync. The default value of 1 is adequate. This option is present in Red Hat Single Sign-On to cover when the user’s counter gets ahead of the server.
					</p></section><section class="section" id="initial_counter"><div class="titlepage"><div><div><h4 class="title">8.2.3.4. Initial counter</h4></div></div></div><p>
						The value of the initial counter.
					</p></section></section></section><section class="section" id="authentication-flows"><div class="titlepage"><div><div><h2 class="title">8.3. Authentication flows</h2></div></div></div><p>
				An <span class="emphasis"><em>authentication flow</em></span> is a container of authentications, screens, and actions, during log in, registration, and other Red Hat Single Sign-On workflows. To view all the flows, actions, and checks, each flow requires:
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Flows</strong></span> tab.
					</li></ol></div><section class="section" id="built_in_flows"><div class="titlepage"><div><div><h3 class="title">8.3.1. Built-in flows</h3></div></div></div><p>
					Red Hat Single Sign-On has several built-in flows. You cannot modify these flows, but you can alter the flow’s requirements to suit your needs.
				</p><p>
					In the drop-down list, select <span class="strong strong"><strong>browser</strong></span> to display the Browser Flow screen.
				</p><div class="formalpara"><p class="title"><strong>Browser flow</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/browser-flow.png" alt="Browser Flow"/></span>
					</p></div><p>
					Hover over the question-mark tooltip of the drop-down list to view a description of the flow. Two sections exist.
				</p><section class="section" id="auth_type"><div class="titlepage"><div><div><h4 class="title">8.3.1.1. Auth type</h4></div></div></div><p>
						The name of the authentication or the action to execute. If an authentication is indented, it is in a sub-flow. It may or may not be executed, depending on the behavior of its parent.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Cookie
							</p><p class="simpara">
								The first time a user logs in successfully, Red Hat Single Sign-On sets a session cookie. If the cookie is already set, this authentication type is successful. Since the cookie provider returned success and each execution at this level of the flow is <span class="emphasis"><em>alternative</em></span>, Red Hat Single Sign-On does not perform any other execution. This results in a successful login.
							</p></li><li class="listitem"><p class="simpara">
								Kerberos
							</p><p class="simpara">
								This authenticator is disabled by default and is skipped during the Browser Flow.
							</p></li><li class="listitem"><p class="simpara">
								Identity Provider Redirector
							</p><p class="simpara">
								This action is configured through the <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Config</strong></span> link. It redirects to another IdP for <a class="link" href="#identity_broker" title="Chapter 9. Integrating identity providers">identity brokering</a>.
							</p></li><li class="listitem"><p class="simpara">
								Forms
							</p><p class="simpara">
								Since this sub-flow is marked as <span class="emphasis"><em>alternative</em></span>, it will not be executed if the <span class="strong strong"><strong>Cookie</strong></span> authentication type passed. This sub-flow contains an additional authentication type that needs to be executed. Red Hat Single Sign-On loads the executions for this sub-flow and processes them.
							</p></li></ol></div><p>
						The first execution is the <span class="strong strong"><strong>Username Password Form</strong></span>, an authentication type that renders the username and password page. It is marked as <span class="emphasis"><em>required</em></span>, so the user must enter a valid username and password.
					</p><p>
						The second execution is the <span class="strong strong"><strong>Browser - Conditional OTP</strong></span> sub-flow. This sub-flow is <span class="emphasis"><em>conditional</em></span> and executes depending on the result of the <span class="strong strong"><strong>Condition - User Configured</strong></span> execution. If the result is true, Red Hat Single Sign-On loads the executions for this sub-flow and processes them.
					</p><p>
						The next execution is the <span class="strong strong"><strong>Condition - User Configured</strong></span> authentication. This authentication checks if Red Hat Single Sign-On has configured other executions in the flow for the user. The <span class="strong strong"><strong>Browser - Conditional OTP</strong></span> sub-flow executes only when the user has a configured OTP credential.
					</p><p>
						The final execution is the <span class="strong strong"><strong>OTP Form</strong></span>. Red Hat Single Sign-On marks this execution as <span class="emphasis"><em>required</em></span> but it runs only when the user has an OTP credential set up because of the setup in the <span class="emphasis"><em>conditional</em></span> sub-flow. If not, the user does not see an OTP form.
					</p></section><section class="section" id="requirement"><div class="titlepage"><div><div><h4 class="title">8.3.1.2. Requirement</h4></div></div></div><p>
						A set of radio buttons that control the execution of an action executes.
					</p><section class="section" id="execution-requirements"><div class="titlepage"><div><div><h5 class="title">8.3.1.2.1. Required</h5></div></div></div><p>
							All <span class="emphasis"><em>Required</em></span> elements in the flow must be successfully sequentially executed. The flow terminates if a required element fails.
						</p></section><section class="section" id="alternative"><div class="titlepage"><div><div><h5 class="title">8.3.1.2.2. Alternative</h5></div></div></div><p>
							Only a single element must successfully execute for the flow to evaluate as successful. Because the <span class="emphasis"><em>Required</em></span> flow elements are sufficient to mark a flow as successful, any <span class="emphasis"><em>Alternative</em></span> flow element within a flow containing <span class="emphasis"><em>Required</em></span> flow elements will not execute.
						</p></section><section class="section" id="disabled"><div class="titlepage"><div><div><h5 class="title">8.3.1.2.3. Disabled</h5></div></div></div><p>
							The element does not count to mark a flow as successful.
						</p></section><section class="section" id="conditional"><div class="titlepage"><div><div><h5 class="title">8.3.1.2.4. Conditional</h5></div></div></div><p>
							This requirement type is only set on sub-flows.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									A <span class="emphasis"><em>Conditional</em></span> sub-flow contains executions. These executions must evaluate to logical statements.
								</li><li class="listitem">
									If all executions evaluate as <span class="emphasis"><em>true</em></span>, the <span class="emphasis"><em>Conditional</em></span> sub-flow acts as <span class="emphasis"><em>Required</em></span>.
								</li><li class="listitem">
									If all executions evaluate as <span class="emphasis"><em>false</em></span>, the <span class="emphasis"><em>Conditional</em></span> sub-flow acts as <span class="emphasis"><em>Disabled</em></span>.
								</li><li class="listitem">
									If you do not set an execution, the <span class="emphasis"><em>Conditional</em></span> sub-flow acts as <span class="emphasis"><em>Disabled</em></span>.
								</li><li class="listitem">
									If a flow contains executions and the flow is not set to <span class="emphasis"><em>Conditional</em></span>, Red Hat Single Sign-On does not evaluate the executions, and the executions are considered functionally <span class="emphasis"><em>Disabled</em></span>.
								</li></ul></div></section></section></section><section class="section" id="creating_flows"><div class="titlepage"><div><div><h3 class="title">8.3.2. Creating flows</h3></div></div></div><p>
					Important functionality and security considerations apply when you design a flow.
				</p><p>
					To create a flow, perform the following:
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>New</strong></span>.
						</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can copy and then modify an existing flow. Select a flow, click <span class="strong strong"><strong>Copy</strong></span>, and enter a name for the new flow.
					</p></div></div><p>
					When creating a new flow, you must create a top-level flow first with the following options:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Alias</span></dt><dd>
								The name of the flow.
							</dd><dt><span class="term">Description</span></dt><dd>
								The description you can set to the flow.
							</dd><dt><span class="term">Top-Level Flow Type</span></dt><dd>
								The type of flow. The type <span class="strong strong"><strong>client</strong></span> is used only for the authentication of clients (applications). For all other cases, choose <span class="strong strong"><strong>generic</strong></span>.
							</dd></dl></div><div class="formalpara"><p class="title"><strong>Create a top-level flow</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/Create-top-level-flow.png" alt="Top Level Flow"/></span>
					</p></div><p>
					When Red Hat Single Sign-On has created the flow, Red Hat Single Sign-On displays the <span class="strong strong"><strong>Delete</strong></span>, <span class="strong strong"><strong>Add execution</strong></span>, and <span class="strong strong"><strong>Add flow</strong></span> buttons.
				</p><div class="formalpara"><p class="title"><strong>An empty new flow</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/New-flow.png" alt="New Flow"/></span>
					</p></div><p>
					Three factors determine the behavior of flows and sub-flows.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The structure of the flow and sub-flows.
						</li><li class="listitem">
							The executions within the flows
						</li><li class="listitem">
							The requirements set within the sub-flows and the executions.
						</li></ul></div><p>
					Executions have a wide variety of actions, from sending a reset email to validating an OTP. Add executions with the <span class="strong strong"><strong>Add execution</strong></span> button. Hover over the question mark next to <span class="strong strong"><strong>Provider</strong></span>, to see a description of the execution.
				</p><div class="formalpara"><p class="title"><strong>Adding an authentication execution</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/Create-authentication-execution.png" alt="Adding an Authentication Execution"/></span>
					</p></div><p>
					Two types of executions exist, <span class="emphasis"><em>automatic executions</em></span> and <span class="emphasis"><em>interactive executions</em></span>. <span class="emphasis"><em>Automatic executions</em></span> are similar to the <span class="strong strong"><strong>Cookie</strong></span> execution and will automatically perform their action in the flow. <span class="emphasis"><em>Interactive executions</em></span> halt the flow to get input. Executions executing successfully set their status to <span class="emphasis"><em>success</em></span>. For a flow to complete, it needs at least one execution with a status of <span class="emphasis"><em>success</em></span>.
				</p><p>
					You can add sub-flows to top-level flows with the <span class="strong strong"><strong>Add flow</strong></span> button. The <span class="strong strong"><strong>Add flow</strong></span> button displays the <span class="strong strong"><strong>Create Execution Flow</strong></span> page. This page is similar to the <span class="strong strong"><strong>Create Top Level Form</strong></span> page. The difference is that the <span class="strong strong"><strong>Flow Type</strong></span> can be <span class="strong strong"><strong>generic</strong></span> (default) or <span class="strong strong"><strong>form</strong></span>. The <span class="strong strong"><strong>form</strong></span> type constructs a sub-flow that generates a form for the user, similar to the built-in <span class="strong strong"><strong>Registration</strong></span> flow. Sub-flows success depends on how their executions evaluate, including their contained sub-flows. See the <a class="link" href="#execution-requirements" title="8.3.1.2.1. Required">execution requirements section</a> for an in-depth explanation of how sub-flows work.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						After adding an execution, check the requirement has the correct value.
					</p></div></div><p>
					All elements in a flow have a <span class="strong strong"><strong>Delete</strong></span> option in the <span class="strong strong"><strong>Actions</strong></span> menu. This action removes the element from the flow. Executions have a <span class="strong strong"><strong>Config</strong></span> menu option to configure the execution. It is also possible to add executions and sub-flows to sub-flows with the <span class="strong strong"><strong>Add execution</strong></span> and <span class="strong strong"><strong>Add flow</strong></span> menu options.
				</p><p>
					Since the order of execution is important, you can move executions and sub-flows up and down within their flows using the up and down buttons beside their names.
				</p></section><section class="section" id="creating_a_password_less_browser_login_flow"><div class="titlepage"><div><div><h3 class="title">8.3.3. Creating a password-less browser login flow</h3></div></div></div><p>
					To illustrate the creation of flows, this section describes creating an advanced browser login flow. The purpose of this flow is to allow a user a choice between logging in using a password-less manner with <a class="link" href="#webauthn" title="8.6. W3C Web Authentication (WebAuthn)">WebAuthn</a>, or two-factor authentication with a password and OTP.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Flows</strong></span> tab.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>New</strong></span>.
						</li><li class="listitem">
							Enter <code class="literal">Browser Password-less</code> as an alias.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Cookie</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Alternative</strong></span> for the <span class="strong strong"><strong>Cookie</strong></span> authentication type to set its requirement to alternative.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Kerberos</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Identity Provider Redirector</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Alternative</strong></span> for the <span class="strong strong"><strong>Identity Provider Redirector</strong></span> authentication type to set its requirement to alternative.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add flow</strong></span>.
						</li><li class="listitem">
							Enter <span class="strong strong"><strong>Forms</strong></span> as an alias.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Alternative</strong></span> for the <span class="strong strong"><strong>Forms</strong></span> authentication type to set its requirement to alternative.
						</p><div class="formalpara"><p class="title"><strong>The common part with the browser flow</strong></p><p>
								<span class="inlinemediaobject"><img src="images/Passwordless-browser-login-common.png" alt="Passwordless browser login common"/></span>
							</p></div></li><li class="listitem">
							Click <span class="strong strong"><strong>Actions for the *Forms</strong></span> execution.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Username Form</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Required</strong></span> for the <span class="strong strong"><strong>Username Form</strong></span> authentication type to set its requirement to required.
						</li></ol></div><p>
					At this stage, the form requires a username but no password. We must enable password authentication to avoid security risks.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Actions</strong></span> for the <span class="strong strong"><strong>Forms</strong></span> sub-flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add flow</strong></span>.
						</li><li class="listitem">
							Enter <code class="literal">Authentication</code> as an alias.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Required</strong></span> for the <span class="strong strong"><strong>Authentication</strong></span> authentication type to set its requirement to required.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Actions</strong></span> for the <span class="strong strong"><strong>Authentication</strong></span> sub-flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Webauthn Passwordless Authenticator</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Alternative</strong></span> for the <span class="strong strong"><strong>Webauthn Passwordless Authenticator</strong></span> authentication type to set its requirement to alternative.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Actions</strong></span> for the <span class="strong strong"><strong>Authentication</strong></span> sub-flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add flow</strong></span>.
						</li><li class="listitem">
							Enter <code class="literal">Password with OTP</code> as an alias.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Alternative</strong></span> for the <span class="strong strong"><strong>Password with OTP</strong></span> authentication type to set its requirement to alternative.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Actions</strong></span> for the <span class="strong strong"><strong>Password with OTP</strong></span> sub-flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Password Form</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Required</strong></span> for the <span class="strong strong"><strong>Password Form</strong></span> authentication type to set its requirement to required.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Actions</strong></span> for the <span class="strong strong"><strong>Password with OTP</strong></span> sub-flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>OTP Form</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Required</strong></span> for the <span class="strong strong"><strong>OTP Form</strong></span> authentication type to set its requirement to required.
						</li></ol></div><p>
					Finally, change the bindings.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click the <span class="strong strong"><strong>Bindings</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Browser Flow</strong></span> drop-down list.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Browser Password-less</strong></span> from the drop-down list.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><div class="formalpara"><p class="title"><strong>A password-less browser login</strong></p><p>
						<span class="inlinemediaobject"><img src="images/Passwordless-browser-login.png" alt="Passwordless browser login"/></span>
					</p></div><p>
					After entering the username, the flow works as follows:
				</p><p>
					If users have WebAuthn passwordless credentials recorded, they can use these credentials to log in directly. This is the password-less login. The user can also select <span class="strong strong"><strong>Password with OTP</strong></span> because the <code class="literal">WebAuthn Passwordless</code> execution and the <code class="literal">Password with OTP</code> flow are set to <span class="strong strong"><strong>Alternative</strong></span>. If they are set to <span class="strong strong"><strong>Required</strong></span>, the user has to enter WebAuthn, password, and OTP.
				</p><p>
					If the user selects the <span class="strong strong"><strong>Try another way</strong></span> link with <code class="literal">WebAuthn passwordless</code> authentication, the user can choose between <code class="literal">Password</code> and <code class="literal">Security Key</code> (WebAuthn passwordless). When selecting the password, the user will need to continue and log in with the assigned OTP. If the user has no WebAuthn credentials, the user must enter the password and then the OTP. If the user has no OTP credential, they will be asked to record one.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Since the WebAuthn Passwordless execution is set to <span class="strong strong"><strong>Alternative</strong></span> rather than <span class="strong strong"><strong>Required</strong></span>, this flow will never ask the user to register a WebAuthn credential. For a user to have a Webauthn credential, an administrator must add a required action to the user. Do this by:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Enabling the <span class="strong strong"><strong>Webauthn Register Passwordless</strong></span> required action in the realm (see the <a class="link" href="#webauthn" title="8.6. W3C Web Authentication (WebAuthn)">WebAuthn</a> documentation).
							</li><li class="listitem">
								Setting the required action using the <span class="strong strong"><strong>Credential Reset</strong></span> part of a user’s <a class="link" href="#ref-user-credentials_server_administration_guide" title="5.6. User credentials">Credentials</a> management menu.
							</li></ol></div><p>
						Creating an advanced flow such as this can have side effects. For example, if you enable the ability to reset the password for users, this would be accessible from the password form. In the default <code class="literal">Reset Credentials</code> flow, users must enter their username. Since the user has already entered a username earlier in the <code class="literal">Browser Password-less</code> flow, this action is unnecessary for Red Hat Single Sign-On and sub-optimal for user experience. To correct this problem, you can:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Copy the <code class="literal">Reset Credentials</code> flow. Set its name to <code class="literal">Reset Credentials for password-less</code>, for example.
							</li><li class="listitem">
								Select <span class="strong strong"><strong>Delete</strong></span> in the <span class="strong strong"><strong>Actions</strong></span> menu of the <span class="strong strong"><strong>Choose user</strong></span> execution.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>Bindings</strong></span> menu, change the reset credential flow from <span class="strong strong"><strong>Reset Credentials</strong></span> to <span class="strong strong"><strong>Reset Credentials for password-less</strong></span>
							</li></ul></div></div></div></section></section><section class="section" id="kerberos"><div class="titlepage"><div><div><h2 class="title">8.4. Kerberos</h2></div></div></div><p>
				Red Hat Single Sign-On supports login with a Kerberos ticket through the Simple and Protected GSSAPI Negotiation Mechanism (SPNEGO) protocol. SPNEGO authenticates transparently through the web browser after the user authenticates the session. For non-web cases, or when a ticket is not available during login, Red Hat Single Sign-On supports login with Kerberos username and password.
			</p><p>
				A typical use case for web authentication is the following:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						The user logs into the desktop.
					</li><li class="listitem">
						The user accesses a web application secured by Red Hat Single Sign-On using a browser.
					</li><li class="listitem">
						The application redirects to Red Hat Single Sign-On login.
					</li><li class="listitem">
						Red Hat Single Sign-On renders the HTML login screen with status 401 and HTTP header <code class="literal">WWW-Authenticate: Negotiate</code>
					</li><li class="listitem">
						If the browser has a Kerberos ticket from desktop login, the browser transfers the desktop sign-on information to Red Hat Single Sign-On in header <code class="literal">Authorization: Negotiate 'spnego-token'</code>. Otherwise, it displays the standard login screen, and the user enters the login credentials.
					</li><li class="listitem">
						Red Hat Single Sign-On validates the token from the browser and authenticates the user.
					</li><li class="listitem">
						If using LDAPFederationProvider with Kerberos authentication support, Red Hat Single Sign-On provisions user data from LDAP. If using KerberosFederationProvider, Red Hat Single Sign-On lets the user update the profile and pre-fill login data.
					</li><li class="listitem">
						Red Hat Single Sign-On returns to the application. Red Hat Single Sign-On and the application communicate through OpenID Connect or SAML messages. Red Hat Single Sign-On acts as a broker to Kerberos/SPNEGO login. Therefore Red Hat Single Sign-On authenticating through Kerberos is hidden from the application.
					</li></ol></div><p>
				Perform the following steps to set up Kerberos authentication:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						The setup and configuration of the Kerberos server (KDC).
					</li><li class="listitem">
						The setup and configuration of the Red Hat Single Sign-On server.
					</li><li class="listitem">
						The setup and configuration of the client machines.
					</li></ol></div><section class="section" id="setup_of_kerberos_server"><div class="titlepage"><div><div><h3 class="title">8.4.1. Setup of Kerberos server</h3></div></div></div><p>
					The steps to set up a Kerberos server depends on the operating system (OS) and the Kerberos vendor. Consult Windows Active Directory, MIT Kerberos, and your OS documentation for instructions on setting up and configuring a Kerberos server.
				</p><p>
					During setup, perform these steps:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Add some user principals to your Kerberos database. You can also integrate your Kerberos with LDAP, so user accounts provision from the LDAP server.
						</li><li class="listitem"><p class="simpara">
							Add service principal for "HTTP" service. For example, if the Red Hat Single Sign-On server runs on <code class="literal">www.mydomain.org</code>, add the service principal <code class="literal">HTTP/www.mydomain.org@&lt;kerberos realm&gt;</code>.
						</p><p class="simpara">
							On MIT Kerberos, you run a "kadmin" session. On a machine with MIT Kerberos, you can use the command:
						</p></li></ol></div><pre class="screen">sudo kadmin.local</pre><p>
					Then, add HTTP principal and export its key to a keytab file with commands such as:
				</p><pre class="screen">addprinc -randkey HTTP/www.mydomain.org@MYDOMAIN.ORG
ktadd -k /tmp/http.keytab HTTP/www.mydomain.org@MYDOMAIN.ORG</pre><p>
					Ensure the keytab file <code class="literal">/tmp/http.keytab</code> is accessible on the host where Red Hat Single Sign-On is running.
				</p></section><section class="section" id="setup_and_configuration_of_red_hat_single_sign_on_server"><div class="titlepage"><div><div><h3 class="title">8.4.2. Setup and configuration of Red Hat Single Sign-On server</h3></div></div></div><p id="server_setup">
					Install a Kerberos client on your machine.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Install a Kerberos client. If your machine runs Fedora, Ubuntu, or RHEL, install the <a class="link" href="https://www.freeipa.org/page/Downloads">freeipa-client</a> package, containing a Kerberos client and other utilities.
						</li><li class="listitem"><p class="simpara">
							Configure the Kerberos client (on Linux, the configuration settings are in the <a class="link" href="https://web.mit.edu/kerberos/krb5-1.12/doc/admin/conf_files/krb5_conf.html">/etc/krb5.conf</a> file ).
						</p><p class="simpara">
							Add your Kerberos realm to the configuration and configure the HTTP domains your server runs on.
						</p><p class="simpara">
							For example, for the MYDOMAIN.ORG realm, you can configure the <code class="literal">domain_realm</code> section like this:
						</p><pre class="screen">[domain_realm]
  .mydomain.org = MYDOMAIN.ORG
  mydomain.org = MYDOMAIN.ORG</pre></li><li class="listitem"><p class="simpara">
							Export the keytab file with the HTTP principal and ensure the file is accessible to the process running the Red Hat Single Sign-On server. For production, ensure that the file is readable by this process only.
						</p><p class="simpara">
							For the MIT Kerberos example above, we exported keytab to the <code class="literal">/tmp/http.keytab</code> file. If your <span class="emphasis"><em>Key Distribution Centre (KDC)</em></span> and Red Hat Single Sign-On run on the same host, the file is already available.
						</p></li></ol></div><section class="section" id="enabling_spnego_processing"><div class="titlepage"><div><div><h4 class="title">8.4.2.1. Enabling SPNEGO processing</h4></div></div></div><p>
						By default, Red Hat Single Sign-On disables SPNEGO protocol support. To enable it, go to the <a class="link" href="#authentication-flows" title="8.3. Authentication flows">browser flow</a> and enable <span class="strong strong"><strong>Kerberos</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Browser flow</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/browser-flow.png" alt="Browser Flow"/></span>
						</p></div><p>
						Set the <span class="strong strong"><strong>Kerberos</strong></span> requirement from <span class="emphasis"><em>disabled</em></span> to <span class="emphasis"><em>alternative</em></span> (Kerberos is optional) or <span class="emphasis"><em>required</em></span> (browser must have Kerberos enabled). If you have not configured the browser to work with SPNEGO or Kerberos, Red Hat Single Sign-On falls back to the regular login screen.
					</p></section><section class="section" id="configure_kerberos_user_storage_federation_providerxs"><div class="titlepage"><div><div><h4 class="title">8.4.2.2. Configure Kerberos user storage federation providerxs</h4></div></div></div><p>
						You must now use <a class="link" href="#user-storage-federation" title="Chapter 4. Using external storage">User Storage Federation</a> to configure how Red Hat Single Sign-On interprets Kerberos tickets. Two different federation providers exist with Kerberos authentication support.
					</p><p>
						To authenticate with Kerberos backed by an LDAP server, configure the <a class="link" href="#ldap" title="4.3. Lightweight Directory Access Protocol (LDAP) and Active Directory">LDAP Federation Provider</a>.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Go to the configuration page for your LDAP provider.
							</p><div class="formalpara"><p class="title"><strong>Ldap kerberos integration</strong></p><p>
									<span class="inlinemediaobject"><img src="images/rhsso-images/ldap-kerberos.png" alt="LDAP Kerberos Integration"/></span>
								</p></div></li><li class="listitem">
								Toggle <span class="strong strong"><strong>Allow Kerberos authentication</strong></span> to <span class="strong strong"><strong>ON</strong></span>
							</li></ol></div><p>
						<span class="strong strong"><strong>Allow Kerberos authentication</strong></span> makes Red Hat Single Sign-On use the Kerberos principal access user information so information can import into the Red Hat Single Sign-On environment.
					</p><p>
						If an LDAP server is not backing up your Kerberos solution, use the <span class="strong strong"><strong>Kerberos</strong></span> User Storage Federation Provider.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>User Federation</strong></span> in the menu.
							</li><li class="listitem"><p class="simpara">
								Select <span class="strong strong"><strong>Kerberos</strong></span> from the <span class="strong strong"><strong>Add provider</strong></span> select box.
							</p><div class="formalpara"><p class="title"><strong>Kerberos user storage provider</strong></p><p>
									<span class="inlinemediaobject"><img src="images/rhsso-images/kerberos-provider.png" alt="Kerberos User Storage Provider"/></span>
								</p></div></li></ol></div><p>
						The <span class="strong strong"><strong>Kerberos</strong></span> provider parses the Kerberos ticket for simple principal information and imports the information into the local Red Hat Single Sign-On database. User profile information, such as first name, last name, and email, are not provisioned.
					</p></section></section><section class="section" id="setup_and_configuration_of_client_machines"><div class="titlepage"><div><div><h3 class="title">8.4.3. Setup and configuration of client machines</h3></div></div></div><p>
					Client machines must have a Kerberos client and set up the <code class="literal">krb5.conf</code> as described <a class="link" href="#server_setup">above</a>. The client machines must also enable SPNEGO login support in their browser. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/configuring_applications_for_sso">configuring Firefox for Kerberos</a> if you are using the Firefox browser.
				</p><p>
					The <code class="literal">.mydomain.org</code> URI must be in the <code class="literal">network.negotiate-auth.trusted-uris</code> configuration option.
				</p><p>
					In Windows domains, clients do not need to adjust their configuration. Internet Explorer and Edge can already participate in SPNEGO authentication.
				</p></section><section class="section" id="credential_delegation"><div class="titlepage"><div><div><h3 class="title">8.4.4. Credential delegation</h3></div></div></div><p>
					Kerberos supports the credential delegation. Applications may need access to the Kerberos ticket so they can re-use it to interact with other services secured by Kerberos. Because the Red Hat Single Sign-On server processed the SPNEGO protocol, you must propagate the GSS credential to your application within the OpenID Connect token claim or a SAML assertion attribute. Red Hat Single Sign-On transmits this to your application from the Red Hat Single Sign-On server. To insert this claim into the token or assertion, each application must enable the built-in protocol mapper <code class="literal">gss delegation credential</code>. This mapper is available in the <span class="strong strong"><strong>Mappers</strong></span> tab of the application’s client page. See <a class="link" href="#protocol-mappers" title="12.4. OIDC token and SAML assertion mappings">Protocol Mappers</a> chapter for more details.
				</p><p>
					Applications must deserialize the claim it receives from Red Hat Single Sign-On before using it to make GSS calls against other services. When you deserialize the credential from the access token to the GSSCredential object, create the GSSContext with this credential passed to the <code class="literal">GSSManager.createContext</code> method. For example:
				</p><pre class="programlisting language-java">// Obtain accessToken in your application.
KeycloakPrincipal keycloakPrincipal = (KeycloakPrincipal) servletReq.getUserPrincipal();
AccessToken accessToken = keycloakPrincipal.getKeycloakSecurityContext().getToken();

// Retrieve Kerberos credential from accessToken and deserialize it
String serializedGssCredential = (String) accessToken.getOtherClaims().
    get(org.keycloak.common.constants.KerberosConstants.GSS_DELEGATION_CREDENTIAL);

GSSCredential deserializedGssCredential = org.keycloak.common.util.KerberosSerializationUtils.
    deserializeCredential(serializedGssCredential);

// Create GSSContext to call other Kerberos-secured services
GSSContext context = gssManager.createContext(serviceName, krb5Oid,
    deserializedGssCredential, GSSContext.DEFAULT_LIFETIME);</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Configure <code class="literal">forwardable</code> Kerberos tickets in <code class="literal">krb5.conf</code> file and add support for delegated credentials to your browser.
					</p></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Credential delegation has security implications, so use it only if necessary and only with HTTPS. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/configuring_applications_for_sso">this article</a> for more details and an example.
					</p></div></div></section><section class="section" id="cross_realm_trust"><div class="titlepage"><div><div><h3 class="title">8.4.5. Cross-realm trust</h3></div></div></div><p>
					In the Kerberos protocol, the <code class="literal">realm</code> is a set of Kerberos principals. The definition of these principals exists in the Kerberos database, which is typically an LDAP server.
				</p><p>
					The Kerberos protocol allows cross-realm trust. For example, if 2 Kerberos realms, A and B, exist, then cross-realm trust will allow the users from realm A to access realm B’s resources. Realm B trusts realm A.
				</p><div class="formalpara"><p class="title"><strong>Kerberos cross-realm trust</strong></p><p>
						<span class="inlinemediaobject"><img src="images/kerberos-trust-basic.png" alt="kerberos trust basic"/></span>
					</p></div><p>
					The Red Hat Single Sign-On server supports cross-realm trust. To implement this, perform the following:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Configure the Kerberos servers for the cross-realm trust. Implementing this step depends on the Kerberos server implementations. This step is necessary to add the Kerberos principal <code class="literal">krbtgt/B@A</code> to the Kerberos databases of realm A and B. This principal must have the same keys on both Kerberos realms. The principals must have the same password, key version numbers, and ciphers in both realms. Consult the Kerberos server documentation for more details.
						</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The cross-realm trust is unidirectional by default. You must add the principal <code class="literal">krbtgt/A@B</code> to both Kerberos databases for bidirectional trust between realm A and realm B. However, trust is transitive by default. If realm B trusts realm A and realm C trusts realm B, then realm C trusts realm A without the principal, <code class="literal">krbtgt/C@A</code>, available. Additional configuration (for example, <code class="literal">capaths</code>) may be necessary on the Kerberos client-side so clients can find the trust path. Consult the Kerberos documentation for more details.
					</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Configure Red Hat Single Sign-On server
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									When using an LDAP storage provider with Kerberos support, configure the server principal for realm B, as in this example: <code class="literal">HTTP/mydomain.com@B</code>. The LDAP server must find the users from realm A if users from realm A are to successfully authenticate to Red Hat Single Sign-On, because Red Hat Single Sign-On must perform the SPNEGO flow and then find the users.
								</li></ul></div></li></ul></div><p>
					For example, Kerberos principal user <code class="literal">john@A</code> must be available in the LDAP under an LDAP DN such as <code class="literal">uid=john,ou=People,dc=example,dc=com</code>. If you want users from realm A and B to authenticate, ensure that LDAP can find users from both realms A and B.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							When using a Kerberos user storage provider (typically, Kerberos without LDAP integration), configure the server principal as <code class="literal">HTTP/mydomain.com@B</code>, and users from Kerberos realms A and B must be able to authenticate.
						</li></ul></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						When using the Kerberos user storage provider, there cannot be conflicting users among Kerberos realms. If conflicting users exist, Red Hat Single Sign-On maps them to the same user.
					</p></div></div></section><section class="section" id="troubleshooting"><div class="titlepage"><div><div><h3 class="title">8.4.6. Troubleshooting</h3></div></div></div><p>
					If you have issues, enable additional logging to debug the problem:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Enable <code class="literal">Debug</code> flag in the Admin Console for Kerberos or LDAP federation providers
						</li><li class="listitem">
							Enable TRACE logging for category <code class="literal">org.keycloak</code> in the logging section of <code class="literal">standalone/configuration/standalone.xml</code> to receive more information in <code class="literal">standalone/log/server.log</code>
						</li><li class="listitem">
							Add system properties <code class="literal">-Dsun.security.krb5.debug=true</code> and <code class="literal">-Dsun.security.spnego.debug=true</code>
						</li></ul></div></section></section><section class="section" id="x509"><div class="titlepage"><div><div><h2 class="title">8.5. X.509 client certificate user authentication</h2></div></div></div><p>
				Red Hat Single Sign-On supports logging in with an X.509 client certificate if you have configured the server to use mutual SSL authentication.
			</p><p>
				A typical workflow:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A client sends an authentication request over SSL/TLS channel.
					</li><li class="listitem">
						During the SSL/TLS handshake, the server and the client exchange their x.509/v3 certificates.
					</li><li class="listitem">
						The container (JBoss EAP) validates the certificate PKIX path and the certificate expiration date.
					</li><li class="listitem"><p class="simpara">
						The x.509 client certificate authenticator validates the client certificate by using the following methods:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Checks the certificate revocation status by using CRL or CRL Distribution Points.
							</li><li class="listitem">
								Checks the Certificate revocation status by using OCSP (Online Certificate Status Protocol).
							</li><li class="listitem">
								Validates whether the key in the certificate matches the expected key.
							</li><li class="listitem">
								Validates whether the extended key in the certificate matches the expected extended key.
							</li></ul></div></li><li class="listitem">
						If any of the these checks fail, the x.509 authentication fails. Otherwise, the authenticator extracts the certificate identity and maps it to an existing user.
					</li></ul></div><p>
				When the certificate maps to an existing user, the behavior diverges depending on the authentication flow:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						In the Browser Flow, the server prompts users to confirm their identity or sign in with a username and password.
					</li><li class="listitem">
						In the Direct Grant Flow, the server signs in the user.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Note that it is the responsibility of the web container to validate certificate PKIX path. X.509 authenticator on the Red Hat Single Sign-On side provides just the additional support for check the certificate expiration, certificate revocation status and key usage. If you are using Red Hat Single Sign-On deployed behind reverse proxy, make sure that your reverse proxy is configured to validate PKIX path. If you do not use reverse proxy and users directly access the JBoss EAP, you should be fine as JBoss EAP makes sure that PKIX path is validated as long as it is configured as described below.
				</p></div></div><section class="section" id="features_2"><div class="titlepage"><div><div><h3 class="title">8.5.1. Features</h3></div></div></div><p>
					Supported Certificate Identity Sources:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Match SubjectDN by using regular expressions
						</li><li class="listitem">
							X500 Subject’s email attribute
						</li><li class="listitem">
							X500 Subject’s email from Subject Alternative Name Extension (RFC822Name General Name)
						</li><li class="listitem">
							X500 Subject’s other name from Subject Alternative Name Extension. This other name is the User Principal Name (UPN), typically.
						</li><li class="listitem">
							X500 Subject’s Common Name attribute
						</li><li class="listitem">
							Match IssuerDN by using regular expressions
						</li><li class="listitem">
							Certificate Serial Number
						</li><li class="listitem">
							Certificate Serial Number and IssuerDN
						</li><li class="listitem">
							SHA-256 Certificate thumbprint
						</li><li class="listitem">
							Full certificate in PEM format
						</li></ul></div><section class="section" id="regular_expressions"><div class="titlepage"><div><div><h4 class="title">8.5.1.1. Regular expressions</h4></div></div></div><p>
						Red Hat Single Sign-On extracts the certificate identity from Subject DN or Issuer DN by using a regular expression as a filter. For example, this regular expression matches the email attribute:
					</p><pre class="screen">emailAddress=(.*?)(?:,|$)</pre><p>
						The regular expression filtering applies if the <code class="literal">Identity Source</code> is set to either <code class="literal">Match SubjectDN using regular expression</code> or <code class="literal">Match IssuerDN using regular expression</code>.
					</p><section class="section" id="mapping_certificate_identity_to_an_existing_user"><div class="titlepage"><div><div><h5 class="title">8.5.1.1.1. Mapping certificate identity to an existing user</h5></div></div></div><p>
							The certificate identity mapping can map the extracted user identity to an existing user’s username, email, or a custom attribute whose value matches the certificate identity. For example, setting <code class="literal">Identity source</code> to <span class="emphasis"><em>Subject’s email</em></span> or <code class="literal">User mapping method</code> to <span class="emphasis"><em>Username or email</em></span> makes the X.509 client certificate authenticator use the email attribute in the certificate’s Subject DN as the search criteria when searching for an existing user by username or by email.
						</p><div class="admonition important"><div class="admonition_header">Important</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										If you disable <span class="strong strong"><strong>Login with email</strong></span> at realm settings, the same rules apply to certificate authentication. Users are unable to log in by using the email attribute.
									</li><li class="listitem">
										Using <code class="literal">Certificate Serial Number and IssuerDN</code> as an identity source requires two custom attributes for the serial number and the IssuerDN.
									</li><li class="listitem">
										<code class="literal">SHA-256 Certificate thumbprint</code> is the lowercase hexadecimal representation of SHA-256 certificate thumbprint.
									</li><li class="listitem">
										Using <code class="literal">Full certificate in PEM format</code> as an identity source is limited to the custom attributes mapped to external federation sources, such as LDAP. Red Hat Single Sign-On cannot store certificates in its database due to length limitations, so in the case of LDAP, you must enable <code class="literal">Always Read Value From LDAP</code>.
									</li></ul></div></div></div></section><section class="section" id="extended_certificate_validation"><div class="titlepage"><div><div><h5 class="title">8.5.1.1.2. Extended certificate validation</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Revocation status checking using CRL.
								</li><li class="listitem">
									Revocation status checking using CRL/Distribution Point.
								</li><li class="listitem">
									Revocation status checking using OCSP/Responder URI.
								</li><li class="listitem">
									Certificate KeyUsage validation.
								</li><li class="listitem">
									Certificate ExtendedKeyUsage validation.
								</li></ul></div></section></section></section><section class="section" id="enable_x_509_client_certificate_user_authentication"><div class="titlepage"><div><div><h3 class="title">8.5.2. Enable X.509 client certificate user authentication</h3></div></div></div><p>
					The following sections describe how to configure JBoss EAP/Undertow and the Red Hat Single Sign-On Server to enable X.509 client certificate authentication.
				</p><section class="section" id="enable-mtls-wildfly"><div class="titlepage"><div><div><h4 class="title">8.5.2.1. Enable mutual SSL in JBoss EAP</h4></div></div></div><p>
						See <a class="link" href="https://docs.wildfly.org/24/Admin_Guide.html#enable-ssl">Enable SSL</a> for the instructions to enable SSL in JBoss EAP.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Open RHSSO_HOME/standalone/configuration/standalone.xml and add a new realm:
							</li></ul></div><pre class="programlisting language-xml">&lt;security-realms&gt;
    &lt;security-realm name="ssl-realm"&gt;
        &lt;server-identities&gt;
            &lt;ssl&gt;
                &lt;keystore path="servercert.jks"
                          relative-to="jboss.server.config.dir"
                          keystore-password="servercert password"/&gt;
            &lt;/ssl&gt;
        &lt;/server-identities&gt;
        &lt;authentication&gt;
            &lt;truststore path="truststore.jks"
                        relative-to="jboss.server.config.dir"
                        keystore-password="truststore password"/&gt;
        &lt;/authentication&gt;
    &lt;/security-realm&gt;
&lt;/security-realms&gt;</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ssl/keystore</code></span></dt><dd>
									The <code class="literal">ssl</code> element contains the <code class="literal">keystore</code> element that contains the details to load the server public key pair from a JKS keystore.
								</dd><dt><span class="term"><code class="literal">ssl/keystore/path</code></span></dt><dd>
									The path to the JKS keystore.
								</dd><dt><span class="term"><code class="literal">ssl/keystore/relative-to</code></span></dt><dd>
									The path that the keystore path is relative to.
								</dd><dt><span class="term"><code class="literal">ssl/keystore/keystore-password</code></span></dt><dd>
									The password to open the keystore.
								</dd><dt><span class="term"><code class="literal">ssl/keystore/alias</code> (optional)</span></dt><dd>
									The alias of the entry in the keystore. Set if the keystore contains multiple entries.
								</dd><dt><span class="term"><code class="literal">ssl/keystore/key-password</code> (optional)</span></dt><dd>
									The private key password, if different from the keystore password.
								</dd><dt><span class="term"><code class="literal">authentication/truststore</code></span></dt><dd>
									Defines how to load a trust store to verify the certificate presented by the remote side of the inbound/outgoing connection. Typically, the truststore contains a collection of trusted CA certificates.
								</dd><dt><span class="term"><code class="literal">authentication/truststore/path</code></span></dt><dd>
									The path to the JKS keystore containing the certificates of the trusted certificate authorities.
								</dd><dt><span class="term"><code class="literal">authentication/truststore/relative-to</code></span></dt><dd>
									The path that the truststore path is relative to.
								</dd><dt><span class="term"><code class="literal">authentication/truststore/keystore-password</code></span></dt><dd>
									The password to open the truststore.
								</dd></dl></div></section><section class="section" id="enable_https_listener"><div class="titlepage"><div><div><h4 class="title">8.5.2.2. Enable HTTPS listener</h4></div></div></div><p>
						See <a class="link" href="https://docs.wildfly.org/24/Admin_Guide.html#https-listener">HTTPS Listener</a> for the instructions to enable HTTPS in WildFly.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Add the &lt;https-listener&gt; element.
							</li></ul></div><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:undertow:12.0"&gt;
	....
    &lt;server name="default-server"&gt;
	    &lt;https-listener name="default"
                        socket-binding="https"
                        security-realm="ssl-realm"
                        verify-client="REQUESTED"/&gt;
    &lt;/server&gt;
&lt;/subsystem&gt;</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">https-listener/security-realm</code></span></dt><dd>
									This value must match the name of the realm from the previous section.
								</dd><dt><span class="term"><code class="literal">https-listener/verify-client</code></span></dt><dd>
									If set to <span class="strong strong"><strong>REQUESTED</strong></span>, the server optionally asks for a client certificate. If set to <span class="strong strong"><strong>REQUIRED</strong></span>, the server refuses inbound connections if no client certificate has been provided.
								</dd></dl></div></section></section><section class="section" id="browser_flow"><div class="titlepage"><div><div><h3 class="title">8.5.3. Adding X.509 client certificate authentication to browser flows</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the "Browser" flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Copy</strong></span> to make a copy of the built-in "Browser" flow.
						</li><li class="listitem">
							Enter a name for the copy.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Ok</strong></span>.
						</li><li class="listitem">
							Click the copy in the <span class="strong strong"><strong>Add policy</strong></span> drop-down box.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Click "X509/Validate Username Form".
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>X509 execution</strong></p><p>
								<span class="inlinemediaobject"><img src="images/x509-execution.png" alt="X509 Execution"/></span>
							</p></div></li><li class="listitem">
							Click the up/down arrow buttons to move the "X509/Validate Username Form" over the "Browser Forms" execution.
						</li><li class="listitem"><p class="simpara">
							Set the requirement to "ALTERNATIVE".
						</p><div class="formalpara"><p class="title"><strong>X509 browser flow</strong></p><p>
								<span class="inlinemediaobject"><img src="images/x509-browser-flow.png" alt="X509 Browser Flow"/></span>
							</p></div></li><li class="listitem">
							Click the <span class="strong strong"><strong>Bindings</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Browser Flow</strong></span> drop-down list.
						</li><li class="listitem">
							Click the copy of the browser flow from the drop-down list.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>X509 browser flow bindings</strong></p><p>
								<span class="inlinemediaobject"><img src="images/x509-browser-flow-bindings.png" alt="X509 Browser Flow Bindings"/></span>
							</p></div></li></ol></div></section><section class="section" id="configuring_x_509_client_certificate_authentication"><div class="titlepage"><div><div><h3 class="title">8.5.4. Configuring X.509 client certificate authentication</h3></div></div></div><div class="formalpara"><p class="title"><strong>X509 configuration</strong></p><p>
						<span class="inlinemediaobject"><img src="images/x509-configuration.png" alt="X509 Configuration"/></span>
					</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>User Identity Source</strong></span></span></dt><dd>
								Defines the method for extracting the user identity from a client certificate.
							</dd><dt><span class="term"><span class="strong strong"><strong>Canonical DN representation enabled</strong></span></span></dt><dd>
								Defines whether to use canonical format to determine a distinguished name. The official <a class="link" href="https://docs.oracle.com/javase/8/docs/api/javax/security/auth/x500/X500Principal.html#getName-java.lang.String-">Java API documentation</a> describes the format. This option affects the two User Identity Sources <span class="emphasis"><em>Match SubjectDN using regular expression</em></span> and <span class="emphasis"><em>Match IssuerDN using regular expression</em></span> only. Enable this option when you set up a new Red Hat Single Sign-On instance. Disable this option to retain backward compatibility with existing Red Hat Single Sign-On instances.
							</dd><dt><span class="term"><span class="strong strong"><strong>Enable Serial Number hexadecimal representation</strong></span></span></dt><dd>
								Represent the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.2">serial number</a> as hexadecimal. The serial number with the sign bit set to 1 must be left padded with 00 octet. For example, a serial number with decimal value <span class="emphasis"><em>161</em></span>, or <span class="emphasis"><em>a1</em></span> in hexadecimal representation is encoded as <span class="emphasis"><em>00a1</em></span>, according to RFC5280. See <a class="link" href="https://datatracker.ietf.org/doc/html/rfc5280#appendix-B">RFC5280, appendix-B</a> for more details.
							</dd><dt><span class="term"><span class="strong strong"><strong>A regular expression</strong></span></span></dt><dd>
								A regular expression to use as a filter for extracting the certificate identity. The expression must contain a single group.
							</dd><dt><span class="term"><span class="strong strong"><strong>User Mapping Method</strong></span></span></dt><dd>
								Defines the method to match the certificate identity with an existing user. <span class="emphasis"><em>Username or email</em></span> searches for existing users by username or email. <span class="emphasis"><em>Custom Attribute Mapper</em></span> searches for existing users with a custom attribute that matches the certificate identity. The name of the custom attribute is configurable.
							</dd><dt><span class="term"><span class="strong strong"><strong>A name of user attribute</strong></span></span></dt><dd>
								A custom attribute whose value matches against the certificate identity. Use multiple custom attributes when attribute mapping is related to multiple values, For example, 'Certificate Serial Number and IssuerDN'.
							</dd><dt><span class="term"><span class="strong strong"><strong>CRL Checking Enabled</strong></span></span></dt><dd>
								Check the revocation status of the certificate by using the Certificate Revocation List. The location of the list is defined in the <span class="strong strong"><strong>CRL file path</strong></span> attribute.
							</dd><dt><span class="term"><span class="strong strong"><strong>Enable CRL Distribution Point to check certificate revocation status</strong></span></span></dt><dd>
								Use CDP to check the certificate revocation status. Most PKI authorities include CDP in their certificates.
							</dd><dt><span class="term"><span class="strong strong"><strong>CRL file path</strong></span></span></dt><dd>
								The path to a file containing a CRL list. The value must be a path to a valid file if the <span class="strong strong"><strong>CRL Checking Enabled</strong></span> option is enabled.
							</dd><dt><span class="term"><span class="strong strong"><strong>OCSP Checking Enabled</strong></span></span></dt><dd>
								Checks the certificate revocation status by using Online Certificate Status Protocol.
							</dd><dt><span class="term"><span class="strong strong"><strong>OCSP Fail-Open Behavior</strong></span></span></dt><dd>
								By default the OCSP check must return a positive response in order to continue with a successful authentication. Sometimes however this check can be inconclusive: for example, the OCSP server could be unreachable, overloaded, or the client certificate may not contain an OCSP responder URI. When this setting is turned ON, authentication will be denied only if an explicit negative response is received by the OCSP responder and the certificate is definitely revoked. If a valid OCSP response is not avalaible the authentication attempt will be accepted.
							</dd><dt><span class="term"><span class="strong strong"><strong>OCSP Responder URI</strong></span></span></dt><dd>
								Override the value of the OCSP responder URI in the certificate.
							</dd><dt><span class="term"><span class="strong strong"><strong>Validate Key Usage</strong></span></span></dt><dd>
								Verifies the certificate’s KeyUsage extension bits are set. For example, "digitalSignature,KeyEncipherment" verifies if bits 0 and 2 in the KeyUsage extension are set. Leave this parameter empty to disable the Key Usage validation. See <a class="link" href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.3">RFC5280, Section-4.2.1.3</a> for more information. Red Hat Single Sign-On raises an error when a key usage mismatch occurs.
							</dd><dt><span class="term"><span class="strong strong"><strong>Validate Extended Key Usage</strong></span></span></dt><dd>
								Verifies one or more purposes defined in the Extended Key Usage extension. See <a class="link" href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.12">RFC5280, Section-4.2.1.12</a> for more information. Leave this parameter empty to disable the Extended Key Usage validation. Red Hat Single Sign-On raises an error when flagged as critical by the issuing CA and a key usage extension mismatch occurs.
							</dd><dt><span class="term"><span class="strong strong"><strong>Validate Certificate Policy</strong></span></span></dt><dd>
								Verifies one or more policy OIDs as defined in the Certificate Policy extension. See <a class="link" href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.4">RFC5280, Section-4.2.1.4</a>. Leave the parameter empty to disable the Certificate Policy validation. Multiple policies should be separated using a comma.
							</dd><dt><span class="term"><span class="strong strong"><strong>Certificate Policy Validation Mode</strong></span></span></dt><dd>
								When more than one policy is specified in the <code class="literal">Validate Certificate Policy</code> setting, it decides whether the matching should check for all requested policies to be present, or one match is enough for a successful authentication. Default value is <code class="literal">All</code>, meaning that all requested policies should be present in the client certificate.
							</dd><dt><span class="term"><span class="strong strong"><strong>Bypass identity confirmation</strong></span></span></dt><dd>
								If enabled, X.509 client certificate authentication does not prompt the user to confirm the certificate identity. Red Hat Single Sign-On signs in the user upon successful authentication.
							</dd><dt><span class="term"><span class="strong strong"><strong>Revalidate client certificate</strong></span></span></dt><dd>
								If set, the client certificate trust chain will be always verified at the application level using the certificates present in the configured trust store. This can be useful if the underlying web server does not enforce client certificate chain validation, for example because it is behind a non-validating load balancer or reverse proxy, or when the number of allowed CAs is too large for the mutual SSL negotiation (most browsers cap the maximum SSL negotiation packet size at 32767 bytes, which corresponds to about 200 advertised CAs). By default this option is off.
							</dd></dl></div></section><section class="section" id="adding_x_509_client_certificate_authentication_to_a_direct_grant_flow"><div class="titlepage"><div><div><h3 class="title">8.5.5. Adding X.509 Client Certificate Authentication to a Direct Grant Flow</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Click the "Direct Grant" flow.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Copy</strong></span> to make a copy of the "Direct Grant" flow.
						</li><li class="listitem">
							Enter a name for the copy.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Ok</strong></span>.
						</li><li class="listitem">
							Click on the <span class="strong strong"><strong>Actions</strong></span> link for "Username Validation" and click <span class="strong strong"><strong>Delete</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Delete</strong></span>.
						</li><li class="listitem">
							Click on the <span class="strong strong"><strong>Actions</strong></span> link for "Password" and click <span class="strong strong"><strong>Delete</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Delete</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add execution</strong></span>.
						</li><li class="listitem">
							Click "X509/Validate Username".
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>X509 direct grant execution</strong></p><p>
								<span class="inlinemediaobject"><img src="images/x509-directgrant-execution.png" alt="X509 Direct Grant Execution"/></span>
							</p></div></li><li class="listitem">
							Set up the x509 authentication configuration by following the steps described in the <a class="link" href="#browser_flow" title="8.5.3. Adding X.509 client certificate authentication to browser flows">x509 Browser Flow</a> section.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Bindings</strong></span> tab.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Direct Grant Flow</strong></span> drop-down list.
						</li><li class="listitem">
							Click the newly created "x509 Direct Grant" flow.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>X509 direct grant flow bindings</strong></p><p>
								<span class="inlinemediaobject"><img src="images/x509-directgrant-flow-bindings.png" alt="X509 Direct Grant Flow Bindings"/></span>
							</p></div></li></ol></div></section><section class="section" id="client_certificate_lookup"><div class="titlepage"><div><div><h3 class="title">8.5.6. Client certificate lookup</h3></div></div></div><p>
					When the Red Hat Single Sign-On server receives a direct HTTP request, the JBoss EAP undertow subsystem establishes an SSL handshake and extracts the client certificate. The JBoss EAP saves the client certificate to the <code class="literal">javax.servlet.request.X509Certificate</code> attribute of the HTTP request, as specified in the servlet specification. The Red Hat Single Sign-On X509 authenticator can look up the certificate from this attribute.
				</p><p>
					However, when the Red Hat Single Sign-On server listens to HTTP requests behind a load balancer or reverse proxy, the proxy server may extract the client certificate and establish a mutual SSL connection. A reverse proxy generally puts the authenticated client certificate in the HTTP header of the underlying request. The proxy forwards the request to the back end Red Hat Single Sign-On server. In this case, Red Hat Single Sign-On must look up the X.509 certificate chain from the HTTP headers rather than the attribute of the HTTP request.
				</p><p>
					If Red Hat Single Sign-On is behind a reverse proxy, you generally need to configure the alternative provider of the <code class="literal">x509cert-lookup</code> SPI in RHSSO_HOME/standalone/configuration/standalone.xml. With the <code class="literal">default</code> provider looking up the HTTP header certificate, two additional built-in providers exist: <code class="literal">haproxy</code> and <code class="literal">apache</code>.
				</p><section class="section" id="haproxy_certificate_lookup_provider"><div class="titlepage"><div><div><h4 class="title">8.5.6.1. HAProxy certificate lookup provider</h4></div></div></div><p>
						You use this provider when your Red Hat Single Sign-On server is behind an HAProxy reverse proxy. Use the following configuration for your server:
					</p><pre class="programlisting language-xml">&lt;spi name="x509cert-lookup"&gt;
    &lt;default-provider&gt;haproxy&lt;/default-provider&gt;
    &lt;provider name="haproxy" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="sslClientCert" value="SSL_CLIENT_CERT"/&gt;
            &lt;property name="sslCertChainPrefix" value="CERT_CHAIN"/&gt;
            &lt;property name="certificateChainLength" value="10"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
						In this example configuration, the client certificate is looked up from the HTTP header, <code class="literal">SSL_CLIENT_CERT</code>, and the other certificates from its chain are looked up from HTTP headers such as <code class="literal">CERT_CHAIN_0</code> through <code class="literal">CERT_CHAIN_9</code>. The attribute <code class="literal">certificateChainLength</code> is the maximum length of the chain so the last attribute is <code class="literal">CERT_CHAIN_9</code>.
					</p><p>
						Consult the HAProxy documentation for the details of configuring the HTTP Headers for the client certificate and client certificate chain.
					</p></section><section class="section" id="apache_certificate_lookup_provider"><div class="titlepage"><div><div><h4 class="title">8.5.6.2. Apache certificate lookup provider</h4></div></div></div><p>
						You can use this provider when your Red Hat Single Sign-On server is behind an Apache reverse proxy. Use the following configuration for your server:
					</p><pre class="programlisting language-xml">&lt;spi name="x509cert-lookup"&gt;
    &lt;default-provider&gt;apache&lt;/default-provider&gt;
    &lt;provider name="apache" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="sslClientCert" value="SSL_CLIENT_CERT"/&gt;
            &lt;property name="sslCertChainPrefix" value="CERT_CHAIN"/&gt;
            &lt;property name="certificateChainLength" value="10"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
						This configuration is the same as the <code class="literal">haproxy</code> provider. Consult the Apache documentation on <a class="link" href="https://httpd.apache.org/docs/current/mod/mod_ssl.html">mod_ssl</a> and <a class="link" href="https://httpd.apache.org/docs/current/mod/mod_headers.html">mod_headers</a> for details on how the HTTP Headers for the client certificate and client certificate chain are configured.
					</p></section><section class="section" id="nginx_certificate_lookup_provider"><div class="titlepage"><div><div><h4 class="title">8.5.6.3. NGINX certificate lookup provider</h4></div></div></div><p>
						You can use this provider when your Red Hat Single Sign-On server is behind an NGINX reverse proxy. Use the following configuration for your server:
					</p><pre class="programlisting language-xml">&lt;spi name="x509cert-lookup"&gt;
    &lt;default-provider&gt;nginx&lt;/default-provider&gt;
    &lt;provider name="nginx" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="sslClientCert" value="ssl-client-cert"/&gt;
            &lt;property name="sslCertChainPrefix" value="USELESS"/&gt;
            &lt;property name="certificateChainLength" value="2"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The NGINX <a class="link" href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#variables">SSL/TLS module</a> does not expose the client certificate chain. Red Hat Single Sign-On’s NGINX certificate lookup provider rebuilds it by using the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#_truststore">Keycloak truststore</a>. Populate the Red Hat Single Sign-On truststore by using the keytool CLI with all root and intermediate CA’s for rebuilding client certificate chain.
						</p></div></div><p>
						Consult the NGINX documentation for the details of configuring the HTTP Headers for the client certificate.
					</p><p>
						Example of NGINX configuration file :
					</p><pre class="programlisting language-txt"> ...
 server {
    ...
    ssl_client_certificate                  trusted-ca-list-for-client-auth.pem;
    ssl_verify_client                       optional_no_ca;
    ssl_verify_depth                        2;
    ...
    location / {
      ...
      proxy_set_header ssl-client-cert        $ssl_client_escaped_cert;
      ...
    }
    ...
}</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							All certificates in trusted-ca-list-for-client-auth.pem must be added to <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#_truststore">Keycloak truststore</a>.
						</p></div></div></section><section class="section" id="other_reverse_proxy_implementations"><div class="titlepage"><div><div><h4 class="title">8.5.6.4. Other reverse proxy implementations</h4></div></div></div><p>
						Red Hat Single Sign-On does not have built-in support for other reverse proxy implementations. However, you can make other reverse proxies behave in a similar way to <code class="literal">apache</code> or <code class="literal">haproxy</code>. If none of these work, create your implementation of the <code class="literal">org.keycloak.services.x509.X509ClientCertificateLookupFactory</code> and <code class="literal">org.keycloak.services.x509.X509ClientCertificateLookup</code> providers. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for details on how to add your provider.
					</p></section></section><section class="section" id="troubleshooting_2"><div class="titlepage"><div><div><h3 class="title">8.5.7. Troubleshooting</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Dumping HTTP headers</span></dt><dd>
								To view what the reverse proxy sends to Keycloak, enable the <code class="literal">RequestDumpingHandler</code> Undertow filter and consult the <code class="literal">server.log</code> file.
							</dd><dt><span class="term">Enable TRACE logging under the logging subsystem</span></dt><dd/></dl></div><pre class="programlisting language-xml">...
    &lt;profile&gt;
        &lt;subsystem xmlns="urn:jboss:domain:logging:8.0"&gt;
...
            &lt;logger category="org.keycloak.authentication.authenticators.x509"&gt;
                &lt;level name="TRACE"/&gt;
            &lt;/logger&gt;
            &lt;logger category="org.keycloak.services.x509"&gt;
                &lt;level name="TRACE"/&gt;
            &lt;/logger&gt;</pre><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Do not use RequestDumpingHandler or TRACE logging in production.
					</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Direct Grant authentication with X.509</span></dt><dd>
								You can use the following template to request a token by using the Resource Owner Password Credentials Grant:
							</dd></dl></div><pre class="screen">$ curl https://[host][:port]/auth/realms/master/protocol/openid-connect/token \
       --insecure \
       --data "grant_type=password&amp;scope=openid profile&amp;username=&amp;password=&amp;client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET" \
       -E /path/to/client_cert.crt \
       --key /path/to/client_cert.key</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">[host][:port]</code></span></dt><dd>
								The host and the port number of the remote Red Hat Single Sign-On server.
							</dd><dt><span class="term"><code class="literal">CLIENT_ID</code></span></dt><dd>
								The client id.
							</dd><dt><span class="term"><code class="literal">CLIENT_SECRET</code></span></dt><dd>
								For confidential clients, a client secret.
							</dd><dt><span class="term"><code class="literal">client_cert.crt</code></span></dt><dd>
								A public key certificate to verify the identity of the client in mutual SSL authentication. The certificate must be in PEM format.
							</dd><dt><span class="term"><code class="literal">client_cert.key</code></span></dt><dd>
								A private key in the public key pair. This key must be in PEM format.
							</dd></dl></div></section></section><section class="section" id="webauthn"><div class="titlepage"><div><div><h2 class="title">8.6. W3C Web Authentication (WebAuthn)</h2></div></div></div><p>
				Red Hat Single Sign-On provides limited support for <a class="link" href="https://www.w3.org/TR/webauthn/">W3C Web Authentication (WebAuthn)</a>. Red Hat Single Sign-On works as a WebAuthn’s <a class="link" href="https://www.w3.org/TR/webauthn/#webauthn-relying-party">Relying Party (RP)</a>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					WebAuthn is <span class="strong strong"><strong>Technology Preview</strong></span> and is not fully supported. This feature is disabled by default.
				</p><p>
					To enable start the server with <code class="literal">-Dkeycloak.profile=preview</code> or <code class="literal">-Dkeycloak.profile.feature.web_authn=enabled</code> . For more details see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#profiles">Profiles</a>.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					WebAuthn’s operations success depends on the user’s WebAuthn supporting authenticator, browser, and platform. Make sure your authenticator, browser, and platform support the WebAuthn specification.
				</p></div></div><section class="section" id="setup"><div class="titlepage"><div><div><h3 class="title">8.6.1. Setup</h3></div></div></div><p>
					The setup procedure of WebAuthn support for 2FA is the following :
				</p><section class="section" id="webauthn-register"><div class="titlepage"><div><div><h4 class="title">8.6.1.1. Enable WebAuthn authenticator registration</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Required Actions</strong></span> tab.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Register</strong></span>.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Required Action</strong></span> drop-down list.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Webauthn Register</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Ok</strong></span>.
							</li></ol></div><p>
						Mark the <span class="strong strong"><strong>Default Action</strong></span> checkbox if you want all new users to be required to register their WebAuthn credentials.
					</p></section><section class="section" id="webauthn-authenticator-setup"><div class="titlepage"><div><div><h4 class="title">8.6.1.2. Adding WebAuthn authentication to a browser flow</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Browser</strong></span> flow.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Copy</strong></span> to make a copy of the built-in <span class="strong strong"><strong>Browser</strong></span> flow.
							</li><li class="listitem">
								Enter a name for the copy.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Ok</strong></span>.
							</li><li class="listitem">
								Click the <span class="emphasis"><em>Actions</em></span> link for <span class="strong strong"><strong>WebAuthn Browser Browser - Conditional OTP</strong></span> and click <span class="emphasis"><em>Delete</em></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Delete</strong></span>.
							</li></ol></div><p>
						If you require WebAuthn for all users:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click on the <span class="emphasis"><em>Actions</em></span> link for <span class="strong strong"><strong>WebAuthn Browser Forms</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add execution</strong></span>.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Provider</strong></span> drop-down list.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>WebAuthn Authenticator</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="emphasis"><em>REQUIRED</em></span> for <span class="strong strong"><strong>WebAuthn Authenticator</strong></span>
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/webauthn-browser-flow-required.png" alt="webauthn browser flow required"/></span>
							</p></li><li class="listitem">
								Click the <span class="strong strong"><strong>Bindings</strong></span> tab.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Browser Flow</strong></span> drop-down list.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>WebAuthn Browser</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If a user does not have WebAuthn credentials, the user must register WebAuthn credentials.
						</p></div></div><p>
						Users can log in with WebAuthn if they have a WebAuthn credential registered only. So instead of adding the <span class="strong strong"><strong>WebAuthn Authenticator</strong></span> execution, you can:
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Click on the <span class="emphasis"><em>Actions</em></span> link for <span class="strong strong"><strong>WebAuthn Browser Forms</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add flow</strong></span>.
							</li><li class="listitem">
								Enter "Conditional 2FA" for the <span class="emphasis"><em>Alias</em></span> field.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem">
								Click <span class="emphasis"><em>CONDITIONAL</em></span> for <span class="strong strong"><strong>Conditional 2FA</strong></span>
							</li><li class="listitem">
								Click on the <span class="emphasis"><em>Actions</em></span> link for <span class="strong strong"><strong>Conditional 2FA</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add execution</strong></span>.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Provider</strong></span> drop-down list.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Condition - User Configured</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem">
								Click <span class="emphasis"><em>REQUIRED</em></span> for <span class="strong strong"><strong>Conditional 2FA</strong></span>
							</li><li class="listitem">
								Click on the <span class="emphasis"><em>Actions</em></span> link for <span class="strong strong"><strong>Conditional 2FA</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add execution</strong></span>.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Provider</strong></span> drop-down list.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>WebAuthn Authenticator</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="emphasis"><em>ALTERNATIVE</em></span> for <span class="strong strong"><strong>Conditional 2FA</strong></span>
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/webauthn-browser-flow-conditional.png" alt="webauthn browser flow conditional"/></span>
							</p></li></ol></div><p>
						The user can choose between using WebAuthn and OTP for the second factor:
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Click the <span class="emphasis"><em>Actions</em></span> link for <span class="strong strong"><strong>Conditional 2FA</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Add execution</strong></span>.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Provider</strong></span> drop-down list.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>ITP Form</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="emphasis"><em>ALTERNATIVE</em></span> for <span class="strong strong"><strong>Conditional 2FA</strong></span>
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/webauthn-browser-flow-conditional-with-OTP.png" alt="webauthn browser flow conditional with OTP"/></span>
							</p></li></ol></div></section></section><section class="section" id="authenticate_with_webauthn_authenticator"><div class="titlepage"><div><div><h3 class="title">8.6.2. Authenticate with WebAuthn authenticator</h3></div></div></div><p>
					After registering a WebAuthn authenticator, the user carries out the following operations:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Open the login form. The user must authenticate with a username and password.
						</li><li class="listitem">
							The user’s browser asks the user to authenticate by using their WebAuthn authenticator.
						</li></ul></div></section><section class="section" id="managing_webauthn_as_an_administrator"><div class="titlepage"><div><div><h3 class="title">8.6.3. Managing WebAuthn as an administrator</h3></div></div></div><section class="section" id="managing_credentials"><div class="titlepage"><div><div><h4 class="title">8.6.3.1. Managing credentials</h4></div></div></div><p>
						Red Hat Single Sign-On manages WebAuthn credentials similarly to other credentials from <a class="link" href="#ref-user-credentials_server_administration_guide" title="5.6. User credentials">User credential management</a>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Red Hat Single Sign-On assigns users a required action to create a WebAuthn credential from the <span class="strong strong"><strong>Reset Actions</strong></span> list and select <span class="strong strong"><strong>Webauthn Register</strong></span>.
							</li><li class="listitem">
								Administrators can delete a WebAuthn credential by clicking <span class="strong strong"><strong>Delete</strong></span>.
							</li><li class="listitem">
								Administrators can view the credential’s data, such as the AAGUID, by selecting <span class="strong strong"><strong>Show data…​</strong></span>.
							</li><li class="listitem">
								Administrators can set a label for the credential by setting a value in the <span class="strong strong"><strong>User Label</strong></span> field and saving the data.
							</li></ul></div></section><section class="section" id="webauthn-policy"><div class="titlepage"><div><div><h4 class="title">8.6.3.2. Managing policy</h4></div></div></div><p>
						Administrators can configure WebAuthn related operations as <span class="strong strong"><strong>WebAuthn Policy</strong></span> per realm.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>WebAuthn Policy</strong></span> tab.
							</li><li class="listitem">
								Configure the items within the policy (see description below).
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li></ol></div><p>
						The configurable items and their description are as follows:
					</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182741504" scope="col">Configuration</th><th align="left" valign="top" id="idm140556182740416" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Relying Party Entity Name
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The readable server name as a WebAuthn Relying Party. This item is mandatory and applies to the registration of the WebAuthn authenticator. The default setting is "keycloak". For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/#dictionary-pkcredentialentity">WebAuthn Specification</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Signature Algorithms
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The algorithms telling the WebAuthn authenticator which signature algorithms to use for the <a class="link" href="https://www.w3.org/TR/webauthn/#iface-pkcredential">Public Key Credential</a>. Red Hat Single Sign-On uses the Public Key Credential to sign and verify <a class="link" href="https://www.w3.org/TR/webauthn/#authentication-assertion">Authentication Assertions</a>. If no algorithms exist, the default <a class="link" href="https://datatracker.ietf.org/doc/html/rfc8152#section-8.1">ES256</a> is adapted. ES256 is an optional configuration item applying to the registration of WebAuthn authenticators. For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/#dictdef-publickeycredentialparameters">WebAuthn Specification</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Relying Party ID
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The ID of a WebAuthn Relying Party that determines the scope of <a class="link" href="https://www.w3.org/TR/webauthn/#public-key-credential">Public Key Credentials</a>. The ID must be the origin’s effective domain. This ID is an optional configuration item applied to the registration of WebAuthn authenticators. If this entry is blank, Red Hat Single Sign-On adapts the host part of Red Hat Single Sign-On’s base URL. For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/">WebAuthn Specification</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Attestation Conveyance Preference
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The WebAuthn API implementation on the browser (<a class="link" href="https://www.w3.org/TR/webauthn/#webauthn-client">WebAuthn Client</a>) is the preferential method to generate Attestation statements. This preference is an optional configuration item applying to the registration of the WebAuthn authenticator. If no option exists, its behavior is the same as selecting "none". For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/">WebAuthn Specification</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Authenticator Attachment
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The acceptable attachment pattern of a WebAuthn authenticator for the WebAuthn Client. This pattern is an optional configuration item applying to the registration of the WebAuthn authenticator. For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/#enumdef-authenticatorattachment">WebAuthn Specification</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Require Resident Key
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The option requiring that the WebAuthn authenticator generates the Public Key Credential as <a class="link" href="https://www.w3.org/TR/webauthn/">Client-side-resident Public Key Credential Source</a>. This option applies to the registration of the WebAuthn authenticator. If left blank, its behavior is the same as selecting "No". For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/#dom-authenticatorselectioncriteria-requireresidentkey">WebAuthn Specification</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										User Verification Requirement
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The option requiring that the WebAuthn authenticator confirms the verification of a user. This is an optional configuration item applying to the registration of a WebAuthn authenticator and the authentication of a user by a WebAuthn authenticator. If no option exists, its behavior is the same as selecting "preferred". For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/#dom-authenticatorselectioncriteria-userverification">WebAuthn Specification for registering a WebAuthn authenticator</a> and <a class="link" href="https://www.w3.org/TR/webauthn/#dom-publickeycredentialrequestoptions-userverification">WebAuthn Specification for authenticating the user by a WebAuthn authenticator</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Timeout
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The timeout value, in seconds, for registering a WebAuthn authenticator and authenticating the user by using a WebAuthn authenticator. If set to zero, its behavior depends on the WebAuthn authenticator’s implementation. The default value is 0. For more details, see <a class="link" href="https://www.w3.org/TR/webauthn/#dom-publickeycredentialcreationoptions-timeout">WebAuthn Specification for registering a WebAuthn authenticator</a> and <a class="link" href="https://www.w3.org/TR/webauthn/#dom-publickeycredentialrequestoptions-timeout">WebAuthn Specification for authenticating the user by a WebAuthn authenticator</a>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Avoid Same Authenticator Registration
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										If enabled, Red Hat Single Sign-On cannot re-register an already registered WebAuthn authenticator.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182741504">
									<p>
										Acceptable AAGUIDs
									</p>
									</td><td align="left" valign="top" headers="idm140556182740416">
									<p>
										The white list of AAGUIDs which a WebAuthn authenticator must register against.
									</p>
									</td></tr></tbody></table></div></section></section><section class="section" id="attestation_statement_verification"><div class="titlepage"><div><div><h3 class="title">8.6.4. Attestation statement verification</h3></div></div></div><p>
					When registering a WebAuthn authenticator, Red Hat Single Sign-On verifies the trustworthiness of the attestation statement generated by the WebAuthn authenticator. Red Hat Single Sign-On requires the trust anchor’s certificates for this. Red Hat Single Sign-On uses the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#_truststore">Keycloak truststore</a>, so you must import these certificates into it in advance.
				</p><p>
					To omit this validation, disable this truststore or set the WebAuthn policy’s configuration item "Attestation Conveyance Preference" to "none".
				</p></section><section class="section" id="managing_webauthn_credentials_as_a_user"><div class="titlepage"><div><div><h3 class="title">8.6.5. Managing WebAuthn credentials as a user</h3></div></div></div><section class="section" id="register_webauthn_authenticator"><div class="titlepage"><div><div><h4 class="title">8.6.5.1. Register WebAuthn authenticator</h4></div></div></div><p>
						The appropriate method to register a WebAuthn authenticator depends on whether the user has already registered an account on Red Hat Single Sign-On.
					</p></section><section class="section" id="new_user"><div class="titlepage"><div><div><h4 class="title">8.6.5.2. New user</h4></div></div></div><p>
						If the <span class="strong strong"><strong>WebAuthn Register</strong></span> required action is <span class="strong strong"><strong>Default Action</strong></span> in a realm, new users must set up the WebAuthn security key after their first login.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Open the login form.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Register</strong></span>.
							</li><li class="listitem">
								Fill in the items on the form.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Register</strong></span>.
							</li></ol></div><p>
						After successfully registering, the browser asks the user to enter the text of their WebAuthn authenticator’s label.
					</p></section><section class="section" id="existing_user"><div class="titlepage"><div><div><h4 class="title">8.6.5.3. Existing user</h4></div></div></div><p>
						If <code class="literal">WebAuthn Authenticator</code> is set up as required as shown in the first example, then when existing users try to log in, they are required to register their WebAuthn authenticator automatically:
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Open the login form.
							</li><li class="listitem">
								Enter the items on the form.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Login</strong></span>.
							</li></ol></div><p>
						After successful registration, the user’s browser asks the user to enter the text of their WebAuthn authenticator’s label.
					</p></section></section><section class="section" id="webauthn_passwordless"><div class="titlepage"><div><div><h3 class="title">8.6.6. Passwordless WebAuthn together with Two-Factor</h3></div></div></div><p>
					Red Hat Single Sign-On uses WebAuthn for two-factor authentication, but you can use WebAuthn as the first-factor authentication. In this case, users with <code class="literal">passwordless</code> WebAuthn credentials can authenticate to Red Hat Single Sign-On without a password. Red Hat Single Sign-On can use WebAuthn as both the passwordless and two-factor authentication mechanism in the context of a realm and a single authentication flow.
				</p><p>
					An administrator typically requires that Security Keys registered by users for the WebAuthn passwordless authentication meet different requirements. For example, the security keys may require users to authenticate to the security key using a PIN, or the security key attests with a stronger certificate authority.
				</p><p>
					Because of this, Red Hat Single Sign-On permits administrators to configure a separate <code class="literal">WebAuthn Passwordless Policy</code>. There is a required <code class="literal">Webauthn Register Passwordless</code> action of type and separate authenticator of type <code class="literal">WebAuthn Passwordless Authenticator</code>.
				</p><section class="section" id="setup_2"><div class="titlepage"><div><div><h4 class="title">8.6.6.1. Setup</h4></div></div></div><p>
						Set up WebAuthn passwordless support as follows:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Register a new required action for WebAuthn passwordless support. Use the steps described in <a class="link" href="#webauthn-register" title="8.6.1.1. Enable WebAuthn authenticator registration">Enable WebAuthn Authenticator Registration</a>. Register the <code class="literal">Webauthn Register Passwordless</code> action.
							</li><li class="listitem">
								Configure the policy. You can use the steps and configuration options described in <a class="link" href="#webauthn-policy" title="8.6.3.2. Managing policy">Managing Policy</a>. Perform the configuration in the Admin Console in the tab <span class="strong strong"><strong>WebAuthn Passwordless Policy</strong></span>. Typically the requirements for the security key will be stronger than for the two-factor policy. For example, you can set the <span class="strong strong"><strong>User Verification Requirement</strong></span> to <span class="strong strong"><strong>Required</strong></span> when you configure the passwordless policy.
							</li><li class="listitem"><p class="simpara">
								Configure the authentication flow. Use the <span class="strong strong"><strong>WebAuthn Browser</strong></span> flow described in <a class="link" href="#webauthn-authenticator-setup" title="8.6.1.2. Adding WebAuthn authentication to a browser flow">Adding WebAuthn Authentication to a Browser Flow</a>. Configure the flow as follows:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										The <span class="strong strong"><strong>WebAuthn Browser Forms</strong></span> subflow contains <span class="strong strong"><strong>Username Form</strong></span> as the first authenticator. Delete the default <span class="strong strong"><strong>Username Password Form</strong></span> authenticator and add the <span class="strong strong"><strong>Username Form</strong></span> authenticator. This action requires the user to provide a username as the first step.
									</li><li class="listitem">
										There will be a required subflow, which can be named <span class="strong strong"><strong>Passwordless Or Two-factor</strong></span>, for example. This subflow indicates the user can authenticate with Passwordless WebAuthn credential or with Two-factor authentication.
									</li><li class="listitem">
										The flow contains <span class="strong strong"><strong>WebAuthn Passwordless Authenticator</strong></span> as the first alternative.
									</li><li class="listitem">
										The second alternative will be a subflow named <span class="strong strong"><strong>Password And Two-factor Webauthn</strong></span>, for example. This subflow contains a <span class="strong strong"><strong>Password Form</strong></span> and a <span class="strong strong"><strong>WebAuthn Authenticator</strong></span>.
									</li></ul></div></li></ol></div><p>
						The final configuration of the flow looks similar to this:
					</p><p>
						<span class="inlinemediaobject"><img src="images/webauthn-passwordless-flow.png" alt="webauthn passwordless flow"/></span>
					</p><p>
						You can now add <span class="strong strong"><strong>WebAuthn Register Passwordless</strong></span> as the required action to a user, already known to Red Hat Single Sign-On, to test this. During the first authentication, the user must use the password and second-factor WebAuthn credential. The user does not need to provide the password and second-factor WebAuthn credential if they use the WebAuthn Passwordless credential. === Conditions in conditional flows
					</p><p>
						As was mentioned in <a class="link" href="#execution-requirements" title="8.3.1.2.1. Required">Execution requirements</a>, <span class="emphasis"><em>Condition</em></span> executions can be only contained in <span class="emphasis"><em>Conditional</em></span> subflow. If all <span class="emphasis"><em>Condition</em></span> executions evaluate as true, then the <span class="emphasis"><em>Conditional</em></span> sub-flow acts as <span class="emphasis"><em>Required</em></span>. You can process the next execution in the <span class="emphasis"><em>Conditional</em></span> sub-flow. If some executions included in the <span class="emphasis"><em>Conditional</em></span> sub-flow evaluate as false, then the whole sub-flow is considered as <span class="emphasis"><em>Disabled</em></span>.
					</p></section></section><section class="section" id="available_conditions"><div class="titlepage"><div><div><h3 class="title">8.6.7. Available conditions</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Condition - User Role</code></span></dt><dd><p class="simpara">
								This execution has the ability to determine if the user has a role defined by <span class="emphasis"><em>User role</em></span> field. If the user has the required role, the execution is considered as true and other executions are evaluated. The administrator has to define the following fields:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Alias</span></dt><dd>
											Describes a name of the execution, which will be shown in the authentication flow.
										</dd><dt><span class="term">User role</span></dt><dd>
											Role the user should have to execute this flow. To specify an application role the syntax is <code class="literal">appname.approle</code> (for example <code class="literal">myapp.myrole</code>).
										</dd></dl></div></dd><dt><span class="term"><code class="literal">Condition - User Configured</code></span></dt><dd>
								This checks if the other executions in the flow are configured for the user. The Execution requirements section includes an example of the OTP form.
							</dd><dt><span class="term"><code class="literal">Condition - User Attribute</code></span></dt><dd><p class="simpara">
								This checks if the user has set up the required attribute. There is a possibility to negate output, which means the user should not have the attribute. The <a class="link" href="#proc-configuring-user-attributes_server_administration_guide" title="5.5. Configuring user attributes">User Attributes</a> section shows how to add a custom attribute. You can provide these fields:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Alias</span></dt><dd>
											Describes a name of the execution, which will be shown in the authentication flow.
										</dd><dt><span class="term">Attribute name</span></dt><dd>
											Name of the attribute to check.
										</dd><dt><span class="term">Expected attribute value</span></dt><dd>
											Expected value in the attribute.
										</dd><dt><span class="term">Negate output</span></dt><dd>
											You can negate the output. In other words, the attribute should not be present.
										</dd></dl></div></dd></dl></div></section><section class="section" id="explicitly_deny_allow_access_in_conditional_flows"><div class="titlepage"><div><div><h3 class="title">8.6.8. Explicitly deny/allow access in conditional flows</h3></div></div></div><p>
					You can allow or deny access to resources in a conditional flow. The two authenticators <code class="literal">Deny Access</code> and <code class="literal">Allow Access</code> control access to the resources by conditions.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Allow Access</code></span></dt><dd>
								Authenticator will always successfully authenticate. This authenticator is not configurable.
							</dd><dt><span class="term"><code class="literal">Deny Access</code></span></dt><dd><p class="simpara">
								Access will always be denied. You can define an error message, which will be shown to the user. You can provide these fields:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Alias</span></dt><dd>
											Describes a name of the execution, which will be shown in the authentication flow.
										</dd><dt><span class="term">Error message</span></dt><dd>
											Error message which will be shown to the user. The error message could be provided as a particular message or as a property in order to use it with localization. (i.e "<span class="emphasis"><em>You do not have the role 'admin'.</em></span>", <span class="emphasis"><em>my-property-deny</em></span> in messages properties) Leave blank for the default message defined as property <code class="literal">access-denied</code>.
										</dd></dl></div></dd></dl></div><p>
					Here is an example how to deny access to all users who do not have the role <code class="literal">role1</code> and show an error message defined by a property <code class="literal">deny-role1</code>. This example includes <code class="literal">Condition - User Role</code> and <code class="literal">Deny Access</code> executions.
				</p><div class="formalpara"><p class="title"><strong>Browser flow</strong></p><p>
						<span class="inlinemediaobject"><img src="images/deny-access-flow.png" alt="deny access flow"/></span>
					</p></div><div class="formalpara"><p class="title"><strong>Condition - user role configuration</strong></p><p>
						<span class="inlinemediaobject"><img src="images/deny-access-role-condition.png" alt="deny access role condition"/></span>
					</p></div><div class="formalpara"><p class="title"><strong>Configuration of the <code class="literal">Deny Access</code> is really easy. You can specify an arbitrary Alias and required message like this:</strong></p><p>
						<span class="inlinemediaobject"><img src="images/deny-access-execution-cond.png" alt="deny access execution cond"/></span>
					</p></div><p>
					The last thing is defining the property with an error message in the login theme <code class="literal">messages_en.properties</code> (for English):
				</p><pre class="screen">deny-role1 = You do not have required role!</pre></section></section></section><section class="chapter" id="identity_broker"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Integrating identity providers</h1></div></div></div><p>
			An Identity Broker is an intermediary service connecting service providers with identity providers. The identity broker creates a relationship with an external identity provider to use the provider’s identities to access the internal services the service provider exposes.
		</p><p>
			From a user perspective, identity brokers provide a user-centric, centralized way to manage identities for security domains and realms. You can link an account with one or more identities from identity providers or create an account based on the identity information from them.
		</p><p>
			An identity provider derives from a specific protocol used to authenticate and send authentication and authorization information to users. It can be:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					A social provider such as Facebook, Google, or Twitter.
				</li><li class="listitem">
					A business partner whose users need to access your services.
				</li><li class="listitem">
					A cloud-based identity service you want to integrate.
				</li></ul></div><p>
			Typically, Red Hat Single Sign-On bases identity providers on the following protocols:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<code class="literal">SAML v2.0</code>
				</li><li class="listitem">
					<code class="literal">OpenID Connect v1.0</code>
				</li><li class="listitem">
					<code class="literal">OAuth v2.0</code>
				</li></ul></div><section class="section" id="identity_broker_overview"><div class="titlepage"><div><div><h2 class="title">9.1. Brokering overview</h2></div></div></div><p>
				When using Red Hat Single Sign-On as an identity broker, Red Hat Single Sign-On does not force users to provide their credentials to authenticate in a specific realm. Red Hat Single Sign-On displays a list of identity providers from which they can authenticate.
			</p><p>
				If you configure a default identity provider, Red Hat Single Sign-On redirects users to the default provider.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Different protocols may require different authentication flows. All the identity providers supported by Red Hat Single Sign-On use the following flow.
				</p></div></div><div class="formalpara"><p class="title"><strong>Identity broker flow</strong></p><p>
					<span class="inlinemediaobject"><img src="images/identity_broker_flow.png" alt="Identity broker flow"/></span>
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						The unauthenticated user requests a protected resource in a client application.
					</li><li class="listitem">
						The client application redirects the user to Red Hat Single Sign-On to authenticate.
					</li><li class="listitem">
						Red Hat Single Sign-On displays the login page with a list of identity providers configured in a realm.
					</li><li class="listitem">
						The user selects one of the identity providers by clicking its button or link.
					</li><li class="listitem">
						Red Hat Single Sign-On issues an authentication request to the target identity provider requesting authentication and redirects the user to the identity provider’s login page. The administrator has already set the connection properties and other configuration options for the Admin Console’s identity provider.
					</li><li class="listitem">
						The user provides credentials or consents to authenticate with the identity provider.
					</li><li class="listitem">
						Upon successful authentication by the identity provider, the user redirects back to Red Hat Single Sign-On with an authentication response. Usually, the response contains a security token used by Red Hat Single Sign-On to trust the identity provider’s authentication and retrieve user information.
					</li><li class="listitem">
						Red Hat Single Sign-On checks if the response from the identity provider is valid. If valid, Red Hat Single Sign-On imports and creates a user if the user does not already exist. Red Hat Single Sign-On may ask the identity provider for further user information if the token does not contain that information. This behavior is <span class="emphasis"><em>identity federation</em></span>. If the user already exists, Red Hat Single Sign-On may ask the user to link the identity returned from the identity provider with the existing account. This behavior is <span class="emphasis"><em>account linking</em></span>. With Red Hat Single Sign-On, you can configure <span class="emphasis"><em>Account linking</em></span> and specify it in the <a class="link" href="#identity_broker_first_login" title="9.10. First login flow">First Login Flow</a>. At this step, Red Hat Single Sign-On authenticates the user and issues its token to access the requested resource in the service provider.
					</li><li class="listitem">
						When the user authenticates, Red Hat Single Sign-On redirects the user to the service provider by sending the token previously issued during the local authentication.
					</li><li class="listitem">
						The service provider receives the token from Red Hat Single Sign-On and permits access to the protected resource.
					</li></ol></div><p>
				Variations of this flow are possible. For example, the client application can request a specific identity provider rather than displaying a list of them, or you can set Red Hat Single Sign-On to force users to provide additional information before federating their identity.
			</p><p>
				At the end of the authentication process, Red Hat Single Sign-On issues its token to client applications. Client applications are separate from the external identity providers, so they cannot see the client application’s protocol or how they validate the user’s identity. The provider only needs to know about Red Hat Single Sign-On.
			</p></section><section class="section" id="default_identity_provider"><div class="titlepage"><div><div><h2 class="title">9.2. Default Identity Provider</h2></div></div></div><p>
				Red Hat Single Sign-On can redirect to an identity provider rather than displaying the login form. To enable this redirection:
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Browser</strong></span> flow.
					</li><li class="listitem">
						Select <span class="strong strong"><strong>Identity Provider Redirector</strong></span> from the drop-down list.
					</li><li class="listitem">
						Set <span class="strong strong"><strong>Default Identity Provider</strong></span> to the identity provider you want to redirect users to.
					</li></ol></div><p>
				If Red Hat Single Sign-On does not find the configured default identity provider, the login form is displayed.
			</p><p>
				This authenticator is responsible for processing the <code class="literal">kc_idp_hint</code> query parameter. See the <a class="link" href="#client_suggested_idp" title="9.7. Client-suggested Identity Provider">client suggested identity provider</a> section for more information.
			</p></section><section class="section" id="general-idp-config"><div class="titlepage"><div><div><h2 class="title">9.3. General configuration</h2></div></div></div><p>
				The foundations of the identity broker configuration are identity providers (IDPs). Red Hat Single Sign-On creates identity providers for each realm and enables them for every application by default. Users from a realm can use any of the registered identity providers when signing in to an application.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
					</p><div class="formalpara"><p class="title"><strong>Identity Providers</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/identity-providers.png" alt="Identity Providers"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						From the <code class="literal">Add provider</code> list, select the identity provider you want to add. Red Hat Single Sign-On displays the configuration page for the identity provider you selected.
					</p><div class="formalpara"><p class="title"><strong>Add facebook identity Provider</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/add-identity-provider.png" alt="Add Facebook Identity Provider"/></span>
						</p></div><p class="simpara">
						When you configure an identity provider, the identity provider appears on the Red Hat Single Sign-On login page as an option. You can place custom icons on the login screen for each identity provider. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/#custom-identity-providers-icons">custom icons</a> for more information.
					</p><div class="formalpara"><p class="title"><strong>IDP login page</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/identity-provider-login-page.png" alt="identity provider login page"/></span>
						</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Social</span></dt><dd>
									Social providers enable social authentication in your realm. With Red Hat Single Sign-On, users can log in to your application using a social network account. Supported providers include Twitter, Facebook, Google, LinkedIn, Instagram, Microsoft, PayPal, Openshift v3, GitHub, GitLab, Bitbucket, and Stack Overflow.
								</dd><dt><span class="term">Protocol-based</span></dt><dd>
									Protocol-based providers rely on specific protocols to authenticate and authorize users. Using these providers, you can connect to any identity provider compliant with a specific protocol. Red Hat Single Sign-On provides support for SAML v2.0 and OpenID Connect v1.0 protocols. You can configure and broker any identity provider based on these open standards.
								</dd></dl></div></li></ol></div><p>
				Although each type of identity provider has its configuration options, all share a common configuration. The following configuration options available:
			</p><div class="table" id="idm140556182086896"><p class="title"><strong>Table 9.1. Common Configuration</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182082064" scope="col">Configuration</th><th align="left" valign="top" id="idm140556182080976" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Alias
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								The alias is a unique identifier for an identity provider and references an internal identity provider. Red Hat Single Sign-On uses the alias to build redirect URIs for OpenID Connect protocols that require a redirect URI or callback URL to communicate with an identity provider. All identity providers must have an alias. Alias examples include <code class="literal">facebook</code>, <code class="literal">google</code>, and <code class="literal">idp.acme.com</code>.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Enabled
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								Toggles the provider ON or OFF.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Hide on Login Page
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On does not display this provider as a login option on the login page. Clients can request this provider by using the 'kc_idp_hint' parameter in the URL to request a login.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Account Linking Only
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On links existing accounts with this provider. This provider cannot log users in, and Red Hat Single Sign-On does not display this provider as an option on the login page.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Store Tokens
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On stores tokens from the identity provider.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Stored Tokens Readable
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, users can retrieve the stored identity provider token. This action also applies to the <span class="emphasis"><em>broker</em></span> client-level role <span class="emphasis"><em>read token</em></span>.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Trust Email
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On trusts email addresses from the identity provider. If the realm requires email validation, users that log in from this identity provider do not need to perform the email verification process.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								GUI Order
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								The sort order of the available identity providers on the login page.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								First Login Flow
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								The authentication flow Red Hat Single Sign-On triggers when users use this identity provider to log into Red Hat Single Sign-On for the first time.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Post Login Flow
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								The authentication flow Red Hat Single Sign-On triggers when a user finishes logging in with the external identity provider.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182082064">
							<p>
								Sync Mode
							</p>
							</td><td align="left" valign="top" headers="idm140556182080976">
							<p>
								Strategy to update user information from the identity provider through mappers. When choosing <span class="strong strong"><strong>legacy</strong></span>, Red Hat Single Sign-On used the current behavior. <span class="strong strong"><strong>Import</strong></span> does not update user data and <span class="strong strong"><strong>force</strong></span> updates user data when possible. See <a class="link" href="#mappers" title="9.8. Mapping claims and assertions">Identity Provider Mappers</a> for more information.
							</p>
							</td></tr></tbody></table></div></div></section><section class="section" id="social_identity_providers"><div class="titlepage"><div><div><h2 class="title">9.4. Social Identity Providers</h2></div></div></div><p>
				A social identity provider can delegate authentication to a trusted, respected social media account. Red Hat Single Sign-On includes support for social networks such as Google, Facebook, Twitter, GitHub, LinkedIn, Microsoft, and Stack Overflow.
			</p><section class="section" id="bitbucket"><div class="titlepage"><div><div><h3 class="title">9.4.1. Bitbucket</h3></div></div></div><p>
					To log in with Bitbucket, perform the following procedure.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Bitbucket</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/bitbucket-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, perform the <a class="link" href="https://support.atlassian.com/bitbucket-cloud/docs/use-oauth-on-bitbucket-cloud/">OAuth on Bitbucket Cloud</a> process. When you click <span class="strong strong"><strong>Add Consumer</strong></span>:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Paste the value of <span class="strong strong"><strong>Redirect URI</strong></span> into the <span class="strong strong"><strong>Callback URL</strong></span> field.
								</li><li class="listitem">
									Ensure you select <span class="strong strong"><strong>Email</strong></span> and <span class="strong strong"><strong>Read</strong></span> in the <span class="strong strong"><strong>Account</strong></span> section to permit your application to read email.
								</li></ol></div></li><li class="listitem">
							Note the <code class="literal">Key</code> and <code class="literal">Secret</code> values Bitbucket displays when you create your consumer.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <code class="literal">Key</code> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <code class="literal">Secret</code> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="facebook"><div class="titlepage"><div><div><h3 class="title">9.4.2. Facebook</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Facebook</code>. Red Hat Single Sign-On displays the configuration page for the Facebook identity provider.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/facebook-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, follow the <a class="link" href="https://developers.facebook.com/docs/development/">Facebook Developer Guide’s</a> instructions to create a project and client in Facebook.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Ensure your app is a website-type app.
								</li><li class="listitem">
									Enter the <span class="strong strong"><strong>Redirect URI’s</strong></span> value into the <code class="literal">Site URL</code> of the Facebook <code class="literal">Website</code> settings block.
								</li><li class="listitem">
									Ensure the app is public.
								</li></ol></div></li><li class="listitem">
							Enter the <a class="link" href="https://developers.facebook.com/docs/facebook-login/access-tokens/"><code class="literal">Client ID</code> and <code class="literal">Client Secret</code></a> values from your Facebook app into the <code class="literal">Client ID</code> and <code class="literal">Client Secret</code> fields in Red Hat Single Sign-On.
						</li><li class="listitem">
							Enter the required scopes into the <span class="strong strong"><strong>Default Scopes</strong></span> field. By default, Red Hat Single Sign-On uses the <code class="literal">email</code> scope. See <a class="link" href="https://developers.facebook.com/docs/graph-api">Graph API</a> for more information about Facebook scopes.
						</li></ol></div><p>
					Red Hat Single Sign-On sends profile requests to <code class="literal">graph.facebook.com/me?fields=id,name,email,first_name,last_name</code> by default. The response contains the id, name, email, first_name, and last_name fields only. To fetch additional fields from the Facebook profile, add a corresponding scope and add the field name in the <code class="literal">Additional user’s profile fields</code> configuration option field.
				</p></section><section class="section" id="github"><div class="titlepage"><div><div><h3 class="title">9.4.3. GitHub</h3></div></div></div><p>
					To log in with Github, perform the following procedure.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Github</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/github-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, <a class="link" href="https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app">create an OAUTH app</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Enter the value of <span class="strong strong"><strong>Redirect URI</strong></span> into the <code class="literal">Authorization callback URL</code> field when creating the app.
								</li><li class="listitem">
									Note the Client ID and Client secret on the management page of your OAUTH app.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <code class="literal">Client ID</code> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <code class="literal">Client Secret</code> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="gitlab"><div class="titlepage"><div><div><h3 class="title">9.4.4. GitLab</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">GitLab</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/github-add-identity-provider.png" alt="Add identity provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, <a class="link" href="https://docs.gitlab.com/ee/integration/oauth_provider.html">add a new GitLab application</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Use the <span class="strong strong"><strong>Redirect URI</strong></span> in your clipboard as the <span class="strong strong"><strong>Redirect URI</strong></span>.
								</li><li class="listitem">
									Note the <code class="literal">Client ID</code> and <code class="literal">Client Secret</code> when you save the application.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <code class="literal">Client ID</code> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <code class="literal">Client Secret</code> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="google"><div class="titlepage"><div><div><h3 class="title">9.4.5. Google</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Google</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/google-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							In a separate browser tab open <a class="link" href="https://console.cloud.google.com/">the Google Cloud Platform console</a>.
						</li><li class="listitem">
							In the Google dashboard for your Google app, click the <span class="strong strong"><strong>OAuth consent screen</strong></span> menu. Create a consent screen, ensuring that the user type of the consent screen is external.
						</li><li class="listitem"><p class="simpara">
							In the Google dashboard:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click the <span class="strong strong"><strong>Credentials</strong></span> menu.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>CREATE CREDENTIALS</strong></span> - <span class="strong strong"><strong>OAuth Client ID</strong></span>.
								</li><li class="listitem">
									From the <span class="strong strong"><strong>Application type</strong></span> list, select <span class="strong strong"><strong>Web application</strong></span>.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Create</strong></span>.
								</li><li class="listitem">
									Note <span class="strong strong"><strong>Your Client ID</strong></span> and <span class="strong strong"><strong>Your Client Secret</strong></span>.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Your Client ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Your Client Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Enter the required scopes into the <span class="strong strong"><strong>Default Scopes</strong></span> field. By default, Red Hat Single Sign-On uses the following scopes: <code class="literal">openid</code> <code class="literal">profile</code> <code class="literal">email</code>. See the <a class="link" href="https://developers.google.com/oauthplayground/">OAuth Playground</a> for a list of Google scopes.
						</li><li class="listitem">
							To restrict access to your GSuite organization’s members only, enter the G Suite domain into the <code class="literal">Hosted Domain</code> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="linkedin"><div class="titlepage"><div><div><h3 class="title">9.4.6. LinkedIn</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">LinkedIn</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/google-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, <a class="link" href="https://www.linkedin.com/developer/apps">create an app</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									After you create the app, click the <span class="strong strong"><strong>Auth</strong></span> tab.
								</li><li class="listitem">
									Enter the value of <span class="strong strong"><strong>Redirect URI</strong></span> into the <span class="strong strong"><strong>Authorized redirect URLs for your app</strong></span> field.
								</li><li class="listitem">
									Note <span class="strong strong"><strong>Your Client ID</strong></span> and <span class="strong strong"><strong>Your Client Secret</strong></span>.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="microsoft"><div class="titlepage"><div><div><h3 class="title">9.4.7. Microsoft</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Microsoft</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/google-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, <a class="link" href="https://account.live.com/developers/applications/create">create a Microsoft app</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click <span class="strong strong"><strong>Add URL</strong></span> to add the redirect URL to the Microsoft app.
								</li><li class="listitem">
									Note the <span class="strong strong"><strong>Application ID</strong></span> and <span class="strong strong"><strong>Application Secret</strong></span>.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Application ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Application Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="openshift_3"><div class="titlepage"><div><div><h3 class="title">9.4.8. OpenShift 3</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Openshift</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/openshift-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							Register your client using the <code class="literal">oc</code> command-line tool.
						</p><pre class="screen">$ oc create -f &lt;(echo '
kind: OAuthClient
apiVersion: v1
metadata:
 name: kc-client <span id="CO1-1"/><span class="callout">1</span>
secret: "..." <span id="CO1-2"/><span class="callout">2</span>
redirectURIs:
 - "http://www.example.com/" <span id="CO1-3"/><span class="callout">3</span>
grantMethod: prompt <span id="CO1-4"/><span class="callout">4</span>
')</pre></li></ol></div><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO1-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							The <code class="literal">name</code> of your OAuth client. Passed as <code class="literal">client_id</code> request parameter when making requests to <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/authorize</code> and <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/token</code>.
						</div></dd><dt><a href="#CO1-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							The <code class="literal">secret</code> Red Hat Single Sign-On uses for the <code class="literal">client_secret</code> request parameter.
						</div></dd><dt><a href="#CO1-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							The <code class="literal">redirect_uri</code> parameter specified in requests to <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/authorize</code> and <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/token</code> must be equal to (or prefixed by) one of the URIs in <code class="literal">redirectURIs</code>. You can obtain this from the <span class="strong strong"><strong>Redirect URI</strong></span> field in the Identity Provider screen
						</div></dd><dt><a href="#CO1-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							The <code class="literal">grantMethod</code> Red Hat Single Sign-On uses to determine the action when this client requests tokens but has not been granted access by the user.
						</div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
									In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
								</li><li class="listitem">
									In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Save</strong></span>.
								</li></ol></div></dd></dl></div></section><section class="section" id="openshift_4"><div class="titlepage"><div><div><h3 class="title">9.4.9. OpenShift 4</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Installation of <a class="link" href="https://stedolan.github.io/jq/">jq</a>.
						</li><li class="listitem">
							<code class="literal">X509_CA_BUNDLE</code> configured in the container and set to <code class="literal">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>.
						</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Run the following command on the command line and note the OpenShift 4 API URL output.
						</p><pre class="screen">curl -s -k -H "Authorization: Bearer $(oc whoami -t)" \https://&lt;openshift-user-facing-api-url&gt;/apis/config.openshift.io/v1/infrastructures/cluster | jq ".status.apiServerURL"</pre></li><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the Red Hat Single Sign-On menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Openshift</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/openshift-4-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							Register your client using the <code class="literal">oc</code> command-line tool.
						</p><pre class="screen">$ oc create -f &lt;(echo '
kind: OAuthClient
apiVersion: v1
metadata:
 name: keycloak-broker <span id="CO2-1"/><span class="callout">1</span>
secret: "..." <span id="CO2-2"/><span class="callout">2</span>
redirectURIs:
 - "&lt;copy pasted Redirect URI from OpenShift 4 Identity Providers page&gt;" <span id="CO2-3"/><span class="callout">3</span>
grantMethod: prompt <span id="CO2-4"/><span class="callout">4</span>
')</pre></li></ol></div><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO2-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							The <code class="literal">name</code> of your OAuth client. Passed as <code class="literal">client_id</code> request parameter when making requests to <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/authorize</code> and <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/token</code>. The <code class="literal">name</code> parameter must be the same in the <code class="literal">OAuthClient</code> object and the Red Hat Single Sign-On configuration.
						</div></dd><dt><a href="#CO2-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							The <code class="literal">secret</code> Red Hat Single Sign-On uses as the <code class="literal">client_secret</code> request parameter.
						</div></dd><dt><a href="#CO2-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							The <code class="literal">redirect_uri</code> parameter specified in requests to <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/authorize</code> and <code class="literal"><span class="emphasis"><em>&lt;openshift_master&gt;</em></span>/oauth/token</code> must be equal to (or prefixed by) one of the URIs in <code class="literal">redirectURIs</code>. The easiest way to configure it correctly is to copy-paste it from Red Hat Single Sign-On OpenShift 4 Identity Provider configuration page (<code class="literal">Redirect URI</code> field).
						</div></dd><dt><a href="#CO2-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							The <code class="literal">grantMethod</code> Red Hat Single Sign-On uses to determine the action when this client requests tokens but has not been granted access by the user.
						</div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
									In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
								</li><li class="listitem">
									In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Save</strong></span>.
								</li></ol></div></dd></dl></div><p>
					See <a class="link" href="https://docs.okd.io/latest/authentication/configuring-oauth-clients.html#oauth-register-additional-client_configuring-oauth-clients">official OpenShift documentation</a> for more information.
				</p></section><section class="section" id="paypal"><div class="titlepage"><div><div><h3 class="title">9.4.10. PayPal</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">PayPal</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/google-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, open the <a class="link" href="https://developer.paypal.com/developer/applications">PayPal Developer applications area</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click <span class="strong strong"><strong>Create App</strong></span> to create a PayPal app.
								</li><li class="listitem">
									Note the Client ID and Client Secret. Click the <span class="strong strong"><strong>Show</strong></span> link to view the secret.
								</li><li class="listitem">
									Ensure <span class="strong strong"><strong>Connect with PayPal</strong></span> is checked.
								</li><li class="listitem">
									Set the value of the <span class="strong strong"><strong>Return URL</strong></span> field to the value of <span class="strong strong"><strong>Redirect URI</strong></span> from Red Hat Single Sign-On.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="stackoverflow"><div class="titlepage"><div><div><h3 class="title">9.4.11. Stack overflow</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Stack Overflow</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/google-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem"><p class="simpara">
							In a separate browser tab, log into <a class="link" href="https://stackapps.com/apps/oauth/register">registering your application on Stack Apps</a>.
						</p><div class="formalpara"><p class="title"><strong>Register application</strong></p><p>
								<span class="inlinemediaobject"><img src="images/stack-overflow-app-register.png" alt="Register Application"/></span>
							</p></div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Enter your application name into the <span class="strong strong"><strong>Application Name</strong></span> field.
								</li><li class="listitem">
									Enter the OAuth domain into the <span class="strong strong"><strong>OAuth Domain</strong></span> field.
								</li><li class="listitem"><p class="simpara">
									Click <span class="strong strong"><strong>Register Your Application</strong></span>.
								</p><div class="formalpara"><p class="title"><strong>Settings</strong></p><p>
										<span class="inlinemediaobject"><img src="images/stack-overflow-app-settings.png" alt="Settings"/></span>
									</p></div></li></ol></div></li><li class="listitem">
							Note the <span class="strong strong"><strong>Client ID</strong></span> and <span class="strong strong"><strong>Client Secret</strong></span>.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Client Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="twitter"><div class="titlepage"><div><div><h3 class="title">9.4.12. Twitter</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							A Twitter developer account.
						</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Twitter</code>.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/twitter-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, create an app in <a class="link" href="https://developer.twitter.com/apps/">Twitter Application Management</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Enter any value for name and description.
								</li><li class="listitem">
									The value for <span class="strong strong"><strong>Website</strong></span> can be any valid URL except <code class="literal">localhost</code>.
								</li><li class="listitem">
									Paste the value of the <span class="strong strong"><strong>Redirect URL</strong></span> into the <span class="strong strong"><strong>Callback URL</strong></span> field.
								</li><li class="listitem">
									When you create your Twitter app, note the value of <span class="strong strong"><strong>Consumer Key</strong></span> and <span class="strong strong"><strong>Consumer Secret</strong></span> in the <span class="strong strong"><strong>Keys and Access Tokens</strong></span> section.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Consumer Key</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Consumer Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="instagram"><div class="titlepage"><div><div><h3 class="title">9.4.13. Instagram</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							From the <code class="literal">Add provider</code> list, select <code class="literal">Instagram</code>. Red Hat Single Sign-On displays the configuration page for the Instagram identity provider.
						</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/instagram-add-identity-provider.png" alt="Add Identity Provider"/></span>
							</p></div></li><li class="listitem">
							Copy the value of <span class="strong strong"><strong>Redirect URI</strong></span> to your clipboard.
						</li><li class="listitem"><p class="simpara">
							In a separate browser tab, open the <a class="link" href="https://developers.facebook.com/">Facebook Developer Console</a>.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click <span class="strong strong"><strong>My Apps</strong></span>.
								</li><li class="listitem"><p class="simpara">
									Select <span class="strong strong"><strong>Add a New App</strong></span>.
								</p><div class="formalpara"><p class="title"><strong>Add a new app</strong></p><p>
										<span class="inlinemediaobject"><img src="images/instagram-add-new-app.png" alt="Add a New App"/></span>
									</p></div></li><li class="listitem"><p class="simpara">
									Select <code class="literal">For Everything Else</code>.
								</p><div class="formalpara"><p class="title"><strong>Create a new app ID</strong></p><p>
										<span class="inlinemediaobject"><img src="images/instagram-create-app-id.png" alt="instagram create app id"/></span>
									</p></div></li><li class="listitem">
									Fill in all required fields.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Create App</strong></span>. Facebook then brings you to the dashboard.
								</li><li class="listitem"><p class="simpara">
									In the navigation panel, select <span class="strong strong"><strong>Settings</strong></span> - <span class="strong strong"><strong>Basic</strong></span>.
								</p><div class="formalpara"><p class="title"><strong>Add platform</strong></p><p>
										<span class="inlinemediaobject"><img src="images/instagram-add-platform.png" alt="Add Platform"/></span>
									</p></div></li><li class="listitem">
									Select <span class="strong strong"><strong>+ Add Platform</strong></span>.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>[Website]</strong></span>.
								</li><li class="listitem"><p class="simpara">
									Enter a URL for your site.
								</p><div class="formalpara"><p class="title"><strong>Add a product</strong></p><p>
										<span class="inlinemediaobject"><img src="images/instagram-add-product.png" alt="instagram add product"/></span>
									</p></div></li><li class="listitem">
									Select <code class="literal">Dashboard</code> from the menu.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Set Up</strong></span> in the Instagram box.
								</li><li class="listitem">
									Select <span class="strong strong"><strong>Instagram</strong></span> - <span class="strong strong"><strong>Basic Display</strong></span> from the menu.
								</li><li class="listitem"><p class="simpara">
									Click <span class="strong strong"><strong>Create New App</strong></span>.
								</p><div class="formalpara"><p class="title"><strong>Create a new Instagram app ID</strong></p><p>
										<span class="inlinemediaobject"><img src="images/instagram-create-instagram-app-id.png" alt="Create a New Instagram App ID"/></span>
									</p></div></li><li class="listitem"><p class="simpara">
									Enter a value into <span class="strong strong"><strong>Display Name</strong></span>.
								</p><div class="formalpara"><p class="title"><strong>Setup the app</strong></p><p>
										<span class="inlinemediaobject"><img src="images/instagram-app-settings.png" alt="Setup the App"/></span>
									</p></div></li><li class="listitem">
									Paste the <span class="strong strong"><strong>Redirect URL</strong></span> from Red Hat Single Sign-On into the <span class="strong strong"><strong>Valid OAuth Redirect URIs</strong></span> field.
								</li><li class="listitem">
									Paste the <span class="strong strong"><strong>Redirect URL</strong></span> from Red Hat Single Sign-On into the <span class="strong strong"><strong>Deauthorize Callback URL</strong></span> field.
								</li><li class="listitem">
									Paste the <span class="strong strong"><strong>Redirect URL</strong></span> from Red Hat Single Sign-On into the <span class="strong strong"><strong>Data Deletion Request URL</strong></span> field.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Show</strong></span> in the <span class="strong strong"><strong>Instagram App Secret</strong></span> field.
								</li><li class="listitem">
									Note the <span class="strong strong"><strong>Instagram App ID</strong></span> and the <span class="strong strong"><strong>Instagram App Secret</strong></span>.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>App Review</strong></span> - <span class="strong strong"><strong>Requests</strong></span>.
								</li><li class="listitem">
									Follow the instructions on the screen.
								</li></ol></div></li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Instagram App ID</strong></span> into the <span class="strong strong"><strong>Client ID</strong></span> field.
						</li><li class="listitem">
							In Red Hat Single Sign-On, paste the value of the <span class="strong strong"><strong>Instagram App Secret</strong></span> into the <span class="strong strong"><strong>Client Secret</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section></section><section class="section" id="identity_broker_oidc"><div class="titlepage"><div><div><h2 class="title">9.5. OpenID Connect v1.0 identity providers</h2></div></div></div><p>
				Red Hat Single Sign-On brokers identity providers based on the OpenID Connect protocol. These identity providers (IDPs) must support the <a class="link" href="#proc-creating-oidc-client_server_administration_guide" title="12.1.1. Creating an OpenID Connect Client">Authorization Code Flow</a> defined in the specification to authenticate users and authorize access.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						From the <code class="literal">Add provider</code> list, select <code class="literal">OpenID Connect v1.0</code>.
					</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/oidc-add-identity-provider.png" alt="Add Identity Provider"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Enter your initial configuration options. See <a class="link" href="#general-idp-config" title="9.3. General configuration">General IDP Configuration</a> for more information about configuration options.
					</p><div class="table" id="idm140556182912336"><p class="title"><strong>Table 9.2. OpenID connect config</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182907504" scope="col">Configuration</th><th align="left" valign="top" id="idm140556182906416" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Authorization URL
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										The authorization URL endpoint the OIDC protocol requires.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Token URL
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										The token URL endpoint the OIDC protocol requires.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Logout URL
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										The logout URL endpoint in the OIDC protocol. This value is optional.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Backchannel Logout
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										A background, out-of-band, REST request to the IDP to log out the user. Some IDPs perform logout through browser redirects only, as they may identify sessions using a browser cookie.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										User Info URL
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										An endpoint the OIDC protocol defines. This endpoint points to user profile information.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Client Authentication
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										Defines the Client Authentication method Red Hat Single Sign-On uses with the Authorization Code Flow. In the case of JWT signed with a private key, Red Hat Single Sign-On uses the realm private key. In the other cases, define a client secret. See the <a class="link" href="https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication">Client Authentication specifications</a> for more information.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Client ID
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										A realm acting as an OIDC client to the external IDP. The realm must have an OIDC client ID if you use the Authorization Code Flow to interact with the external IDP.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Client Secret
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										Client secret from an external <a class="link" href="#vault-administration" title="Chapter 13. Using a vault to obtain secrets">vault</a>. This secret is necessary if you are using the Authorization Code Flow.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Client Assertion Signature Algorithm
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										Signature algorithm to create JWT assertion as client authentication. In the case of JWT signed with private key or Client secret as jwt, it is required. If no algorithm is specified, the following algorithm is adapted. <code class="literal">RS256</code> is adapted in the case of JWT signed with private key. <code class="literal">HS256</code> is adapted in the case of Client secret as jwt.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Issuer
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										Red Hat Single Sign-On validates issuer claims, in responses from the IDP, against this value.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Default Scopes
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										A list of OIDC scopes Red Hat Single Sign-On sends with the authentication request. The default value is <code class="literal">openid</code>. A space separates each scope.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Prompt
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										The prompt parameter in the OIDC specification. Through this parameter, you can force re-authentication and other options. See the specification for more details.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Accepts prompt=none forward from client
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										Specifies if the IDP accepts forwarded authentication requests containing the <code class="literal">prompt=none</code> query parameter. If a realm receives an auth request with <code class="literal">prompt=none</code>, the realm checks if the user is currently authenticated and returns a <code class="literal">login_required</code> error if the user has not logged in. When Red Hat Single Sign-On determines a default IDP for the auth request (using the <code class="literal">kc_idp_hint</code> query parameter or having a default IDP for the realm), you can forward the auth request with <code class="literal">prompt=none</code> to the default IDP. The default IDP checks the authentication of the user there. Because not all IDPs support requests with <code class="literal">prompt=none</code>, Red Hat Single Sign-On uses this switch to indicate that the default IDP supports the parameter before redirecting the authentication request.
									</p>
									<p>
										If the user is unauthenticated in the IDP, the client still receives a <code class="literal">login_required</code> error. If the user is authentic in the IDP, the client can still receive an <code class="literal">interaction_required</code> error if Red Hat Single Sign-On must display authentication pages that require user interaction. This authentication includes required actions (for example, password change), consent screens, and screens set to display by the <code class="literal">first broker login</code> flow or <code class="literal">post broker login</code> flow.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Validate Signatures
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										Specifies if Red Hat Single Sign-On verifies signatures on the external ID Token signed by this IDP. If <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On must know the public key of the external OIDC IDP. For performance purposes, Red Hat Single Sign-On caches the public key of the external OIDC identity provider. If your identity provider’s private key is compromised, update your keys and clear the keys cache. See <a class="link" href="#clear-cache" title="3.5. Clearing server caches">Clearing the cache</a> section for more details.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Use JWKS URL
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										This switch is applicable if <code class="literal">Validate Signatures</code> is <span class="strong strong"><strong>ON</strong></span>. If <span class="strong strong"><strong>Use JWKS URL</strong></span> is <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On downloads the IDP’s public keys from the JWKS URL. New keys download when the identity provider generates a new keypair. If <span class="strong strong"><strong>OFF</strong></span>, Red Hat Single Sign-On uses the public key (or certificate) from its database, so when the IDP keypair changes, import the new key to the Red Hat Single Sign-On database as well.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										JWKS URL
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										The URL pointing to the location of the IDP JWK keys. For more information, see the <a class="link" href="https://self-issued.info/docs/draft-ietf-jose-json-web-key.html">JWK specification</a>. If you use an external Red Hat Single Sign-On as an IDP, you can use a URL such as <a class="link" href="http://broker-keycloak:8180/auth/realms/test/protocol/openid-connect/certs">http://broker-keycloak:8180/auth/realms/test/protocol/openid-connect/certs</a> if your brokered Red Hat Single Sign-On is running on <a class="link" href="http://broker-keycloak:8180">http://broker-keycloak:8180</a> and its realm is <code class="literal">test</code>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Validating Public Key
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										The public key in PEM format that Red Hat Single Sign-On uses to verify external IDP signatures. This key applies if <code class="literal">Use JWKS URL</code> is <span class="strong strong"><strong>OFF</strong></span>.
									</p>
									</td></tr><tr><td align="left" valign="top" headers="idm140556182907504">
									<p>
										Validating Public Key Id
									</p>
									</td><td align="left" valign="top" headers="idm140556182906416">
									<p>
										This setting applies if <span class="strong strong"><strong>Use JWKS URL</strong></span> is <span class="strong strong"><strong>OFF</strong></span>. This setting specifies the ID of the public key in PEM format. Because there is no standard way for computing key ID from the key, external identity providers can use different algorithms from what Red Hat Single Sign-On uses. If this field’s value is not specified, Red Hat Single Sign-On uses the validating public key for all requests, regardless of the key ID sent by the external IDP. When <span class="strong strong"><strong>ON</strong></span>, this field’s value is the key ID used by Red Hat Single Sign-On for validating signatures from providers and must match the key ID specified by the IDP.
									</p>
									</td></tr></tbody></table></div></div></li></ol></div><p>
				You can import all this configuration data by providing a URL or file that points to OpenID Provider Metadata. If you connect to a Red Hat Single Sign-On external IDP, you can import the IDP settings from <code class="literal">&lt;root&gt;/auth/realms/{realm-name}/.well-known/openid-configuration</code>. This link is a JSON document describing metadata about the IDP.
			</p></section><section class="section" id="saml_v2_0_identity_providers"><div class="titlepage"><div><div><h2 class="title">9.6. SAML v2.0 Identity Providers</h2></div></div></div><p>
				Red Hat Single Sign-On can broker identity providers based on the SAML v2.0 protocol.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						From the <code class="literal">Add provider</code> list, select <code class="literal">SAML v2.0</code>.
					</p><div class="formalpara"><p class="title"><strong>Add identity provider</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/saml-add-identity-provider.png" alt="Add Identity Provider"/></span>
						</p></div></li><li class="listitem">
						Enter your initial configuration options. See <a class="link" href="#general-idp-config" title="9.3. General configuration">General IDP Configuration</a> for more information about configuration options. .SAML Config
					</li></ol></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182793760" scope="col">Configuration</th><th align="left" valign="top" id="idm140556182792672" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Service Provider Entity ID
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								The SAML Entity ID that the remote Identity Provider uses to identify requests from this Service Provider. By default, this setting is set to the realms base URL <code class="literal">&lt;root&gt;/auth/realms/{realm-name}</code>.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Single Sign-On Service URL
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								The SAML endpoint that starts the authentication process. If your SAML IDP publishes an IDP entity descriptor, the value of this field is specified there.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Single Logout Service URL
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								The SAML logout endpoint. If your SAML IDP publishes an IDP entity descriptor, the value of this field is specified there.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Backchannel Logout
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Toggle this switch to <span class="strong strong"><strong>ON</strong></span> if your SAML IDP supports back channel logout.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								NameID Policy Format
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								The URI reference corresponding to a name identifier format. By default, Red Hat Single Sign-On sets it to <code class="literal">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</code>.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Principal Type
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Specifies which part of the SAML assertion will be used to identify and track external user identities. Can be either Subject NameID or SAML attribute (either by name or by friendly name). Subject NameID value can not be set together with 'urn:oasis:names:tc:SAML:2.0:nameid-format:transient' NameID Policy Format value.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Principal Attribute
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								If a Principal type is non-blank, this field specifies the name ("Attribute [Name]") or the friendly name ("Attribute [Friendly Name]") of the identifying attribute.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Allow create
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Allow the external identity provider to create a new identifier to represent the principal.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								HTTP-POST Binding Response
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Controls the SAML binding in response to any SAML requests sent by an external IDP. When <span class="strong strong"><strong>OFF</strong></span>, Red Hat Single Sign-On uses Redirect Binding.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								HTTP-POST Binding for AuthnRequest
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Controls the SAML binding when requesting authentication from an external IDP. When <span class="strong strong"><strong>OFF</strong></span>, Red Hat Single Sign-On uses Redirect Binding.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Want AuthnRequests Signed
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On uses the realm’s keypair to sign requests sent to the external SAML IDP.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Signature Algorithm
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								If <span class="strong strong"><strong>Want AuthnRequests Signed</strong></span> is <span class="strong strong"><strong>ON</strong></span>, the signature algorithm to use.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								SAML Signature Key Name
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Signed SAML documents sent using POST binding contain the identification of signing key in <code class="literal">KeyName</code> element, which, by default, contains the Red Hat Single Sign-On key ID. External SAML IDPs can expect a different key name. This switch controls whether <code class="literal">KeyName</code> contains: * <code class="literal">KEY_ID</code> - Key ID. * <code class="literal">CERT_SUBJECT</code> - the subject from the certificate corresponding to the realm key. Microsoft Active Directory Federation Services expect <code class="literal">CERT_SUBJECT</code>. * <code class="literal">NONE</code> - Red Hat Single Sign-On omits the key name hint from the SAML message.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Force Authentication
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								The user must enter their credentials at the external IDP even when the user is already logged in.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Validate Signature
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, the realm expects SAML requests and responses from the external IDP to be digitally signed.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Validating X509 Certificate
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								The public certificate Red Hat Single Sign-On uses to validate the signatures of SAML requests and responses from the external IDP.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Sign Service Provider Metadata
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								When <span class="strong strong"><strong>ON</strong></span>, Red Hat Single Sign-On uses the realm’s key pair to sign the <a class="link" href="#identity_broker_saml_sp_descriptor" title="9.6.2. SP Descriptor">SAML Service Provider Metadata descriptor</a>.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Pass subject
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Controls if Red Hat Single Sign-On forwards a <code class="literal">login_hint</code> query parameter to the IDP. Red Hat Single Sign-On adds this field’s value to the login_hint parameter in the AuthnRequest’s Subject so destination providers can pre-fill their login form.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Attribute Consuming Service Index
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								Identifies the attribute set to request to the remote IDP. Red Hat Single Sign-On automatically adds the attributes mapped in the identity provider configuration to the autogenerated SP metadata document.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556182793760">
							<p>
								Attribute Consuming Service Name
							</p>
							</td><td align="left" valign="top" headers="idm140556182792672">
							<p>
								A descriptive name for the set of attributes that are advertised in the autogenerated SP metadata document.
							</p>
							</td></tr></tbody></table></div><p>
				You can import all configuration data by providing a URL or a file pointing to the SAML IDP entity descriptor of the external IDP. If you are connecting to a Red Hat Single Sign-On external IDP, you can import the IDP settings from the URL <code class="literal">&lt;root&gt;/auth/realms/{realm-name}/protocol/saml/descriptor</code>. This link is an XML document describing metadata about the IDP. You can also import all this configuration data by providing a URL or XML file pointing to the external SAML IDP’s entity descriptor to connect to.
			</p><section class="section" id="identity_broker_saml_requested_authncontext"><div class="titlepage"><div><div><h3 class="title">9.6.1. Requesting specific AuthnContexts</h3></div></div></div><p>
					Identity Providers facilitate clients specifying constraints on the authentication method verifying the user identity. For example, asking for MFA, Kerberos authentication, or security requirements. These constraints use particular AuthnContext criteria. A client can ask for one or more criteria and specify how the Identity Provider must match the requested AuthnContext, exactly, or by satisfying other equivalents.
				</p><p>
					You can list the criteria your Service Provider requires by adding ClassRefs or DeclRefs in the Requested AuthnContext Constraints section. Usually, you need to provide either ClassRefs or DeclRefs, so check with your Identity Provider documentation which values are supported. If no ClassRefs or DeclRefs are present, the Identity Provider does not enforce additional constraints.
				</p><div class="table" id="idm140556183141776"><p class="title"><strong>Table 9.3. Requested AuthnContext Constraints</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556183136928" scope="col">Configuration</th><th align="left" valign="top" id="idm140556183135840" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556183136928">
								<p>
									Comparison
								</p>
								</td><td align="left" valign="top" headers="idm140556183135840">
								<p>
									The method the Identity Provider uses to evaluate the context requirements. The available values are <code class="literal">Exact</code>, <code class="literal">Minimum</code>, <code class="literal">Maximum</code>, or <code class="literal">Better</code>. The default value is <code class="literal">Exact</code>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556183136928">
								<p>
									AuthnContext ClassRefs
								</p>
								</td><td align="left" valign="top" headers="idm140556183135840">
								<p>
									The AuthnContext ClassRefs describing the required criteria.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556183136928">
								<p>
									AuthnContext DeclRefs
								</p>
								</td><td align="left" valign="top" headers="idm140556183135840">
								<p>
									The AuthnContext DeclRefs describing the required criteria.
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="identity_broker_saml_sp_descriptor"><div class="titlepage"><div><div><h3 class="title">9.6.2. SP Descriptor</h3></div></div></div><p>
					When you access the provider’s SAML SP metadata, look for the <code class="literal">Endpoints</code> item in the identity provider configuration settings. It contains a <code class="literal">SAML 2.0 Service Provider Metadata</code> link which generates the SAML entity descriptor for the Service Provider. You can download the descriptor or copy its URL and then import it into the remote Identity Provider.
				</p><p>
					This metadata is also available publicly by going to the following URL:
				</p><pre class="screen">http[s]://{host:port}/auth/realms/{realm-name}/broker/{broker-alias}/endpoint/descriptor</pre><p>
					Ensure you save any configuration changes before accessing the descriptor.
				</p></section><section class="section" id="identity_broker_saml_login_hint"><div class="titlepage"><div><div><h3 class="title">9.6.3. Send subject in SAML requests</h3></div></div></div><p>
					By default, a social button pointing to a SAML Identity Provider redirects the user to the following login URL:
				</p><pre class="screen">http[s]://{host:port}/auth/realms/${realm-name}/broker/{broker-alias}/login</pre><p>
					Adding a query parameter named <code class="literal">login_hint</code> to this URL adds the parameter’s value to SAML request as a Subject attribute. If this query parameter is empty, Red Hat Single Sign-On does not add a subject to the request.
				</p><p>
					Enable the "Pass subject" option to send the subject in SAML requests.
				</p></section></section><section class="section" id="client_suggested_idp"><div class="titlepage"><div><div><h2 class="title">9.7. Client-suggested Identity Provider</h2></div></div></div><p>
				OIDC applications can bypass the Red Hat Single Sign-On login page by hinting at the identity provider they want to use. You can enable this by setting the <code class="literal">kc_idp_hint</code> query parameter in the Authorization Code Flow authorization endpoint.
			</p><p>
				With Red Hat Single Sign-On OIDC client adapters, you can specify this query parameter when you access a secured resource in the application.
			</p><p>
				For example:
			</p><pre class="programlisting language-bash">GET /myapplication.com?kc_idp_hint=facebook HTTP/1.1
Host: localhost:8080</pre><p>
				In this case, your realm must have an identity provider with a <code class="literal">facebook</code> alias. If this provider does not exist, the login form is displayed.
			</p><p>
				If you are using the <code class="literal">keycloak.js</code> adapter, you can also achieve the same behavior as follows:
			</p><pre class="programlisting language-javascript">var keycloak = new Keycloak('keycloak.json');

keycloak.createLoginUrl({
	idpHint: 'facebook'
});</pre><p>
				With the <code class="literal">kc_idp_hint</code> query parameter, the client can override the default identity provider if you configure one for the <code class="literal">Identity Provider Redirector</code> authenticator. The client can disable the automatic redirecting by setting the <code class="literal">kc_idp_hint</code> query parameter to an empty value.
			</p></section><section class="section" id="mappers"><div class="titlepage"><div><div><h2 class="title">9.8. Mapping claims and assertions</h2></div></div></div><p>
				You can import the SAML and OpenID Connect metadata, provided by the external IDP you are authenticating with, into the realm. After importing, you can extract user profile metadata and other information, so you can make it available to your applications.
			</p><p>
				Each user logging into your realm using an external identity provider has an entry in the local Red Hat Single Sign-On database, based on the metadata from the SAML or OIDC assertions and claims.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
					</li><li class="listitem">
						Select one of the identity providers in the list.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Mappers</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Identity provider mappers</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/identity-provider-mappers.png" alt="identity provider mappers"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Identity provider mapper</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/identity-provider-mapper.png" alt="identity provider mapper"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Select a value for <span class="strong strong"><strong>Sync Mode Override</strong></span>. The mapper updates user information when users log in repeatedly according to this setting.
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Select <span class="strong strong"><strong>legacy</strong></span> to use the behavior of the previous Red Hat Single Sign-On version.
							</li><li class="listitem">
								Select <span class="strong strong"><strong>import</strong></span> to import data from when the user was first created in Red Hat Single Sign-On during the first login to Red Hat Single Sign-On with a particular identity provider.
							</li><li class="listitem">
								Select <span class="strong strong"><strong>force</strong></span> to update user data at each user login.
							</li><li class="listitem">
								Select <span class="strong strong"><strong>inherit</strong></span> to use the sync mode configured in the identity provider. All other options will override this sync mode.
							</li></ol></div></li><li class="listitem">
						Select a mapper from the <span class="strong strong"><strong>Mapper Type</strong></span> list. Hover over the <span class="strong strong"><strong>Mapper Type</strong></span> for a description of the mapper and configuration to enter for the mapper.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div><p>
				For JSON-based claims, you can use dot notation for nesting and square brackets to access array fields by index. For example, <code class="literal">contact.address[0].country</code>.
			</p><p>
				To investigate the structure of user profile JSON data provided by social providers, you can enable the <code class="literal">DEBUG</code> level logger <code class="literal">org.keycloak.social.user_profile_dump</code> in the server’s app-server configuration file (domain.xml or standalone.xml).
			</p></section><section class="section" id="available_user_session_data"><div class="titlepage"><div><div><h2 class="title">9.9. Available user session data</h2></div></div></div><p>
				After a user login from an external IDP, Red Hat Single Sign-On stores user session note data that you can access. This data can be propagated to the client requesting log in using the token or SAML assertion passed back to the client using an appropriate client mapper.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">identity_provider</span></dt><dd>
							The IDP alias of the broker used to perform the login.
						</dd><dt><span class="term">identity_provider_identity</span></dt><dd>
							The IDP username of the currently authenticated user. Often, but not always, the same as the Red Hat Single Sign-On username. For example, Red Hat Single Sign-On can link a user john` to a Facebook user <code class="literal">john123@gmail.com</code>. In that case, the value of the user session note is <code class="literal">john123@gmail.com</code>.
						</dd></dl></div><p>
				You can use a <a class="link" href="#protocol-mappers" title="12.4. OIDC token and SAML assertion mappings">Protocol Mapper</a> of type <code class="literal">User Session Note</code> to propagate this information to your clients.
			</p></section><section class="section" id="identity_broker_first_login"><div class="titlepage"><div><div><h2 class="title">9.10. First login flow</h2></div></div></div><p>
				When users log in through identity brokering, Red Hat Single Sign-On imports and links aspects of the user within the realm’s local database. When Red Hat Single Sign-On successfully authenticates users through an external identity provider, two situations can exist:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Red Hat Single Sign-On has already imported and linked a user account with the authenticated identity provider account. In this case, Red Hat Single Sign-On authenticates as the existing user and redirects back to the application.
					</li><li class="listitem">
						No account exists for this user in Red Hat Single Sign-On. Usually, you register and import a new account into the Red Hat Single Sign-On database, but there may be an existing Red Hat Single Sign-On account with the same email address. Automatically linking the existing local account to the external identity provider is a potential security hole. You cannot always trust the information you get from the external identity provider.
					</li></ul></div><p>
				Different organizations have different requirements when dealing with some of these situations. With Red Hat Single Sign-On, you can use the <code class="literal">First Login Flow</code> option in the IDP settings to choose a <a class="link" href="#authentication-flows" title="8.3. Authentication flows">workflow</a> for a user logging in from an external IDP for the first time. By default, the <code class="literal">First Login Flow</code> option points to the <code class="literal">first broker login</code> flow, but you can use your flow or different flows for different identity providers.
			</p><p>
				The flow is in the Admin Console under the <span class="strong strong"><strong>Authentication</strong></span> tab. When you choose the <code class="literal">First Broker Login</code> flow, you see the authenticators used by default. You can re-configure the existing flow. For example, you can disable some authenticators, mark some of them as <code class="literal">required</code>, or configure some authenticators.
			</p><section class="section" id="default_first_login_flow_authenticators"><div class="titlepage"><div><div><h3 class="title">9.10.1. Default first login flow authenticators</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Review Profile</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										This authenticator displays the profile information page, so the users can review their profile that Red Hat Single Sign-On retrieves from an identity provider.
									</li><li class="listitem">
										You can set the <code class="literal">Update Profile On First Login</code> option in the <span class="strong strong"><strong>Actions</strong></span> menu.
									</li><li class="listitem">
										When <span class="strong strong"><strong>ON</strong></span>, users are presented with the profile page requesting additional information to federate the user’s identities.
									</li><li class="listitem">
										When <span class="strong strong"><strong>missing</strong></span>, users are presented with the profile page if the identity provider does not provide mandatory information, such as email, first name, or last name.
									</li><li class="listitem">
										When <span class="strong strong"><strong>OFF</strong></span>, the profile page does not display unless the user clicks in a later phase on the <code class="literal">Review profile info</code> link in the page displayed by the <code class="literal">Confirm Link Existing Account</code> authenticator.
									</li></ul></div></dd><dt><span class="term">Create User If Unique</span></dt><dd><p class="simpara">
								This authenticator checks if there is already an existing Red Hat Single Sign-On account with the same email or username like the account from the identity provider. If it’s not, then the authenticator just creates a new local Red Hat Single Sign-On account and links it with the identity provider and the whole flow is finished. Otherwise it goes to the next <code class="literal">Handle Existing Account</code> subflow. If you always want to ensure that there is no duplicated account, you can mark this authenticator as <code class="literal">REQUIRED</code>. In this case, the user will see the error page if there is an existing Red Hat Single Sign-On account and the user will need to link the identity provider account through Account management.
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										This authenticator verifies that there is already a Red Hat Single Sign-On account with the same email or username as the identity provider’s account.
									</li><li class="listitem">
										If an account does not exist, the authenticator creates a local Red Hat Single Sign-On account, links this account with the identity provider, and terminates the flow.
									</li><li class="listitem">
										If an account exists, the authenticator implements the next <code class="literal">Handle Existing Account</code> sub-flow.
									</li><li class="listitem">
										To ensure there is no duplicated account, you can mark this authenticator as <code class="literal">REQUIRED</code>. The user sees the error page if a Red Hat Single Sign-On account exists, and users must link their identity provider account through Account management.
									</li></ul></div></dd><dt><span class="term">Confirm Link Existing Account</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										On the information page, users see a Red Hat Single Sign-On account with the same email. Users can review their profile again and use a different email or username. The flow restarts and goes back to the <code class="literal">Review Profile</code> authenticator.
									</li><li class="listitem">
										Alternatively, users can confirm that they want to link their identity provider account with their existing Red Hat Single Sign-On account.
									</li><li class="listitem">
										Disable this authenticator if you do not want users to see this confirmation page and go straight to linking identity provider account by email verification or re-authentication.
									</li></ul></div></dd><dt><span class="term">Verify Existing Account By Email</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										This authenticator is <code class="literal">ALTERNATIVE</code> by default. Red Hat Single Sign-On uses this authenticator if the realm has an SMTP setup configured.
									</li><li class="listitem">
										The authenticator sends an email to users to confirm that they want to link the identity provider with their Red Hat Single Sign-On account.
									</li><li class="listitem">
										Disable this authenticator if you do not want to confirm linking by email, but want users to reauthenticate with their password.
									</li></ul></div></dd><dt><span class="term">Verify Existing Account By Re-authentication</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Use this authenticator if the email authenticator is not available. For example, you have not configured SMTP for your realm. This authenticator displays a login screen for users to authenticate to link their Red Hat Single Sign-On account with the Identity Provider.
									</li><li class="listitem">
										Users can also re-authenticate with another identity provider already linked to their Red Hat Single Sign-On account.
									</li><li class="listitem">
										You can force users to use OTP. Otherwise, it is optional and used if you have set OTP for the user account.
									</li></ul></div></dd></dl></div></section><section class="section" id="automatically_link_existing_first_login_flow"><div class="titlepage"><div><div><h3 class="title">9.10.2. Automatically link existing first login flow</h3></div></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						The AutoLink authenticator is dangerous in a generic environment where users can register themselves using arbitrary usernames or email addresses. Do not use this authenticator unless you are carefully curating user registration and assigning usernames and email addresses.
					</p></div></div><p>
					To configure a first login flow that links users automatically without prompting, create a new flow with the following two authenticators:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Create User If Unique</span></dt><dd>
								This authenticator ensures Red Hat Single Sign-On handles unique users. Set the authenticator requirement to <span class="strong strong"><strong>Alternative</strong></span>.
							</dd><dt><span class="term">Automatically Set Existing User</span></dt><dd>
								This authenticator sets an existing user to the authentication context without verification. Set the authenticator requirement to "Alternative".
							</dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						This setup is the simplest setup available, but it is possible to use other authenticators. For example: * You can add the Review Profile authenticator to the beginning of the flow if you want end users to confirm their profile information. * You can add authentication mechanisms to this flow, forcing a user to verify their credentials. Adding authentication mechanisms requires a complex flow. For example, you can set the "Automatically Set Existing User" and "Password Form" as "Required" in an "Alternative" sub-flow.
					</p></div></div></section><section class="section" id="disabling_automatic_user_creation"><div class="titlepage"><div><div><h3 class="title">9.10.3. Disabling automatic user creation</h3></div></div></div><p>
					The Default first login flow looks up the Red Hat Single Sign-On account matching the external identity and offers to link them. If no matching Red Hat Single Sign-On account exists, the flow automatically creates one.
				</p><p>
					This default behavior may be unsuitable for some setups. One example is when you use a read-only LDAP user store, where all users are pre-created. In this case, you must switch off automatic user creation.
				</p><p>
					To disable user creation:
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Authentication</strong></span> in the menu.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>First Broker Login</strong></span> from the list.
						</li><li class="listitem">
							Set <span class="strong strong"><strong>Create User If Unique</strong></span> to <span class="strong strong"><strong>DISABLED</strong></span>.
						</li><li class="listitem">
							Set <span class="strong strong"><strong>Confirm Link Existing Account</strong></span> to <span class="strong strong"><strong>DISABLED</strong></span>.
						</li></ol></div><p>
					This configuration also implies that Keycloak itself won’t be able to determine which internal account would correspond to the external identity. Therefore, the <code class="literal">Verify Existing Account By Re-authentication</code> authenticator will ask the user to provide both username and password.
				</p></section><section class="section" id="detect_existing_user_first_loging_flow"><div class="titlepage"><div><div><h3 class="title">9.10.4. Detect existing user first login flow</h3></div></div></div><p>
					In order to configure a first login flow in which:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							only users already registered in this realm can log in,
						</li><li class="listitem">
							users are automatically linked without being prompted,
						</li></ul></div><p>
					create a new flow with the following two authenticators:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Detect Existing Broker User</span></dt><dd>
								This authenticator ensures that unique users are handled. Set the authenticator requirement to <code class="literal">Mandatory</code>.
							</dd><dt><span class="term">Automatically Set Existing User</span></dt><dd>
								Automatically sets an existing user to the authentication context without any verification. Set the authenticator requirement to <code class="literal">Mandatory</code>.
							</dd></dl></div><p>
					You have to set the <code class="literal">First Login Flow</code> of the identity provider configuration to that flow. You could set the also set <code class="literal">Sync Mode</code> to <code class="literal">force</code> if you want to update the user profile (Last Name, First Name…​) with the identity provider attributes.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						This flow can be used if you want to delegate the identity to other identity providers (such as github, facebook …​) but you want to manage which users that can log in.
					</p></div></div><p>
					With this configuration, Red Hat Single Sign-On is unable to determine which internal account corresponds to the external identity. The <span class="strong strong"><strong>Verify Existing Account By Re-authentication</strong></span> authenticator asks the provider for the username and password.
				</p></section></section><section class="section" id="retrieving_external_idp_tokens"><div class="titlepage"><div><div><h2 class="title">9.11. Retrieving external IDP tokens</h2></div></div></div><p>
				With Red Hat Single Sign-On, you can store tokens and responses from the authentication process with the external IDP using the <code class="literal">Store Token</code> configuration option on the IDP’s settings page.
			</p><p>
				Application code can retrieve these tokens and responses to import extra user information or to request the external IDP securely. For example, an application can use the Google token to use other Google services and REST APIs. To retrieve a token for a particular identity provider, send a request as follows:
			</p><pre class="screen">GET /auth/realms/{realm}/broker/{provider_alias}/token HTTP/1.1
Host: localhost:8080
Authorization: Bearer &lt;KEYCLOAK ACCESS TOKEN&gt;</pre><p>
				An application must authenticate with Red Hat Single Sign-On and receive an access token. This access token must have the <code class="literal">broker</code> client-level role <code class="literal">read-token</code> set, so the user must have a role mapping for this role, and the client application must have that role within its scope. In this case, since you are accessing a protected service in Red Hat Single Sign-On, send the access token issued by Red Hat Single Sign-On during the user authentication. You can assign this role to newly imported users in the broker configuration page by setting the <span class="strong strong"><strong>Stored Tokens Readable</strong></span> switch to <span class="strong strong"><strong>ON</strong></span>.
			</p><p>
				These external tokens can be re-established by logging in again through the provider or using the client-initiated account linking API.
			</p></section><section class="section" id="identity_broker_logout"><div class="titlepage"><div><div><h2 class="title">9.12. Identity broker logout</h2></div></div></div><p>
				When logging out, Red Hat Single Sign-On sends a request to the external identity provider that is used to log in initially and logs the user out of this identity provider. You can skip this behavior and avoid logging out of the external identity provider. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_java_adapter_logout">adapter logout documentation</a> for more information.
			</p></section></section><section class="chapter" id="sso_protocols"><div class="titlepage"><div><div><h1 class="title">Chapter 10. SSO protocols</h1></div></div></div><p class="_abstract _abstract">
			This section discusses authentication protocols, the Red Hat Single Sign-On authentication server and how applications, secured by the Red Hat Single Sign-On authentication server, interact with these protocols.
		</p><section class="section" id="con-oidc_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">10.1. OpenID Connect</h2></div></div></div><p class="_abstract _abstract">
				<a class="link" href="https://openid.net/connect/">OpenID Connect</a> (OIDC) is an authentication protocol that is an extension of <a class="link" href="https://datatracker.ietf.org/doc/html/rfc6749">OAuth 2.0</a>.
			</p><p>
				OAuth 2.0 is a framework for building authorization protocols and is incomplete. OIDC, however, is a full authentication and authorization protocol that uses the <a class="link" href="https://jwt.io">Json Web Token</a> (JWT) standards. The JWT standards define an identity token JSON format and methods to digitally sign and encrypt data in a compact and web-friendly way.
			</p><p>
				In general, OIDC implements two use cases. The first case is an application requesting that a Red Hat Single Sign-On server authenticates a user. Upon successful login, the application receives an <span class="emphasis"><em>identity token</em></span> and an <span class="emphasis"><em>access token</em></span>. The <span class="emphasis"><em>identity token</em></span> contains user information including user name, email, and profile information. The realm digitally signs the <span class="emphasis"><em>access token</em></span> which contains access information (such as user role mappings) that applications use to determine the resources users can access in the application.
			</p><p>
				The second use case is a client accessing remote services.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The client requests an <span class="emphasis"><em>access token</em></span> from Red Hat Single Sign-On to invoke on remote services on behalf of the user.
					</li><li class="listitem">
						Red Hat Single Sign-On authenticates the user and asks the user for consent to grant access to the requesting client.
					</li><li class="listitem">
						The client receives the <span class="emphasis"><em>access token</em></span> which is digitally signed by the realm.
					</li><li class="listitem">
						The client makes REST requests on remote services using the <span class="emphasis"><em>access token</em></span>.
					</li><li class="listitem">
						The remote REST service extracts the <span class="emphasis"><em>access token</em></span>.
					</li><li class="listitem">
						The remote REST service verifies the tokens signature.
					</li><li class="listitem">
						The remote REST service decides, based on access information within the token, to process or reject the request.
					</li></ul></div><section class="section" id="con-oidc-auth-flows_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">10.1.1. OIDC auth flows</h3></div></div></div><p class="_abstract _abstract">
					OIDC has several methods, or flows, that clients or applications can use to authenticate users and receive <span class="emphasis"><em>identity</em></span> and <span class="emphasis"><em>access</em></span> tokens. The method depends on the type of application or client requesting access.
				</p><section class="section" id="oidc-auth-flows-authorization"><div class="titlepage"><div><div><h4 class="title">10.1.1.1. Authorization Code Flow</h4></div></div></div><p>
						The Authorization Code Flow is a browser-based protocol and suits authenticating and authorizing browser-based applications. It uses browser redirects to obtain <span class="emphasis"><em>identity</em></span> and <span class="emphasis"><em>access</em></span> tokens.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								A user connects to an application using a browser. The application detects the user is not logged into the application.
							</li><li class="listitem">
								The application redirects the browser to Red Hat Single Sign-On for authentication.
							</li><li class="listitem">
								The application passes a callback URL as a query parameter in the browser redirect. Red Hat Single Sign-On uses the parameter upon successful authentication.
							</li><li class="listitem">
								Red Hat Single Sign-On authenticates the user and creates a one-time, short lived, temporary code.
							</li><li class="listitem">
								Red Hat Single Sign-On redirects to the application using the callback URL and adds the temporary code as a query parameter in the callback URL.
							</li><li class="listitem">
								The application extracts the temporary code and makes a background REST invocation to Red Hat Single Sign-On to exchange the code for an <span class="emphasis"><em>identity</em></span> and <span class="emphasis"><em>access</em></span> and <span class="emphasis"><em>refresh</em></span> token. To prevent replay attacks, the temporary code cannot be used more than once.
							</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							A system is vulnerable to a stolen token for the lifetime of that token. For security and scalability reasons, access tokens are generally set to expire quickly so subsequent token requests fail. If a token expires, an application can obtain a new access token using the additional <span class="emphasis"><em>refresh</em></span> token sent by the login protocol.
						</p></div></div><p id="confidential-clients">
						<span class="emphasis"><em>Confidential</em></span> clients provide client secrets when they exchange the temporary codes for tokens. <span class="emphasis"><em>Public</em></span> clients are not required to provide client secrets. <span class="emphasis"><em>Public</em></span> clients are secure when HTTPS is strictly enforced and redirect URIs registered for the client are strictly controlled. HTML5/JavaScript clients have to be <span class="emphasis"><em>public</em></span> clients because there is no way to securely transmit the client secret to HTML5/JavaScript clients. For more details, see the <a class="link" href="#assembly-managing-clients_server_administration_guide" title="Chapter 12. Managing OpenID Connect and SAML Clients">Managing Clients</a> chapter.
					</p><p>
						Red Hat Single Sign-On also supports the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7636">Proof Key for Code Exchange</a> specification.
					</p></section><section class="section" id="oidc-auth-flows-implicit"><div class="titlepage"><div><div><h4 class="title">10.1.1.2. Implicit Flow</h4></div></div></div><p>
						The Implicit Flow is a browser-based protocol. It is similar to the Authorization Code Flow but with fewer requests and no refresh tokens.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The possibility exists of <span class="emphasis"><em>access</em></span> tokens leaking in the browser history when tokens are transmitted via redirect URIs (see below).
						</p><p>
							Also, this flow does not provide clients with refresh tokens. Therefore, access tokens have to be long-lived or users have to re-authenticate when they expire.
						</p><p>
							We do not advise using this flow. This flow is supported because it is in the OIDC and OAuth 2.0 specification.
						</p></div></div><p>
						The protocol works as follows:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								A user connects to an application using a browser. The application detects the user is not logged into the application.
							</li><li class="listitem">
								The application redirects the browser to Red Hat Single Sign-On for authentication.
							</li><li class="listitem">
								The application passes a callback URL as a query parameter in the browser redirect. Red Hat Single Sign-On uses the query parameter upon successful authentication.
							</li><li class="listitem">
								Red Hat Single Sign-On authenticates the user and creates an <span class="emphasis"><em>identity</em></span> and <span class="emphasis"><em>access</em></span> token. Red Hat Single Sign-On redirects to the application using the callback URL and additionally adds the <span class="emphasis"><em>identity</em></span> and <span class="emphasis"><em>access</em></span> tokens as a query parameter in the callback URL.
							</li><li class="listitem">
								The application extracts the <span class="emphasis"><em>identity</em></span> and <span class="emphasis"><em>access</em></span> tokens from the callback URL.
							</li></ol></div></section><section class="section" id="oidc-auth-flows-direct"><div class="titlepage"><div><div><h4 class="title">10.1.1.3. Resource owner password credentials grant (Direct Access Grants)</h4></div></div></div><p>
						<span class="emphasis"><em>Direct Access Grants</em></span> are used by REST clients to obtain tokens on behalf of users. It is a HTTP POST request that contains:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The credentials of the user. The credentials are sent within form parameters.
							</li><li class="listitem">
								The id of the client.
							</li><li class="listitem">
								The clients secret (if it is a confidential client).
							</li></ul></div><p>
						The HTTP response contains the <span class="emphasis"><em>identity</em></span>, <span class="emphasis"><em>access</em></span>, and <span class="emphasis"><em>refresh</em></span> tokens.
					</p></section><section class="section" id="client_credentials_grant"><div class="titlepage"><div><div><h4 class="title">10.1.1.4. Client credentials grant</h4></div></div></div><p>
						The <span class="emphasis"><em>Client Credentials Grant</em></span> creates a token based on the metadata and permissions of a service account associated with the client instead of obtaining a token that works on behalf of an external user. <span class="emphasis"><em>Client Credentials Grants</em></span> are used by REST clients.
					</p><p>
						See the <a class="link" href="#service_accounts" title="12.1.5. Using a service account">Service Accounts</a> chapter for more information.
					</p></section><section class="section" id="device_authorization_grant"><div class="titlepage"><div><div><h4 class="title">10.1.1.5. Device authorization grant</h4></div></div></div><p>
						This is used by clients running on internet-connected devices that have limited input capabilities or lack a suitable browser. Here’s a brief summary of the protocol:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								The application requests Red Hat Single Sign-On a device code and a user code. Red Hat Single Sign-On creates a device code and a user code. Red Hat Single Sign-On returns a response including the device code and the user code to the application.
							</li><li class="listitem">
								The application provides the user with the user code and the verification URI. The user accesses a verification URI to be authenticated by using another browser.
							</li><li class="listitem">
								The application repeatedly polls Red Hat Single Sign-On to find out if the user completed the user authorization. If user authentication is complete, the application exchanges the device code for an <span class="emphasis"><em>identity</em></span>, <span class="emphasis"><em>access</em></span> and <span class="emphasis"><em>refresh</em></span> token.
							</li></ol></div></section><section class="section" id="client_initiated_backchannel_authentication_grant"><div class="titlepage"><div><div><h4 class="title">10.1.1.6. Client initiated backchannel authentication grant</h4></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Client Initiated Backchannel Authentication Grant is <span class="strong strong"><strong>Technology Preview</strong></span> and is not fully supported. This feature is disabled by default.
						</p><p>
							To enable start the server with <code class="literal">-Dkeycloak.profile=preview</code> or <code class="literal">-Dkeycloak.profile.feature.ciba=enabled</code> . For more details see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#profiles">Profiles</a>.
						</p></div></div><p>
						This is used by clients who want to initiate the authentication flow by communicating with the OpenID Provider directly without redirect through the user’s browser like OAuth 2.0’s authorization code grant. Here’s a brief summary of the protocol:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								The client requests Red Hat Single Sign-On an auth_req_id that identifies the authentication request made by the client. Red Hat Single Sign-On creates the auth_req_id.
							</li><li class="listitem">
								After receiving this auth_req_id, this client repeatedly needs to poll Red Hat Single Sign-On to obtain an Access Token, Refresh Token and ID Token from Red Hat Single Sign-On in return for the auth_req_id until the user is authenticated.
							</li></ol></div><p>
						An administrator can configure Client Initiated Backchannel Authentication (CIBA) related operations as <code class="literal">CIBA Policy</code> per realm.
					</p><p>
						Also please refer to other places of Red Hat Single Sign-On documentation like <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_backchannel_authentication_endpoint">Backchannel Authentication Endpoint section</a> of Securing Applications and Services Guide and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_client_initiated_backchannel_authentication_grant">Client Initiated Backchannel Authentication Grant section</a> of Securing Applications and Services Guide.
					</p><section class="section" id="ciba_policy"><div class="titlepage"><div><div><h5 class="title">10.1.1.6.1. CIBA Policy</h5></div></div></div><p>
							An administrator carries out the following operations on the <code class="literal">Admin Console</code> :
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Open the <code class="literal">Authentication → CIBA Policy</code> tab.
								</li><li class="listitem">
									Configure items and click <code class="literal">Save</code>.
								</li></ul></div><p>
							The configurable items and their description follow.
						</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556178729248" scope="col">Configuration</th><th align="left" valign="top" id="idm140556178728160" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556178729248">
										<p>
											Backchannel Token Delivery Mode
										</p>
										</td><td align="left" valign="top" headers="idm140556178728160">
										<p>
											Specifying how the CD (Consumption Device) gets the authentication result and related tokens. There are three modes, "poll", "ping" and "push". Red Hat Single Sign-On only supports "poll". The default setting is "poll". This configuration is required. For more details, see <a class="link" href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.5">CIBA Specification</a>.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556178729248">
										<p>
											Expires In
										</p>
										</td><td align="left" valign="top" headers="idm140556178728160">
										<p>
											The expiration time of the "auth_req_id" in seconds since the authentication request was received. The default setting is 120. This configuration is required. For more details, see <a class="link" href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#successful_authentication_request_acknowdlegment">CIBA Specification</a>.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556178729248">
										<p>
											Interval
										</p>
										</td><td align="left" valign="top" headers="idm140556178728160">
										<p>
											The interval in seconds the CD (Consumption Device) needs to wait for between polling requests to the token endpoint. The default setting is 5. This configuration is optional. For more details, see <a class="link" href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#successful_authentication_request_acknowdlegment">CIBA Specification</a>.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556178729248">
										<p>
											Authentication Requested User Hint
										</p>
										</td><td align="left" valign="top" headers="idm140556178728160">
										<p>
											The way of identifying the end-user for whom authentication is being requested. The default setting is "login_hint". There are three modes, "login_hint", "login_hint_token" and "id_token_hint". Red Hat Single Sign-On only supports "login_hint". This configuration is required. For more details, see <a class="link" href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.7.1">CIBA Specification</a>.
										</p>
										</td></tr></tbody></table></div></section><section class="section" id="provider_setting"><div class="titlepage"><div><div><h5 class="title">10.1.1.6.2. Provider Setting</h5></div></div></div><p>
							The CIBA grant uses the following two providers.
						</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
									Authentication Channel Provider : provides the communication between Red Hat Single Sign-On and the entity that actually authenticates the user via AD (Authentication Device).
								</li><li class="listitem">
									User Resolver Provider : get <code class="literal">UserModel</code> of Red Hat Single Sign-On from the information provided by the client to identify the user.
								</li></ol></div><p>
							Red Hat Single Sign-On has both default providers. However, the administrator needs to set up Authentication Channel Provider like this:
						</p><pre class="programlisting language-xml">&lt;spi name="ciba-auth-channel"&gt;
    &lt;default-provider&gt;ciba-http-auth-channel&lt;/default-provider&gt;
    &lt;provider name="ciba-http-auth-channel" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="httpAuthenticationChannelUri" value="https://backend.internal.example.com/auth"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
							The configurable items and their description follow.
						</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182610208" scope="col">Configuration</th><th align="left" valign="top" id="idm140556182609120" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182610208">
										<p>
											httpAuthenticationChannelUri
										</p>
										</td><td align="left" valign="top" headers="idm140556182609120">
										<p>
											Specifying URI of the entity that actually authenticates the user via AD (Authentication Device).
										</p>
										</td></tr></tbody></table></div></section><section class="section" id="authentication_channel_provider"><div class="titlepage"><div><div><h5 class="title">10.1.1.6.3. Authentication Channel Provider</h5></div></div></div><p>
							CIBA standard document does not specify how to authenticate the user by AD. Therefore, it might be implemented at the discretion of products. Red Hat Single Sign-On delegates this authentication to an external authentication entity. To communicate with the authentication entity, Red Hat Single Sign-On provides Authentication Channel Provider.
						</p><p>
							Its implementation of Red Hat Single Sign-On assumes that the authentication entity is under the control of the administrator of Red Hat Single Sign-On so that Red Hat Single Sign-On trusts the authentication entity. It is not recommended to use the authentication entity that the administrator of Red Hat Single Sign-On cannot control.
						</p><p>
							Authentication Channel Provider is provided as SPI provider so that users of Red Hat Single Sign-On can implement their own provider in order to meet their environment. Red Hat Single Sign-On provides its default provider called HTTP Authentication Channel Provider that uses HTTP to communicate with the authentication entity.
						</p><p>
							If a user of Red Hat Single Sign-On user want to use the HTTP Authentication Channel Provider, they need to know its contract between Red Hat Single Sign-On and the authentication entity consisting of the following two parts.
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication Delegation Request/Response</span></dt><dd>
										Red Hat Single Sign-On sends an authentication request to the authentication entity.
									</dd><dt><span class="term">Authentication Result Notification/ACK</span></dt><dd>
										The authentication entity notifies the result of the authentication to Red Hat Single Sign-On.
									</dd></dl></div><p>
							Authentication Delegation Request/Response consists of the following messaging.
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication Delegation Request</span></dt><dd>
										The request is sent from Red Hat Single Sign-On to the authentication entity to ask it for user authentication by AD.
									</dd></dl></div><pre class="screen">POST [delegation_reception]</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Headers
								</li></ul></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182583344" scope="col">Name</th><th align="left" valign="top" id="idm140556182582256" scope="col">Value</th><th align="left" valign="top" id="idm140556182581168" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182583344">
										<p>
											Content-Type
										</p>
										</td><td align="left" valign="top" headers="idm140556182582256">
										<p>
											application/json
										</p>
										</td><td align="left" valign="top" headers="idm140556182581168">
										<p>
											The message body is json formatted.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556182583344">
										<p>
											Authorization
										</p>
										</td><td align="left" valign="top" headers="idm140556182582256">
										<p>
											Bearer [token]
										</p>
										</td><td align="left" valign="top" headers="idm140556182581168">
										<p>
											The [token] is used when the authentication entity notifies the result of the authentication to Red Hat Single Sign-On.
										</p>
										</td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Parameters
								</li></ul></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182561616" scope="col">Type</th><th align="left" valign="top" id="idm140556182560528" scope="col">Name</th><th align="left" valign="top" id="idm140556182559440" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182561616">
										<p>
											Path
										</p>
										</td><td align="left" valign="top" headers="idm140556182560528">
										<p>
											delegation_reception
										</p>
										</td><td align="left" valign="top" headers="idm140556182559440">
										<p>
											The endpoint provided by the authentication entity to receive the delegation request
										</p>
										</td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Body
								</li></ul></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182546112" scope="col">Name</th><th align="left" valign="top" id="idm140556182545024" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182546112">
										<p>
											login_hint
										</p>
										</td><td align="left" valign="top" headers="idm140556182545024">
										<p>
											It tells the authentication entity who is authenticated by AD.<br/> By default, it is the user’s "username".<br/> This field is required and was defined by CIBA standard document.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556182546112">
										<p>
											scope
										</p>
										</td><td align="left" valign="top" headers="idm140556182545024">
										<p>
											It tells which scopes the authentication entity gets consent from the authenticated user.<br/> This field is required and was defined by CIBA standard document.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556182546112">
										<p>
											is_consent_required
										</p>
										</td><td align="left" valign="top" headers="idm140556182545024">
										<p>
											It shows whether the authentication entity needs to get consent from the authenticated user about the scope.<br/> This field is required.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556182546112">
										<p>
											binding_message
										</p>
										</td><td align="left" valign="top" headers="idm140556182545024">
										<p>
											Its value is intended to be shown in both CD and AD’s UI to make the user recognize that the authentication by AD is triggered by CD.<br/> This field is optional and was defined by CIBA standard document.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556182546112">
										<p>
											acr_values
										</p>
										</td><td align="left" valign="top" headers="idm140556182545024">
										<p>
											It tells the requesting Authentication Context Class Reference from CD.<br/> This field is optional and was defined by CIBA standard document.
										</p>
										</td></tr></tbody></table></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication Delegation Response</span></dt><dd><p class="simpara">
										The response is returned from the authentication entity to Red Hat Single Sign-On to notify that the authentication entity received the authentication request from Red Hat Single Sign-On.
									</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
												Responses
											</li></ul></div></dd></dl></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182513184" scope="col">HTTP Status Code</th><th align="left" valign="top" id="idm140556182512096" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182513184">
										<p>
											201
										</p>
										</td><td align="left" valign="top" headers="idm140556182512096">
										<p>
											It notifies Red Hat Single Sign-On of receiving the authentication delegation request.
										</p>
										</td></tr></tbody></table></div><p>
							Authentication Result Notification/ACK consists of the following messaging.
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication Result Notification</span></dt><dd>
										The authentication entity sends the result of the authentication request to Red Hat Single Sign-On.
									</dd></dl></div><pre class="screen">POST /auth/realms/[realm]/protocol/openid-connect/ext/ciba/auth/callback</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Headers
								</li></ul></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182495792" scope="col">Name</th><th align="left" valign="top" id="idm140556182494704" scope="col">Value</th><th align="left" valign="top" id="idm140556182493616" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182495792">
										<p>
											Content-Type
										</p>
										</td><td align="left" valign="top" headers="idm140556182494704">
										<p>
											application/json
										</p>
										</td><td align="left" valign="top" headers="idm140556182493616">
										<p>
											The message body is json formatted.
										</p>
										</td></tr><tr><td align="left" valign="top" headers="idm140556182495792">
										<p>
											Authorization
										</p>
										</td><td align="left" valign="top" headers="idm140556182494704">
										<p>
											Bearer [token]
										</p>
										</td><td align="left" valign="top" headers="idm140556182493616">
										<p>
											The [token] must be the one the authentication entity has received from Red Hat Single Sign-On in Authentication Delegation Request.
										</p>
										</td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Parameters
								</li></ul></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182474048" scope="col">Type</th><th align="left" valign="top" id="idm140556182472960" scope="col">Name</th><th align="left" valign="top" id="idm140556182471872" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182474048">
										<p>
											Path
										</p>
										</td><td align="left" valign="top" headers="idm140556182472960">
										<p>
											realm
										</p>
										</td><td align="left" valign="top" headers="idm140556182471872">
										<p>
											The realm name
										</p>
										</td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Body
								</li></ul></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182458640" scope="col">Name</th><th align="left" valign="top" id="idm140556182457552" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182458640">
										<p>
											status
										</p>
										</td><td align="left" valign="top" headers="idm140556182457552">
										<p>
											It tells the result of user authentication by AD.<br/> It must be one of the following status.<br/> SUCCEED : The authentication by AD has been successfully completed.<br/> UNAUTHORIZED : The authentication by AD has not been completed.<br/> CANCELLED : The authentication by AD has been cancelled by the user.
										</p>
										</td></tr></tbody></table></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication Result ACK</span></dt><dd><p class="simpara">
										The response is returned from Red Hat Single Sign-On to the authentication entity to notify Red Hat Single Sign-On received the result of user authentication by AD from the authentication entity.
									</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
												Responses
											</li></ul></div></dd></dl></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556182441632" scope="col">HTTP Status Code</th><th align="left" valign="top" id="idm140556182440544" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556182441632">
										<p>
											200
										</p>
										</td><td align="left" valign="top" headers="idm140556182440544">
										<p>
											It notifies the authentication entity of receiving the notification of the authentication result.
										</p>
										</td></tr></tbody></table></div></section><section class="section" id="user_resolver_provider"><div class="titlepage"><div><div><h5 class="title">10.1.1.6.4. User Resolver Provider</h5></div></div></div><p>
							Even if the same user, its representation may differ in each CD, Red Hat Single Sign-On and the authentication entity.
						</p><p>
							For CD, Red Hat Single Sign-On and the authentication entity to recognize the same user, this User Resolver Provider converts their own user representations among them.
						</p><p>
							User Resolver Provider is provided as SPI provider so that users of Red Hat Single Sign-On can implement their own provider in order to meet their environment. Red Hat Single Sign-On provides its default provider called Default User Resolver Provider that has the following characteristics.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Only support <code class="literal">login_hint</code> parameter and is used as default.
								</li><li class="listitem">
									<code class="literal">username</code> of UserModel in Red Hat Single Sign-On is used to represent the user on CD, Red Hat Single Sign-On and the authentication entity.
								</li></ul></div></section></section></section><section class="section" id="oidc-logout"><div class="titlepage"><div><div><h3 class="title">10.1.2. OIDC Logout</h3></div></div></div><p>
					OIDC has three different specifications relevant to logout mechanisms, all of these are currently in draft status:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							<a class="link" href="https://openid.net/specs/openid-connect-session-1_0.html">Session Management</a>
						</li><li class="listitem">
							<a class="link" href="https://openid.net/specs/openid-connect-frontchannel-1_0.html">Front-Channel Logout</a>
						</li><li class="listitem">
							<a class="link" href="https://openid.net/specs/openid-connect-backchannel-1_0.html">Back-Channel Logout</a>
						</li></ol></div><p>
					Again since all of this is described in the OIDC specification we will only give a brief overview here.
				</p><section class="section" id="session_management"><div class="titlepage"><div><div><h4 class="title">10.1.2.1. Session Management</h4></div></div></div><p>
						This is a browser-based logout. The application obtains session status information from Red Hat Single Sign-On at a regular basis. When the session is terminated at Red Hat Single Sign-On the application will notice and trigger it’s own logout.
					</p></section><section class="section" id="frontchannel_logout"><div class="titlepage"><div><div><h4 class="title">10.1.2.2. Frontchannel Logout</h4></div></div></div><p>
						This is also a browser-based logout where the logout starts by redirecting the user to a specific endpoint at Red Hat Single Sign-On.
					</p><p>
						Once the user is redirected to the logout endpoint, Red Hat Single Sign-On is going to send logout requests to clients to let them to invalidate their local user sessions, and potentially redirect the user to some URL once the logout process is finished.
					</p><p>
						Depending on the client configuration, logout requests can be sent to clients through the front-channel or through the back-channel.
					</p><p>
						To configure clients to receive logout requests through the front-channel, look at the <a class="link" href="#front-channel-logout">Front-Channel Logout</a> client setting. When using this method, consider the following:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Logout requests sent by Red Hat Single Sign-On to clients rely on the browser and on embedded <code class="literal">iframes</code> that are rendered for the logout page.
							</li><li class="listitem">
								By being based on <code class="literal">iframes</code>, front-channel logout might be impacted by Content Security Policies (CSP) and logout requests might be blocked.
							</li><li class="listitem">
								If the user closes the browser prior to rendering the logout page or before logout requests are actually sent to clients, their sessions at the client might not be invalidated.
							</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Consider using Back-Channel Logout as it provides a more reliable and secure approach to log out users and terminate their sessions on the clients.
						</p></div></div><p>
						If the client is not enabled with front-channel logout, then Red Hat Single Sign-On is going to try first to send logout requests through the back-channel using the <a class="link" href="#back-channel-logout-url">Back-Channel Logout URL</a>. If not defined, the server is going to fall back to using the <a class="link" href="#admin-url">Admin URL</a>.
					</p></section><section class="section" id="backchannel_logout"><div class="titlepage"><div><div><h4 class="title">10.1.2.3. Backchannel Logout</h4></div></div></div><p>
						This is a non browser-based logout that uses direct backchannel communication between Red Hat Single Sign-On and clients. Red Hat Single Sign-On sends a HTTP POST request containing a logout token to all clients logged into Red Hat Single Sign-On. These requests are sent to a registered backchannel logout URLs at Red Hat Single Sign-On and are supposed to trigger a logout at client side.
					</p></section></section><section class="section" id="con-server-oidc-uri-endpoints_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">10.1.3. Red Hat Single Sign-On server OIDC URI endpoints</h3></div></div></div><p class="_abstract _abstract">
					The following is a list of OIDC endpoints that Red Hat Single Sign-On publishes. These endpoints can be used when a non-Red Hat Single Sign-On client adapter uses OIDC to communicate with the authentication server. They are all relative URLs. The root of the URL consists of the HTTP(S) protocol, hostname, and the path, which is usually prefixed with <span class="emphasis"><em>/auth</em></span>: For example
				</p><pre class="screen">https://localhost:8080/auth</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/auth</span></dt><dd>
								Used for obtaining a temporary code in the Authorization Code Flow or obtaining tokens using the Implicit Flow, Direct Grants, or Client Grants.
							</dd><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/token</span></dt><dd>
								Used by the Authorization Code Flow to convert a temporary code into a token.
							</dd><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/logout</span></dt><dd>
								Used for performing logouts.
							</dd><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/userinfo</span></dt><dd>
								Used for the User Info service described in the OIDC specification.
							</dd><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/revoke</span></dt><dd>
								Used for OAuth 2.0 Token Revocation described in <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7009">RFC7009</a>.
							</dd><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/certs</span></dt><dd>
								Used for the JSON Web Key Set (JWKS) containing the public keys used to verify any JSON Web Token (jwks_uri)
							</dd><dt><span class="term">/realms/{realm-name}/protocol/openid-connect/auth/device</span></dt><dd>
								Used for Device Authorization Grant to obtain a device code and a user code.
							</dd></dl></div><p>
					In all of these, replace {realm-name} with the name of the realm.
				</p></section></section><section class="section" id="saml"><div class="titlepage"><div><div><h2 class="title">10.2. SAML</h2></div></div></div><p class="_abstract _abstract">
				<a class="link" href="http://saml.xml.org/saml-specifications">SAML 2.0</a> is a similar specification to OIDC but more mature. It is descended from SOAP and web service messaging specifications so is generally more verbose than OIDC. SAML 2.0 is an authentication protocol that exchanges XML documents between authentication servers and applications. XML signatures and encryption are used to verify requests and responses.
			</p><p>
				In general, SAML implements two use cases.
			</p><p>
				The first use case is an application that requests the Red Hat Single Sign-On server authenticates a user. Upon successful login, the application will receive an XML document. This document contains an SAML assertion that specifies user attributes. The realm digitally signs the the document which contains access information (such as user role mappings) that applications use to determine the resources users are allowed to access in the application.
			</p><p>
				The second use case is a client accessing remote services. The client requests a SAML assertion from Red Hat Single Sign-On to invoke on remote services on behalf of the user.
			</p><section class="section" id="con-saml-bindings_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">10.2.1. SAML bindings</h3></div></div></div><p class="_abstract _abstract">
					Red Hat Single Sign-On supports three binding types.
				</p><section class="section" id="redirect_binding"><div class="titlepage"><div><div><h4 class="title">10.2.1.1. Redirect binding</h4></div></div></div><p>
						<span class="emphasis"><em>Redirect</em></span> binding uses a series of browser redirect URIs to exchange information.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								A user connects to an application using a browser. The application detects the user is not authenticated.
							</li><li class="listitem">
								The application generates an XML authentication request document and encodes it as a query parameter in a URI. The URI is used to redirect to the Red Hat Single Sign-On server. Depending on your settings, the application can also digitally sign the XML document and include the signature as a query parameter in the redirect URI to Red Hat Single Sign-On. This signature is used to validate the client that sends the request.
							</li><li class="listitem">
								The browser redirects to Red Hat Single Sign-On.
							</li><li class="listitem">
								The server extracts the XML auth request document and verifies the digital signature, if required.
							</li><li class="listitem">
								The user enters their authentication credentials.
							</li><li class="listitem">
								After authentication, the server generates an XML authentication response document. The document contains a SAML assertion that holds metadata about the user, including name, address, email, and any role mappings the user has. The document is usually digitally signed using XML signatures, and may also be encrypted.
							</li><li class="listitem">
								The XML authentication response document is encoded as a query parameter in a redirect URI. The URI brings the browser back to the application. The digital signature is also included as a query parameter.
							</li><li class="listitem">
								The application receives the redirect URI and extracts the XML document.
							</li><li class="listitem">
								The application verifies the realm’s signature to ensure it is receiving a valid authentication response. The information inside the SAML assertion is used to make access decisions or display user data.
							</li></ol></div></section><section class="section" id="post_binding"><div class="titlepage"><div><div><h4 class="title">10.2.1.2. POST binding</h4></div></div></div><p>
						<span class="emphasis"><em>POST</em></span> binding is similar to <span class="emphasis"><em>Redirect</em></span> binding but <span class="emphasis"><em>POST</em></span> binding exchanges XML documents using POST requests instead of using GET requests. <span class="emphasis"><em>POST</em></span> Binding uses JavaScript to make the browser send a POST request to the Red Hat Single Sign-On server or application when exchanging documents. HTTP responds with an HTML document which contains an HTML form containing embedded JavaScript. When the page loads, the JavaScript automatically invokes the form.
					</p><p>
						<span class="emphasis"><em>POST</em></span> binding is recommended due to two restrictions:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Security</strong></span> — With <span class="emphasis"><em>Redirect</em></span> binding, the SAML response is part of the URL. It is less secure as it is possible to capture the response in logs.
							</li><li class="listitem">
								<span class="strong strong"><strong>Size</strong></span> — Sending the document in the HTTP payload provides more scope for large amounts of data than in a limited URL.
							</li></ul></div></section><section class="section" id="ecp"><div class="titlepage"><div><div><h4 class="title">10.2.1.3. ECP</h4></div></div></div><p>
						Enhanced Client or Proxy (ECP) is a SAML v.2.0 profile which allows the exchange of SAML attributes outside the context of a web browser. It is often used by REST or SOAP-based clients.
					</p></section></section><section class="section" id="red_hat_single_sign_on_server_saml_uri_endpoints"><div class="titlepage"><div><div><h3 class="title">10.2.2. Red Hat Single Sign-On Server SAML URI Endpoints</h3></div></div></div><p>
					Red Hat Single Sign-On has one endpoint for all SAML requests.
				</p><p>
					<code class="literal">http(s)://authserver.host/auth/realms/{realm-name}/protocol/saml</code>
				</p><p>
					All bindings use this endpoint.
				</p></section></section><section class="section" id="ref-saml-vs-oidc_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">10.3. OpenID Connect compared to SAML</h2></div></div></div><p class="_abstract _abstract">
				The following lists a number of factors to consider when choosing a protocol.
			</p><p>
				For most purposes, Red Hat Single Sign-On recommends using OIDC.
			</p><p>
				<span class="strong strong"><strong>OIDC</strong></span>
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						OIDC is specifically designed to work with the web.
					</li><li class="listitem">
						OIDC is suited for HTML5/JavaScript applications because it is easier to implement on the client side than SAML.
					</li><li class="listitem">
						OIDC tokens are in the JSON format which makes them easier for Javascript to consume.
					</li><li class="listitem">
						OIDC has features to make security implementation easier. For example, see the <a class="link" href="https://openid.net/specs/openid-connect-session-1_0.html#ChangeNotification">iframe trick</a> that the specification uses to determine a users login status.
					</li></ul></div><p>
				<span class="strong strong"><strong>SAML</strong></span>
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						SAML is designed as a layer to work on top of the web.
					</li><li class="listitem">
						SAML can be more verbose than OIDC.
					</li><li class="listitem">
						Users pick SAML over OIDC because there is a perception that it is mature.
					</li><li class="listitem">
						Users pick SAML over OIDC existing applications that are secured with it.
					</li></ul></div></section><section class="section" id="docker"><div class="titlepage"><div><div><h2 class="title">10.4. Docker registry v2 authentication</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Docker authentication is disabled by default. To enable docker authentication, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#profiles">Profiles</a>.
				</p></div></div><p class="_abstract _abstract">
				<a class="link" href="https://docs.docker.com/registry/spec/auth/">Docker Registry V2 Authentication</a> is a protocol, similar to OIDC, that authenticates users against Docker registries. Red Hat Single Sign-On’s implementation of this protocol lets Docker clients use a Red Hat Single Sign-On authentication server authenticate against a registry. This protocol uses standard token and signature mechanisms but it does deviate from a true OIDC implementation. It deviates by using a very specific JSON format for requests and responses as well as mapping repository names and permissions to the OAuth scope mechanism.
			</p><section class="section" id="docker_authentication_flow"><div class="titlepage"><div><div><h3 class="title">10.4.1. Docker authentication flow</h3></div></div></div><p>
					The authentication flow is described in the <a class="link" href="https://docs.docker.com/registry/spec/auth/token/">Docker API documentation</a>. The following is a summary from the perspective of the Red Hat Single Sign-On authentication server:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Perform a <code class="literal">docker login</code>.
						</li><li class="listitem">
							The Docker client requests a resource from the Docker registry. If the resource is protected and no authentication token is in the request, the Docker registry server responds with a 401 HTTP message with some information on the permissions that are required and the location of the authorization server.
						</li><li class="listitem">
							The Docker client constructs an authentication request based on the 401 HTTP message from the Docker registry. The client uses the locally cached credentials (from the <code class="literal">docker login</code> command) as part of the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc2617">HTTP Basic Authentication</a> request to the Red Hat Single Sign-On authentication server.
						</li><li class="listitem">
							The Red Hat Single Sign-On authentication server attempts to authenticate the user and return a JSON body containing an OAuth-style Bearer token.
						</li><li class="listitem">
							The Docker client receives a bearer token from the JSON response and uses it in the authorization header to request the protected resource.
						</li><li class="listitem">
							The Docker registry receives the new request for the protected resource with the token from the Red Hat Single Sign-On server. The registry validates the token and grants access to the requested resource (if appropriate).
						</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Red Hat Single Sign-On does not create a browser SSO session after successful authentication with the Docker protocol. The browser SSO session does not use the Docker protocol as it cannot refresh tokens or obtain the status of a token or session from the Red Hat Single Sign-On server; therefore a browser SSO session is not necessary. For more details, see the <a class="link" href="#transient-session" title="6.5. Transient sessions">transient session</a> section.
					</p></div></div></section><section class="section" id="red_hat_single_sign_on_docker_registry_v2_authentication_server_uri_endpoints"><div class="titlepage"><div><div><h3 class="title">10.4.2. Red Hat Single Sign-On Docker Registry v2 Authentication Server URI Endpoints</h3></div></div></div><p>
					Red Hat Single Sign-On has one endpoint for all Docker auth v2 requests.
				</p><p>
					<code class="literal">http(s)://authserver.host/auth/realms/{realm-name}/protocol/docker-v2</code>
				</p></section></section></section><section class="chapter" id="admin_permissions"><div class="titlepage"><div><div><h1 class="title">Chapter 11. Controlling access to the Admin Console</h1></div></div></div><p>
			Each realm created on the Red Hat Single Sign-On has a dedicated Admin Console from which that realm can be managed. The <code class="literal">master</code> realm is a special realm that allows admins to manage more than one realm on the system. You can also define fine-grained access to users in different realms to manage the server. This chapter goes over all the scenarios for this.
		</p><section class="section" id="master_realm_access_control"><div class="titlepage"><div><div><h2 class="title">11.1. Master realm access control</h2></div></div></div><p>
				The <code class="literal">master</code> realm in Red Hat Single Sign-On is a special realm and treated differently than other realms. Users in the Red Hat Single Sign-On <code class="literal">master</code> realm can be granted permission to manage zero or more realms that are deployed on the Red Hat Single Sign-On server. When a realm is created, Red Hat Single Sign-On automatically creates various roles that grant fine-grain permissions to access that new realm. Access to The Admin Console and Admin REST endpoints can be controlled by mapping these roles to users in the <code class="literal">master</code> realm. It’s possible to create multiple super users, as well as users that can only manage specific realms.
			</p><section class="section" id="global_roles"><div class="titlepage"><div><div><h3 class="title">11.1.1. Global roles</h3></div></div></div><p>
					There are two realm-level roles in the <code class="literal">master</code> realm. These are:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							admin
						</li><li class="listitem">
							create-realm
						</li></ul></div><p>
					Users with the <code class="literal">admin</code> role are super users and have full access to manage any realm on the server. Users with the <code class="literal">create-realm</code> role are allowed to create new realms. They will be granted full access to any new realm they create.
				</p></section><section class="section" id="realm_specific_roles"><div class="titlepage"><div><div><h3 class="title">11.1.2. Realm specific roles</h3></div></div></div><p>
					Admin users within the <code class="literal">master</code> realm can be granted management privileges to one or more other realms in the system. Each realm in Red Hat Single Sign-On is represented by a client in the <code class="literal">master</code> realm. The name of the client is <code class="literal">&lt;realm name&gt;-realm</code>. These clients each have client-level roles defined which define varying level of access to manage an individual realm.
				</p><p>
					The roles available are:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							view-realm
						</li><li class="listitem">
							view-users
						</li><li class="listitem">
							view-clients
						</li><li class="listitem">
							view-events
						</li><li class="listitem">
							manage-realm
						</li><li class="listitem">
							manage-users
						</li><li class="listitem">
							create-client
						</li><li class="listitem">
							manage-clients
						</li><li class="listitem">
							manage-events
						</li><li class="listitem">
							view-identity-providers
						</li><li class="listitem">
							manage-identity-providers
						</li><li class="listitem">
							impersonation
						</li></ul></div><p>
					Assign the roles you want to your users and they will only be able to use that specific part of the administration console.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Admins with the <code class="literal">manage-users</code> role will only be able to assign admin roles to users that they themselves have. So, if an admin has the <code class="literal">manage-users</code> role but doesn’t have the <code class="literal">manage-realm</code> role, they will not be able to assign this role.
					</p></div></div></section></section><section class="section" id="per_realm_admin_permissions"><div class="titlepage"><div><div><h2 class="title">11.2. Dedicated realm admin consoles</h2></div></div></div><p>
				Each realm has a dedicated Admin Console that can be accessed by going to the url <code class="literal">/auth/admin/{realm-name}/console</code>. Users within that realm can be granted realm management permissions by assigning specific user role mappings.
			</p><p>
				Each realm has a built-in client called <code class="literal">realm-management</code>. You can view this client by going to the <code class="literal">Clients</code> left menu item of your realm. This client defines client-level roles that specify permissions that can be granted to manage the realm.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						view-realm
					</li><li class="listitem">
						view-users
					</li><li class="listitem">
						view-clients
					</li><li class="listitem">
						view-events
					</li><li class="listitem">
						manage-realm
					</li><li class="listitem">
						manage-users
					</li><li class="listitem">
						create-client
					</li><li class="listitem">
						manage-clients
					</li><li class="listitem">
						manage-events
					</li><li class="listitem">
						view-identity-providers
					</li><li class="listitem">
						manage-identity-providers
					</li><li class="listitem">
						impersonation
					</li></ul></div><p>
				Assign the roles you want to your users and they will only be able to use that specific part of the administration console.
			</p></section><section class="section" id="fine_grain_permissions"><div class="titlepage"><div><div><h2 class="title">11.3. Fine grain admin permissions</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Fine Grain Admin Permissions is <span class="strong strong"><strong>Technology Preview</strong></span> and is not fully supported. This feature is disabled by default.
				</p><p>
					To enable start the server with <code class="literal">-Dkeycloak.profile=preview</code> or <code class="literal">-Dkeycloak.profile.feature.admin_fine_grained_authz=enabled</code> . For more details see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#profiles">Profiles</a>.
				</p></div></div><p>
				Sometimes roles like <code class="literal">manage-realm</code> or <code class="literal">manage-users</code> are too coarse grain and you want to create restricted admin accounts that have more fine grain permissions. Red Hat Single Sign-On allows you to define and assign restricted access policies for managing a realm. Things like:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Managing one specific client
					</li><li class="listitem">
						Managing users that belong to a specific group
					</li><li class="listitem">
						Managing membership of a group
					</li><li class="listitem">
						Limited user management.
					</li><li class="listitem">
						Fine grain impersonation control
					</li><li class="listitem">
						Being able to assign a specific restricted set of roles to users.
					</li><li class="listitem">
						Being able to assign a specific restricted set of roles to a composite role.
					</li><li class="listitem">
						Being able to assign a specific restricted set of roles to a client’s scope.
					</li><li class="listitem">
						New general policies for viewing and managing users, groups, roles, and clients.
					</li></ul></div><p>
				There are some important things to note about fine grain admin permissions:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Fine grain admin permissions were implemented on top of <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/authorization_services_guide/">Authorization Services</a>. It is highly recommended that you read up on those features before diving into fine grain permissions.
					</li><li class="listitem">
						Fine grain permissions are only available within <a class="link" href="#per_realm_admin_permissions" title="11.2. Dedicated realm admin consoles">dedicated admin consoles</a> and admins defined within those realms. You cannot define cross-realm fine grain permissions.
					</li><li class="listitem">
						Fine grain permissions are used to grant additional permissions. You cannot override the default behavior of the built in admin roles.
					</li></ul></div><section class="section" id="managing_one_specific_client"><div class="titlepage"><div><div><h3 class="title">11.3.1. Managing one specific client</h3></div></div></div><p>
					Let’s look first at allowing an admin to manage one client and one client only. In our example, we have a realm called <code class="literal">test</code> and a client called <code class="literal">sales-application</code>. In the realm <code class="literal">test</code> we will give a user in that realm permission to only manage that application.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						You cannot do cross realm fine grain permissions. Admins in the <code class="literal">master</code> realm are limited to the predefined admin roles defined in previous chapters.
					</p></div></div><section class="section" id="permission_setup"><div class="titlepage"><div><div><h4 class="title">11.3.1.1. Permission setup</h4></div></div></div><p>
						The first thing we must do is login to the Admin Console so we can set up permissions for that client. We navigate to the management section of the client, we want to define fine-grain permissions for.
					</p><div class="formalpara"><p class="title"><strong>Client management</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client.png" alt="fine grain client"/></span>
						</p></div><p>
						You should see a tab menu item called <code class="literal">Permissions</code>. Click on that tab.
					</p><div class="formalpara"><p class="title"><strong>Client permissions tab</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client-permissions-tab-off.png" alt="fine grain client permissions tab off"/></span>
						</p></div><p>
						By default, each client is not enabled to do fine grain permissions. So turn the <code class="literal">Permissions Enabled</code> switch to on to initialize permissions.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							If you turn the <code class="literal">Permissions Enabled</code> switch to off, it will delete any and all permissions you have defined for this client.
						</p></div></div><div class="formalpara"><p class="title"><strong>Client permissions tab</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client-permissions-tab-on.png" alt="fine grain client permissions tab on"/></span>
						</p></div><p>
						When you switch <code class="literal">Permissions Enabled</code> to on, it initializes various permission objects behind the scenes using <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/authorization_services_guide/">Authorization Services</a>. For this example, we’re interested in the <code class="literal">manage</code> permission for the client. Clicking on that will redirect you to the permission that handles the <code class="literal">manage</code> permission for the client. All authorization objects are contained in the <code class="literal">realm-management</code> client’s <code class="literal">Authorization</code> tab.
					</p><div class="formalpara"><p class="title"><strong>Client manage permission</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client-manage-permissions.png" alt="fine grain client manage permissions"/></span>
						</p></div><p>
						When first initialized the <code class="literal">manage</code> permission does not have any policies associated with it. You will need to create one by going to the policy tab. To get there fast, click on the <code class="literal">Authorization</code> link shown in the above image. Then click on the policies tab.
					</p><p>
						There’s a pull down menu on this page called <code class="literal">Create policy</code>. There’s a multitude of policies you can define. You can define a policy that is associated with a role or a group or even define rules in JavaScript. For this simple example, we’re going to create a <code class="literal">User Policy</code>.
					</p><div class="formalpara"><p class="title"><strong>User policy</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client-user-policy.png" alt="fine grain client user policy"/></span>
						</p></div><p>
						This policy will match a hard-coded user in the user database. In this case, it is the <code class="literal">sales-admin</code> user. We must then go back to the <code class="literal">sales-application</code> client’s <code class="literal">manage</code> permission page and assign the policy to the permission object.
					</p><div class="formalpara"><p class="title"><strong>Assign user policy</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client-assign-user-policy.png" alt="fine grain client assign user policy"/></span>
						</p></div><p>
						The <code class="literal">sales-admin</code> user can now has permission to manage the <code class="literal">sales-application</code> client.
					</p><p>
						There’s one more thing we have to do. Go to the <code class="literal">Role Mappings</code> tab and assign the <code class="literal">query-clients</code> role to the <code class="literal">sales-admin</code>.
					</p><div class="formalpara"><p class="title"><strong>Assign query-clients</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-assign-query-clients.png" alt="fine grain assign query clients"/></span>
						</p></div><p>
						Why do you have to do this? This role tells the Admin Console what menu items to render when the <code class="literal">sales-admin</code> visits the Admin Console. The <code class="literal">query-clients</code> role tells the Admin Console that it should render client menus for the <code class="literal">sales-admin</code> user.
					</p><p>
						IMPORTANT If you do not set the <code class="literal">query-clients</code> role, restricted admins like <code class="literal">sales-admin</code> will not see any menu options when they log into the Admin Console
					</p></section><section class="section" id="testing_it_out"><div class="titlepage"><div><div><h4 class="title">11.3.1.2. Testing it out</h4></div></div></div><p>
						Next, we log out of the master realm and re-login to the <a class="link" href="#per_realm_admin_permissions" title="11.2. Dedicated realm admin consoles">dedicated admin console</a> for the <code class="literal">test</code> realm using the <code class="literal">sales-admin</code> as a username. This is located under <code class="literal">/auth/admin/test/console</code>.
					</p><div class="formalpara"><p class="title"><strong>Sales admin login</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-sales-admin-login.png" alt="fine grain sales admin login"/></span>
						</p></div><p>
						This admin is now able to manage this one client.
					</p></section></section><section class="section" id="restrict_user_role_mapping"><div class="titlepage"><div><div><h3 class="title">11.3.2. Restrict user role mapping</h3></div></div></div><p>
					Another thing you might want to do is to restrict the set of roles an admin is allowed to assign to a user. Continuing our last example, let’s expand the permission set of the 'sales-admin' user so that he can also control which users are allowed to access this application. Through fine grain permissions, we can enable it so that the <code class="literal">sales-admin</code> can only assign roles that grant specific access to the <code class="literal">sales-application</code>. We can also restrict it so that the admin can only map roles and not perform any other types of user administration.
				</p><p>
					The <code class="literal">sales-application</code> has defined three different client roles.
				</p><div class="formalpara"><p class="title"><strong>Sales application roles</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-sales-application-roles.png" alt="fine grain sales application roles"/></span>
					</p></div><p>
					We want the <code class="literal">sales-admin</code> user to be able to map these roles to any user in the system. The first step to do this is to allow the role to be mapped by the admin. If we click on the <code class="literal">viewLeads</code> role, you’ll see that there is a <code class="literal">Permissions</code> tab for this role.
				</p><div class="formalpara"><p class="title"><strong>View leads role permission tab</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-view-leads-role-tab.png" alt="fine grain view leads role tab"/></span>
					</p></div><p>
					If we click on that tab and turn the <code class="literal">Permissions Enabled</code> on, you’ll see that there are a number of actions we can apply policies to.
				</p><div class="formalpara"><p class="title"><strong>View leads permissions</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-view-leads-permissions.png" alt="fine grain view leads permissions"/></span>
					</p></div><p>
					The one we are interested in is <code class="literal">map-role</code>. Click on this permission and add the same User Policy that was created in the earlier example.
				</p><div class="formalpara"><p class="title"><strong>Map-roles permission</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-map-roles-permission.png" alt="fine grain map roles permission"/></span>
					</p></div><p>
					What we’ve done is say that the <code class="literal">sales-admin</code> can map the <code class="literal">viewLeads</code> role. What we have not done is specify which users the admin is allowed to map this role too. To do that we must go to the <code class="literal">Users</code> section of the admin console for this realm. Clicking on the <code class="literal">Users</code> left menu item brings us to the users interface of the realm. You should see a <code class="literal">Permissions</code> tab. Click on that and enable it.
				</p><div class="formalpara"><p class="title"><strong>Users permissions</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-users-permissions.png" alt="fine grain users permissions"/></span>
					</p></div><p>
					The permission we are interested in is <code class="literal">map-roles</code>. This is a restrictive policy in that it only allows admins the ability to map roles to a user. If we click on the <code class="literal">map-roles</code> permission and again add the User Policy we created for this, our <code class="literal">sales-admin</code> will be able to map roles to any user.
				</p><p>
					The last thing we have to do is add the <code class="literal">view-users</code> role to the <code class="literal">sales-admin</code>. This will allow the admin to view users in the realm he wants to add the <code class="literal">sales-application</code> roles to.
				</p><div class="formalpara"><p class="title"><strong>Add view-users</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-add-view-users.png" alt="fine grain add view users"/></span>
					</p></div><section class="section" id="testing_it_out_2"><div class="titlepage"><div><div><h4 class="title">11.3.2.1. Testing it out</h4></div></div></div><p>
						Next, we log out of the master realm and re-login to the <a class="link" href="#per_realm_admin_permissions" title="11.2. Dedicated realm admin consoles">dedicated admin console</a> for the <code class="literal">test</code> realm using the <code class="literal">sales-admin</code> as a username. This is located under <code class="literal">/auth/admin/test/console</code>.
					</p><p>
						You will see that now the <code class="literal">sales-admin</code> can view users in the system. If you select one of the users you’ll see that each user detail page is read only, except for the <code class="literal">Role Mappings</code> tab. Going to this tab you’ll find that there are no <code class="literal">Available</code> roles for the admin to map to the user except when we browse the <code class="literal">sales-application</code> roles.
					</p><div class="formalpara"><p class="title"><strong>Add viewleads</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-add-view-leads.png" alt="fine grain add view leads"/></span>
						</p></div><p>
						We’ve only specified that the <code class="literal">sales-admin</code> can map the <code class="literal">viewLeads</code> role.
					</p></section><section class="section" id="per_client_map_roles_shortcut"><div class="titlepage"><div><div><h4 class="title">11.3.2.2. Per client map-roles shortcut</h4></div></div></div><p>
						It would be tedious if we had to do this for every client role that the <code class="literal">sales-application</code> published. to make things easier, there’s a way to specify that an admin can map any role defined by a client. If we log back into the admin console to our master realm admin and go back to the <code class="literal">sales-application</code> permissions page, you’ll see the <code class="literal">map-roles</code> permission.
					</p><div class="formalpara"><p class="title"><strong>Client map-roles permission</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/fine-grain-client-permissions-tab-on.png" alt="fine grain client permissions tab on"/></span>
						</p></div><p>
						If you grant access to this particular permission to an admin, that admin will be able map any role defined by the client.
					</p></section></section><section class="section" id="full_list_of_permissions"><div class="titlepage"><div><div><h3 class="title">11.3.3. Full list of permissions</h3></div></div></div><p>
					You can do a lot more with fine grain permissions beyond managing a specific client or the specific roles of a client. This chapter defines the whole list of permission types that can be described for a realm.
				</p><section class="section" id="role"><div class="titlepage"><div><div><h4 class="title">11.3.3.1. Role</h4></div></div></div><p>
						When going to the <code class="literal">Permissions</code> tab for a specific role, you will see these permission types listed.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">map-role</span></dt><dd>
									Policies that decide if an admin can map this role to a user. These policies only specify that the role can be mapped to a user, not that the admin is allowed to perform user role mapping tasks. The admin will also have to have manage or role mapping permissions. See <a class="link" href="#users-permissions" title="11.3.3.3. Users">Users Permissions</a> for more information.
								</dd><dt><span class="term">map-role-composite</span></dt><dd>
									Policies that decide if an admin can map this role as a composite to another role. An admin can define roles for a client if he has to manage permissions for that client but he will not be able to add composites to those roles unless he has the <code class="literal">map-role-composite</code> privileges for the role he wants to add as a composite.
								</dd><dt><span class="term">map-role-client-scope</span></dt><dd>
									Policies that decide if an admin can apply this role to the scope of a client. Even if the admin can manage the client, he will not have permission to create tokens for that client that contain this role unless this privilege is granted.
								</dd></dl></div></section><section class="section" id="client"><div class="titlepage"><div><div><h4 class="title">11.3.3.2. Client</h4></div></div></div><p>
						When going to the <code class="literal">Permissions</code> tab for a specific client, you will see these permission types listed.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">view</span></dt><dd>
									Policies that decide if an admin can view the client’s configuration.
								</dd><dt><span class="term">manage</span></dt><dd>
									Policies that decide if an admin can view and manage the client’s configuration. There are some issues with this in that privileges could be leaked unintentionally. For example, the admin could define a protocol mapper that hardcoded a role even if the admin does not have privileges to map the role to the client’s scope. This is currently the limitation of protocol mappers as they don’t have a way to assign individual permissions to them like roles do.
								</dd><dt><span class="term">configure</span></dt><dd>
									Reduced set of privileges to manage the client. It is like the <code class="literal">manage</code> scope except the admin is not allowed to define protocol mappers, change the client template, or the client’s scope.
								</dd><dt><span class="term">map-roles</span></dt><dd>
									Policies that decide if an admin can map any role defined by the client to a user. This is a shortcut, easy-of-use feature to avoid having to define policies for each and every role defined by the client.
								</dd><dt><span class="term">map-roles-composite</span></dt><dd>
									Policies that decide if an admin can map any role defined by the client as a composite to another role. This is a shortcut, easy-of-use feature to avoid having to define policies for each and every role defined by the client.
								</dd><dt><span class="term">map-roles-client-scope</span></dt><dd>
									Policies that decide if an admin can map any role defined by the client to the scope of another client. This is a shortcut, easy-of-use feature to avoid having to define policies for each and every role defined by the client.
								</dd></dl></div></section><section class="section" id="users-permissions"><div class="titlepage"><div><div><h4 class="title">11.3.3.3. Users</h4></div></div></div><p>
						When going to the <code class="literal">Permissions</code> tab for all users, you will see these permission types listed.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">view</span></dt><dd>
									Policies that decide if an admin can view all users in the realm.
								</dd><dt><span class="term">manage</span></dt><dd>
									Policies that decide if an admin can manage all users in the realm. This permission grants the admin the privilege to perform user role mappings, but it does not specify which roles the admin is allowed to map. You’ll need to define the privilege for each role you want the admin to be able to map.
								</dd><dt><span class="term">map-roles</span></dt><dd>
									This is a subset of the privileges granted by the <code class="literal">manage</code> scope. In this case the admin is only allowed to map roles. The admin is not allowed to perform any other user management operation. Also, like <code class="literal">manage</code>, the roles that the admin is allowed to apply must be specified per role or per set of roles if dealing with client roles.
								</dd><dt><span class="term">manage-group-membership</span></dt><dd>
									Similar to <code class="literal">map-roles</code> except that it pertains to group membership: which groups a user can be added or removed from. These policies just grant the admin permission to manage group membership, not which groups the admin is allowed to manage membership for. You’ll have to specify policies for each group’s <code class="literal">manage-members</code> permission.
								</dd><dt><span class="term">impersonate</span></dt><dd>
									Policies that decide if the admin is allowed to impersonate other users. These policies are applied to the admin’s attributes and role mappings.
								</dd><dt><span class="term">user-impersonated</span></dt><dd>
									Policies that decide which users can be impersonated. These policies will be applied to the user being impersonated. For example, you might want to define a policy that will forbid anybody from impersonating a user that has admin privileges.
								</dd></dl></div></section><section class="section" id="group"><div class="titlepage"><div><div><h4 class="title">11.3.3.4. Group</h4></div></div></div><p>
						When going to the <code class="literal">Permissions</code> tab for a specific group, you will see these permission types listed.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">view</span></dt><dd>
									Policies that decide if the admin can view information about the group.
								</dd><dt><span class="term">manage</span></dt><dd>
									Policies that decide if the admin can manage the configuration of the group.
								</dd><dt><span class="term">view-members</span></dt><dd>
									Policies that decide if the admin can view the user details of members of the group.
								</dd><dt><span class="term">manage-members</span></dt><dd>
									Policies that decide if the admin can manage the users that belong to this group.
								</dd><dt><span class="term">manage-membership</span></dt><dd>
									Policies that decide if an admin can change the membership of the group. Add or remove members from the group.
								</dd></dl></div></section></section></section></section><section class="chapter" id="assembly-managing-clients_server_administration_guide"><div class="titlepage"><div><div><h1 class="title">Chapter 12. Managing OpenID Connect and SAML Clients</h1></div></div></div><p class="_abstract _abstract">
			Clients are entities that can request authentication of a user. Clients come in two forms. The first type of client is an application that wants to participate in single-sign-on. These clients just want Red Hat Single Sign-On to provide security for them. The other type of client is one that is requesting an access token so that it can invoke other services on behalf of the authenticated user. This section discusses various aspects around configuring clients and various ways to do it.
		</p><section class="section" id="oidc_clients"><div class="titlepage"><div><div><h2 class="title">12.1. OIDC clients</h2></div></div></div><p class="_abstract _abstract">
				<a class="link" href="#con-oidc_server_administration_guide" title="10.1. OpenID Connect">OpenID Connect</a> is the recommended protocol to secure applications. It was designed from the ground up to be web friendly and it works best with HTML5/JavaScript applications.
			</p><section class="section" id="proc-creating-oidc-client_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">12.1.1. Creating an OpenID Connect Client</h3></div></div></div><p class="_abstract _abstract">
					To protect an application that uses the OpenID connect protocol, you create a client.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Clients</strong></span> in the menu.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Create</strong></span> to go to the <span class="strong strong"><strong>Add Client</strong></span> page.
						</p><div class="formalpara"><p class="title"><strong>Add client</strong></p><p>
								<span class="inlinemediaobject"><img src="images/rhsso-images/add-client-oidc.png" alt="Add Client"/></span>
							</p></div></li><li class="listitem">
							Enter any name for <span class="strong strong"><strong>Client ID.</strong></span>
						</li><li class="listitem">
							Select <span class="strong strong"><strong>openid-connect</strong></span> in the <span class="strong strong"><strong>Client Protocol</strong></span> drop down box.
						</li><li class="listitem">
							Enter the base URL of your application in the <span class="strong strong"><strong>Root URL</strong></span> field.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					This action creates the client and bring you to the <span class="strong strong"><strong>Settings</strong></span> tab.
				</p><div class="formalpara"><p class="title"><strong>Client settings</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-settings-oidc.png" alt="Client Settings"/></span>
					</p></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							For more information about the OIDC protocol, see <a class="link" href="#con-oidc_server_administration_guide" title="10.1. OpenID Connect">OpenID Connect</a>.
						</li></ul></div></section><section class="section" id="con-basic-settings_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">12.1.2. Basic settings</h3></div></div></div><p class="_abstract _abstract">
					When you create an OIDC client, you see the following fields on the <span class="strong strong"><strong>Settings</strong></span> tab.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Client ID</strong></span></span></dt><dd>
								The alpha-numeric ID string that is used in OIDC requests and in the Red Hat Single Sign-On database to identify the client.
							</dd><dt><span class="term"><span class="strong strong"><strong>Name</strong></span></span></dt><dd>
								The name for the client in Red Hat Single Sign-On UI screen. To localize the name, set up a replacement string value. For example, a string value such as ${myapp}. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more information.
							</dd><dt><span class="term"><span class="strong strong"><strong>Description</strong></span></span></dt><dd>
								The description of the client. This setting can also be localized.
							</dd><dt><span class="term"><span class="strong strong"><strong>Enabled</strong></span></span></dt><dd>
								When turned off, the client cannot request authentication.
							</dd><dt><span class="term"><span class="strong strong"><strong>Consent Required</strong></span></span></dt><dd>
								When turned on, users see a consent page that they can use to grant access to that application. It will also display metadata so the user knows the exact information that the client can access.
							</dd></dl></div><div class="variablelist" id="access-type"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Access Type</strong></span></span></dt><dd>
								The type of OIDC client.
							</dd><dt><span class="term"><span class="emphasis"><em>Confidential</em></span></span></dt><dd>
								For server-side clients that perform browser logins and require client secrets when making an Access Token Request. This setting should be used for server-side applications.
							</dd><dt><span class="term"><span class="emphasis"><em>Public</em></span></span></dt><dd>
								For client-side clients that perform browser logins. As it is not possible to ensure that secrets can be kept safe with client-side clients, it is important to restrict access by configuring correct redirect URIs.
							</dd><dt><span class="term"><span class="emphasis"><em>Bearer-only</em></span></span></dt><dd>
								The application allows only bearer token requests. When turned on, this application cannot participate in browser logins.
							</dd><dt><span class="term"><span class="strong strong"><strong>Standard Flow Enabled</strong></span></span></dt><dd>
								When enabled, clients can use the OIDC <a class="link" href="#oidc-auth-flows-authorization" title="10.1.1.1. Authorization Code Flow">Authorization Code Flow</a>.
							</dd><dt><span class="term"><span class="strong strong"><strong>Implicit Flow Enabled</strong></span></span></dt><dd>
								When enabled, clients can use the OIDC <a class="link" href="#oidc-auth-flows-implicit" title="10.1.1.2. Implicit Flow">Implicit Flow</a>.
							</dd><dt><span class="term"><span class="strong strong"><strong>Direct Access Grants Enabled</strong></span></span></dt><dd>
								When enabled, clients can use the OIDC <a class="link" href="#oidc-auth-flows-direct" title="10.1.1.3. Resource owner password credentials grant (Direct Access Grants)">Direct Access Grants</a>.
							</dd><dt><span class="term"><span class="strong strong"><strong>OAuth 2.0 Device Authorization Grant Enabled</strong></span></span></dt><dd>
								If this is on, clients are allowed to use the OIDC <a class="link" href="#con-oidc-auth-flows_server_administration_guide" title="10.1.1. OIDC auth flows">Device Authorization Grant</a>.
							</dd><dt><span class="term"><span class="strong strong"><strong>OpenID Connect Client Initiated Backchannel Authentication Grant Enabled</strong></span></span></dt><dd>
								If this is on, clients are allowed to use the OIDC <a class="link" href="#con-oidc-auth-flows_server_administration_guide" title="10.1.1. OIDC auth flows">Client Initiated Backchannel Authentication Grant</a>.
							</dd><dt><span class="term"><span class="strong strong"><strong>Root URL</strong></span></span></dt><dd>
								If Red Hat Single Sign-On uses any configured relative URLs, this value is prepended to them.
							</dd><dt><span class="term"><span class="strong strong"><strong>Valid Redirect URIs</strong></span></span></dt><dd><p class="simpara">
								Required field. Enter a URL pattern and click <span class="strong strong"><strong>+</strong></span> to add and <span class="strong strong"><strong>-</strong></span> to remove existing URLs and click <span class="strong strong"><strong>Save</strong></span>. You can use wildcards at the end of the URL pattern. For example http://host.com/*
							</p><p class="simpara">
								Exclusive redirect URL patterns are typically more secure. See <a class="link" href="#unspecific-redirect-uris_server_administration_guide" title="16.8. Unspecific redirect URIs">Unspecific Redirect URIs</a> for more information.
							</p></dd><dt><span class="term"><span class="strong strong"><strong>Base URL</strong></span></span></dt><dd>
								This URL is used when Red Hat Single Sign-On needs to link to the client.
							</dd></dl></div><div class="variablelist" id="admin-url"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Admin URL</strong></span></span></dt><dd>
								Callback endpoint for a client. The server uses this URL to make callbacks like pushing revocation policies, performing backchannel logout, and other administrative operations. For Red Hat Single Sign-On servlet adapters, this URL can be the root URL of the servlet application. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/">Securing Applications and Services Guide</a>.
							</dd><dt><span class="term"><span class="strong strong"><strong>Web Origins</strong></span></span></dt><dd><p class="simpara">
								Enter a URL pattern and click <span class="strong strong"><strong>+</strong></span> to add and <span class="strong strong"><strong>-</strong></span> to remove existing URLs. Click <span class="strong strong"><strong>Save</strong></span>.
							</p><p class="simpara">
								This option handles <a class="link" href="https://fetch.spec.whatwg.org/">Cross-Origin Resource Sharing (CORS)</a>. If browser JavaScript attempts an AJAX HTTP request to a server whose domain is different from the one that the JavaScript code came from, the request must use CORS. The server must handle CORS requests, otherwise the browser will not display or allow the request to be processed. This protocol protects against XSS, CSRF, and other JavaScript-based attacks.
							</p><p class="simpara">
								Domain URLs listed here are embedded within the access token sent to the client application. The client application uses this information to decide whether to allow a CORS request to be invoked on it. Only Red Hat Single Sign-On client adapters support this feature. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/">Securing Applications and Services Guide</a> for more information.
							</p></dd></dl></div><div class="variablelist" id="front-channel-logout"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Front Channel Logout</strong></span></span></dt><dd>
								If <span class="strong strong"><strong>Front Channel Logout</strong></span> is enabled, the application should be able to log out users through the front channel as per <a class="link" href="https://openid.net/specs/openid-connect-frontchannel-1_0.html">OpenID Connect Front-Channel Logout</a> specification. If enabled, you should also provide the <code class="literal">Front-Channel Logout URL</code>.
							</dd><dt><span class="term"><span class="strong strong"><strong>Front-Channel Logout URL</strong></span></span></dt><dd>
								URL that will be used by Red Hat Single Sign-On to send logout requests to clients through the front-channel.
							</dd></dl></div><div class="variablelist" id="back-channel-logout-url"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Backchannel Logout URL</strong></span></span></dt><dd>
								URL that will cause the client to log itself out when a logout request is sent to this realm (via end_session_endpoint). If omitted, no logout requests are sent to the client.
							</dd></dl></div></section><section class="section" id="con-advanced-settings_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">12.1.3. Advanced settings</h3></div></div></div><p class="_abstract _abstract">
					When you click <span class="emphasis"><em>Advanced Settings</em></span>, additional fields are displayed.
				</p><p id="mtls-client-certificate-bound-tokens">
					<span class="strong strong"><strong>OAuth 2.0 Mutual TLS Certificate Bound Access Tokens Enabled</strong></span>
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						To enable mutual TLS in Red Hat Single Sign-On, see <a class="link" href="#enable-mtls-wildfly" title="8.5.2.1. Enable mutual SSL in JBoss EAP">Enable mutual SSL in WildFly</a>.
					</p></div></div><p>
					Mutual TLS binds an access token and a refresh token together with a client certificate, which is exchanged during a TLS handshake. This binding prevents an attacker from using stolen tokens.
				</p><p>
					This type of token is a holder-of-key token. Unlike bearer tokens, the recipient of a holder-of-key token can verify if the sender of the token is legitimate.
				</p><p>
					If this setting is on, the workflow is:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							A token request is sent to the token endpoint in an authorization code flow or hybrid flow.
						</li><li class="listitem">
							Red Hat Single Sign-On requests a client certificate.
						</li><li class="listitem">
							Red Hat Single Sign-On receives the client certificate.
						</li><li class="listitem">
							Red Hat Single Sign-On successfully verifies the client certificate.
						</li></ol></div><p>
					If verification fails, Red Hat Single Sign-On rejects the token.
				</p><p>
					In the following cases, Red Hat Single Sign-On will verify the client sending the access token or the refresh token:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							A token refresh request is sent to the token endpoint with a holder-of-key refresh token.
						</li><li class="listitem">
							A UserInfo request is sent to UserInfo endpoint with a holder-of-key access token.
						</li><li class="listitem">
							A logout request is sent to Logout endpoint with a holder-of-key refresh token.
						</li></ul></div><p>
					See <a class="link" href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-mtls-08#section-3">Mutual TLS Client Certificate Bound Access Tokens</a> in the OAuth 2.0 Mutual TLS Client Authentication and Certificate Bound Access Tokens for more details.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Currently, Red Hat Single Sign-On client adapters do not support holder-of-key token verification. Red Hat Single Sign-On adapters treat access and refresh tokens as bearer tokens.
					</p></div></div><p id="proof-key-for-code-exchange">
					<span class="strong strong"><strong>Proof Key for Code Exchange Code Challenge Method</strong></span>
				</p><p>
					If an attacker steals an authorization code of a legitimate client, Proof Key for Code Exchange (PKCE) prevents the attacker from receiving the tokens that apply to the code.
				</p><p>
					An administrator can select one of these options:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>(blank)</strong></span></span></dt><dd>
								Red Hat Single Sign-On does not apply PKCE unless the client sends appropriate PKCE parameters to Red Hat Single Sign-Ons authorization endpoint.
							</dd><dt><span class="term"><span class="strong strong"><strong>S256</strong></span></span></dt><dd>
								Red Hat Single Sign-On applies to the client PKCE whose code challenge method is S256.
							</dd><dt><span class="term"><span class="strong strong"><strong>plain</strong></span></span></dt><dd>
								Red Hat Single Sign-On applies to the client PKCE whose code challenge method is plain.
							</dd></dl></div><p>
					See <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7636">RFC 7636 Proof Key for Code Exchange by OAuth Public Clients</a> for more details.
				</p><p id="jwe-id-token-encryption">
					<span class="strong strong"><strong>Signed and Encrypted ID Token Support</strong></span>
				</p><p>
					Red Hat Single Sign-On can encrypt ID tokens according to the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7516">Json Web Encryption (JWE)</a> specification. The administrator determines if ID tokens are encrypted for each client.
				</p><p>
					The key used for encrypting the ID token is the Content Encryption Key (CEK). Red Hat Single Sign-On and a client must negotiate which CEK is used and how it is delivered. The method used to determine the CEK is the Key Management Mode. The Key Management Mode that Red Hat Single Sign-On supports is Key Encryption.
				</p><p>
					In Key Encryption:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							The client generates an asymmetric cryptographic key pair.
						</li><li class="listitem">
							The public key is used to encrypt the CEK.
						</li><li class="listitem">
							Red Hat Single Sign-On generates a CEK per ID token
						</li><li class="listitem">
							Red Hat Single Sign-On encrypts the ID token using this generated CEK
						</li><li class="listitem">
							Red Hat Single Sign-On encrypts the CEK using the client’s public key.
						</li><li class="listitem">
							The client decrypts this encrypted CEK using their private key
						</li><li class="listitem">
							The client decrypts the ID token using the decrypted CEK.
						</li></ol></div><p>
					No party, other than the client, can decrypt the ID token.
				</p><p>
					The client must pass its public key for encrypting CEK to Red Hat Single Sign-On. Red Hat Single Sign-On supports downloading public keys from a URL provided by the client. The client must provide public keys according to the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7517">Json Web Keys (JWK)</a> specification.
				</p><p>
					The procedure is:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Open the client’s <span class="strong strong"><strong>Keys</strong></span> tab.
						</li><li class="listitem">
							Toggle <span class="strong strong"><strong>JWKS URL</strong></span> to ON.
						</li><li class="listitem">
							Input the client’s public key URL in the <span class="strong strong"><strong>JWKS URL</strong></span> textbox.
						</li></ol></div><p>
					Key Encryption’s algorithms are defined in the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7518#section-4.1">Json Web Algorithm (JWA)</a> specification. Red Hat Single Sign-On supports:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							RSAES-PKCS1-v1_5(RSA1_5)
						</li><li class="listitem">
							RSAES OAEP using default parameters (RSA-OAEP)
						</li><li class="listitem">
							RSAES OAEP 256 using SHA-256 and MFG1 (RSA-OAEP-256)
						</li></ul></div><p>
					The procedure to select the algorithm is:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Open the client’s <span class="strong strong"><strong>Settings</strong></span> tab.
						</li><li class="listitem">
							Open <span class="strong strong"><strong>Fine Grain OpenID Connect Configuration</strong></span>.
						</li><li class="listitem">
							Select the algorithm from <span class="strong strong"><strong>ID Token Encryption Content Encryption Algorithm</strong></span> pulldown menu.
						</li></ol></div></section><section class="section" id="client-credentials"><div class="titlepage"><div><div><h3 class="title">12.1.4. Confidential client credentials</h3></div></div></div><p class="_abstract _abstract">
					If the <a class="link" href="#access-type">access type</a> of the client is set to <span class="strong strong"><strong>confidential</strong></span>, the credentials of the client must be configured under the <span class="strong strong"><strong>Credentials</strong></span> tab.
				</p><div class="formalpara"><p class="title"><strong>Credentials tab</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-credentials.png" alt="Credentials Tab"/></span>
					</p></div><p>
					The <span class="strong strong"><strong>Client Authenticator</strong></span> drop-down list specifies the type of credential to use for your client.
				</p><p>
					<span class="strong strong"><strong>Client ID and Secret</strong></span>
				</p><p>
					This choice is the default setting. The secret is automatically generated for you and the clicking <span class="strong strong"><strong>Regenerate Secret</strong></span> recreates the secret if necessary.
				</p><div class="formalpara"><p class="title"><strong>Signed JWT</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-credentials-jwt.png" alt="client credentials jwt"/></span>
					</p></div><p>
					<span class="strong strong"><strong>Signed JWT</strong></span> is "Signed Json Web Token".
				</p><p>
					When choosing this credential type you will have to also generate a private key and certificate for the client in the tab <code class="literal">Keys</code>. The private key will be used to sign the JWT, while the certificate is used by the server to verify the signature.
				</p><div class="formalpara"><p class="title"><strong>Keys tab</strong></p><p>
						<span class="inlinemediaobject"><img src="images/client-oidc-keys.png" alt="client oidc keys"/></span>
					</p></div><p>
					Click on the <code class="literal">Generate new keys and certificate</code> button to start this process.
				</p><div class="formalpara"><p class="title"><strong>Generate keys</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/generate-client-keys.png" alt="generate client keys"/></span>
					</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Select the archive format you want to use.
						</li><li class="listitem">
							Enter a <span class="strong strong"><strong>key password</strong></span>.
						</li><li class="listitem">
							Enter a <span class="strong strong"><strong>store password</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Generate and Download</strong></span>.
						</li></ol></div><p>
					When you generate the keys, Red Hat Single Sign-On will store the certificate and you download the private key and certificate for your client.
				</p><p>
					You can also generate keys using an external tool and then import the client’s certificate by clicking <span class="strong strong"><strong>Import Certificate</strong></span>.
				</p><div class="formalpara"><p class="title"><strong>Import certificate</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/import-client-cert.png" alt="Import Certificate"/></span>
					</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Select the archive format of the certificate.
						</li><li class="listitem">
							Enter the store password.
						</li><li class="listitem">
							Select the certificate file by clicking <span class="strong strong"><strong>Import File</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Import</strong></span>.
						</li></ol></div><p>
					Importing a certificate is unnecessary if you click <span class="strong strong"><strong>Use JWKS URL</strong></span>. In this case, you can provide the URL where the public key is published in <a class="link" href="https://self-issued.info/docs/draft-ietf-jose-json-web-key.html">JWK</a> format. With this option, if the key is ever changed, Red Hat Single Sign-On reimports the key.
				</p><p>
					If you are using a client secured by Red Hat Single Sign-On adapter, you can configure the JWKS URL in this format, assuming that <a class="link" href="https://myhost.com/myapp">https://myhost.com/myapp</a> is the root URL of your client application:
				</p><pre class="programlisting language-bash">https://myhost.com/myapp/k_jwks</pre><p>
					See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more details.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Red Hat Single Sign-On caches public keys of OIDC clients. If the private key of your client is compromised, update your keys and clear the key cache. See <a class="link" href="#clear-cache" title="3.5. Clearing server caches">Clearing the cache</a> section for more details.
					</p></div></div><p>
					<span class="strong strong"><strong>Signed JWT with Client Secret</strong></span>
				</p><p>
					If you select this option, you can use a JWT signed by client secret instead of the private key.
				</p><p>
					The client secret will be used to sign the JWT by the client.
				</p><p>
					<span class="strong strong"><strong>X509 Certificate</strong></span>
				</p><p>
					Red Hat Single Sign-On will validate if the client uses proper X509 certificate during the TLS Handshake.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						This option requires mutual TLS in Red Hat Single Sign-On. See <a class="link" href="#enable-mtls-wildfly" title="8.5.2.1. Enable mutual SSL in JBoss EAP">Enable mutual SSL in WildFly</a>.
					</p></div></div><div class="formalpara"><p class="title"><strong>X509 certificate</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/x509-client-auth.png" alt="x509 client auth"/></span>
					</p></div><p>
					The validator also checks the Subject DN field of the certificate with a configured regexp validation expression. For some use cases, it is sufficient to accept all certificates. In that case, you can use <code class="literal">(.*?)(?:$)</code> expression.
				</p><p>
					Two ways exist for Red Hat Single Sign-On to obtain the Client ID from the request:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">client_id</code> parameter in the query (described in Section 2.2 of the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc6749">OAuth 2.0 Specification</a>).
						</li><li class="listitem">
							Supply <code class="literal">client_id</code> as a form parameter.
						</li></ul></div></section><section class="section" id="service_accounts"><div class="titlepage"><div><div><h3 class="title">12.1.5. Using a service account</h3></div></div></div><p class="_abstract _abstract">
					Each OIDC client has a built-in <span class="emphasis"><em>service account</em></span>. Use this <span class="emphasis"><em>service account</em></span> to obtain an access token.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Clients</strong></span> in the menu.
						</li><li class="listitem">
							Select your client.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Settings</strong></span> tab.
						</li><li class="listitem">
							Set the <a class="link" href="#access-type">Access Type</a> of your client to <span class="strong strong"><strong>confidential</strong></span>.
						</li><li class="listitem">
							Toggle <span class="strong strong"><strong>Service Accounts Enabled</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Configure your <a class="link" href="#client-credentials" title="12.1.4. Confidential client credentials">client credentials</a>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Scope</strong></span> tab.
						</li><li class="listitem">
							Verify that you have roles or toggle <span class="strong strong"><strong>Full Scope Allowed</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Service Account Roles</strong></span> tab
						</li><li class="listitem">
							Configure the roles available to this service account for your client.
						</li></ol></div><p>
					Roles from access tokens are the intersection of:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Role scope mappings of a client combined with the role scope mappings inherited from linked client scopes.
						</li><li class="listitem">
							Service account roles.
						</li></ul></div><p>
					The REST URL to invoke is <code class="literal">/auth/realms/{realm-name}/protocol/openid-connect/token</code>. This URL must be invoked as a POST request and requires that you post the client credentials with the request.
				</p><p>
					By default, client credentials are represented by the clientId and clientSecret of the client in the <span class="strong strong"><strong>Authorization: Basic</strong></span> header but you can also authenticate the client with a signed JWT assertion or any other custom mechanism for client authentication.
				</p><p>
					You also need to set the <span class="strong strong"><strong>grant_type</strong></span> parameter to "client_credentials" as per the OAuth2 specification.
				</p><p>
					For example, the POST invocation to retrieve a service account can look like this:
				</p><pre class="screen">    POST /auth/realms/demo/protocol/openid-connect/token
    Authorization: Basic cHJvZHVjdC1zYS1jbGllbnQ6cGFzc3dvcmQ=
    Content-Type: application/x-www-form-urlencoded

    grant_type=client_credentials</pre><p>
					The response would be similar to this <a class="link" href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.4.3">Access Token Response</a> from the OAuth 2.0 specification.
				</p><pre class="screen">HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
    "access_token":"2YotnFZFEjr1zCsicMWpAA",
    "token_type":"bearer",
    "expires_in":60
}</pre><p>
					Only the access token is returned by default. No refresh token is returned and no user session is created on the Red Hat Single Sign-On side upon successful authentication by default. Due to the lack of refresh token, re-authentication is required when the access token expires. However, this situation does not mean any additional overhead for the Red Hat Single Sign-On server because sessions are not created by default.
				</p><p>
					In this situation, logout is unnecessary. However, issued access tokens can be revoked by sending requests to the OAuth2 Revocation Endpoint as described in the <a class="link" href="#con-oidc_server_administration_guide" title="10.1. OpenID Connect">OpenID Connect Endpoints</a> section.
				</p><div class="_additional-resources _additional-resources"><p class="title"><strong>Additional resources</strong></p><p>
						For more details, see <a class="link" href="#client_credentials_grant" title="10.1.1.4. Client credentials grant">Client Credentials Grant</a>.
					</p></div></section><section class="section" id="audience-support"><div class="titlepage"><div><div><h3 class="title">12.1.6. Audience support</h3></div></div></div><p class="_abstract _abstract">
					Typically, the environment where Red Hat Single Sign-On is deployed consists of a set of <span class="emphasis"><em>confidential</em></span> or <span class="emphasis"><em>public</em></span> client applications that use Red Hat Single Sign-On for authentication.
				</p><p>
					<span class="emphasis"><em>Services</em></span> (<span class="emphasis"><em>Resource Servers</em></span> in the <a class="link" href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-mtls-08#section-4.2">OAuth 2 specification</a>) are also available that serve requests from client applications and provide resources to these applications. These services require an <span class="emphasis"><em>Access token</em></span> (Bearer token) to be sent to them to authenticate a request. This token is obtained by the frontend application upon login to Red Hat Single Sign-On.
				</p><p>
					In the environment where trust among services is low, you may encounter this scenario:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							A frontend client application requires authentication against Red Hat Single Sign-On.
						</li><li class="listitem">
							Red Hat Single Sign-On authenticates a user.
						</li><li class="listitem">
							Red Hat Single Sign-On issues a token to the application.
						</li><li class="listitem">
							The application uses the token to invoke an untrusted service.
						</li><li class="listitem">
							The untrusted service returns the response to the application. However, it keeps the applications token.
						</li><li class="listitem">
							The untrusted service then invokes a trusted service using the applications token. This results in broken security as the untrusted service misuses the token to access other services on behalf of the client application.
						</li></ol></div><p>
					This scenario is unlikely in environments with a high level of trust between services but not in environments where trust is low. In some environments, this workflow may be correct as the untrusted service may have to retrieve data from a trusted service to return data to the original client application.
				</p><p>
					An unlimited audience is useful when a high level of trust exists between services. Otherwise, the audience should be limited. You can limit the audience and, at the same time, allow untrusted services to retrieve data from trusted services. In this case, ensure that the untrusted service and the trusted service are added as audiences to the token.
				</p><p>
					To prevent any misuse of the access token, limit the audience on the token and configure your services to verify the audience on the token. The flow will change as follows:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							A frontend application authenticates against Red Hat Single Sign-On.
						</li><li class="listitem">
							Red Hat Single Sign-On authenticates a user.
						</li><li class="listitem"><p class="simpara">
							Red Hat Single Sign-On issues a token to the application. The application knows that it will need to invoke an untrusted service so it places <span class="strong strong"><strong>scope=&lt;untrusted service&gt;</strong></span> in the authentication request sent to Red Hat Single Sign-On (see <a class="link" href="#client_scopes" title="12.6. Client scopes">Client Scopes section</a> for more details about the <span class="emphasis"><em>scope</em></span> parameter).
						</p><p class="simpara">
							The token issued to the application contains a reference to the untrusted service in its audience (<span class="strong strong"><strong>"audience": [ "&lt;untrusted service&gt;" ]</strong></span>) which declares that the client uses this access token to invoke the untrusted service.
						</p></li><li class="listitem">
							The untrusted service invokes a trusted service with the token. Invocation is not successful because the trusted service checks the audience on the token and find that its audience is only for the untrusted service. This behavior is expected and security is not broken.
						</li></ol></div><p>
					If the client wants to invoke the trusted service later, it must obtain another token by reissuing the SSO login with <span class="strong strong"><strong>scope=&lt;trusted service&gt;</strong></span>. The returned token will then contain the trusted service as an audience:
				</p><pre class="programlisting language-json">"audience": [ "&lt;trusted service&gt;" ]</pre><p>
					Use this value to invoke the <span class="strong strong"><strong>&lt;trusted service&gt;</strong></span>.
				</p><section class="section" id="setup_3"><div class="titlepage"><div><div><h4 class="title">12.1.6.1. Setup</h4></div></div></div><p>
						When setting up audience checking:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Ensure that services are configured to check audience on the access token sent to them by adding the flag <span class="strong strong"><strong><span class="emphasis"><em>verify-token-audience</em></span></strong></span> in the adapter configuration. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_java_adapter_config">Adapter configuration</a> for details.
							</li><li class="listitem">
								Ensure that access tokens issued by Red Hat Single Sign-On contain all necessary audiences. Audiences can be added using the client roles as described in the <a class="link" href="#audience_resolve" title="12.1.6.2. Automatically add audience">next section</a> or hardcoded. See <a class="link" href="#audience_hardcoded" title="12.1.6.3. Hardcoded audience">Hardcoded audience</a>.
							</li></ul></div></section><section class="section" id="audience_resolve"><div class="titlepage"><div><div><h4 class="title">12.1.6.2. Automatically add audience</h4></div></div></div><p>
						An <span class="emphasis"><em>Audience Resolve</em></span> protocol mapper is defined in the default client scope <span class="emphasis"><em>roles</em></span>. The mapper checks for clients that have at least one client role available for the current token. The client ID of each client is then added as an audience, which is useful if your service (usually bearer-only) clients rely on client roles.
					</p><p>
						For example, for a bearer-only client and a confidential client, you can use the access token issued for the confidential client to invoke the bearer-only client REST service. The bearer-only client will be automatically added as an audience to the access token issued for the confidential client if the following are true:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The bearer-only client has any client roles defined on itself.
							</li><li class="listitem">
								Target user has at least one of those client roles assigned.
							</li><li class="listitem">
								Confidential client has the role scope mappings for the assigned role.
							</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If you want to ensure that the audience is not added automatically, do not configure role scope mappings directly on the confidential client. Instead, you can create a dedicated client scope that contains the role scope mappings for the client roles of your dedicated client scope.
						</p><p>
							Assuming that the client scope is added as an optional client scope to the confidential client, the client roles and the audience will be added to the token if explicitly requested by the <span class="strong strong"><strong>scope=&lt;trusted service&gt;</strong></span> parameter.
						</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The frontend client itself is not automatically added to the access token audience, therefore allowing easy differentiation between the access token and the ID token, since the access token will not contain the client for which the token is issued as an audience.
						</p><p>
							If you need the client itself as an audience, see the <a class="link" href="#audience_hardcoded" title="12.1.6.3. Hardcoded audience">hardcoded audience</a> option. However, using the same client as both frontend and REST service is not recommended.
						</p></div></div></section><section class="section" id="audience_hardcoded"><div class="titlepage"><div><div><h4 class="title">12.1.6.3. Hardcoded audience</h4></div></div></div><p>
						When your service relies on realm roles or does not rely on the roles in the token at all, it can be useful to use a hardcoded audience. A hardcoded audience is a protocol mapper, that will add the client ID of the specified service client as an audience to the token. You can use any custom value, for example a URL, if you want to use a different audience than the client ID.
					</p><p>
						You can add the protocol mapper directly to the frontend client. If the protocol mapper is added directly, the audience will be always added as well.
					</p><p>
						For more control over the protocol mapper, you can create the protocol mapper on the dedicated client scope, which will be called for example <span class="strong strong"><strong>good-service</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Audience protocol mapper</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/audience_mapper.png" alt="audience mapper"/></span>
						</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								From the <a class="link" href="#client_installation" title="12.5. Generating client adapter config">Installation tab</a> of the <span class="strong strong"><strong>good-service</strong></span> client, you can generate the adapter configuration and you can confirm that <span class="emphasis"><em>verify-token-audience</em></span> option will be set to <span class="strong strong"><strong>true</strong></span>. This forces the adapter to verify the audience if you use this configuration.
							</li><li class="listitem"><p class="simpara">
								You need to ensure that the confidential client is able to request <span class="strong strong"><strong>good-service</strong></span> as an audience in its tokens.
							</p><p class="simpara">
								On the confidential client:
							</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
										Click the <span class="emphasis"><em>Client Scopes</em></span> tab.
									</li><li class="listitem"><p class="simpara">
										Assign <span class="strong strong"><strong>good-service</strong></span> as an optional (or default) client scope.
									</p><p class="simpara">
										See <a class="link" href="#client_scopes_linking" title="12.6.3. Link client scope with the client">Client Scopes Linking section</a> for more details.
									</p></li></ol></div></li><li class="listitem">
								You can optionally <a class="link" href="#client_scopes_evaluate" title="12.6.4. Evaluating Client Scopes">Evaluate Client Scopes</a> and generate an example access token. <span class="strong strong"><strong>good-service</strong></span> will be added to the audience of the generated access token if <span class="strong strong"><strong>good-service</strong></span> is included in the <span class="emphasis"><em>scope</em></span> parameter, when you assigned it as an optional client scope.
							</li><li class="listitem"><p class="simpara">
								In your confidential client application, ensure that the <span class="emphasis"><em>scope</em></span> parameter is used. The value <span class="strong strong"><strong>good-service</strong></span> must be included when you want to issue the token for accessing <span class="strong strong"><strong>good-service</strong></span>.
							</p><p class="simpara">
								See:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_params_forwarding">parameters forwarding section</a> if your application uses the servlet adapter.
									</li><li class="listitem">
										<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_javascript_adapter">javascript adapter section</a> if your application uses the javascript adapter.
									</li></ul></div></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Both the <span class="emphasis"><em>Audience</em></span> and <span class="emphasis"><em>Audience Resolve</em></span> protocol mappers add the audiences to the access token only, by default. The ID Token typically contains only a single audience, the client ID for which the token was issued, a requirement of the OpenID Connect specification. However, the access token does not necessarily have the client ID, which was the token issued for, unless the audience mappers added it.
						</p></div></div></section></section></section><section class="section" id="client-saml-configuration"><div class="titlepage"><div><div><h2 class="title">12.2. Creating a SAML client</h2></div></div></div><p class="_abstract _abstract">
				Red Hat Single Sign-On supports <a class="link" href="#saml" title="10.2. SAML">SAML 2.0</a> for registered applications. POST and Redirect bindings are supported. You can choose to require client signature validation. You can have the server sign and/or encrypt responses as well.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Clients</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Create</strong></span> to go to the <span class="strong strong"><strong>Add Client</strong></span> page.
					</p><div class="formalpara"><p class="title"><strong>Add client</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/add-client-saml.png" alt="add client saml"/></span>
						</p></div></li><li class="listitem">
						Enter the <span class="strong strong"><strong>Client ID</strong></span> of the client. This is often a URL and is the expected <span class="strong strong"><strong>issuer</strong></span> value in SAML requests sent by the application.
					</li><li class="listitem">
						Select <span class="strong strong"><strong>saml</strong></span> in the <span class="strong strong"><strong>Client Protocol</strong></span> drop down box.
					</li><li class="listitem">
						Enter the <span class="strong strong"><strong>Client SAML Endpoint</strong></span> URL. This URL is where you want the Red Hat Single Sign-On server to send SAML requests and responses. Generally, applications have one URL for processing SAML requests. Multiple URLs can be set in the <span class="strong strong"><strong>Settings</strong></span> tab of the client.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Save</strong></span>. This action creates the client and brings you to the <span class="strong strong"><strong>Settings</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Client settings</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/client-settings-saml.png" alt="client settings saml"/></span>
						</p></div><p class="simpara">
						The following list describes each setting:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Client ID</strong></span></span></dt><dd>
									The alpha-numeric ID string that is used in OIDC requests and in the Red Hat Single Sign-On database to identify the client. This value must match the issuer value sent with AuthNRequests. Red Hat Single Sign-On pulls the issuer from the Authn SAML request and match it to a client by this value.
								</dd><dt><span class="term"><span class="strong strong"><strong>Name</strong></span></span></dt><dd>
									The name for the client in a Red Hat Single Sign-On UI screen. To localize the name, set up a replacement string value. For example, a string value such as ${myapp}. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more information.
								</dd><dt><span class="term"><span class="strong strong"><strong>Description</strong></span></span></dt><dd>
									The description of the client. This setting can also be localized.
								</dd><dt><span class="term"><span class="strong strong"><strong>Enabled</strong></span></span></dt><dd>
									When set to OFF, the client cannot request authentication.
								</dd><dt><span class="term"><span class="strong strong"><strong>Consent Required</strong></span></span></dt><dd>
									When set to ON, users see a consent page that grants access to that application. The page also displays the metadata of the information that the client can access. If you have ever done a social login to Facebook, you often see a similar page. Red Hat Single Sign-On provides the same functionality.
								</dd><dt><span class="term"><span class="strong strong"><strong>Include AuthnStatement</strong></span></span></dt><dd>
									SAML login responses may specify the authentication method used, such as password, as well as timestamps of the login and the session expiration. <span class="strong strong"><strong>Include AuthnStatement</strong></span> is enabled by default, so that the <span class="strong strong"><strong>AuthnStatement</strong></span> element will be included in login responses. Setting this to OFF prevents clients from determining the maximum session length, which can create client sessions that do not expire.
								</dd><dt><span class="term"><span class="strong strong"><strong>Sign Documents</strong></span></span></dt><dd>
									When set to ON, Red Hat Single Sign-On signs the document using the realms private key.
								</dd><dt><span class="term"><span class="strong strong"><strong>Optimize REDIRECT signing key lookup</strong></span></span></dt><dd><p class="simpara">
									When set to ON, the SAML protocol messages include the Red Hat Single Sign-On native extension. This extension contains a hint with the signing key ID. The SP uses the extension for signature validation instead of attempting to validate the signature using keys.
								</p><p class="simpara">
									This option applies to REDIRECT bindings where the signature is transferred in query parameters and this information is not found in the signature information. This is contrary to POST binding messages where key ID is always included in document signature.
								</p><p class="simpara">
									This option is used when Red Hat Single Sign-On server and adapter provide the IDP and SP. This option is only relevant when <span class="strong strong"><strong>Sign Documents</strong></span> is set to ON.
								</p></dd><dt><span class="term"><span class="strong strong"><strong>Sign Assertions</strong></span></span></dt><dd>
									The assertion is signed and embedded in the SAML XML Auth response.
								</dd><dt><span class="term"><span class="strong strong"><strong>Signature Algorithm</strong></span></span></dt><dd>
									The algorithm used in signing SAML documents.
								</dd><dt><span class="term"><span class="strong strong"><strong>SAML Signature Key Name</strong></span></span></dt><dd><p class="simpara">
									Signed SAML documents sent using POST binding contain the identification of the signing key in the <span class="strong strong"><strong>KeyName</strong></span> element. This action can be controlled by the <span class="strong strong"><strong>SAML Signature Key Name</strong></span> option. This option controls the contents of the <span class="strong strong"><strong>Keyname</strong></span>.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<span class="strong strong"><strong>KEY_ID</strong></span> The <span class="strong strong"><strong>KeyName</strong></span> contains the key ID. This option is the default option.
										</li><li class="listitem">
											<span class="strong strong"><strong>CERT_SUBJECT</strong></span> The <span class="strong strong"><strong>KeyName</strong></span> contains the subject from the certificate corresponding to the realm key. This option is expected by Microsoft Active Directory Federation Services.
										</li><li class="listitem">
											<span class="strong strong"><strong>NONE</strong></span> The <span class="strong strong"><strong>KeyName</strong></span> hint is completely omitted from the SAML message.
										</li></ul></div></dd><dt><span class="term"><span class="strong strong"><strong>Canonicalization Method</strong></span></span></dt><dd>
									The canonicalization method for XML signatures.
								</dd><dt><span class="term"><span class="strong strong"><strong>Encrypt Assertions</strong></span></span></dt><dd>
									Encrypts the assertions in SAML documents with the realms private key. The AES algorithm uses a key size of 128 bits.
								</dd><dt><span class="term"><span class="strong strong"><strong>Client Signature Required</strong></span></span></dt><dd>
									If <span class="strong strong"><strong>Client Signature Required</strong></span> is enabled, documents coming from a client are expected to be signed. Red Hat Single Sign-On will validate this signature using the client public key or cert set up in the <code class="literal">Keys</code> tab.
								</dd><dt><span class="term"><span class="strong strong"><strong>Force POST Binding</strong></span></span></dt><dd>
									By default, Red Hat Single Sign-On responds using the initial SAML binding of the original request. By enabling <span class="strong strong"><strong>Force POST Binding</strong></span>, Red Hat Single Sign-On responds using the SAML POST binding even if the original request used the redirect binding.
								</dd><dt><span class="term"><span class="strong strong"><strong>Front Channel Logout</strong></span></span></dt><dd>
									If <span class="strong strong"><strong>Front Channel Logout</strong></span> is enabled, the application requires a browser redirect to perform a logout. For example, the application may require a cookie to be reset which could only be done via a redirect. If <span class="strong strong"><strong>Front Channel Logout</strong></span> is disabled, Red Hat Single Sign-On invokes a background SAML request to log out of the application.
								</dd><dt><span class="term"><span class="strong strong"><strong>Force Name ID Format</strong></span></span></dt><dd>
									If a request has a name ID policy, ignore it and use the value configured in the Admin Console under <span class="strong strong"><strong>Name ID Format</strong></span>.
								</dd><dt><span class="term"><span class="strong strong"><strong>Name ID Format</strong></span></span></dt><dd>
									The Name ID Format for the subject. This format is used if no name ID policy is specified in a request, or if the Force Name ID Format attribute is set to ON.
								</dd><dt><span class="term"><span class="strong strong"><strong>Root URL</strong></span></span></dt><dd>
									When Red Hat Single Sign-On uses a configured relative URL, this value is prepended to the URL.
								</dd><dt><span class="term"><span class="strong strong"><strong>Valid Redirect URIs</strong></span></span></dt><dd>
									Enter a URL pattern and click the + sign to add. Click the - sign to remove. Click <span class="strong strong"><strong>Save</strong></span> to save these changes. Wildcards values are allowed only at the end of a URL. For example, <a class="link" href="http://host.com/*$$">http://host.com/*$$</a>. This field is used when the exact SAML endpoints are not registered and Red Hat Single Sign-On pulls the Assertion Consumer URL from a request.
								</dd><dt><span class="term"><span class="strong strong"><strong>Base URL</strong></span></span></dt><dd>
									If Red Hat Single Sign-On needs to link to a client, this URL is used.
								</dd><dt><span class="term"><span class="strong strong"><strong>Master SAML Processing URL</strong></span></span></dt><dd><p class="simpara">
									This URL is used for all SAML requests and the response is directed to the SP. It is used as the Assertion Consumer Service URL and the Single Logout Service URL.
								</p><p class="simpara">
									If login requests contain the Assertion Consumer Service URL then those login requests will take precedence. This URL must be validated by a registered Valid Redirect URI pattern.
								</p></dd><dt><span class="term"><span class="strong strong"><strong>Assertion Consumer Service POST Binding URL</strong></span></span></dt><dd>
									POST Binding URL for the Assertion Consumer Service.
								</dd><dt><span class="term"><span class="strong strong"><strong>Assertion Consumer Service Redirect Binding URL</strong></span></span></dt><dd>
									Redirect Binding URL for the Assertion Consumer Service.
								</dd><dt><span class="term"><span class="strong strong"><strong>Logout Service POST Binding URL</strong></span></span></dt><dd>
									POST Binding URL for the Logout Service.
								</dd><dt><span class="term"><span class="strong strong"><strong>Logout Service Redirect Binding URL</strong></span></span></dt><dd>
									Redirect Binding URL for the Logout Service.
								</dd><dt><span class="term"><span class="strong strong"><strong>Logout Service Artifact Binding URL</strong></span></span></dt><dd>
									<span class="emphasis"><em>Artifact</em></span> Binding URL for the Logout Service. When set together with the <code class="literal">Force Artifact Binding</code> option, <span class="emphasis"><em>Artifact</em></span> binding is forced for both login and logout flows. <span class="emphasis"><em>Artifact</em></span> binding is not used for logout unless this property is set.
								</dd><dt><span class="term"><span class="strong strong"><strong>Artifact Binding URL</strong></span></span></dt><dd>
									URL to send the HTTP artifact messages to.
								</dd><dt><span class="term"><span class="strong strong"><strong>Artifact Resolution Service</strong></span></span></dt><dd>
									URL of the client SOAP endpoint where to send the <code class="literal">ArtifactResolve</code> messages to.
								</dd></dl></div></li></ol></div><section class="section" id="idp_initiated_login"><div class="titlepage"><div><div><h3 class="title">12.2.1. IDP Initiated login</h3></div></div></div><p class="_abstract _abstract">
					IDP Initiated Login is a feature that allows you to set up an endpoint on the Red Hat Single Sign-On server that will log you into a specific application/client. In the <span class="strong strong"><strong>Settings</strong></span> tab for your client, you need to specify the <span class="strong strong"><strong>IDP Initiated SSO URL Name</strong></span>. This is a simple string with no whitespace in it. After this you can reference your client at the following URL: <code class="literal">root/auth/realms/{realm}/protocol/saml/clients/{url-name}</code>
				</p><p>
					The IDP initiated login implementation prefers <span class="emphasis"><em>POST</em></span> over <span class="emphasis"><em>REDIRECT</em></span> binding (check <a class="link" href="#saml" title="10.2. SAML">saml bindings</a> for more information). Therefore the final binding and SP URL are selected in the following way:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							If the specific <span class="strong strong"><strong>Assertion Consumer Service POST Binding URL</strong></span> is defined (inside <span class="strong strong"><strong>Fine Grain SAML Endpoint Configuration</strong></span> section of the client settings) <span class="emphasis"><em>POST</em></span> binding is used through that URL.
						</li><li class="listitem">
							If the general <span class="strong strong"><strong>Master SAML Processing URL</strong></span> is specified then <span class="emphasis"><em>POST</em></span> binding is used again throught this general URL.
						</li><li class="listitem">
							As the last resort, if the <span class="strong strong"><strong>Assertion Consumer Service Redirect Binding URL</strong></span> is configured (inside <span class="strong strong"><strong>Fine Grain SAML Endpoint Configuration</strong></span>) <span class="emphasis"><em>REDIRECT</em></span> binding is used with this URL.
						</li></ol></div><p>
					If your client requires a special relay state, you can also configure this on the <span class="strong strong"><strong>Settings</strong></span> tab in the <span class="strong strong"><strong>IDP Initiated SSO Relay State</strong></span> field. Alternatively, browsers can specify the relay state in a <span class="strong strong"><strong>RelayState</strong></span> query parameter, i.e. <code class="literal">root/auth/realms/{realm}/protocol/saml/clients/{url-name}?RelayState=thestate</code>.
				</p><p>
					When using <a class="link" href="#identity_broker" title="Chapter 9. Integrating identity providers">identity brokering</a>, it is possible to set up an IDP Initiated Login for a client from an external IDP. The actual client is set up for IDP Initiated Login at broker IDP as described above. The external IDP has to set up the client for application IDP Initiated Login that will point to a special URL pointing to the broker and representing IDP Initiated Login endpoint for a selected client at the brokering IDP. This means that in client settings at the external IDP:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>IDP Initiated SSO URL Name</strong></span> is set to a name that will be published as IDP Initiated Login initial point,
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Assertion Consumer Service POST Binding URL</strong></span> in the <span class="strong strong"><strong>Fine Grain SAML Endpoint Configuration</strong></span> section has to be set to the following URL: <code class="literal">broker-root/auth/realms/{broker-realm}/broker/{idp-name}/endpoint/clients/{client-id}</code>, where:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<span class="emphasis"><em>broker-root</em></span> is base broker URL
								</li><li class="listitem">
									<span class="emphasis"><em>broker-realm</em></span> is name of the realm at broker where external IDP is declared
								</li><li class="listitem">
									<span class="emphasis"><em>idp-name</em></span> is name of the external IDP at broker
								</li><li class="listitem">
									<span class="emphasis"><em>client-id</em></span> is the value of <span class="strong strong"><strong>IDP Initiated SSO URL Name</strong></span> attribute of the SAML client defined at broker. It is this client, which will be made available for IDP Initiated Login from the external IDP.
								</li></ul></div></li></ul></div><p>
					Please note that you can import basic client settings from the brokering IDP into client settings of the external IDP - just use <a class="link" href="#identity_broker_saml_sp_descriptor" title="9.6.2. SP Descriptor">SP Descriptor</a> available from the settings of the identity provider in the brokering IDP, and add <code class="literal">clients/<span class="emphasis"><em>client-id</em></span></code> to the endpoint URL.
				</p></section><section class="section" id="proc-using-an-entity-descriptors_server_administration_guide"><div class="titlepage"><div><div><h3 class="title">12.2.2. Using an entity descriptor to create a client</h3></div></div></div><p class="_abstract _abstract">
					Instead of registering a SAML 2.0 client manually, you can import the client using a standard SAML Entity Descriptor XML file.
				</p><p>
					The Add Client page includes an <span class="strong strong"><strong>Import</strong></span> option.
				</p><div class="formalpara"><p class="title"><strong>Add client</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/add-client-saml.png" alt="add client saml"/></span>
					</p></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Select File</strong></span>.
						</li><li class="listitem">
							Load the file that contains the XML entity descriptor information.
						</li><li class="listitem">
							Review the information to ensure everything is set up correctly.
						</li></ol></div><p>
					Some SAML client adapters, such as <span class="emphasis"><em>mod-auth-mellon</em></span>, need the XML Entity Descriptor for the IDP. You can find this descriptor by going to this URL:
				</p><pre class="screen">root/auth/realms/{realm}/protocol/saml/descriptor</pre><p>
					where <span class="emphasis"><em>realm</em></span> is the realm of your client.
				</p></section></section><section class="section" id="con-client-links_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">12.3. Client links</h2></div></div></div><p class="_abstract _abstract">
				To link from one client to another, Red Hat Single Sign-On provides a redirect endpoint: <code class="literal">/realms/realm_name/clients/{client-id}/redirect</code>.
			</p><p>
				If a client accesses this endpoint using a <code class="literal">HTTP GET</code> request, Red Hat Single Sign-On returns the configured base URL for the provided Client and Realm in the form of an <code class="literal">HTTP 307</code> (Temporary Redirect) in the response’s <code class="literal">Location</code> header. As a result of this, a client needs only to know the Realm name and the Client ID to link to them. This indirection avoids hard-coding client base URLs.
			</p><p>
				As an example, given the realm <code class="literal">master</code> and the client-id <code class="literal">account</code>:
			</p><pre class="screen">http://host:port/auth/realms/master/clients/account/redirect</pre><p>
				This URL temporarily redirects to: <a class="link" href="http://host:port/auth/realms/master/account">http://host:port/auth/realms/master/account</a>
			</p></section><section class="section" id="protocol-mappers"><div class="titlepage"><div><div><h2 class="title">12.4. OIDC token and SAML assertion mappings</h2></div></div></div><p class="_abstract _abstract">
				Applications receiving ID tokens, access tokens, or SAML assertions may require different roles and user metadata.
			</p><p>
				You can use Red Hat Single Sign-On to:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Hardcode roles, claims and custom attributes.
					</li><li class="listitem">
						Pull user metadata into a token or assertion.
					</li><li class="listitem">
						Rename roles.
					</li></ul></div><p>
				You perform these actions in the <span class="strong strong"><strong>Mappers</strong></span> tab in the Admin Console.
			</p><div class="formalpara"><p class="title"><strong>Mappers tab</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/mappers-oidc.png" alt="mappers oidc"/></span>
				</p></div><p>
				New clients do not have built-in mappers but they can inherit some mappers from client scopes. See the <a class="link" href="#client_scopes" title="12.6. Client scopes">client scopes section</a> for more details.
			</p><p>
				Protocol mappers map items (such as an email address, for example) to a specific claim in the identity and access token. The function of a mapper should be self explanatory from its name. You add pre-configured mappers by clicking <span class="strong strong"><strong>Add Builtin</strong></span>.
			</p><p>
				Each mapper has a set of common settings. Additional settings are available, depending on the mapper type. Click <span class="strong strong"><strong>Edit</strong></span> next to a mapper to access the configuration screen to adjust these settings.
			</p><div class="formalpara"><p class="title"><strong>Mapper config</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/mapper-config.png" alt="mapper config"/></span>
				</p></div><p>
				Details on each option can be viewed by hovering over its tooltip.
			</p><p>
				You can use most OIDC mappers to control where the claim gets placed. You opt to include or exclude the claim from the <span class="emphasis"><em>id</em></span> and <span class="emphasis"><em>access</em></span> tokens by adjusting the <span class="strong strong"><strong>Add to ID token</strong></span> and <span class="strong strong"><strong>Add to access token</strong></span> switches.
			</p><p id="proc-creating-mappers_server_administration_guide" class="_abstract _abstract">
				You can add mapper types as follows:
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Go to the <span class="strong strong"><strong>Mappers</strong></span> tab.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Add mapper</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/add-mapper.png" alt="add mapper"/></span>
						</p></div></li><li class="listitem">
						Select a <span class="strong strong"><strong>Mapper Type</strong></span> from the list box.
					</li></ol></div><section class="section" id="priority_order"><div class="titlepage"><div><div><h3 class="title">12.4.1. Priority order</h3></div></div></div><p>
					Mapper implementations have <span class="emphasis"><em>priority order</em></span>. <span class="emphasis"><em>Priority order</em></span> is not the configuration property of the mapper. It is the property of the concrete implementation of the mapper.
				</p><p>
					Mappers are sorted by the order in the list of mappers. The changes in the token or assertion are applied in that order with the lowest applying first. Therefore, the implementations that are dependent on other implementations are processed in the necessary order.
				</p><p>
					For example, to compute the roles which will be included with a token:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Resolve audiences based on those roles.
						</li><li class="listitem">
							Process a JavaScript script that uses the roles and audiences already available in the token.
						</li></ol></div></section><section class="section" id="protocol-mappers_oidc-user-session-note-mappers"><div class="titlepage"><div><div><h3 class="title">12.4.2. OIDC user session note mappers</h3></div></div></div><p>
					User session details are defined using mappers and are automatically included when you use or enable a feature on a client. Click <span class="strong strong"><strong>Add builtin</strong></span> to include session details.
				</p><p>
					Impersonated user sessions provide the following details:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>IMPERSONATOR_ID</strong></span>: The ID of an impersonating user.
						</li><li class="listitem">
							<span class="strong strong"><strong>IMPERSONATOR_USERNAME</strong></span>: The username of an impersonating user.
						</li></ul></div><p>
					Service account sessions provide the following details:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>clientId</strong></span>: The client ID of the service account.
						</li><li class="listitem">
							<span class="strong strong"><strong>clientAddress</strong></span>: The remote host IP of the service account’s authenticated device.
						</li><li class="listitem">
							<span class="strong strong"><strong>clientHost</strong></span>: The remote host name of the service account’s authenticated device.
						</li></ul></div></section><section class="section" id="script_mapper"><div class="titlepage"><div><div><h3 class="title">12.4.3. Script mapper</h3></div></div></div><p>
					Use the <span class="strong strong"><strong>Script Mapper</strong></span> to map claims to tokens by running user-defined JavaScript code. For more details about deploying scripts to the server, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/#_script_providers">JavaScript Providers</a>.
				</p><p>
					When scripts deploy, you should be able to select the deployed scripts from the list of available mappers.
				</p></section></section><section class="section" id="client_installation"><div class="titlepage"><div><div><h2 class="title">12.5. Generating client adapter config</h2></div></div></div><p class="_abstract _abstract">
				Red Hat Single Sign-On can generate configuration files that you can use to install a client adapter in your application’s deployment environment. A number of adapter types are supported for OIDC and SAML.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Go to the <span class="strong strong"><strong>Installation</strong></span> tab of the client you want to generate configuration for.
					</p><p class="simpara">
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-installation.png" alt="client installation"/></span>
					</p></li><li class="listitem">
						Select the <span class="strong strong"><strong>Format Option</strong></span> you want configuration generated for.
					</li></ol></div><p>
				All Red Hat Single Sign-On client adapters for OIDC and SAML are supported. The mod-auth-mellon Apache HTTPD adapter for SAML is supported as well as standard SAML entity descriptor files.
			</p></section><section class="section" id="client_scopes"><div class="titlepage"><div><div><h2 class="title">12.6. Client scopes</h2></div></div></div><p class="_abstract _abstract">
				Use Red Hat Single Sign-On to define a shared client configuration in an entity called a <span class="emphasis"><em>client scope</em></span>. A <span class="emphasis"><em>client scope</em></span> configures <a class="link" href="#protocol-mappers" title="12.4. OIDC token and SAML assertion mappings">protocol mappers</a> and <a class="link" href="#role_scope_mappings" title="7.6. Role scope mappings">role scope mappings</a> for multiple clients.
			</p><p>
				Client scopes also support the OAuth 2 <span class="strong strong"><strong>scope</strong></span> parameter. Client applications use this parameter to request claims or roles in the access token, depending on the requirement of the application.
			</p><p id="proc_creating_client_scopes_server_administration_guide" class="_abstract _abstract">
				To create a client scope, follow these steps:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Client Scopes</strong></span> in the menu.
					</p><div class="formalpara"><p class="title"><strong>Client scopes list</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/client-scopes-list.png" alt="client scopes list"/></span>
						</p></div></li><li class="listitem">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</li><li class="listitem">
						Name your client scope.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div><p>
				A <span class="emphasis"><em>client scope</em></span> has similar tabs to regular clients. You can define <a class="link" href="#protocol-mappers" title="12.4. OIDC token and SAML assertion mappings">protocol mappers</a> and <a class="link" href="#role_scope_mappings" title="7.6. Role scope mappings">role scope mappings</a>. These mappings can be inherited by other clients and are configured to inherit from this client scope.
			</p><section class="section" id="protocol"><div class="titlepage"><div><div><h3 class="title">12.6.1. Protocol</h3></div></div></div><p>
					When you create a client scope, choose the <span class="strong strong"><strong>Protocol</strong></span>. Clients linked in the same scope must have the same protocol.
				</p><p>
					Each realm has a set of pre-defined built-in client scopes in the menu.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							SAML protocol: The <span class="strong strong"><strong>role_list</strong></span>. This scope contains one protocol mapper for the roles list in the SAML assertion.
						</li><li class="listitem"><p class="simpara">
							OpenID Connect protocol: Several client scopes are available:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>roles</strong></span>
								</p><p class="simpara">
									This scope is not defined in the OpenID Connect specification and is not added automatically to the <span class="strong strong"><strong>scope</strong></span> claim in the access token. This scope has mappers, which are used to add the roles of the user to the access token and add audiences for clients that have at least one client role. These mappers are described in more detail in the <a class="link" href="#audience_resolve" title="12.1.6.2. Automatically add audience">Audience section</a>.
								</p></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>web-origins</strong></span>
								</p><p class="simpara">
									This scope is also not defined in the OpenID Connect specification and not added to the <span class="strong strong"><strong>scope</strong></span> claiming the access token. This scope is used to add allowed web origins to the access token <span class="strong strong"><strong>allowed-origins</strong></span> claim.
								</p></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>microprofile-jwt</strong></span>
								</p><p class="simpara">
									This scope handles claims defined in the <a class="link" href="https://wiki.eclipse.org/MicroProfile/JWT_Auth">MicroProfile/JWT Auth Specification</a>. This scope defines a user property mapper for the <span class="strong strong"><strong>upn</strong></span> claim and a realm role mapper for the <span class="strong strong"><strong>groups</strong></span> claim. These mappers can be changed so different properties can be used to create the MicroProfile/JWT specific claims.
								</p></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>offline_access</strong></span>
								</p><p class="simpara">
									This scope is used in cases when clients need to obtain offline tokens. More details on offline tokens is available in the <a class="link" href="#offline-access" title="6.4. Offline access">Offline Access section</a> and in the <a class="link" href="https://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess">OpenID Connect specification</a>.
								</p></li><li class="listitem">
									<span class="strong strong"><strong>profile</strong></span>
								</li><li class="listitem">
									<span class="strong strong"><strong>email</strong></span>
								</li><li class="listitem">
									<span class="strong strong"><strong>address</strong></span>
								</li><li class="listitem">
									<span class="strong strong"><strong>phone</strong></span>
								</li></ul></div></li></ul></div><p>
					The client scopes <span class="strong strong"><strong>profile</strong></span>, <span class="strong strong"><strong>email</strong></span>, <span class="strong strong"><strong>address</strong></span> and <span class="strong strong"><strong>phone</strong></span> are defined in the <a class="link" href="https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims">OpenID Connect specification</a>. These scopes do not have any role scope mappings defined but they do have protocol mappers defined. These mappers correspond to the claims defined in the OpenID Connect specification.
				</p><p>
					For example, when you open the <span class="strong strong"><strong>phone</strong></span> client scope and open the <span class="strong strong"><strong>Mappers</strong></span> tab, you will see the protocol mappers which correspond to the claims defined in the specification for the scope <span class="strong strong"><strong>phone</strong></span>.
				</p><div class="formalpara"><p class="title"><strong>Client scope mappers</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-scopes-phone.png" alt="client scopes phone"/></span>
					</p></div><p>
					When the <span class="strong strong"><strong>phone</strong></span> client scope is linked to a client, the client automatically inherits all the protocol mappers defined in the <span class="strong strong"><strong>phone</strong></span> client scope. Access tokens issued for this client contain the phone number information about the user, assuming that the user has a defined phone number.
				</p><p>
					Built-in client scopes contain the protocol mappers as defined in the specification. You are free to edit client scopes and create, update, or remove any protocol mappers or role scope mappings.
				</p></section><section class="section" id="consent_related_settings"><div class="titlepage"><div><div><h3 class="title">12.6.2. Consent related settings</h3></div></div></div><p>
					Client scopes contain options related to the consent screen. Those options are useful if the linked client if <span class="strong strong"><strong>Consent Required</strong></span> is enabled on the client.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Display On Consent Screen</span></dt><dd>
								If <span class="strong strong"><strong>Display On Consent Screen</strong></span> is enabled, and the scope is added to a client that requires consent, the text specified in <span class="strong strong"><strong>Consent Screen Text</strong></span> will be displayed on the consent screen. This text is shown when the user is authenticated and before the user is redirected from Red Hat Single Sign-On to the client. If <span class="strong strong"><strong>Display On Consent Screen</strong></span> is disabled, this client scope will not be displayed on the consent screen.
							</dd><dt><span class="term">Consent Screen Text</span></dt><dd>
								The text displayed on the consent screen when this client scope is added to a client when consent required defaults to the name of client scope. The value for this text can be customised by specifying a substitution variable with <span class="strong strong"><strong>${var-name}</strong></span> strings. The customised value is configured within the property files in your theme. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more information on customisation.
							</dd></dl></div></section><section class="section" id="client_scopes_linking"><div class="titlepage"><div><div><h3 class="title">12.6.3. Link client scope with the client</h3></div></div></div><p>
					Linking between a client scope and a client is configured in the <span class="strong strong"><strong>Client Scopes</strong></span> tab of the client. Two ways of linking between client scope and client are available.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Default Client Scopes</span></dt><dd>
								This setting is applicable to the OpenID Connect and SAML clients. Default client scopes are applied when issuing OpenID Connect tokens or SAML assertions for a client. The client will inherit Protocol Mappers and Role Scope Mappings that are defined on the client scope. For the OpenID Connect Protocol, the Mappers and Role Scope Mappings are always applied, regardless of the value used for the scope parameter in the OpenID Connect authorization request.
							</dd><dt><span class="term">Optional Client Scopes</span></dt><dd>
								This setting is applicable only for OpenID Connect clients. Optional client scopes are applied when issuing tokens for this client but only when requested by the <span class="strong strong"><strong>scope</strong></span> parameter in the OpenID Connect authorization request.
							</dd></dl></div><section class="section" id="example"><div class="titlepage"><div><div><h4 class="title">12.6.3.1. Example</h4></div></div></div><p>
						For this example, assume the client has <span class="strong strong"><strong>profile</strong></span> and <span class="strong strong"><strong>email</strong></span> linked as default client scopes, and <span class="strong strong"><strong>phone</strong></span> and <span class="strong strong"><strong>address</strong></span> linked as optional client scopes. The client uses the value of the scope parameter when sending a request to the OpenID Connect authorization endpoint.
					</p><pre class="programlisting language-bash">scope=openid phone</pre><p>
						The scope parameter contains the string, with the scope values divided by spaces. The value <span class="strong strong"><strong>openid</strong></span> is the meta-value used for all OpenID Connect requests. The token will contain mappers and role scope mappings from the default client scopes <span class="strong strong"><strong>profile</strong></span> and <span class="strong strong"><strong>email</strong></span> as well as <span class="strong strong"><strong>phone</strong></span>, an optional client scope requested by the scope parameter.
					</p></section></section><section class="section" id="client_scopes_evaluate"><div class="titlepage"><div><div><h3 class="title">12.6.4. Evaluating Client Scopes</h3></div></div></div><p id="proc_evaluating_client_scopes_server_administration_guide" class="_abstract _abstract">
					The <span class="strong strong"><strong>Mappers</strong></span> tab contains the protocol mappers and the <span class="strong strong"><strong>Scope</strong></span> tab contains the role scope mappings declared for this client. They do not contain the mappers and scope mappings inherited from client scopes. It is possible to see the effective protocol mappers (that is the protocol mappers defined on the client itself as well as inherited from the linked client scopes) and the effective role scope mappings used when generating a token for a client.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click the <span class="strong strong"><strong>Client Scopes</strong></span> tab for the client.
						</li><li class="listitem">
							Open the sub-tab <span class="strong strong"><strong>Evaluate</strong></span>.
						</li><li class="listitem">
							Select the optional client scopes that you want to apply.
						</li></ol></div><p>
					This will also show you the value of the <span class="strong strong"><strong>scope</strong></span> parameter. This parameter needs to be sent from the application to the Red Hat Single Sign-On OpenID Connect authorization endpoint.
				</p><div class="formalpara"><p class="title"><strong>Evaluating client scopes</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-scopes-evaluate.png" alt="client scopes evaluate"/></span>
					</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						To send a custom value for a <span class="strong strong"><strong>scope</strong></span> parameter from your application, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_params_forwarding">parameters forwarding section</a>, for servlet adapters or the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_javascript_adapter">javascript adapter section</a>, for javascript adapters.
					</p></div></div><p>
					All examples are generated for the particular user and issued for the particular client, with the specified value of the <span class="strong strong"><strong>scope</strong></span> parameter. The examples include all of the claims and role mappings used.
				</p></section><section class="section" id="client_scopes_permissions"><div class="titlepage"><div><div><h3 class="title">12.6.5. Client scopes permissions</h3></div></div></div><p>
					When issuing tokens to a user, the client scope applies only if the user is permitted to use it.
				</p><p>
					When a client scope does not have any role scope mappings defined, each user is permitted to use this client scope. However, when a client scope has role scope mappings defined, the user must be a member of at least one of the roles. There must be an intersection between the user roles and the roles of the client scope. Composite roles are factored into evaluating this intersection.
				</p><p>
					If a user is not permitted to use the client scope, no protocol mappers or role scope mappings will be used when generating tokens. The client scope will not appear in the <span class="emphasis"><em>scope</em></span> value in the token.
				</p></section><section class="section" id="realm_default_client_scopes"><div class="titlepage"><div><div><h3 class="title">12.6.6. Realm default client scopes</h3></div></div></div><p id="proc_updating_client_scopes_server_administration_guide" class="_abstract _abstract">
					Use <span class="strong strong"><strong>Realm Default Client Scopes</strong></span> to define sets of client scopes that are automatically linked to newly created clients.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click the <span class="strong strong"><strong>Client Scopes</strong></span> tab for the client.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Default Client Scopes</strong></span>.
						</li></ol></div><p>
					From here, select the client scopes that you want to add as <span class="strong strong"><strong>Default Client Scopes</strong></span> to newly created clients and <span class="strong strong"><strong>Optional Client Scopes</strong></span>.
				</p><div class="formalpara"><p class="title"><strong>Default client scopes</strong></p><p>
						<span class="inlinemediaobject"><img src="images/rhsso-images/client-scopes-default.png" alt="client scopes default"/></span>
					</p></div><p>
					When a client is created, you can unlink the default client scopes, if needed. This is similar to removing <a class="link" href="#default_roles" title="7.5. Using default roles">Default Roles</a>.
				</p></section><section class="section" id="scopes_explained"><div class="titlepage"><div><div><h3 class="title">12.6.7. Scopes explained</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Client scope</span></dt><dd>
								Client scopes are entities in Red Hat Single Sign-On that are configured at the realm level and can be linked to clients. Client scopes are referenced by their name when a request is sent to the Red Hat Single Sign-On authorization endpoint with a corresponding value of the <span class="strong strong"><strong>scope</strong></span> parameter. See the <a class="link" href="#client_scopes_linking" title="12.6.3. Link client scope with the client">client scopes linking</a> section for more details.
							</dd><dt><span class="term">Role scope mapping</span></dt><dd>
								This is available under the <span class="strong strong"><strong>Scope</strong></span> tab of a client or client scope. Use <span class="strong strong"><strong>Role scope mapping</strong></span> to limit the roles that can be used in the access tokens. See the <a class="link" href="#role_scope_mappings" title="7.6. Role scope mappings">Role Scope Mappings section</a> for more details.
							</dd></dl></div></section></section><section class="section" id="client_policies"><div class="titlepage"><div><div><h2 class="title">12.7. Client Policies</h2></div></div></div><p>
				To make it easy to secure client applications, it is beneficial to realize the following points in a unified way.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Setting policies on what configuration a client can have
					</li><li class="listitem">
						Validation of client configurations
					</li><li class="listitem">
						Conformance to a required security standards and profiles such as Financial-grade API (FAPI)
					</li></ul></div><p>
				To realize these points in a unified way, <span class="emphasis"><em>Client Policies</em></span> concept is introduced.
			</p><section class="section" id="use_cases"><div class="titlepage"><div><div><h3 class="title">12.7.1. Use-cases</h3></div></div></div><p>
					Client Policies realize the following points mentioned as follows.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Setting policies on what configuration a client can have</span></dt><dd>
								Configuration settings on the client can be enforced by client policies during client creation/update, but also during OpenID Connect requests to Red Hat Single Sign-On server, which are related to particular client. Red Hat Single Sign-On supports similar thing also through the Client Registration Policies described in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_client_registration_policies">Securing Applications and Services Guide</a>. However, Client Registration Policies can only cover OIDC Dynamic Client Registration. Client Policies cover not only what Client Registration Policies can do, but other client registration and configuration ways. The current plans are for Client Registration to be replaced by Client Policies.
							</dd><dt><span class="term">Validation of client configurations</span></dt><dd>
								Red Hat Single Sign-On supports validation whether the client follows settings like Proof Key for Code Exchange, Request Object Signing Algorithm, Holder-of-Key Token, and so on on some endpoints like Authorization Endpoint, Token Endpoint, and so on. These can be specified by each setting item (on Admin Console, switch, pulldown menu and so on). To make the client application secure, the administrator needs to set many settings in the appropriate way, which makes it difficult for the administrator to secure the client application. Client Policies can do these validation of client configurations mentioned just above and they can also be used to auto-configure some client configuration switches to meet the advanced security requirements. In the future, individual client configuration settings may be replaced by Client Policies directly performing required validations.
							</dd><dt><span class="term">Conformance to a required security standards and profiles such as FAPI</span></dt><dd>
								The <span class="emphasis"><em>Global client profiles</em></span> are client profiles pre-configured in Red Hat Single Sign-On by default. They are pre-configured to be compliant with standard security profiles like <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_fapi-support">FAPI</a>, which makes it easy for the administrator to secure their client application to be compliant with the particular security profile. At this moment, Red Hat Single Sign-On has global profiles for the support of FAPI 1 specification. The administrator will just need to configure the client policies to specify which clients should be compliant with the FAPI. The administrator can configure client profiles and client policies, so that Red Hat Single Sign-On clients can be easily made compliant with various other security profiles like SPA, Native App, Open Banking and so on.
							</dd></dl></div></section><section class="section" id="protocol_2"><div class="titlepage"><div><div><h3 class="title">12.7.2. Protocol</h3></div></div></div><p>
					The client policy concept is independent of any specific protocol. However, Red Hat Single Sign-On currently supports it only just for the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_oidc">OpenID Connect (OIDC) protocol</a>.
				</p></section><section class="section" id="architecture"><div class="titlepage"><div><div><h3 class="title">12.7.3. Architecture</h3></div></div></div><p>
					Client Policies consists of the four building blocks: Condition, Executor, Profile and Policy.
				</p><section class="section" id="condition"><div class="titlepage"><div><div><h4 class="title">12.7.3.1. Condition</h4></div></div></div><p>
						A condition determines to which client a policy is adopted and when it is adopted. Some conditions are checked at the time of client create/update when some other conditions are checked during client requests (OIDC Authorization request, Token endpoint request and so on). The condition checks whether one specified criteria is satisfied. For example, some condition checks whether the access type of the client is confidential.
					</p><p>
						The condition can not be used solely by itself. It can be used in a <a class="link" href="#client_policy_policy" title="12.7.3.4. Policy">policy</a> that is described afterwards.
					</p><p>
						A condition can be configurable the same as other configurable providers. What can be configured depends on each condition’s nature.
					</p><p>
						The following conditions are provided:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The way of creating/updating a client</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											Dynamic Client Registration (Anonymous or Authenticated with Initial access token or Registration access token)
										</li><li class="listitem">
											Admin REST API (Admin Console and so on)
										</li></ul></div></dd></dl></div><p>
						So for example when creating a client, a condition can be configured to evaluate to true when this client is created by OIDC Dynamic Client Registration without initial access token (Anonymous Dynamic Client Registration). So this condition can be used for example to ensure that all clients registered through OIDC Dynamic Client Registration are FAPI compliant.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Author of a client (Checked by presence to the particular role or group)</span></dt><dd>
									On OpenID Connect dynamic client registration, an author of a client is the end user who was authenticated to get an access token for generating a new client, not Service Account of the existing client that actually accesses the registration endpoint with the access token. On registration by Admin REST API, an author of a client is the end user like the administrator of the Red Hat Single Sign-On.
								</dd><dt><span class="term">Client Access Type (confidential, public, bearer-only)</span></dt><dd>
									For example when a client sends an authorization request, a policy is adopted if this client is confidential.
								</dd><dt><span class="term">Client Scope</span></dt><dd>
									Evaluates to true if the client has a particular client scope (either as default or as an optional scope used in current request). This can be used for example to ensure that OIDC authorization requests with scope <code class="literal">fapi-example-scope</code> need to be FAPI compliant.
								</dd><dt><span class="term">Client Role</span></dt><dd>
									Applies for clients with the client role of the specified name
								</dd><dt><span class="term">Client Domain Name, Host or IP Address</span></dt><dd>
									Applied for specific domain names of client. Or for the cases when the administrator registers/updates client from particular Host or IP Address.
								</dd><dt><span class="term">Any Client</span></dt><dd>
									This condition always evaluates to true. It can be used for example to ensure that all clients in the particular realm are FAPI compliant.
								</dd></dl></div></section><section class="section" id="executor"><div class="titlepage"><div><div><h4 class="title">12.7.3.2. Executor</h4></div></div></div><p>
						An executor specifies what action is executed on a client to which a policy is adopted. The executor executes one or several specified actions. For example, some executor checks whether the value of the parameter <code class="literal">redirect_uri</code> in the authorization request matches exactly with one of the pre-registered redirect URIs on Authorization Endpoint and rejects this request if not.
					</p><p>
						The executor can not be used solely by itself. It can be used in a <a class="link" href="#client_policy_profile" title="12.7.3.3. Profile">profile</a> that is described afterwards.
					</p><p>
						An executor can be configurable the same as other configurable providers. What can be configured depends on the nature of each executor.
					</p><p>
						An executor acts on various events. An executor implementation can ignore certain types of events (For example, executor for checking OIDC <code class="literal">request</code> object acts just on the OIDC authorization request). Events are:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Creating a client (including creation through dynamic client registration)
							</li><li class="listitem">
								Updating a client
							</li><li class="listitem">
								Sending an authorization request
							</li><li class="listitem">
								Sending a token request
							</li><li class="listitem">
								Sending a token refresh request
							</li><li class="listitem">
								Sending a token revocation request
							</li><li class="listitem">
								Sending a token introspection request
							</li><li class="listitem">
								Sending a userinfo request
							</li><li class="listitem">
								Sending a logout request with a refresh token
							</li></ul></div><p>
						On each event, an executor can work in multiple phases. For example, on creating/updating a client, the executor can modify the client configuration by auto-configure specific client settings. After that, the executor validates this configuration in validation phase.
					</p><p>
						One of several purposes for this executor is to realize the security requirements of client conformance profiles like FAPI. To do so, the following executors are needed:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Enforce secure <a class="link" href="#client-credentials" title="12.1.4. Confidential client credentials">Client Authentication method</a> is used for the client
							</li><li class="listitem">
								Enforce <a class="link" href="#mtls-client-certificate-bound-tokens">Holder-of-key tokens</a> are used
							</li><li class="listitem">
								Enforce <a class="link" href="#proof-key-for-code-exchange">Proof Key for Code Exchange (PKCE)</a> is used
							</li><li class="listitem">
								Enforce secure signature algorithm for <a class="link" href="#client-credentials" title="12.1.4. Confidential client credentials">Signed JWT client authentication (private-key-jwt)</a> is used
							</li><li class="listitem">
								Enforce HTTPS redirect URI and make sure that configured redirect URI does not contain wildcards
							</li><li class="listitem">
								Enforce OIDC <code class="literal">request</code> object satisfying high security level
							</li><li class="listitem">
								Enforce Response Type of OIDC Hybrid Flow including ID Token used as <span class="emphasis"><em>detached signature</em></span> as described in the FAPI 1 specification, which means that ID Token returned from Authorization response won’t contain user profile data
							</li><li class="listitem">
								Enforce more secure <code class="literal">state</code> and <code class="literal">nonce</code> parameters treatment for preventing CSRF
							</li><li class="listitem">
								Enforce more secure signature algorithm when client registration
							</li><li class="listitem">
								Enforce <code class="literal">binding_message</code> parameter is used for CIBA requests
							</li></ul></div></section><section class="section" id="client_policy_profile"><div class="titlepage"><div><div><h4 class="title">12.7.3.3. Profile</h4></div></div></div><p>
						A profile consists of several executors, which can realize a security profile like FAPI. Profile can be configured by the Admin REST API (Admin Console) together with its executors. Three <span class="emphasis"><em>global profiles</em></span> exist and they are configured in Red Hat Single Sign-On by default with pre-configured executors compliant with the FAPI Baseline, FAPI Advanced and FAPI CIBA specifications. More details exist in the FAPI section of the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_fapi-support">Securing Applications and Services Guide</a>.
					</p></section><section class="section" id="client_policy_policy"><div class="titlepage"><div><div><h4 class="title">12.7.3.4. Policy</h4></div></div></div><p>
						A policy consists of several conditions and profiles. The policy can be adopted to clients satisfying all conditions of this policy. The policy refers several profiles and all executors of these profiles execute their task against the client that this policy is adopted to.
					</p></section></section><section class="section" id="configuration"><div class="titlepage"><div><div><h3 class="title">12.7.4. Configuration</h3></div></div></div><p>
					Policies, profiles, conditions, executors can be configured by Admin REST API, which means also the Admin Console. To do so, there is a tab <span class="emphasis"><em>Realm</em></span> → <span class="emphasis"><em>Realm Settings</em></span> → <span class="emphasis"><em>Client Policies</em></span> , which means the administrator can have client policies per realm.
				</p><p>
					The <span class="emphasis"><em>Global Client Profiles</em></span> are automatically available in each realm. However there are no client policies configured by default. This means that the administrator is always required to create any client policy if they want for example the clients of his realm to be FAPI compliant. Global profiles cannot be updated, but the administrator can easily use them as a template and create their own profile if they want to do some slight changes in the global profile configurations. There is JSON Editor available in the Admin Console, which simplifies the creation of new profile based on some global profile.
				</p></section><section class="section" id="backward_compatibility"><div class="titlepage"><div><div><h3 class="title">12.7.5. Backward Compatibility</h3></div></div></div><p>
					Client Policies can replace Client Registration Policies described in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_client_registration_policies">Securing Applications and Services Guide</a>. However, Client Registration Policies also still co-exist. This means that for example during a Dynamic Client Registration request to create/update a client, both client policies and client registration policies are applied.
				</p><p>
					The current plans are for the Client Registration Policies feature to be removed and the existing client registration policies will be migrated into new client policies automatically.
				</p></section></section></section><section class="chapter" id="vault-administration"><div class="titlepage"><div><div><h1 class="title">Chapter 13. Using a vault to obtain secrets</h1></div></div></div><p>
			To obtain a secret from a vault rather than entering it directly, enter the following specially crafted string into the appropriate field:
		</p><pre class="screen">**${vault.**_key_**}**</pre><p>
			where the <code class="literal"><span class="emphasis"><em>key</em></span></code> is the name of the secret recognized by the vault.
		</p><p>
			To prevent secrets from leaking across realms, Red Hat Single Sign-On combines the realm name with the <code class="literal"><span class="emphasis"><em>key</em></span></code> obtained from the vault expression. This method means that the <code class="literal"><span class="emphasis"><em>key</em></span></code> does not directly map to an entry in the vault but creates the final entry name according to the algorithm used to combine the <code class="literal"><span class="emphasis"><em>key</em></span></code> with the realm name.
		</p><p>
			You can obtain the secret from the vault in the following fields:
		</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">SMTP password</span></dt><dd>
						In the realm <a class="link" href="#email" title="3.6. Configuring email for a realm">SMTP settings</a>
					</dd><dt><span class="term">LDAP bind credential</span></dt><dd>
						In the <a class="link" href="#ldap" title="4.3. Lightweight Directory Access Protocol (LDAP) and Active Directory">LDAP settings</a> of LDAP-based user federation.
					</dd><dt><span class="term">OIDC identity provider secret</span></dt><dd>
						In the <span class="emphasis"><em>Client Secret</em></span> inside identity provider <a class="link" href="#identity_broker_oidc" title="9.5. OpenID Connect v1.0 identity providers">OpenID Connect Config</a>
					</dd></dl></div><p>
			To use a vault, register a vault provider in Red Hat Single Sign-On. You can use the providers described <a class="link" href="#providers" title="13.1. Kubernetes / OpenShift files plain-text vault provider">here</a> or implement your provider. See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a> for more information.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				Red Hat Single Sign-On permits a maximum of one active vault provider per Red Hat Single Sign-On instance at a time. Configure the vault provider in each instance within the cluster consistently.
			</p></div></div><section class="section" id="providers"><div class="titlepage"><div><div><h2 class="title">13.1. Kubernetes / OpenShift files plain-text vault provider</h2></div></div></div><p>
				Red Hat Single Sign-On supports vault implementation for <a class="link" href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes secrets</a>. You can mount Kubernetes secrets as data volumes, and they appear as a directory with a flat-file structure. Red Hat Single Sign-On represents each secret as a file with the file’s name as the secret name and the file’s contents as the secret value.
			</p><p>
				You must name the files within this directory as the secret name prefixed by the realm name and an underscore. Double all underscores within the secret name or the realm name in the file name. For example, for a field within a realm named <code class="literal">sso_realm</code>, a reference to a secret with the name <code class="literal">secret-name</code> would be written as <code class="literal">${vault.secret-name}</code>, and the file name looked up would be <code class="literal">sso__realm_secret-name</code>. Note the underscore doubled in realm name.
			</p><p>
				To use this type of secret store, you must declare the <code class="literal">files-plaintext</code> vault provider in the standalone.xml file and set its parameter for the directory containing the mounted volume. This example shows the <code class="literal">files-plaintext</code> provider with the directory where vault files are searched set to <code class="literal">standalone/configuration/vault</code> relative to the Red Hat Single Sign-On base directory:
			</p><pre class="programlisting language-xml">&lt;spi name="vault"&gt;
    &lt;default-provider&gt;files-plaintext&lt;/default-provider&gt;
    &lt;provider name="files-plaintext" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="dir" value="${jboss.home.dir}/standalone/configuration/vault/" /&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
				Here is the equivalent configuration using CLI commands:
			</p><pre class="programlisting language-bash">/subsystem=keycloak-server/spi=vault/:add
/subsystem=keycloak-server/spi=vault/provider=files-plaintext/:add(enabled=true,properties={dir =&gt; "${jboss.home.dir}/standalone/configuration/vault"})</pre></section><section class="section" id="elytron_credential_store_vault_provider"><div class="titlepage"><div><div><h2 class="title">13.2. Elytron credential store vault provider</h2></div></div></div><p>
				Red Hat Single Sign-On also provides support for reading secrets stored in an Elytron credential store. The <code class="literal">elytron-cs-keystore</code> vault provider can retrieve secrets from the credential store’s keystore based implementation, which is also the default implementation Elytron provides.
			</p><p>
				A keystore backs this credential store. <code class="literal">JCEKS</code> is the default format, but you can use other formats such as <code class="literal">PKCS12</code>. Users can create and manage the store contents using the <code class="literal">elytron</code> subsystem in WildFly/JBoss EAP, or the <code class="literal">elytron-tool.sh</code> script.
			</p><p>
				To use this provider, you must declare the <code class="literal">elytron-cs-keystore</code> in the <code class="literal">keycloak-server</code> subsystem and set the location and master secret of the keystore created by Elytron. An example of the minimal configuration for the provider follows:
			</p><pre class="programlisting language-xml">&lt;spi name="vault"&gt;
    &lt;default-provider&gt;elytron-cs-keystore&lt;/default-provider&gt;
    &lt;provider name="elytron-cs-keystore" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="location" value="${jboss.home.dir}/standalone/configuration/vault/credential-store.jceks" /&gt;
            &lt;property name="secret" value="secretpw1!"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
				If the underlying keystore has a format different from <code class="literal">JCEKS</code>, you must specify this format by using the <code class="literal">keyStoreType</code>:
			</p><pre class="programlisting language-xml">&lt;spi name="vault"&gt;
    &lt;default-provider&gt;elytron-cs-keystore&lt;/default-provider&gt;
    &lt;provider name="elytron-cs-keystore" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="location" value="${jboss.home.dir}/standalone/configuration/vault/credential-store.p12" /&gt;
            &lt;property name="secret" value="secretpw1!"/&gt;
            &lt;property name="keyStoreType" value="PKCS12"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
				For the secret, the <code class="literal">elytron-cs-keystore</code> provider supports clear-text values and masked values by using the <code class="literal">elytron-tool.sh</code> script:
			</p><pre class="programlisting language-xml">&lt;spi name="vault"&gt;
   ...
            &lt;property name="secret" value="MASK-3u2HNQaMogJJ8VP7J6gRIl;12345678;321"/&gt;
   ...
&lt;/spi&gt;</pre><p>
				For more information about creating and managing elytron credential stores and masking keystore secrets, see the Elytron documentation.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On implements the <code class="literal">elytron-cs-keystore</code> vault provider as a WildFly extension and is available if the Red Hat Single Sign-On server runs on WildFly/JBoss EAP only.
				</p></div></div></section><section class="section" id="key_resolvers"><div class="titlepage"><div><div><h2 class="title">13.3. Key resolvers</h2></div></div></div><p>
				All built-in providers support the configuration of key resolvers. A key resolver implements the algorithm or strategy for combining the realm name with the key, obtained from the <code class="literal">${vault.key}</code> expression, into the final entry name used to retrieve the secret from the vault. Red Hat Single Sign-On uses the <code class="literal">keyResolvers</code> property to configure the resolvers that the provider uses. The value is a comma-separated list of resolver names. An example of the configuration for the <code class="literal">files-plaintext</code> provider follows:
			</p><pre class="programlisting language-xml">&lt;spi name="vault"&gt;
    &lt;default-provider&gt;files-plaintext&lt;/default-provider&gt;
    &lt;provider name="files-plaintext" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="dir" value="${jboss.home.dir}/standalone/configuration/vault/" /&gt;
            &lt;property name="keyResolvers" value="REALM_UNDERSCORE_KEY, KEY_ONLY"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
				The resolvers run in the same order you declare them in the configuration. For each resolver, Red Hat Single Sign-On uses the last entry name the resolver produces, which combines the realm with the vault key to search for the vault’s secret. If Red Hat Single Sign-On finds a secret, it returns the secret. If not, Red Hat Single Sign-On uses the next resolver. This search continues until Red Hat Single Sign-On finds a non-empty secret or runs out of resolvers. If Red Hat Single Sign-On finds no secret, Red Hat Single Sign-On returns an empty secret.
			</p><p>
				In the previous example, Red Hat Single Sign-On uses the <code class="literal">REALM_UNDERSCORE_KEY</code> resolver first. If Red Hat Single Sign-On finds an entry in the vault that using that resolver, Red Hat Single Sign-On returns that entry. If not, Red Hat Single Sign-On searches again using the <code class="literal">KEY_ONLY</code> resolver. If Red Hat Single Sign-On finds an entry by using the <code class="literal">KEY_ONLY</code> resolver, Red Hat Single Sign-On returns that entry. If Red Hat Single Sign-On uses all resolvers, Red Hat Single Sign-On returns an empty secret.
			</p><p>
				A list of the currently available resolvers follows:
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556181008224" scope="col">Name</th><th align="left" valign="top" id="idm140556181007136" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556181008224">
							<p>
								KEY_ONLY
							</p>
							</td><td align="left" valign="top" headers="idm140556181007136">
							<p>
								Red Hat Single Sign-On ignores the realm name and uses the key from the vault expression.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556181008224">
							<p>
								REALM_UNDERSCORE_KEY
							</p>
							</td><td align="left" valign="top" headers="idm140556181007136">
							<p>
								Red Hat Single Sign-On combines the realm and key by using an underscore character. Red Hat Single Sign-On escapes occurrences of underscores in the realm or key with another underscore character. For example, if the realm is called <code class="literal">master_realm</code> and the key is <code class="literal">smtp_key</code>, the combined key is <code class="literal">master__realm_smtp__key</code>.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556181008224">
							<p>
								REALM_FILESEPARATOR_KEY
							</p>
							</td><td align="left" valign="top" headers="idm140556181007136">
							<p>
								Red Hat Single Sign-On combines the realm and key by using the platform file separator character.
							</p>
							</td></tr></tbody></table></div><p>
				If you have not configured a resolver for the built-in providers, Red Hat Single Sign-On selects the <code class="literal">REALM_UNDERSCORE_KEY</code>.
			</p></section><section class="section" id="sample_configuration"><div class="titlepage"><div><div><h2 class="title">13.4. Sample Configuration</h2></div></div></div><p>
				The following is an example of configuring a vault and credential store. The procedure involves two parts:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Creating the credential store and a vault, where the credential store and vault passwords are in plain text.
					</li><li class="listitem">
						Updating the credential store and vault to have the password use a mask provided by <code class="literal">elytron-tool.sh</code>.
					</li></ul></div><p>
				In this example, the test target used is an LDAP instance with <code class="literal">BIND DN credential: secret12</code>. The target is mapped using user federation in the realm <code class="literal">ldaptest</code>.
			</p><section class="section" id="configuring_the_credential_store_and_vault_without_a_mask"><div class="titlepage"><div><div><h3 class="title">13.4.1. Configuring the credential store and vault without a mask</h3></div></div></div><p>
					You create the credential store and a vault where the credential store and vault passwords are in plain text.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							A running LDAP instance has <code class="literal">BIND DN credential: secret12</code>.
						</li><li class="listitem">
							The alias uses the format &lt;realm-name&gt;_&lt; key-value&gt; when using the default key resolver. In this case, the instance is running in the realm <code class="literal">ldaptest</code> and <code class="literal">ldaptest_ldap_secret</code> is the alias that corresponds to the value <code class="literal">ldap_secret</code> in that realm.
						</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The resolver replaces underscore characters with double underscore characters in the realm and key names. For example, for the key <code class="literal">ldaptest_ldap_secret</code>, the final key will be <code class="literal">ldaptest_ldap__secret</code>.
					</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create the Elytron credential store.
						</p><pre class="programlisting language-bash">[standalone@localhost:9990 /] /subsystem=elytron/credential-store=test-store:add(create=true, location=/home/test/test-store.p12, credential-reference={clear-text=testpwd1!},implementation-properties={keyStoreType=PKCS12})</pre></li><li class="listitem"><p class="simpara">
							Add an alias to the credential store.
						</p><pre class="programlisting language-bash">/subsystem=elytron/credential-store=test-store:add-alias(alias=ldaptest_ldap__secret,secret-value=secret12)</pre><p class="simpara">
							Notice how the resolver causes the key <code class="literal">ldaptest_ldap__secret</code> to use double underscores.
						</p></li><li class="listitem"><p class="simpara">
							List the aliases from the credential store to inspect the contents of the keystore that is produced by Elytron.
						</p><pre class="programlisting language-bash">keytool -list -keystore /home/test/test-store.p12 -storetype PKCS12 -storepass testpwd1!
Keystore type: PKCS12
Keystore provider: SUN

Your keystore contains 1 entries

ldaptest_ldap__secret/passwordcredential/clear/, Oct 12, 2020, SecretKeyEntry,</pre></li><li class="listitem"><p class="simpara">
							Configure the vault SPI in Red Hat Single Sign-On.
						</p><pre class="programlisting language-bash">/subsystem=keycloak-server/spi=vault:add(default-provider=elytron-cs-keystore)

/subsystem=keycloak-server/spi=vault/provider=elytron-cs-keystore:add(enabled=true, properties={location=&gt;/home/test/test-store.p12, secret=&gt;testpwd1!, keyStoreType=&gt;PKCS12})</pre><p class="simpara">
							At this point, the vault and credentials store passwords are not masked.
						</p><pre class="programlisting language-bash">        &lt;spi name="vault"&gt;
                &lt;default-provider&gt;elytron-cs-keystore&lt;/default-provider&gt;
                &lt;provider name="elytron-cs-keystore" enabled="true"&gt;
                    &lt;properties&gt;
                        &lt;property name="location" value="/home/test/test-store.p12"/&gt;
                        &lt;property name="secret" value="testpwd1!"/&gt;
                        &lt;property name="keyStoreType" value="PKCS12"/&gt;
                    &lt;/properties&gt;
                &lt;/provider&gt;
            &lt;/spi&gt;

         &lt;credential-stores&gt;
                &lt;credential-store name="test-store" location="/home/test/test-store.p12" create="true"&gt;
                    &lt;implementation-properties&gt;
                        &lt;property name="keyStoreType" value="PKCS12"/&gt;
                    &lt;/implementation-properties&gt;
                    &lt;credential-reference clear-text="testpwd1!"/&gt;
                &lt;/credential-store&gt;
         &lt;/credential-stores&gt;</pre></li><li class="listitem">
							In the LDAP provider, replace <code class="literal">binDN credential</code> with <code class="literal">${vault.ldap_secret}</code>.
						</li><li class="listitem"><p class="simpara">
							Test your LDAP connection.
						</p><div class="formalpara"><p class="title"><strong>LDAP Vault</strong></p><p>
								<span class="inlinemediaobject"><img src="images/ldap-vault.png" alt="LDAP Vault"/></span>
							</p></div></li></ol></div></section><section class="section" id="masking_the_password_in_the_credential_store_and_vault"><div class="titlepage"><div><div><h3 class="title">13.4.2. Masking the password in the credential store and vault</h3></div></div></div><p>
					You can now update the credential store and vault to have passwords that use a mask provided by <code class="literal">elytron-tool.sh</code>.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a masked password using values for the <code class="literal">salt</code> and the <code class="literal">iteration</code> parameters:
						</p><pre class="programlisting language-bash">$ EAP_HOME/bin/elytron-tool.sh mask --salt SALT --iteration ITERATION_COUNT --secret PASSWORD</pre><p class="simpara">
							For example:
						</p><pre class="programlisting language-bash">elytron-tool.sh mask --salt 12345678 --iteration 123 --secret testpwd1!
MASK-3BUbFEyWu0lRAu8.fCqyUk;12345678;123</pre></li><li class="listitem"><p class="simpara">
							Update the Elytron credential store configuration to use the masked password.
						</p><pre class="programlisting language-bash">/subsystem=elytron/credential-store=cs-store:write-attribute(name=credential-reference.clear-text,value="MASK-3BUbFEyWu0lRAu8.fCqyUk;12345678;123")</pre></li><li class="listitem"><p class="simpara">
							Update the Red Hat Single Sign-On vault configuration to use the masked password.
						</p><pre class="programlisting language-bash">/subsystem=keycloak-server/spi=vault/provider=elytron-cs-keystore:remove()
/subsystem=keycloak-server/spi=vault/provider=elytron-cs-keystore:add(enabled=true, properties={location=&gt;/home/test/test-store.p12, secret=&gt;”MASK-3BUbFEyWu0lRAu8.fCqyUk;12345678;123”, keyStoreType=&gt;PKCS12})</pre><p class="simpara">
							The vault and credential store are now masked:
						</p><pre class="programlisting language-bash">        &lt;spi name="vault"&gt;
                &lt;default-provider&gt;elytron-cs-keystore&lt;/default-provider&gt;
                &lt;provider name="elytron-cs-keystore" enabled="true"&gt;
                    &lt;properties&gt;
                        &lt;property name="location" value="/home/test/test-store.p12"/&gt;
                        &lt;property name="secret" value="MASK-3BUbFEyWu0lRAu8.fCqyUk;12345678;123"/&gt;
                        &lt;property name="keyStoreType" value="PKCS12"/&gt;
                    &lt;/properties&gt;
                &lt;/provider&gt;
            &lt;/spi&gt;
         ....
         .....
         &lt;credential-stores&gt;
                &lt;credential-store name="test-store" location="/home/test/test-store.p12" create="true"&gt;
                    &lt;implementation-properties&gt;
                        &lt;property name="keyStoreType" value="PKCS12"/&gt;
                    &lt;/implementation-properties&gt;
                    &lt;credential-reference clear-text="MASK-3BUbFEyWu0lRAu8.fCqyUk;12345678;123"/&gt;
                &lt;/credential-store&gt;
         &lt;/credential-stores&gt;</pre></li><li class="listitem">
							You can now test the connection to the LDAP using <code class="literal">${vault.ldap_secret}</code>.
						</li></ol></div><div class="_additional-resources _additional-resources"><p class="title"><strong>Additional resources</strong></p><p>
						For more information about the Elytron tool, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.3/html/how_to_configure_server_security/securely_storing_credentials#cred_store_elytron_client">Using Credential Stores with Elytron Client</a>.
					</p></div></section></section></section><section class="chapter" id="configuring_auditing_to_track_events"><div class="titlepage"><div><div><h1 class="title">Chapter 14. Configuring auditing to track events</h1></div></div></div><p class="_abstract _abstract">
			Red Hat Single Sign-On includes a suite of auditing capabilities. You can record every login and administrator action and review those actions in the Admin Console. Red Hat Single Sign-On also includes a Listener SPI that listens for events and can trigger actions. Examples of built-in listeners include log files and sending emails if an event occurs.
		</p><section class="section" id="login_events"><div class="titlepage"><div><div><h2 class="title">14.1. Login events</h2></div></div></div><p>
				You can record and view every event that affects users. Red Hat Single Sign-On triggers login events for actions such as successful user login, a user entering an incorrect password, or a user account updating. By default, Red Hat Single Sign-On does not store or display events in the Admin Console. Only the error events are logged to the Admin Console and the server’s log file.
			</p><p>
				To start saving events, enable storage.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Events</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Config</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Event Configuration</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/login-events-config.png" alt="Event Configuration"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Toggle <span class="strong strong"><strong>Save Events</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
					</p><div class="formalpara"><p class="title"><strong>Save Events</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/login-events-settings.png" alt="Save Events"/></span>
						</p></div></li><li class="listitem">
						Specify the events to store in the <span class="strong strong"><strong>Saved Types</strong></span> field.
					</li></ol></div><p>
				You can click the <span class="strong strong"><strong>Clear events</strong></span> button to delete all events.
			</p><p>
				Specify the length of time to store events in the <span class="strong strong"><strong>Expiration</strong></span> field. When you enable login event storage and enable your settings, click the <span class="strong strong"><strong>Save</strong></span> button.
			</p><p>
				Click the <span class="strong strong"><strong>Login Events</strong></span> tab to view the events.
			</p><div class="formalpara"><p class="title"><strong>Login Events</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/login-events.png" alt="Login Events"/></span>
				</p></div><p>
				You can filter events using the <span class="strong strong"><strong>Filter</strong></span> button.
			</p><div class="formalpara"><p class="title"><strong>Login Events Filter</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/login-events-filter.png" alt="Login Events Filter"/></span>
				</p></div><p>
				In this example, we filter only <code class="literal">Login</code> events. Click <span class="strong strong"><strong>Update</strong></span> to run the filter.
			</p><section class="section" id="event_types"><div class="titlepage"><div><div><h3 class="title">14.1.1. Event types</h3></div></div></div><p>
					<span class="strong strong"><strong>Login events:</strong></span>
				</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556180883024" scope="col">Event</th><th align="left" valign="top" id="idm140556180881936" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556180883024">
								<p>
									Login
								</p>
								</td><td align="left" valign="top" headers="idm140556180881936">
								<p>
									A user logs in.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180883024">
								<p>
									Register
								</p>
								</td><td align="left" valign="top" headers="idm140556180881936">
								<p>
									A user registers.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180883024">
								<p>
									Logout
								</p>
								</td><td align="left" valign="top" headers="idm140556180881936">
								<p>
									A user logs out.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180883024">
								<p>
									Code to Token
								</p>
								</td><td align="left" valign="top" headers="idm140556180881936">
								<p>
									An application, or client, exchanges a code for a token.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180883024">
								<p>
									Refresh Token
								</p>
								</td><td align="left" valign="top" headers="idm140556180881936">
								<p>
									An application, or client, refreshes a token.
								</p>
								</td></tr></tbody></table></div><p>
					<span class="strong strong"><strong>Account events:</strong></span>
				</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556180855792" scope="col">Event</th><th align="left" valign="top" id="idm140556180854704" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Social Link
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									A user account links to a social media provider.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Remove Social Link
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									The link from a social media account to a user account severs.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Update Email
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									An email address for an account changes.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Update Profile
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									A profile for an account changes.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Send Password Reset
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									Red Hat Single Sign-On sends a password reset email.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Update Password
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									The password for an account changes.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Update TOTP
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									The Time-based One-time Password (TOTP) settings for an account changes.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Remove TOTP
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									Red Hat Single Sign-On removes TOTP from an account.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Send Verify Email
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									Red Hat Single Sign-On sends an email verification email.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm140556180855792">
								<p>
									Verify Email
								</p>
								</td><td align="left" valign="top" headers="idm140556180854704">
								<p>
									Red Hat Single Sign-On verifies the email address for an account.
								</p>
								</td></tr></tbody></table></div><p>
					Each event has a corresponding error event.
				</p></section><section class="section" id="event_listener"><div class="titlepage"><div><div><h3 class="title">14.1.2. Event listener</h3></div></div></div><p>
					Event listeners listen for events and perform actions based on that event. Red Hat Single Sign-On includes two built-in listeners, the Logging Event Listener and Email Event Listener.
				</p><section class="section" id="the_logging_event_listener"><div class="titlepage"><div><div><h4 class="title">14.1.2.1. The logging event listener</h4></div></div></div><p>
						When the Logging Event Listener is enabled, this listener writes to a log file when an error event occurs.
					</p><p>
						An example log message from a Logging Event Listener:
					</p><pre class="screen">11:36:09,965 WARN  [org.keycloak.events] (default task-51) type=LOGIN_ERROR, realmId=master,
                    clientId=myapp,
                    userId=19aeb848-96fc-44f6-b0a3-59a17570d374, ipAddress=127.0.0.1,
                    error=invalid_user_credentials, auth_method=openid-connect, auth_type=code,
                    redirect_uri=http://localhost:8180/myapp,
                    code_id=b669da14-cdbb-41d0-b055-0810a0334607, username=admin</pre><p>
						You can use the Logging Event Listener to protect against hacker bot attacks:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Parse the log file for the <code class="literal">LOGIN_ERROR</code> event.
							</li><li class="listitem">
								Extract the IP Address of the failed login event.
							</li><li class="listitem">
								Send the IP address to an intrusion prevention software framework tool.
							</li></ol></div><p>
						The Logging Event Listener logs events to the <code class="literal">org.keycloak.events</code> log category. Red Hat Single Sign-On does not include debug log events in server logs, by default.
					</p><p>
						To include debug log events in server logs:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Edit the <code class="literal">standalone.xml</code> file.
							</li><li class="listitem">
								Change the log level used by the Logging Event listener.
							</li></ol></div><p>
						Alternately, you can configure the log level for <code class="literal">org.keycloak.events</code>.
					</p><p>
						For example, to change the log level add the following:
					</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:logging:..."&gt;
    ...
    &lt;logger category="org.keycloak.events"&gt;
        &lt;level name="DEBUG"/&gt;
    &lt;/logger&gt;
&lt;/subsystem&gt;</pre><p>
						To change the log level used by the Logging Event listener, add the following:
					</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:keycloak-server:..."&gt;
    ...
    &lt;spi name="eventsListener"&gt;
      &lt;provider name="jboss-logging" enabled="true"&gt;
        &lt;properties&gt;
          &lt;property name="success-level" value="info"/&gt;
          &lt;property name="error-level" value="error"/&gt;
        &lt;/properties&gt;
      &lt;/provider&gt;
    &lt;/spi&gt;
&lt;/subsystem&gt;</pre><p>
						The valid values for log levels are <code class="literal">debug</code>, <code class="literal">info</code>, <code class="literal">warn</code>, <code class="literal">error</code>, and <code class="literal">fatal</code>.
					</p></section><section class="section" id="the_email_event_listener"><div class="titlepage"><div><div><h4 class="title">14.1.2.2. The Email Event Listener</h4></div></div></div><p>
						The Email Event Listener sends an email to the user’s account when an event occurs and supports the following events:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Login Error.
							</li><li class="listitem">
								Update Password.
							</li><li class="listitem">
								Update Time-based One-time Password (TOTP).
							</li><li class="listitem">
								Remove Time-based One-time Password (TOTP).
							</li></ul></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
							To enable the Email Listener:
						</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click <span class="strong strong"><strong>Events</strong></span> from the menu.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Config</strong></span> tab.
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Event Listeners</strong></span> field.
							</li><li class="listitem">
								Select <code class="literal">email</code>.
							</li></ol></div><p>
						You can exclude events by editing the <code class="literal">standalone.xml</code>, <code class="literal">standalone-ha.xml</code>, or <code class="literal">domain.xml</code> configuration files included in your distribution. For example:
					</p><pre class="programlisting language-xml">&lt;spi name="eventsListener"&gt;
  &lt;provider name="email" enabled="true"&gt;
    &lt;properties&gt;
      &lt;property name="exclude-events" value="[&amp;quot;UPDATE_TOTP&amp;quot;,&amp;quot;REMOVE_TOTP&amp;quot;]"/&gt;
    &lt;/properties&gt;
  &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
						You can set a maximum length of the Event detail in the database by editing the <code class="literal">standalone.xml</code>, <code class="literal">standalone-ha.xml</code>, or <code class="literal">domain.xml</code> configuration files. This setting is useful if a field (for example, redirect_uri) is long. For example:
					</p><pre class="programlisting language-xml">&lt;spi name="eventsStore"&gt;
    &lt;provider name="jpa" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="max-detail-length" value="1000"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
						See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/">Server Installation and Configuration Guide</a> for more details on the location of the <code class="literal">standalone.xml</code>, <code class="literal">standalone-ha.xml</code>, or <code class="literal">domain.xml</code> files.
					</p></section></section></section><section class="section" id="admin_events"><div class="titlepage"><div><div><h2 class="title">14.2. Admin events</h2></div></div></div><p>
				You can record all actions that are performed by an administrator in the Admin Console. The Admin Console performs administrative actions by invoking the Red Hat Single Sign-On REST interface and Red Hat Single Sign-On audits these REST invocations. You can view the resulting events in the Admin Console.
			</p><p>
				To enable auditing of Admin actions:
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Events</strong></span> in the menu.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Config</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Event configuration</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/login-events-config.png" alt="Event Configuration"/></span>
						</p></div></li><li class="listitem"><p class="simpara">
						Toggle <span class="strong strong"><strong>Save Events</strong></span> to <span class="strong strong"><strong>ON</strong></span> in the <span class="strong strong"><strong>Admin Events Settings</strong></span> section. Red Hat Single Sign-On displays the <span class="strong strong"><strong>Include Representation</strong></span> switch.
					</p><div class="formalpara"><p class="title"><strong>Admin event configuration</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/admin-events-settings.png" alt="Admin Event Configuration"/></span>
						</p></div></li><li class="listitem">
						Toggle <span class="strong strong"><strong>Include Representation</strong></span> to <span class="strong strong"><strong>ON</strong></span>.
					</li></ol></div><p>
				The <code class="literal">Include Representation</code> switch includes JSON documents sent through the admin REST API so you can view the administrators actions. To clear the database of stored actions, click <span class="strong strong"><strong>Clear admin events</strong></span>.
			</p><p>
				To view the admin events, click the <span class="strong strong"><strong>Admin Events</strong></span> tab.
			</p><div class="formalpara"><p class="title"><strong>Admin events</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/admin-events.png" alt="Admin Events"/></span>
				</p></div><p>
				If the <code class="literal">Details</code> column has a <span class="strong strong"><strong>Representation</strong></span> button, click the <span class="strong strong"><strong>Representation</strong></span> button to view the JSON Red Hat Single Sign-On sent with the operation.
			</p><div class="formalpara"><p class="title"><strong>Admin representation</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/admin-events-representation.png" alt="Admin Representation"/></span>
				</p></div><p>
				Click <code class="literal">Filter</code> to view specific events.
			</p><div class="formalpara"><p class="title"><strong>Admin event filter</strong></p><p>
					<span class="inlinemediaobject"><img src="images/rhsso-images/admin-events-filter.png" alt="Admin Event Filter"/></span>
				</p></div></section></section><section class="chapter" id="assembly-exporting-importing_server_administration_guide"><div class="titlepage"><div><div><h1 class="title">Chapter 15. Importing and exporting the database</h1></div></div></div><p class="_abstract _abstract">
			Red Hat Single Sign-On includes the ability to export and import its entire database.
		</p><p>
			You can migrate the whole Red Hat Single Sign-On database from one environment to another or migrate to another database. The export/import triggers at server boot time, and its parameters pass through Java properties.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				Because import and export trigger at server startup, take no actions on the server or the database during export/import.
			</p></div></div><p>
			You can export/import your database to:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					A directory on the filesystem.
				</li><li class="listitem">
					A single JSON file on your filesystem.
				</li></ul></div><p>
			When importing from a directory, the filenames must follow this naming convention:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					&lt;REALM_NAME&gt;-realm.json. For example, "acme-roadrunner-affairs-realm.json" for the realm named "acme-roadrunner-affairs".
				</li><li class="listitem">
					&lt;REALM_NAME&gt;-users-&lt;INDEX&gt;.json. For example, "acme-roadrunner-affairs-users-0.json" for the first user’s file of the realm named "acme-roadrunner-affairs"
				</li></ul></div><p>
			If you export to a directory, you can specify the number of users stored in each JSON file.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				Exporting into single files can produce large files, so if your database contains more than 500 users, export to a directory and not a single file. Exporting many users into a directory performs optimally as the directory provider uses a separate transaction for each "page" (a file of users).
			</p><p>
				The default count of users per file and per transaction is fifty, but you can override this number. See <a class="link" href="#keycloak-migration-usersPerFile">keycloak.migration.usersPerFile</a> for more information.
			</p><p>
				Exporting to or importing from a single file uses one transaction, which can impair performance if the database contains many users.
			</p></div></div><p>
			To export into an unencrypted directory:
		</p><pre class="screen">bin/standalone.sh -Dkeycloak.migration.action=export
-Dkeycloak.migration.provider=dir -Dkeycloak.migration.dir=&lt;DIR TO EXPORT TO&gt;</pre><p>
			To export into single JSON file:
		</p><pre class="screen">bin/standalone.sh -Dkeycloak.migration.action=export
-Dkeycloak.migration.provider=singleFile -Dkeycloak.migration.file=&lt;FILE TO EXPORT TO&gt;</pre><p>
			Similarly, for importing,use <code class="literal">-Dkeycloak.migration.action=import</code> rather than <code class="literal">export</code>. For example:
		</p><pre class="screen">bin/standalone.sh -Dkeycloak.migration.action=import
-Dkeycloak.migration.provider=singleFile -Dkeycloak.migration.file=&lt;FILE TO IMPORT&gt;
-Dkeycloak.migration.strategy=OVERWRITE_EXISTING</pre><p>
			Other command line options include:
		</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-Dkeycloak.migration.realmName</span></dt><dd>
						Use this property to export one specifically named realm. If this parameter is not specified, all realms export.
					</dd><dt><span class="term">-Dkeycloak.migration.usersExportStrategy</span></dt><dd><p class="simpara">
						This property specifies where users export to. Possible values include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								DIFFERENT_FILES - Users export into different files subject to the maximum <a class="link" href="#keycloak-migration-usersPerFile">number of users per file</a>. DIFFERENT_FILES is the default value for this property.
							</li><li class="listitem">
								SKIP - Red Hat Single Sign-On skips exporting users.
							</li><li class="listitem">
								REALM_FILE - Users export to the same file with the realm settings. The file is similar to "foo-realm.json" with realm data and users.
							</li><li class="listitem">
								SAME_FILE - Users export to the same file but different from the realm file. The result is similar to "foo-realm.json" with realm data and "foo-users.json" with users.
							</li></ul></div></dd></dl></div><div class="variablelist" id="keycloak-migration-usersPerFile"><dl class="variablelist"><dt><span class="term">-Dkeycloak.migration.usersPerFile</span></dt><dd>
						This property specifies the number of users per file and database transaction. By default, its value is fifty. Red Hat Single Sign-On uses this property if keycloak.migration.usersExportStrategy is DIFFERENT_FILES.
					</dd><dt><span class="term">-Dkeycloak.migration.strategy</span></dt><dd>
						Red Hat Single Sign-On uses this property when importing. It specifies how to proceed when a realm with the same name already exists in the database.
					</dd></dl></div><p>
			Possible values are:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					IGNORE_EXISTING - Do not import a realm if a realm with the same name already exists.
				</li><li class="listitem">
					OVERWRITE_EXISTING - Remove the existing realm and import the realm again with new data from the JSON file. Use this value to migrate from one environment to another fully.
				</li></ul></div><p>
			If you are importing files that are not from a Red Hat Single Sign-On export, use the <code class="literal">keycloak.import</code> option. If you are importing more than one realm file, specify a comma-separated list of filenames. A list of filenames is more suitable than the previous cases because this happens after Red Hat Single Sign-On initializes the master realm.
		</p><p>
			Examples:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					-Dkeycloak.import=/tmp/realm1.json
				</li><li class="listitem">
					-Dkeycloak.import=/tmp/realm1.json,/tmp/realm2.json
				</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				You cannot use the <code class="literal">keycloak.import</code> parameter with <code class="literal">keycloak.migration.X</code> parameters. If you use these parameters together, Red Hat Single Sign-On ignores the <code class="literal">keycloak.import</code> parameter. The <code class="literal">keycloak.import</code> mechanism ignores the realms which already exist in Red Hat Single Sign-On. The <code class="literal">keycloak.import</code> mechanism is convenient for development purposes, but if more flexibility is needed, use the <code class="literal">keycloak.migration.X</code> parameters.
			</p></div></div><section class="section" id="admin_console_export_import"><div class="titlepage"><div><div><h2 class="title">15.1. Admin console export/import</h2></div></div></div><p>
				Red Hat Single Sign-On imports most resources from the Admin Console as well as exporting most resources. Red Hat Single Sign-On does not support the export of users.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On masks attributes containing secrets or private information in the export file. Export files from the Admin Console are not suitable for backups or data transfer between servers. Only boot-time exports are suitable for backups or data transfer between servers.
				</p></div></div><p>
				You can use the files created during an export to import from the Admin Console. You can export from one realm and import to another realm, or you can export from one server and import to another.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The admin console export/import permits one realm per file only.
				</p></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					The Admin Console import can overwrite resources. Use this feature with caution, especially on a production server. JSON files from the Admin Console Export operation are not appropriate for data import because they contain invalid values for secrets.
				</p></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					You can use the Admin Console to export clients, groups, and roles. If the database in your realm contains many clients, groups, and roles, the export may take a long time to conclude, and the Red Hat Single Sign-On server may not respond to user requests. Use this feature with caution, especially on a production server.
				</p></div></div></section></section><section class="chapter" id="mitigating_security_threats"><div class="titlepage"><div><div><h1 class="title">Chapter 16. Mitigating security threats</h1></div></div></div><p>
			Security vulnerabilities exist in any authentication server. See the Internet Engineering Task Force’s (IETF) <a class="link" href="https://datatracker.ietf.org/doc/html/rfc6819">OAuth 2.0 Threat Model</a> and the <a class="link" href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-15">OAuth 2.0 Security Best Current Practice</a> for more information.
		</p><section class="section" id="host"><div class="titlepage"><div><div><h2 class="title">16.1. Host</h2></div></div></div><p>
				Red Hat Single Sign-On uses the public hostname in several ways, such as within token issuer fields and URLs in password reset emails.
			</p><p>
				By default, the hostname derives from request headers. No validation exists to ensure a hostname is valid. If you are not using a load balancer, or proxy, with Red Hat Single Sign-On to prevent invalid host headers, configure the acceptable hostnames.
			</p><p>
				The hostname’s Service Provider Interface (SPI) provides a way to configure the hostname for requests. You can use this built-in provider to set a fixed URL for frontend requests while allowing backend requests based on the request URI. If the built-in provider does not have the required capability, you can develop a customized provider.
			</p></section><section class="section" id="admin_endpoints_and_admin_console"><div class="titlepage"><div><div><h2 class="title">16.2. Admin endpoints and Admin Console</h2></div></div></div><p>
				Red Hat Single Sign-On exposes the administrative REST API and the web console on the same port as non-administrative usage by default. Do not expose administrative endpoints externally if external access is not necessary. If you need to expose administrative endpoints externally, you can expose them directly in Red Hat Single Sign-On or use a proxy.
			</p><p>
				To expose endpoints by using a proxy, consult the documentation for the proxy. You need to control access to requests to the <code class="literal">/auth/admin</code> endpoint.
			</p><p>
				Two options are available in Red Hat Single Sign-On to expose endpoints directly, IP restriction and separate ports.
			</p><p>
				When the Admin Console becomes inaccessible on the frontend URL of Red Hat Single Sign-On, configure a fixed admin URL in the default hostname provider.
			</p><section class="section" id="ip_restriction"><div class="titlepage"><div><div><h3 class="title">16.2.1. IP restriction</h3></div></div></div><p>
					You can restrict access to <code class="literal">/auth/admin</code> to only specific IP addresses. For example, restrict access to <code class="literal">/auth/admin</code> to IP addresses in the range <code class="literal">10.0.0.1</code> to <code class="literal">10.0.0.255</code>.
				</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:undertow:12.0"&gt;
    ...
    &lt;server name="default-server"&gt;
        ...
        &lt;host name="default-host" alias="localhost"&gt;
            ...
            &lt;filter-ref name="ipAccess"/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
    &lt;filters&gt;
        &lt;expression-filter name="ipAccess" expression="path-prefix('/auth/admin') -&gt; ip-access-control(acl={'10.0.0.0/24 allow'})"/&gt;
    &lt;/filters&gt;
    ...
&lt;/subsystem&gt;</pre><p>
					You can also restrict access to specific IP addresses by using these CLI commands.:
				</p><pre class="programlisting language-bash">/subsystem=undertow/configuration=filter/expression-filter=ipAccess:add(,expression="path-prefix[/auth/admin] -&gt; ip-access-control(acl={'10.0.0.0/24 allow'})")
/subsystem=undertow/server=default-server/host=default-host/filter-ref=ipAccess:add()</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						For IP restriction using a proxy, configure the proxy to ensure Red Hat Single Sign-On receives the client IP address and not the proxy IP address.
					</p></div></div></section><section class="section" id="port_restriction"><div class="titlepage"><div><div><h3 class="title">16.2.2. Port restriction</h3></div></div></div><p>
					You can expose <code class="literal">/auth/admin</code> to a different unexposed port. For example, expose <code class="literal">/auth/admin</code> on port <code class="literal">8444</code> and prevent access to the default port <code class="literal">8443</code>.
				</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:undertow:12.0"&gt;
    ...
    &lt;server name="default-server"&gt;
        ...
        &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;https-listener name="https-admin" socket-binding="https-admin" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;host name="default-host" alias="localhost"&gt;
            ...
            &lt;filter-ref name="portAccess"/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
    &lt;filters&gt;
        &lt;expression-filter name="portAccess" expression="path-prefix('/auth/admin') and not equals(%p, 8444) -&gt; response-code(403)"/&gt;
    &lt;/filters&gt;
    ...
&lt;/subsystem&gt;

...

&lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;
    ...
    &lt;socket-binding name="https" port="${jboss.https.port:8443}"/&gt;
    &lt;socket-binding name="https-admin" port="${jboss.https.port:8444}"/&gt;
    ...
&lt;/socket-binding-group&gt;</pre><p>
					You can expose <code class="literal">/auth/admin</code> on port <code class="literal">8444</code> and prevent access to the default port <code class="literal">8443</code> by using CLI commands:
				</p><pre class="programlisting language-bash">/socket-binding-group=standard-sockets/socket-binding=https-admin/:add(port=8444)

/subsystem=undertow/server=default-server/https-listener=https-admin:add(socket-binding=https-admin, security-realm=ApplicationRealm, enable-http2=true)

/subsystem=undertow/configuration=filter/expression-filter=portAccess:add(,expression="path-prefix('/auth/admin') and not equals(%p, 8444) -&gt; response-code(403)")
/subsystem=undertow/server=default-server/host=default-host/filter-ref=portAccess:add()</pre></section></section><section class="section" id="password-guess-brute-force-attacks"><div class="titlepage"><div><div><h2 class="title">16.3. Brute force attacks</h2></div></div></div><p>
				A brute force attack attempts to guess a user’s password by trying to log in multiple times. Red Hat Single Sign-On has brute force detection capabilities and can temporarily disable a user account if the number of login failures exceeds a specified threshold.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On disables brute force detection by default. Enable this feature to protect against brute force attacks.
				</p></div></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					To enable this protection:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Realm Settings</strong></span> in the menu
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Security Defenses</strong></span> tab.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Brute Force Detection</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Brute force detection</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/brute-force.png" alt="brute force"/></span>
						</p></div></li></ol></div><p>
				Red Hat Single Sign-On can deploy permanent lockout and temporary lockout actions when it detects an attack. Permanent lockout disables a user account until an administrator re-enables it. Temporary lockout disables a user account for a specific period of time. The time period that the account is disabled increases as the attack continues.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					When a user is temporarily locked and attempts to log in, Red Hat Single Sign-On displays the default <code class="literal">Invalid username or password</code> error message. This message is the same error message as the message displayed for an invalid username or invalid password to ensure the attacker is unaware the account is disabled.
				</p></div></div><p>
				<span class="strong strong"><strong>Common Parameters</strong></span>
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556181527120" scope="col">Name</th><th align="left" valign="top" id="idm140556181526032" scope="col">Description</th><th align="left" valign="top" id="idm140556181524944" scope="col">Default</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556181527120">
							<p>
								Max Login Failures
							</p>
							</td><td align="left" valign="top" headers="idm140556181526032">
							<p>
								The maximum number of login failures.
							</p>
							</td><td align="left" valign="top" headers="idm140556181524944">
							<p>
								30 failures.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556181527120">
							<p>
								Quick Login Check Milliseconds
							</p>
							</td><td align="left" valign="top" headers="idm140556181526032">
							<p>
								The minimum time between login attempts.
							</p>
							</td><td align="left" valign="top" headers="idm140556181524944">
							<p>
								1000 milliseconds.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556181527120">
							<p>
								Minimum Quick Login Wait
							</p>
							</td><td align="left" valign="top" headers="idm140556181526032">
							<p>
								The minimum time the user is disabled when login attempts are quicker than <span class="emphasis"><em>Quick Login Check Milliseconds</em></span>.
							</p>
							</td><td align="left" valign="top" headers="idm140556181524944">
							<p>
								1 minute.
							</p>
							</td></tr></tbody></table></div><p>
				<span class="strong strong"><strong>Permanent Lockout Flow</strong></span>
			</p><div class="informalexample"><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						On successful login
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Reset <code class="literal">count</code>
							</li></ol></div></li><li class="listitem"><p class="simpara">
						On failed login
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Increment <code class="literal">count</code>
							</li><li class="listitem"><p class="simpara">
								If <code class="literal">count</code> greater than <span class="emphasis"><em>Max Login Failures</em></span>
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										Permanently disable user
									</li></ol></div></li><li class="listitem"><p class="simpara">
								Else if the time between this failure and the last failure is less than <span class="emphasis"><em>Quick Login Check Milliseconds</em></span>
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										Temporarily disable user for <span class="emphasis"><em>Minimum Quick Login Wait</em></span>
									</li></ol></div></li></ol></div></li></ol></div><p>
				When Red Hat Single Sign-On disables a user, the user cannot log in until an administrator enables the user. Enabling an account resets the <code class="literal">count</code>.
			</p></div><p>
				<span class="strong strong"><strong>Temporary Lockout Parameters</strong></span>
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm140556181482352" scope="col">Name</th><th align="left" valign="top" id="idm140556181481264" scope="col">Description</th><th align="left" valign="top" id="idm140556181480176" scope="col">Default</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140556181482352">
							<p>
								Wait Increment
							</p>
							</td><td align="left" valign="top" headers="idm140556181481264">
							<p>
								The time added to the time a user is temporarily disabled when the user’s login attempts exceed <span class="emphasis"><em>Max Login Failures</em></span>.
							</p>
							</td><td align="left" valign="top" headers="idm140556181480176">
							<p>
								1 minute.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556181482352">
							<p>
								Max Wait
							</p>
							</td><td align="left" valign="top" headers="idm140556181481264">
							<p>
								The maximum time a user is temporarily disabled.
							</p>
							</td><td align="left" valign="top" headers="idm140556181480176">
							<p>
								15 minutes.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm140556181482352">
							<p>
								Failure Reset Time
							</p>
							</td><td align="left" valign="top" headers="idm140556181481264">
							<p>
								The time when the failure count resets. The timer runs from the last failed login.
							</p>
							</td><td align="left" valign="top" headers="idm140556181480176">
							<p>
								12 hours.
							</p>
							</td></tr></tbody></table></div><p>
				<span class="strong strong"><strong>Temporary Lockout Algorithm</strong></span>
			</p><div class="informalexample"><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						On successful login
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Reset <code class="literal">count</code>
							</li></ol></div></li><li class="listitem"><p class="simpara">
						On failed login
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								If the time between this failure and the last failure is greater than <span class="emphasis"><em>Failure Reset Time</em></span>
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										Reset <code class="literal">count</code>
									</li></ol></div></li><li class="listitem">
								Increment <code class="literal">count</code>
							</li><li class="listitem">
								Calculate <code class="literal">wait</code> using <span class="emphasis"><em>Wait Increment</em></span> * (<code class="literal">count</code> / <span class="emphasis"><em>Max Login Failures</em></span>). The division is an integer division rounded down to a whole number
							</li><li class="listitem"><p class="simpara">
								If <code class="literal">wait</code> equals 0 and the time between this failure and the last failure is less than <span class="emphasis"><em>Quick Login Check Milliseconds</em></span>, set <code class="literal">wait</code> to <span class="emphasis"><em>Minimum Quick Login Wait</em></span>.
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										Temporarily disable the user for the smaller of <code class="literal">wait</code> and <span class="emphasis"><em>Max Wait</em></span> seconds
									</li></ol></div></li></ol></div></li></ol></div><p>
				'count` does not increment when a temporarily disabled account commits a login failure.
			</p></div><p>
				The downside of Red Hat Single Sign-On brute force detection is that the server becomes vulnerable to denial of service attacks. When implementing a denial of service attack, an attacker can attempt to log in by guessing passwords for any accounts it knows and eventually causing Red Hat Single Sign-On to disable the accounts.
			</p><p>
				Consider using intrusion prevention software (IPS). Red Hat Single Sign-On logs every login failure and client IP address failure. You can point the IPS to the Red Hat Single Sign-On server’s log file, and the IPS can modify firewalls to block connections from these IP addresses.
			</p><section class="section" id="password_policies"><div class="titlepage"><div><div><h3 class="title">16.3.1. Password policies</h3></div></div></div><p>
					Ensure you have a complex password policy to force users to choose complex passwords. See the <a class="link" href="#password-policies" title="8.1. Password policies">Password Policies</a> chapter for more information. Prevent password guessing by setting up the Red Hat Single Sign-On server to use one-time-passwords.
				</p></section></section><section class="section" id="read_only_user_attributes"><div class="titlepage"><div><div><h2 class="title">16.4. Read-only user attributes</h2></div></div></div><p>
				Typical users who are stored in Red Hat Single Sign-On have various attributes related to their user profiles. Such attributes include email, firstName or lastname. However users may also have attributes, which are not typical profile data, but rather metadata. The metadata attributes usually should be read-only for the users and the typical users never should have a way to update those attributes from the Red Hat Single Sign-On user interface or Account REST API. Some of the attributes should be even read-only for the administrators when creating or updating user with the Admin REST API.
			</p><p>
				The metadata attributes are usually attributes from those groups:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Various links or metadata related to the user storage providers. For example in case of the LDAP integration, the <code class="literal">LDAP_ID</code> attribute contains the ID of the user in the LDAP server.
					</li><li class="listitem">
						Metadata provisioned by User Storage. For example <code class="literal">createdTimestamp</code> provisioned from the LDAP should be always read-only by user or administrator.
					</li><li class="listitem">
						Metadata related to various authenticators. For example <code class="literal">KERBEROS_PRINCIPAL</code> attribute can contain the kerberos principal name of the particular user. Similarly attribute <code class="literal">usercertificate</code> can contain metadata related to binding the user with the data from the X.509 certificate, which is used typically when X.509 certificate authentication is enabled.
					</li><li class="listitem">
						Metadata related to the identificator of users by the applications/clients. For example <code class="literal">saml.persistent.name.id.for.my_app</code> can contain SAML NameID, which will be used by the client application <code class="literal">my_app</code> as the identifier of the user.
					</li><li class="listitem">
						Metadata related to the authorization policies, which are used for the attribute based access control (ABAC). Values of those attributes may be used for the authorization decisions. Hence it is important that those attributes cannot be updated by the users.
					</li></ul></div><p>
				From the long term perspective, Red Hat Single Sign-On will have a proper User Profile SPI, which will allow fine-grained configuration of every user attribute. Currently this capability is not fully available yet. So Red Hat Single Sign-On has the internal list of user attributes, which are read-only for the users and read-only for the administrators configured at the server level.
			</p><p>
				This is the list of the read-only attributes, which are used internally by the Red Hat Single Sign-On default providers and functionalities and hence are always read-only:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						For users: <code class="literal">KERBEROS_PRINCIPAL</code>, <code class="literal">LDAP_ID</code>, <code class="literal">LDAP_ENTRY_DN</code>, <code class="literal">CREATED_TIMESTAMP</code>, <code class="literal">createTimestamp</code>, <code class="literal">modifyTimestamp</code>, <code class="literal">userCertificate</code>, <code class="literal">saml.persistent.name.id.for.*</code>, <code class="literal">ENABLED</code>, <code class="literal">EMAIL_VERIFIED</code>
					</li><li class="listitem">
						For administrators: <code class="literal">KERBEROS_PRINCIPAL</code>, <code class="literal">LDAP_ID</code>, <code class="literal">LDAP_ENTRY_DN</code>, <code class="literal">CREATED_TIMESTAMP</code>, <code class="literal">createTimestamp</code>, <code class="literal">modifyTimestamp</code>
					</li></ul></div><p>
				System administrators have a way to add additional attributes to this list. The configuration is currently available at the server level. You can add this configuration to your <code class="literal">standalone(-*).xml</code> files to the configuration of the Red Hat Single Sign-On server subsystem:
			</p><pre class="screen">&lt;spi name="userProfile"&gt;
    &lt;provider name="legacy-user-profile" enabled="true"&gt;
        &lt;properties&gt;
            &lt;property name="read-only-attributes" value="[&amp;quot;foo&amp;quot;,&amp;quot;bar*&amp;quot;]"/&gt;
            &lt;property name="admin-read-only-attributes" value="[&amp;quot;foo&amp;quot;]"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</pre><p>
				The same can be configured with the usage of the JBoss CLI with the commands:
			</p><pre class="screen">/subsystem=keycloak-server/spi=userProfile/:add
/subsystem=keycloak-server/spi=userProfile/provider=legacy-user-profile/:add(properties={},enabled=true)
/subsystem=keycloak-server/spi=userProfile/provider=legacy-user-profile/:map-put(name=properties,key=read-only-attributes,value=[foo,bar*])
/subsystem=keycloak-server/spi=userProfile/provider=legacy-user-profile/:map-put(name=properties,key=admin-read-only-attributes,value=[foo])</pre><p>
				For this example, users and administrators would not be able to update attribute <code class="literal">foo</code>. Users would not be able to edit any attributes starting with the <code class="literal">bar</code>. So for example <code class="literal">bar</code> or <code class="literal">barrier</code>. Configuration is case insensitive, so attributes like <code class="literal">FOO</code> or <code class="literal">BarRier</code> will be denied as well for this example. The wildcard character <code class="literal">*</code> is supported only at the end of the attribute name, so the administrator can effectively deny all the attributes starting with the specified character. The <code class="literal">*</code> in the middle of the attribute is considered as a normal character.
			</p></section><section class="section" id="clickjacking"><div class="titlepage"><div><div><h2 class="title">16.5. Clickjacking</h2></div></div></div><p>
				Clickjacking is a technique of tricking users into clicking on a user interface element different from what users perceive. A malicious site loads the target site in a transparent iFrame, overlaid on top of a set of dummy buttons placed directly under important buttons on the target site. When a user clicks a visible button, they are clicking a button on the hidden page. An attacker can steal a user’s authentication credentials and access their resources by using this method.
			</p><p>
				By default, every response by Red Hat Single Sign-On sets some specific browser headers that can prevent this from happening. Specifically, it sets <a class="link" href="https://datatracker.ietf.org/doc/html/rfc7034">X-FRAME_OPTIONS</a> and <a class="link" href="http://www.w3.org/TR/CSP/">Content-Security-Policy</a>. You should take a look at the definition of both of these headers as there is a lot of fine-grain browser access you can control.
			</p><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					In the Admin Console, you can specify the values of the X-FRAME_OPTIONS and Content-Security-Policy headers.
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Click the <span class="strong strong"><strong>Realm Settings</strong></span> menu item.
					</li><li class="listitem"><p class="simpara">
						Click the <span class="strong strong"><strong>Security Defenses</strong></span> tab.
					</p><div class="formalpara"><p class="title"><strong>Security Defenses</strong></p><p>
							<span class="inlinemediaobject"><img src="images/rhsso-images/security-headers.png" alt="Security Defences"/></span>
						</p></div></li></ol></div><p>
				By default, Red Hat Single Sign-On only sets up a <span class="emphasis"><em>same-origin</em></span> policy for iframes.
			</p></section><section class="section" id="ssl_https_requirement"><div class="titlepage"><div><div><h2 class="title">16.6. SSL/HTTPS requirement</h2></div></div></div><p>
				OAuth 2.0/OpenID Connect uses access tokens for security. Attackers can scan your network for access tokens and use them to perform malicious operations for which the token has permission. This attack is known as a man-in-the-middle attack. Use SSL/HTTPS for communication between the Red Hat Single Sign-On auth server and the clients Red Hat Single Sign-On secures to prevent man-in-the-middle attacks.
			</p><p>
				Red Hat Single Sign-On has <a class="link" href="#ssl_modes" title="3.4. Configuring SSL for a realm">three modes for SSL/HTTPS</a>. SSL is complex to set up, so Red Hat Single Sign-On allows non-HTTPS communication over private IP addresses such as localhost, 192.168.x.x, and other private IP addresses. In production, ensure you enable SSL and SSL is compulsory for all operations.
			</p><p>
				On the adapter/client-side, you can disable the SSL trust manager. The trust manager ensures the client’s identity that Red Hat Single Sign-On communicates with is valid and ensures the DNS domain name against the server’s certificate. In production, ensure that each of your client adapters uses a truststore to prevent DNS man-in-the-middle attacks.
			</p></section><section class="section" id="csrf_attacks"><div class="titlepage"><div><div><h2 class="title">16.7. CSRF attacks</h2></div></div></div><p>
				A Cross-site request forgery (CSRF) attack uses HTTP requests from users that websites have already authenticated. Any site using cookie-based authentication is vulnerable to CSRF attacks. You can mitigate these attacks by matching a state cookie against a posted form or query parameter.
			</p><p>
				The OAuth 2.0 login specification requires that a state cookie matches against a transmitted state parameter. Red Hat Single Sign-On fully implements this part of the specification, so all logins are protected.
			</p><p>
				The Red Hat Single Sign-On Admin Console is a JavaScript/HTML5 application that makes REST calls to the backend Red Hat Single Sign-On admin REST API. These calls all require bearer token authentication and consist of JavaScript Ajax calls, so CSRF is impossible. You can configure the admin REST API to validate the CORS origins.
			</p><p>
				The user account management section in Red Hat Single Sign-On can be vulnerable to CSRF. To prevent CSRF attacks, Red Hat Single Sign-On sets a state cookie and embeds the value of this cookie in hidden form fields or query parameters within action links. Red Hat Single Sign-On checks the query/form parameter against the state cookie to verify that the user makes the call.
			</p></section><section class="section" id="unspecific-redirect-uris_server_administration_guide"><div class="titlepage"><div><div><h2 class="title">16.8. Unspecific redirect URIs</h2></div></div></div><p>
				Make your registered redirect URIs as specific as feasible. Registering vague redirect URIs for <a class="link" href="#con-oidc-auth-flows_server_administration_guide" title="10.1.1. OIDC auth flows">Authorization Code Flows</a> can allow malicious clients to impersonate another client with broader access. Impersonation can happen if two clients live under the same domain, for example.
			</p></section><section class="section" id="fapi_compliance"><div class="titlepage"><div><div><h2 class="title">16.9. FAPI compliance</h2></div></div></div><p>
				To make sure that Red Hat Single Sign-On server will validate your client to be more secure and FAPI compliant, you can configure client policies for the FAPI support. Details are described in the FAPI section of <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/#_fapi-support">Securing Applications and Services Guide</a>. Among other things, this ensures some security best practices described above like SSL required for clients, secure redirect URI used and more of similar best practices.
			</p></section><section class="section" id="compromised_access_and_refresh_tokens"><div class="titlepage"><div><div><h2 class="title">16.10. Compromised access and refresh tokens</h2></div></div></div><p>
				Red Hat Single Sign-On includes several actions to prevent malicious actors from stealing access tokens and refresh tokens. The crucial action is to enforce SSL/HTTPS communication between Red Hat Single Sign-On and its clients and applications. Red Hat Single Sign-On does not enable SSL by default.
			</p><p>
				Another action to mitigate damage from leaked access tokens is to shorten the token’s lifespans. You can specify token lifespans within the <a class="link" href="#timeouts" title="6.3. Session and token timeouts">timeouts page</a>. Short lifespans for access tokens force clients and applications to refresh their access tokens after a short time. If an admin detects a leak, the admin can log out all user sessions to invalidate these refresh tokens or set up a revocation policy.
			</p><p>
				Ensure refresh tokens always stay private to the client and are never transmitted.
			</p><p>
				You can mitigate damage from leaked access tokens and refresh tokens by issuing these tokens as holder-of-key tokens. See <a class="link" href="#mtls-client-certificate-bound-tokens">OAuth 2.0 Mutual TLS Client Certificate Bound Access Token</a> for more information.
			</p><p>
				If an access token or refresh token is compromised, access the Admin Console and push a not-before revocation policy to all applications. Pushing a not-before policy ensures that any tokens issued before that time become invalid. Pushing a new not-before policy ensures that applications must download new public keys from Red Hat Single Sign-On and mitigate damage from a compromised realm signing key. See the <a class="link" href="#realm_keys" title="3.9. Configuring realm keys">keys chapter</a> for more information.
			</p><p>
				You can disable specific applications, clients, or users if they are compromised.
			</p></section><section class="section" id="compromised_authorization_code"><div class="titlepage"><div><div><h2 class="title">16.11. Compromised authorization code</h2></div></div></div><p>
				For the <a class="link" href="#con-oidc-auth-flows_server_administration_guide" title="10.1.1. OIDC auth flows">OIDC Auth Code Flow</a>, Red Hat Single Sign-On generates a cryptographically strong random value for its authorization codes. An authorization code is used only once to obtain an access token.
			</p><p>
				On the <a class="link" href="#timeouts" title="6.3. Session and token timeouts">timeouts page</a> in the Admin Console, you can specify the length of time an authorization code is valid. Ensure that the length of time is less than 10 seconds, which is long enough for a client to request a token from the code.
			</p><p>
				You can also defend against leaked authorization codes by applying <a class="link" href="#proof-key-for-code-exchange">Proof Key for Code Exchange (PKCE)</a> to clients.
			</p></section><section class="section" id="open_redirectors"><div class="titlepage"><div><div><h2 class="title">16.12. Open redirectors</h2></div></div></div><p>
				An open redirector is an endpoint using a parameter to automatically redirect a user agent to the location specified by the parameter value without validation. An attacker can use the end-user authorization endpoint and the redirect URI parameter to use the authorization server as an open redirector, using a user’s trust in an authorization server to launch a phishing attack.
			</p><p>
				Red Hat Single Sign-On requires that all registered applications and clients register at least one redirection URI pattern. When a client requests that Red Hat Single Sign-On performs a redirect, Red Hat Single Sign-On checks the redirect URI against the list of valid registered URI patterns. Clients and applications must register as specific a URI pattern as possible to mitigate open redirector attacks.
			</p></section><section class="section" id="password_database_compromised"><div class="titlepage"><div><div><h2 class="title">16.13. Password database compromised</h2></div></div></div><p>
				Red Hat Single Sign-On does not store passwords in raw text but as hashed text, using the PBKDF2 hashing algorithm. Red Hat Single Sign-On performs 20,000 hashing iterations, the number of iterations recommended by the security community. This number of hashing iterations can adversely affect performance as PBKDF2 hashing uses a significant amount of CPU resources.
			</p></section><section class="section" id="limiting_scope"><div class="titlepage"><div><div><h2 class="title">16.14. Limiting scope</h2></div></div></div><p>
				By default, new client applications have unlimited <code class="literal">role scope mappings</code>. Every access token for that client contains all permissions that the user has. If an attacker compromises the client and obtains the client’s access tokens, each system that the user can access is compromised.
			</p><p>
				Limit the roles of an access token by using the <a class="link" href="#role_scope_mappings" title="7.6. Role scope mappings">Scope menu</a> for each client. Alternatively, you can set role scope mappings at the Client Scope level and assign Client Scopes to your client by using the <a class="link" href="#client_scopes_linking" title="12.6.3. Link client scope with the client">Client Scope menu</a>.
			</p></section><section class="section" id="limit_token_audience"><div class="titlepage"><div><div><h2 class="title">16.15. Limit token audience</h2></div></div></div><p>
				In environments with low levels of trust among services, limit the audiences on the token. See the <a class="link" href="https://datatracker.ietf.org/doc/html/rfc6819#section-5.1.5.5">OAuth2 Threat Model</a> and the <a class="link" href="#audience-support" title="12.1.6. Audience support">Audience Support</a> section for more information.
			</p></section><section class="section" id="limit-authentication-sessions"><div class="titlepage"><div><div><h2 class="title">16.16. Limit Authentication Sessions</h2></div></div></div><p>
				When a login page is opened for the first time in a web browser, Red Hat Single Sign-On creates an object called authentication session that stores some useful information about the request. Whenever a new login page is opened from a different tab in the same browser, Red Hat Single Sign-On creates a new record called authentication sub-session that is stored within the authentication session. Authentication requests can come from any type of clients such as the Admin CLI. In that case, a new authentication session is also created with one authentication sub-session. Please note that authentication sessions can be created also in other ways than using a browser flow. The text below is applicable regardless of the source flow.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					This section describes deployments that use the RHDG provider for authentication sessions.
				</p></div></div><p>
				Authentication session is internally stored as <code class="literal">RootAuthenticationSessionEntity</code>. Each <code class="literal">RootAuthenticationSessionEntity</code> can have multiple authentication sub-sessions stored within the <code class="literal">RootAuthenticationSessionEntity</code> as a collection of <code class="literal">AuthenticationSessionEntity</code> objects. Red Hat Single Sign-On stores authentication sessions in a dedicated RHDG cache. The number of <code class="literal">AuthenticationSessionEntity</code> per <code class="literal">RootAuthenticationSessionEntity</code> contributes to the size of each cache entry. Total memory footprint of authentication session cache is determined by the number of stored <code class="literal">RootAuthenticationSessionEntity</code> and by the number of <code class="literal">AuthenticationSessionEntity</code> within each <code class="literal">RootAuthenticationSessionEntity</code>.
			</p><p>
				The number of maintained <code class="literal">RootAuthenticationSessionEntity</code> objects corresponds to the number of unfinished login flows from the browser. To keep the number of <code class="literal">RootAuthenticationSessionEntity</code> under control, using an advanced firewall control to limit ingress network traffic is recommended.
			</p><p>
				Higher memory usage may occur for deployments where there are many active <code class="literal">RootAuthenticationSessionEntity</code> with a lot of <code class="literal">AuthenticationSessionEntity</code>. If the load balancer does not support or is not configured for <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/#sticky-sessions">session stickiness</a>, the load over network in a cluster can increase significantly. The reason for this load is that each request that lands on a node that does not own the appropriate authentication session needs to retrieve and update the authentication session record in the owner node which involves a separate network transmission for both the retrieval and the storage.
			</p><p>
				The maximum number of <code class="literal">AuthenticationSessionEntity</code> per <code class="literal">RootAuthenticationSessionEntity</code> can be configured in <code class="literal">authenticationSessions</code> SPI by setting property <code class="literal">authSessionsLimit</code>. The default value is set to 300 <code class="literal">AuthenticationSessionEntity</code> per a <code class="literal">RootAuthenticationSessionEntity</code>. When this limit is reached, the oldest authentication sub-session will be removed after a new authentication session request.
			</p><p>
				The following example shows how to limit the number of active <code class="literal">AuthenticationSessionEntity</code> per a <code class="literal">RootAuthenticationSessionEntity</code> to 100.
			</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:keycloak-server:1.1"&gt;
    ...
    &lt;spi name="authenticationSessions"&gt;
        &lt;default-provider&gt;infinispan&lt;/default-provider&gt;
        &lt;provider name="infinispan" enabled="true"&gt;
            &lt;properties&gt;
                &lt;property name="authSessionsLimit" value="100"/&gt;
            &lt;/properties&gt;
        &lt;/provider&gt;
    &lt;/spi&gt;
    ...
&lt;/subsystem&gt;</pre><p>
				Equivalent configuration using CLI commands:
			</p><pre class="programlisting language-bash">/subsystem=keycloak-server/spi=authenticationSessions:add(default-provider=infinispan)
/subsystem=keycloak-server/spi=authenticationSessions/provider=infinispan:add(properties={authSessionsLimit =&gt; "100"},enabled=true)</pre></section><section class="section" id="sql_injection_attacks"><div class="titlepage"><div><div><h2 class="title">16.17. SQL injection attacks</h2></div></div></div><p>
				Currently, Red Hat Single Sign-On has no known SQL injection vulnerabilities.
			</p></section></section><section class="chapter" id="account-service"><div class="titlepage"><div><div><h1 class="title">Chapter 17. Account Console</h1></div></div></div><p>
			Red Hat Single Sign-On users can manage their accounts through the Account Console. Users can manage their profiles, add two-factor authentication, include identity provider acounts, and manage device activity.
		</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
					The Account Console is completely themeable and internationalizable as is the case with all Red Hat Single Sign-On user interfaces. For example, you can add attributes to the <span class="strong strong"><strong>Personal Info</strong></span> page. For more details, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_developer_guide/">Server Developer Guide</a>.
				</li></ul></div><section class="section" id="accessing_the_account_console"><div class="titlepage"><div><div><h2 class="title">17.1. Accessing the Account Console</h2></div></div></div><p>
				Any user can access the Account Console.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Make note of the realm name and IP address for the Red Hat Single Sign-On server where your account exists.
					</li><li class="listitem">
						In a web browser, enter a URL in this format: <code class="literal">&lt;server-root&gt;/auth/realms/{realm-name}/account</code>.
					</li><li class="listitem">
						Enter your login name and password.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Account Console</strong></p><p>
					<span class="inlinemediaobject"><img src="images/account-console-intro.png" alt="Account Console"/></span>
				</p></div></section><section class="section" id="configuring_ways_to_sign_in"><div class="titlepage"><div><div><h2 class="title">17.2. Configuring ways to sign in</h2></div></div></div><p>
				You can sign in to this console using basic authentication (a login name and password) or two-factor authentication. For two-factor authentication, use one of the following procedures.
			</p><section class="section" id="two_factor_authentication_with_otp"><div class="titlepage"><div><div><h3 class="title">17.2.1. Two-factor authentication with OTP</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							OTP is a valid authentication mechanism for your realm.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Account Security</strong></span> in the menu.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Signing In</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Set Up Authenticator Application</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>Signing In</strong></p><p>
								<span class="inlinemediaobject"><img src="images/account-console-signing-in.png" alt="Signing In"/></span>
							</p></div></li><li class="listitem">
							Follow the directions that appear on the screen to use either <a class="link" href="https://freeotp.github.io/">FreeOTP</a> or <a class="link" href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Google Authenticator</a> on your mobile device as your OTP generator.
						</li><li class="listitem">
							Scan the QR code in the screen shot into the OTP generator on your mobile device.
						</li><li class="listitem">
							Log out and log in again.
						</li><li class="listitem">
							Respond to the prompt by entering an OTP that is provided on your mobile device.
						</li></ol></div></section><section class="section" id="two_factor_authentication_with_webauthn"><div class="titlepage"><div><div><h3 class="title">17.2.2. Two-factor authentication with WebAuthn</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							WebAuthn is a valid two-factor authentication mechanism for your realm. Please follow the <a class="link" href="#webauthn" title="8.6. W3C Web Authentication (WebAuthn)">WebAuthn section</a> for more details.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Account Security</strong></span> in the menu.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Signing In</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Set up Security Key</strong></span>.
						</p><div class="formalpara"><p class="title"><strong>Signing In</strong></p><p>
								<span class="inlinemediaobject"><img src="images/account-console-signing-in-webauthn-2factor.png" alt="Signing In With Security Key"/></span>
							</p></div></li><li class="listitem">
							Prepare your WebAuthn Security Key. How you prepare this key depends on the type of WebAuthn security key you use. For example, for a USB based Yubikey, you may need to put your key into the USB port on your laptop.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Register</strong></span> to register your security key.
						</li><li class="listitem">
							Log out and log in again.
						</li><li class="listitem">
							Assuming authentication flow was correctly set, a message appears asking you to authenticate with your Security Key as second factor.
						</li></ol></div></section><section class="section" id="passwordless_authentication_with_webauthn"><div class="titlepage"><div><div><h3 class="title">17.2.3. Passwordless authentication with WebAuthn</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							WebAuthn is a valid passwordless authentication mechanism for your realm. Please follow the <a class="link" href="#webauthn_passwordless" title="8.6.6. Passwordless WebAuthn together with Two-Factor">Passwordless WebAuthn section</a> for more details.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Click <span class="strong strong"><strong>Account Security</strong></span> in the menu.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Signing In</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Set up Security Key</strong></span> in the <span class="strong strong"><strong>Passwordless</strong></span> section.
						</p><div class="formalpara"><p class="title"><strong>Signing In</strong></p><p>
								<span class="inlinemediaobject"><img src="images/account-console-signing-in-webauthn-passwordless.png" alt="Signing In With Security Key"/></span>
							</p></div></li><li class="listitem">
							Prepare your WebAuthn Security Key. How you prepare this key depends on the type of WebAuthn security key you use. For example, for a USB based Yubikey, you may need to put your key into the USB port on your laptop.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Register</strong></span> to register your security key.
						</li><li class="listitem">
							Log out and log in again.
						</li><li class="listitem">
							Assuming authentication flow was correctly set, a message appears asking you to authenticate with your Security Key as second factor. You no longer need to provide your password to log in.
						</li></ol></div></section></section><section class="section" id="viewing_device_activity"><div class="titlepage"><div><div><h2 class="title">17.3. Viewing device activity</h2></div></div></div><p>
				You can view the devices that are logged in to your account.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Account Security</strong></span> in the menu.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Device Activity</strong></span>.
					</li><li class="listitem">
						Log out a device if it looks suspicious.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Devices</strong></p><p>
					<span class="inlinemediaobject"><img src="images/account-console-device.png" alt="Devices"/></span>
				</p></div></section><section class="section" id="adding_an_identity_provider_acccount"><div class="titlepage"><div><div><h2 class="title">17.4. Adding an identity provider acccount</h2></div></div></div><p>
				You can link your account with an <a class="link" href="#identity_broker" title="Chapter 9. Integrating identity providers">identity broker</a>. This option is often used to link social provider accounts.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log into the Admin Console.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Identity Providers</strong></span> in the menu.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Add provider</strong></span>.
					</li><li class="listitem">
						Select a provider and complete the fields.
					</li><li class="listitem">
						Return to the Account Console.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Account Security</strong></span> in the menu.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Linked Accounts</strong></span>.
					</li></ol></div><p>
				The identity provider you added appears in this page.
			</p><div class="formalpara"><p class="title"><strong>Linked Accounts</strong></p><p>
					<span class="inlinemediaobject"><img src="images/account-console-linked.png" alt="Linked Accounts"/></span>
				</p></div></section><section class="section" id="accessing_other_applications"><div class="titlepage"><div><div><h2 class="title">17.5. Accessing other applications</h2></div></div></div><p>
				The <span class="strong strong"><strong>Applications</strong></span> menu item shows users which applications you can access. In this case, only the Account Console is available.
			</p><div class="formalpara"><p class="title"><strong>Applications</strong></p><p>
					<span class="inlinemediaobject"><img src="images/account-console-applications.png" alt="Applications"/></span>
				</p></div></section></section><section class="chapter" id="admin_cli"><div class="titlepage"><div><div><h1 class="title">Chapter 18. Admin CLI</h1></div></div></div><p>
			With Red Hat Single Sign-On, you can perform administration tasks from the command-line interface (CLI) by using the Admin CLI command-line tool.
		</p><section class="section" id="installing_the_admin_cli"><div class="titlepage"><div><div><h2 class="title">18.1. Installing the Admin CLI</h2></div></div></div><p>
				Red Hat Single Sign-On packages the Admin CLI server distribution with the execution scripts in the <code class="literal">bin</code> directory.
			</p><p>
				The Linux script is called <code class="literal">kcadm.sh</code>, and the script for Windows is called <code class="literal">kcadm.bat</code>. Add the Red Hat Single Sign-On server directory to your <code class="literal">PATH</code> to use the client from any location on your file system.
			</p><p>
				For example:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Linux:
					</li></ul></div><pre class="screen">$ export PATH=$PATH:$KEYCLOAK_HOME/bin
$ kcadm.sh</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Windows:
					</li></ul></div><pre class="screen">c:\&gt; set PATH=%PATH%;%KEYCLOAK_HOME%\bin
c:\&gt; kcadm</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					You must set the <code class="literal">KEYCLOAK_HOME</code> environment variable to the path where you extracted the Red Hat Single Sign-On Server distribution.
				</p><p>
					To avoid repetition, the rest of this document only uses Windows examples in places where the CLI differences are more than just in the <code class="literal">kcadm</code> command name.
				</p></div></div></section><section class="section" id="using_the_admin_cli"><div class="titlepage"><div><div><h2 class="title">18.2. Using the Admin CLI</h2></div></div></div><p>
				The Admin CLI makes HTTP requests to Admin REST endpoints. Access to the Admin REST endpoints requires authentication.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Consult the Admin REST API documentation for details about JSON attributes for specific endpoints.
				</p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Start an authenticated session by logging in. You can now perform create, read, update, and delete (CRUD) operations.
					</p><p class="simpara">
						For example:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Linux:
							</p><pre class="screen">$ kcadm.sh config credentials --server http://localhost:8080/auth --realm demo --user admin --client admin
$ kcadm.sh create realms -s realm=demorealm -s enabled=true -o
$ CID=$(kcadm.sh create clients -r demorealm -s clientId=my_client -s 'redirectUris=["http://localhost:8980/myapp/*"]' -i)
$ kcadm.sh get clients/$CID/installation/providers/keycloak-oidc-keycloak-json</pre></li><li class="listitem"><p class="simpara">
								Windows:
							</p><pre class="screen">c:\&gt; kcadm config credentials --server http://localhost:8080/auth --realm demo --user admin --client admin
c:\&gt; kcadm create realms -s realm=demorealm -s enabled=true -o
c:\&gt; kcadm create clients -r demorealm -s clientId=my_client -s "redirectUris=[\"http://localhost:8980/myapp/*\"]" -i &gt; clientid.txt
c:\&gt; set /p CID=&lt;clientid.txt
c:\&gt; kcadm get clients/%CID%/installation/providers/keycloak-oidc-keycloak-json</pre></li></ul></div></li><li class="listitem"><p class="simpara">
						In a production environment, access Red Hat Single Sign-On by using <code class="literal">https:</code> to avoid exposing tokens. If a trusted certificate authority, included in Java’s default certificate truststore, has not issued a server’s certificate, prepare a <code class="literal">truststore.jks</code> file and instruct the Admin CLI to use it.
					</p><p class="simpara">
						For example:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Linux:
							</p><pre class="screen">$ kcadm.sh config truststore --trustpass $PASSWORD ~/.keycloak/truststore.jks</pre></li><li class="listitem"><p class="simpara">
								Windows:
							</p><pre class="screen">c:\&gt; kcadm config truststore --trustpass %PASSWORD% %HOMEPATH%\.keycloak\truststore.jks</pre></li></ul></div></li></ol></div></section><section class="section" id="authenticating"><div class="titlepage"><div><div><h2 class="title">18.3. Authenticating</h2></div></div></div><p>
				When you log in with the Admin CLI, you specify:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A server endpoint URL
					</li><li class="listitem">
						A realm
					</li><li class="listitem">
						A user name
					</li></ul></div><p>
				Another option is to specify a clientId only, which creates a unique service account for you to use.
			</p><p>
				When you log in using a user name, use a password for the specified user. When you log in using a clientId, you need the client secret only, not the user password. You can also use the <code class="literal">Signed JWT</code> rather than the client secret.
			</p><p>
				Ensure the account used for the session has the proper permissions to invoke Admin REST API operations. For example, the <code class="literal">realm-admin</code> role of the <code class="literal">realm-management</code> client can administer the realm of the user.
			</p><p>
				Two primary mechanisms are available for authentication. One mechanism uses <code class="literal">kcadm config credentials</code> to start an authenticated session.
			</p><pre class="screen">$ kcadm.sh config credentials --server http://localhost:8080/auth --realm master --user admin --password admin</pre><p>
				This mechanism maintains an authenticated session between the <code class="literal">kcadm</code> command invocations by saving the obtained access token and its associated refresh token. It can maintain other secrets in a private configuration file. See the <a class="link" href="#working_with_alternative_configurations" title="18.4. Working with alternative configurations">next chapter</a> for more information.
			</p><p>
				The second mechanism authenticates each command invocation for the duration of the invocation. This mechanism increases the load on the server and the time spent on round trips obtaining tokens. The benefit of this approach is that it is unnecessary to save tokens between invocations, so nothing is saved to disk. Red Hat Single Sign-On uses this mode when the <code class="literal">--no-config</code> argument is specified.
			</p><p>
				For example, when performing an operation, specify all the information required for authentication.
			</p><pre class="screen">$ kcadm.sh get realms --no-config --server http://localhost:8080/auth --realm master --user admin --password admin</pre><p>
				Run the <code class="literal">kcadm.sh help</code> command for more information on using the Admin CLI.
			</p><p>
				Run the <code class="literal">kcadm.sh config credentials --help</code> command for more information about starting an authenticated session.
			</p></section><section class="section" id="working_with_alternative_configurations"><div class="titlepage"><div><div><h2 class="title">18.4. Working with alternative configurations</h2></div></div></div><p>
				By default, the Admin CLI maintains a configuration file named <code class="literal">kcadm.config</code>. Red Hat Single Sign-On places this file in the user’s home directory. In Linux-based systems, the full pathname is <code class="literal">$HOME/.keycloak/kcadm.config</code>. In Windows, the full pathname is <code class="literal">%HOMEPATH%\.keycloak\kcadm.config</code>.
			</p><p>
				You can use the <code class="literal">--config</code> option to point to a different file or location so you can maintain multiple authenticated sessions in parallel.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Perform operations tied to a single configuration file from a single thread.
				</p></div></div><p>
				Ensure the configuration file is invisible to other users on the system. It contains access tokens and secrets that must be private. Red Hat Single Sign-On creates the <code class="literal">~/.keycloak</code> directory and its contents automatically with proper access limits. If the directory already exists, Red Hat Single Sign-On does not update the directory’s permissions.
			</p><p>
				It is possible to avoid storing secrets inside a configuration file, but doing so is inconvenient and increases the number of token requests. Use the <code class="literal">--no-config</code> option with all commands and specify the authentication information the <code class="literal">config credentials</code> command requires with each invocation of <code class="literal">kcadm</code>.
			</p></section><section class="section" id="basic_operations_and_resource_uris"><div class="titlepage"><div><div><h2 class="title">18.5. Basic operations and resource URIs</h2></div></div></div><p>
				The Admin CLI can generically perform CRUD operations against Admin REST API endpoints with additional commands that simplify particular tasks.
			</p><p>
				The main usage pattern is listed here:
			</p><pre class="screen">$ kcadm.sh create ENDPOINT [ARGUMENTS]
$ kcadm.sh get ENDPOINT [ARGUMENTS]
$ kcadm.sh update ENDPOINT [ARGUMENTS]
$ kcadm.sh delete ENDPOINT [ARGUMENTS]</pre><p>
				The <code class="literal">create</code>, <code class="literal">get</code>, <code class="literal">update</code>, and <code class="literal">delete</code> commands map to the HTTP verbs <code class="literal">POST</code>, <code class="literal">GET</code>, <code class="literal">PUT</code>, and <code class="literal">DELETE</code>, respectively. ENDPOINT is a target resource URI and can be absolute (starting with <code class="literal">http:</code> or <code class="literal">https:</code>) or relative, that Red Hat Single Sign-On uses to compose absolute URLs in the following format:
			</p><pre class="screen">SERVER_URI/admin/realms/REALM/ENDPOINT</pre><p>
				For example, if you authenticate against the server <a class="link" href="http://localhost:8080/auth">http://localhost:8080/auth</a> and realm is <code class="literal">master</code>, using <code class="literal">users</code> as ENDPOINT creates the <a class="link" href="http://localhost:8080/auth/admin/realms/master/users">http://localhost:8080/auth/admin/realms/master/users</a> resource URL.
			</p><p>
				If you set ENDPOINT to <code class="literal">clients</code>, the effective resource URI is <a class="link" href="http://localhost:8080/auth/admin/realms/master/clients">http://localhost:8080/auth/admin/realms/master/clients</a>.
			</p><p>
				Red Hat Single Sign-On has a <code class="literal">realms</code> endpoint that is the container for realms. It resolves to:
			</p><pre class="screen">SERVER_URI/admin/realms</pre><p>
				Red Hat Single Sign-On has a <code class="literal">serverinfo</code> endpoint. This endpoint is independent of realms.
			</p><p>
				When you authenticate as a user with realm-admin powers, you may need to perform commands on multiple realms. If so, specify the <code class="literal">-r</code> option to tell the CLI which realm the command is to execute against explicitly. Instead of using <code class="literal">REALM</code> as specified by the <code class="literal">--realm</code> option of <code class="literal">kcadm.sh config credentials</code>, the command uses <code class="literal">TARGET_REALM</code>.
			</p><pre class="screen">SERVER_URI/admin/realms/TARGET_REALM/ENDPOINT</pre><p>
				For example:
			</p><pre class="screen">$ kcadm.sh config credentials --server http://localhost:8080/auth --realm master --user admin --password admin
$ kcadm.sh create users -s username=testuser -s enabled=true -r demorealm</pre><p>
				In this example, you start a session authenticated as the <code class="literal">admin</code> user in the <code class="literal">master</code> realm. You then perform a POST call against the resource URL <code class="literal"><a class="link" href="http://localhost:8080/auth/admin/realms/demorealm/users">http://localhost:8080/auth/admin/realms/demorealm/users</a></code>.
			</p><p>
				The <code class="literal">create</code> and <code class="literal">update</code> commands send a JSON body to the server. You can use <code class="literal">-f FILENAME</code> to read a pre-made document from a file. When you can use the <code class="literal">-f -</code> option, Red Hat Single Sign-On reads the message body from the standard input. You can specify individual attributes and their values, as seen in the <code class="literal">create users</code> example. Red Hat Single Sign-On composes the attributes into a JSON body and sends them to the server.
			</p><p>
				Several methods are available in Red Hat Single Sign-On to update a resource using the <code class="literal">update</code> command. You can determine the current state of a resource and save it to a file, edit that file, and send it to the server for an update.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get realms/demorealm &gt; demorealm.json
$ vi demorealm.json
$ kcadm.sh update realms/demorealm -f demorealm.json</pre><p>
				This method updates the resource on the server with the attributes in the sent JSON document.
			</p><p>
				Another method is to perform an on-the-fly update by using the <code class="literal">-s, --set</code> options to set new values.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update realms/demorealm -s enabled=false</pre><p>
				This method sets the <code class="literal">enabled</code> attribute to <code class="literal">false</code>.
			</p><p>
				By default, the <code class="literal">update</code> command performs a <code class="literal">get</code> and then merges the new attribute values with existing values. In some cases, the endpoint may support the <code class="literal">put</code> command but not the <code class="literal">get</code> command. You can use the <code class="literal">-n</code> option to perform a no-merge update, which performs a <code class="literal">put</code> command without first running a <code class="literal">get</code> command.
			</p></section><section class="section" id="realm_operations"><div class="titlepage"><div><div><h2 class="title">18.6. Realm operations</h2></div></div></div><h4 id="creating_a_new_realm">Creating a new realm</h4><p>
				Use the <code class="literal">create</code> command on the <code class="literal">realms</code> endpoint to create a new enabled realm. Set the attributes to <code class="literal">realm</code> and <code class="literal">enabled</code>.
			</p><pre class="screen">$ kcadm.sh create realms -s realm=demorealm -s enabled=true</pre><p>
				Red Hat Single Sign-On disables realms by default. You can use a realm immediately for authentication by enabling it.
			</p><p>
				A description for a new object can also be in JSON format.
			</p><pre class="screen">$ kcadm.sh create realms -f demorealm.json</pre><p>
				You can send a JSON document with realm attributes directly from a file or pipe the document to standard input.
			</p><p>
				For example:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Linux:
					</li></ul></div><pre class="screen">$ kcadm.sh create realms -f - &lt;&lt; EOF
{ "realm": "demorealm", "enabled": true }
EOF</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Windows:
					</li></ul></div><pre class="screen">c:\&gt; echo { "realm": "demorealm", "enabled": true } | kcadm create realms -f -</pre><h4 id="listing_existing_realms">Listing existing realms</h4><p>
				This command returns a list of all realms.
			</p><pre class="screen">$ kcadm.sh get realms</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On filters the list of realms on the server to return realms a user can see only.
				</p></div></div><p>
				The list of all realm attributes can be verbose, and most users are interested in a subset of attributes, such as the realm name and the enabled status of the realm. You can specify the attributes to return by using the <code class="literal">--fields</code> option.
			</p><pre class="screen">$ kcadm.sh get realms --fields realm,enabled</pre><p>
				You can display the result as comma-separated values.
			</p><pre class="screen">$ kcadm.sh get realms --fields realm --format csv --noquotes</pre><h4 id="getting_a_specific_realm">Getting a specific realm</h4><p>
				Append a realm name to a collection URI to get an individual realm.
			</p><pre class="screen">$ kcadm.sh get realms/master</pre><h4 id="updating_a_realm">Updating a realm</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Use the <code class="literal">-s</code> option to set new values for the attributes when you do not want to change all of the realm’s attributes.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh update realms/demorealm -s enabled=false</pre></li><li class="listitem"><p class="simpara">
						If you want to set all writable attributes to new values:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Run a <code class="literal">get</code> command.
							</li><li class="listitem">
								Edit the current values in the JSON file.
							</li><li class="listitem"><p class="simpara">
								Resubmit.
							</p><p class="simpara">
								For example:
							</p><pre class="screen">$ kcadm.sh get realms/demorealm &gt; demorealm.json
$ vi demorealm.json
$ kcadm.sh update realms/demorealm -f demorealm.json</pre></li></ol></div></li></ol></div><h4 id="deleting_a_realm">Deleting a realm</h4><p>
				Run the following command to delete a realm:
			</p><pre class="screen">$ kcadm.sh delete realms/demorealm</pre><h4 id="turning_on_all_login_page_options_for_the_realm">Turning on all login page options for the realm</h4><p>
				Set the attributes that control specific capabilities to <code class="literal">true</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update realms/demorealm -s registrationAllowed=true -s registrationEmailAsUsername=true -s rememberMe=true -s verifyEmail=true -s resetPasswordAllowed=true -s editUsernameAllowed=true</pre><h4 id="listing_the_realm_keys">Listing the realm keys</h4><p>
				Use the <code class="literal">get</code> operation on the <code class="literal">keys</code> endpoint of the target realm.
			</p><pre class="screen">$ kcadm.sh get keys -r demorealm</pre><h4 id="generating_new_realm_keys">Generating new realm keys</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Get the ID of the target realm before adding a new RSA-generated key pair.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get realms/demorealm --fields id --format csv --noquotes</pre></li><li class="listitem"><p class="simpara">
						Add a new key provider with a higher priority than the existing providers as revealed by <code class="literal">kcadm.sh get keys -r demorealm</code>.
					</p><p class="simpara">
						For example:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Linux:
							</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=rsa-generated -s providerId=rsa-generated -s providerType=org.keycloak.keys.KeyProvider -s parentId=959844c1-d149-41d7-8359-6aa527fca0b0 -s 'config.priority=["101"]' -s 'config.enabled=["true"]' -s 'config.active=["true"]' -s 'config.keySize=["2048"]'</pre></li><li class="listitem"><p class="simpara">
								Windows:
							</p><pre class="screen">c:\&gt; kcadm create components -r demorealm -s name=rsa-generated -s providerId=rsa-generated -s providerType=org.keycloak.keys.KeyProvider -s parentId=959844c1-d149-41d7-8359-6aa527fca0b0 -s "config.priority=[\"101\"]" -s "config.enabled=[\"true\"]" -s "config.active=[\"true\"]" -s "config.keySize=[\"2048\"]"</pre></li></ul></div></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">parentId</code> attribute to the value of the target realm’s ID.
					</p><p class="simpara">
						The newly added key is now the active key, as revealed by <code class="literal">kcadm.sh get keys -r demorealm</code>.
					</p></li></ol></div><h4 id="adding_new_realm_keys_from_a_java_key_store_file">Adding new realm keys from a Java Key Store file</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Add a new key provider to add a new key pair pre-prepared as a JKS file.
					</p><p class="simpara">
						For example, on:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Linux:
							</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=java-keystore -s providerId=java-keystore -s providerType=org.keycloak.keys.KeyProvider -s parentId=959844c1-d149-41d7-8359-6aa527fca0b0 -s 'config.priority=["101"]' -s 'config.enabled=["true"]' -s 'config.active=["true"]' -s 'config.keystore=["/opt/keycloak/keystore.jks"]' -s 'config.keystorePassword=["secret"]' -s 'config.keyPassword=["secret"]' -s 'config.keyAlias=["localhost"]'</pre></li><li class="listitem"><p class="simpara">
								Windows:
							</p><pre class="screen">c:\&gt; kcadm create components -r demorealm -s name=java-keystore -s providerId=java-keystore -s providerType=org.keycloak.keys.KeyProvider -s parentId=959844c1-d149-41d7-8359-6aa527fca0b0 -s "config.priority=[\"101\"]" -s "config.enabled=[\"true\"]" -s "config.active=[\"true\"]" -s "config.keystore=[\"/opt/keycloak/keystore.jks\"]" -s "config.keystorePassword=[\"secret\"]" -s "config.keyPassword=[\"secret\"]" -s "config.keyAlias=[\"localhost\"]"</pre></li></ul></div></li><li class="listitem">
						Ensure you change the attribute values for <code class="literal">keystore</code>, <code class="literal">keystorePassword</code>, <code class="literal">keyPassword</code>, and <code class="literal">alias</code> to match your specific keystore.
					</li><li class="listitem">
						Set the <code class="literal">parentId</code> attribute to the value of the target realm’s ID.
					</li></ol></div><h4 id="making_the_key_passive_or_disabling_the_key">Making the key passive or disabling the key</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Identify the key you want to make passive.
					</p><pre class="screen">$ kcadm.sh get keys -r demorealm</pre></li><li class="listitem">
						Use the key’s <code class="literal">providerId</code> attribute to construct an endpoint URI, such as <code class="literal">components/PROVIDER_ID</code>.
					</li><li class="listitem"><p class="simpara">
						Perform an <code class="literal">update</code>.
					</p><p class="simpara">
						For example:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Linux:
							</p><pre class="screen">$ kcadm.sh update components/PROVIDER_ID -r demorealm -s 'config.active=["false"]'</pre></li><li class="listitem"><p class="simpara">
								Windows:
							</p><pre class="screen">c:\&gt; kcadm update components/PROVIDER_ID -r demorealm -s "config.active=[\"false\"]"</pre><p class="simpara">
								You can update other key attributes:
							</p></li></ul></div></li><li class="listitem">
						Set a new <code class="literal">enabled</code> value to disable the key, for example, <code class="literal">config.enabled=["false"]</code>.
					</li><li class="listitem">
						Set a new <code class="literal">priority</code> value to change the key’s priority, for example, <code class="literal">config.priority=["110"]</code>.
					</li></ol></div><h4 id="deleting_an_old_key">Deleting an old key</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Ensure the key you are deleting is inactive and you have disabled it. This action is to prevent existing tokens held by applications and users from failing.
					</li><li class="listitem"><p class="simpara">
						Identify the key to delete.
					</p><pre class="screen">$ kcadm.sh get keys -r demorealm</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">providerId</code> of the key to perform the delete.
					</p><pre class="screen">$ kcadm.sh delete components/PROVIDER_ID -r demorealm</pre></li></ol></div><h4 id="configuring_event_logging_for_a_realm">Configuring event logging for a realm</h4><p>
				Use the <code class="literal">update</code> command on the <code class="literal">events/config</code> endpoint.
			</p><p>
				The <code class="literal">eventsListeners</code> attribute contains a list of EventListenerProviderFactory IDs, specifying all event listeners that receive events. Attributes are available that control built-in event storage, so you can query past events using the Admin REST API. Red Hat Single Sign-On has separate control over the logging of service calls (<code class="literal">eventsEnabled</code>) and the auditing events triggered by the Admin Console or Admin REST API (<code class="literal">adminEventsEnabled</code>). You can set up the <code class="literal">eventsExpiration</code> event to expire to prevent your database from filling. Red Hat Single Sign-On sets <code class="literal">eventsExpiration</code> to time-to-live expressed in seconds.
			</p><p>
				You can set up a built-in event listener that receives all events and logs the events through JBoss-logging. Using the <code class="literal">org.keycloak.events</code> logger, Red Hat Single Sign-On logs error events as <code class="literal">WARN</code> and other events as <code class="literal">DEBUG</code>.
			</p><p>
				For example:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Linux:
					</li></ul></div><pre class="screen">$ kcadm.sh update events/config -r demorealm -s 'eventsListeners=["jboss-logging"]'</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Windows:
					</li></ul></div><pre class="screen">c:\&gt; kcadm update events/config -r demorealm -s "eventsListeners=[\"jboss-logging\"]"</pre><p>
				For example:
			</p><p>
				You can turn on storage for all available ERROR events, not including auditing events, for two days so you can retrieve the events through Admin REST.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Linux:
					</li></ul></div><pre class="screen">$ kcadm.sh update events/config -r demorealm -s eventsEnabled=true -s 'enabledEventTypes=["LOGIN_ERROR","REGISTER_ERROR","LOGOUT_ERROR","CODE_TO_TOKEN_ERROR","CLIENT_LOGIN_ERROR","FEDERATED_IDENTITY_LINK_ERROR","REMOVE_FEDERATED_IDENTITY_ERROR","UPDATE_EMAIL_ERROR","UPDATE_PROFILE_ERROR","UPDATE_PASSWORD_ERROR","UPDATE_TOTP_ERROR","VERIFY_EMAIL_ERROR","REMOVE_TOTP_ERROR","SEND_VERIFY_EMAIL_ERROR","SEND_RESET_PASSWORD_ERROR","SEND_IDENTITY_PROVIDER_LINK_ERROR","RESET_PASSWORD_ERROR","IDENTITY_PROVIDER_FIRST_LOGIN_ERROR","IDENTITY_PROVIDER_POST_LOGIN_ERROR","CUSTOM_REQUIRED_ACTION_ERROR","EXECUTE_ACTIONS_ERROR","CLIENT_REGISTER_ERROR","CLIENT_UPDATE_ERROR","CLIENT_DELETE_ERROR"]' -s eventsExpiration=172800</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Windows:
					</li></ul></div><pre class="screen">c:\&gt; kcadm update events/config -r demorealm -s eventsEnabled=true -s "enabledEventTypes=[\"LOGIN_ERROR\",\"REGISTER_ERROR\",\"LOGOUT_ERROR\",\"CODE_TO_TOKEN_ERROR\",\"CLIENT_LOGIN_ERROR\",\"FEDERATED_IDENTITY_LINK_ERROR\",\"REMOVE_FEDERATED_IDENTITY_ERROR\",\"UPDATE_EMAIL_ERROR\",\"UPDATE_PROFILE_ERROR\",\"UPDATE_PASSWORD_ERROR\",\"UPDATE_TOTP_ERROR\",\"VERIFY_EMAIL_ERROR\",\"REMOVE_TOTP_ERROR\",\"SEND_VERIFY_EMAIL_ERROR\",\"SEND_RESET_PASSWORD_ERROR\",\"SEND_IDENTITY_PROVIDER_LINK_ERROR\",\"RESET_PASSWORD_ERROR\",\"IDENTITY_PROVIDER_FIRST_LOGIN_ERROR\",\"IDENTITY_PROVIDER_POST_LOGIN_ERROR\",\"CUSTOM_REQUIRED_ACTION_ERROR\",\"EXECUTE_ACTIONS_ERROR\",\"CLIENT_REGISTER_ERROR\",\"CLIENT_UPDATE_ERROR\",\"CLIENT_DELETE_ERROR\"]" -s eventsExpiration=172800</pre><p>
				You can reset stored event types to <span class="strong strong"><strong>all available event types</strong></span>. Setting the value to an empty list is the same as enumerating all.
			</p><pre class="screen">$ kcadm.sh update events/config -r demorealm -s enabledEventTypes=[]</pre><p>
				You can enable storage of auditing events.
			</p><pre class="screen">$ kcadm.sh update events/config -r demorealm -s adminEventsEnabled=true -s adminEventsDetailsEnabled=true</pre><p>
				You can get the last 100 events. The events are ordered from newest to oldest.
			</p><pre class="screen">$ kcadm.sh get events --offset 0 --limit 100</pre><p>
				You can delete all saved events.
			</p><pre class="screen">$ kcadm delete events</pre><h4 id="flushing_the_caches">Flushing the caches</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Use the <code class="literal">create</code> command with one of these endpoints to clear caches:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">clear-realm-cache</code>
							</li><li class="listitem">
								<code class="literal">clear-user-cache</code>
							</li><li class="listitem">
								<code class="literal">clear-keys-cache</code>
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Set <code class="literal">realm</code> to the same value as the target realm.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create clear-realm-cache -r demorealm -s realm=demorealm
$ kcadm.sh create clear-user-cache -r demorealm -s realm=demorealm
$ kcadm.sh create clear-keys-cache -r demorealm -s realm=demorealm</pre></li></ol></div><h4 id="importing_a_realm_from_exported_json_file">Importing a realm from exported .json file</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use the <code class="literal">create</code> command on the <code class="literal">partialImport</code> endpoint.
					</li><li class="listitem">
						Set <code class="literal">ifResourceExists</code> to <code class="literal">FAIL</code>, <code class="literal">SKIP</code>, or <code class="literal">OVERWRITE</code>.
					</li><li class="listitem"><p class="simpara">
						Use <code class="literal">-f</code> to submit the exported realm <code class="literal">.json</code> file.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create partialImport -r demorealm2 -s ifResourceExists=FAIL -o -f demorealm.json</pre><p class="simpara">
						If the realm does not yet exist, create it first.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create realms -s realm=demorealm2 -s enabled=true</pre></li></ol></div></section><section class="section" id="role_operations"><div class="titlepage"><div><div><h2 class="title">18.7. Role operations</h2></div></div></div><h4 id="creating_a_realm_role">Creating a realm role</h4><p>
				Use the <code class="literal">roles</code> endpoint to create a realm role.
			</p><pre class="screen">$ kcadm.sh create roles -r demorealm -s name=user -s 'description=Regular user with a limited set of permissions'</pre><h4 id="creating_a_client_role">Creating a client role</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Identify the client.
					</li><li class="listitem"><p class="simpara">
						Use the <code class="literal">get</code> command to list the available clients.
					</p><pre class="screen">$ kcadm.sh get clients -r demorealm --fields id,clientId</pre></li><li class="listitem"><p class="simpara">
						Create a new role by using the <code class="literal">clientId</code> attribute to construct an endpoint URI, such as <code class="literal">clients/ID/roles</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create clients/a95b6af3-0bdc-4878-ae2e-6d61a4eca9a0/roles -r demorealm -s name=editor -s 'description=Editor can edit, and publish any article'</pre></li></ol></div><h4 id="listing_realm_roles">Listing realm roles</h4><p>
				Use the <code class="literal">get</code> command on the <code class="literal">roles</code> endpoint to list existing realm roles.
			</p><pre class="screen">$ kcadm.sh get roles -r demorealm</pre><p>
				You can use the <code class="literal">get-roles</code> command also.
			</p><pre class="screen">$ kcadm.sh get-roles -r demorealm</pre><h4 id="listing_client_roles">Listing client roles</h4><p>
				Red Hat Single Sign-On has a dedicated <code class="literal">get-roles</code> command to simplify the listing of realm and client roles. The command is an extension of the <code class="literal">get</code> command and behaves the same as the <code class="literal">get</code> command but with additional semantics for listing roles.
			</p><p>
				Use the <code class="literal">get-roles</code> command by passing it the clientId (<code class="literal">--cclientid</code>) option or the <code class="literal">id</code> (<code class="literal">--cid</code>) option to identify the client to list client roles.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --cclientid realm-management</pre><h4 id="getting_a_specific_realm_role">Getting a specific realm role</h4><p>
				Use the <code class="literal">get</code> command and the role <code class="literal">name</code> to construct an endpoint URI for a specific realm role, <code class="literal">roles/ROLE_NAME</code>, where <code class="literal">user</code> is the existing role’s name.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get roles/user -r demorealm</pre><p>
				You can use the <code class="literal">get-roles</code> command, passing it a role name (<code class="literal">--rolename</code> option) or ID (<code class="literal">--roleid</code> option).
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rolename user</pre><h4 id="getting_a_specific_client_role">Getting a specific client role</h4><p>
				Use the <code class="literal">get-roles</code> command, passing it the clientId attribute (<code class="literal">--cclientid</code> option) or ID attribute (<code class="literal">--cid</code> option) to identify the client, and pass the role name (<code class="literal">--rolename</code> option) or the role ID attribute (<code class="literal">--roleid</code>) to identify a specific client role.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --cclientid realm-management --rolename manage-clients</pre><h4 id="updating_a_realm_role">Updating a realm role</h4><p>
				Use the <code class="literal">update</code> command with the endpoint URI you used to get a specific realm role.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update roles/user -r demorealm -s 'description=Role representing a regular user'</pre><h4 id="updating_a_client_role">Updating a client role</h4><p>
				Use the <code class="literal">update</code> command with the endpoint URI that you used to get a specific client role.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update clients/a95b6af3-0bdc-4878-ae2e-6d61a4eca9a0/roles/editor -r demorealm -s 'description=User that can edit, and publish articles'</pre><h4 id="deleting_a_realm_role">Deleting a realm role</h4><p>
				Use the <code class="literal">delete</code> command with the endpoint URI that you used to get a specific realm role.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete roles/user -r demorealm</pre><h4 id="deleting_a_client_role">Deleting a client role</h4><p>
				Use the <code class="literal">delete</code> command with the endpoint URI that you used to get a specific client role.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete clients/a95b6af3-0bdc-4878-ae2e-6d61a4eca9a0/roles/editor -r demorealm</pre><h4 id="listing_assigned_available_and_effective_realm_roles_for_a_composite_role">Listing assigned, available, and effective realm roles for a composite role</h4><p>
				Use the <code class="literal">get-roles</code> command to list assigned, available, and effective realm roles for a composite role.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To list <span class="strong strong"><strong>assigned</strong></span> realm roles for the composite role, specify the target composite role by name (<code class="literal">--rname</code> option) or ID (<code class="literal">--rid</code> option).
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rname testrole</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--effective</code> option to list <span class="strong strong"><strong>effective</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rname testrole --effective</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--available</code> option to list realm roles that you can add to the composite role.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rname testrole --available</pre></li></ol></div><h4 id="listing_assigned_available_and_effective_client_roles_for_a_composite_role">Listing assigned, available, and effective client roles for a composite role</h4><p>
				Use the <code class="literal">get-roles</code> command to list assigned, available, and effective client roles for a composite role.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To list <span class="strong strong"><strong>assigned</strong></span> client roles for the composite role, you can specify the target composite role by name (<code class="literal">--rname</code> option) or ID (<code class="literal">--rid</code> option) and client by the clientId attribute (<code class="literal">--cclientid</code> option) or ID (<code class="literal">--cid</code> option).
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rname testrole --cclientid realm-management</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--effective</code> option to list <span class="strong strong"><strong>effective</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rname testrole --cclientid realm-management --effective</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--available</code> option to list realm roles that you can add to the target composite role.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --rname testrole --cclientid realm-management --available</pre></li></ol></div><h4 id="adding_realm_roles_to_a_composite_role">Adding realm roles to a composite role</h4><p>
				Red Hat Single Sign-On provides an <code class="literal">add-roles</code> command for adding realm roles and client roles.
			</p><p>
				This example adds the <code class="literal">user</code> role to the composite role <code class="literal">testrole</code>.
			</p><pre class="screen">$ kcadm.sh add-roles --rname testrole --rolename user -r demorealm</pre><h4 id="removing_realm_roles_from_a_composite_role">Removing realm roles from a composite role</h4><p>
				Red Hat Single Sign-On provides a <code class="literal">remove-roles</code> command for removing realm roles and client roles.
			</p><p>
				The following example removes the <code class="literal">user</code> role from the target composite role <code class="literal">testrole</code>.
			</p><pre class="screen">$ kcadm.sh remove-roles --rname testrole --rolename user -r demorealm</pre><h4 id="adding_client_roles_to_a_realm_role">Adding client roles to a realm role</h4><p>
				Red Hat Single Sign-On provides an <code class="literal">add-roles</code> command for adding realm roles and client roles.
			</p><p>
				The following example adds the roles defined on the client <code class="literal">realm-management</code>, <code class="literal">create-client</code>, and <code class="literal">view-users</code>, to the <code class="literal">testrole</code> composite role.
			</p><pre class="screen">$ kcadm.sh add-roles -r demorealm --rname testrole --cclientid realm-management --rolename create-client --rolename view-users</pre><h4 id="adding_client_roles_to_a_client_role">Adding client roles to a client role</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Determine the ID of the composite client role by using the <code class="literal">get-roles</code> command.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --cclientid test-client --rolename operations</pre></li><li class="listitem">
						Assume that a client exists with a clientId attribute named <code class="literal">test-client</code>, a client role named <code class="literal">support</code>, and a client role named <code class="literal">operations</code> which becomes a composite role that has an ID of "fc400897-ef6a-4e8c-872b-1581b7fa8a71".
					</li><li class="listitem"><p class="simpara">
						Use the following example to add another role to the composite role.
					</p><pre class="screen">$ kcadm.sh add-roles -r demorealm --cclientid test-client --rid fc400897-ef6a-4e8c-872b-1581b7fa8a71 --rolename support</pre></li><li class="listitem"><p class="simpara">
						List the roles of a composite role by using the <code class="literal">get-roles --all</code> command.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles --rid fc400897-ef6a-4e8c-872b-1581b7fa8a71 --all</pre></li></ol></div><h4 id="removing_client_roles_from_a_composite_role">Removing client roles from a composite role</h4><p>
				Use the <code class="literal">remove-roles</code> command to remove client roles from a composite role.
			</p><p>
				Use the following example to remove two roles defined on the client <code class="literal">realm-management</code>, the <code class="literal">create-client</code> role and the <code class="literal">view-users</code> role, from the <code class="literal">testrole</code> composite role.
			</p><pre class="screen">$ kcadm.sh remove-roles -r demorealm --rname testrole --cclientid realm-management --rolename create-client --rolename view-users</pre><h4 id="adding_client_roles_to_a_group">Adding client roles to a group</h4><p>
				Use the <code class="literal">add-roles</code> command to add realm roles and client roles.
			</p><p>
				The following example adds the roles defined on the client <code class="literal">realm-management</code>, <code class="literal">create-client</code> and <code class="literal">view-users</code>, to the <code class="literal">Group</code> group (<code class="literal">--gname</code> option). Alternatively, you can specify the group by ID (<code class="literal">--gid</code> option).
			</p><p>
				See <a class="link" href="#group_operations" title="18.10. Group operations">Group operations</a> for more information.
			</p><pre class="screen">$ kcadm.sh add-roles -r demorealm --gname Group --cclientid realm-management --rolename create-client --rolename view-users</pre><h4 id="removing_client_roles_from_a_group">Removing client roles from a group</h4><p>
				Use the <code class="literal">remove-roles</code> command to remove client roles from a group.
			</p><p>
				The following example removes two roles defined on the client <code class="literal">realm management</code>, <code class="literal">create-client</code> and <code class="literal">view-users</code>, from the <code class="literal">Group</code> group.
			</p><p>
				See <a class="link" href="#group_operations" title="18.10. Group operations">Group operations</a> for more information.
			</p><pre class="screen">$ kcadm.sh remove-roles -r demorealm --gname Group --cclientid realm-management --rolename create-client --rolename view-users</pre></section><section class="section" id="client_operations"><div class="titlepage"><div><div><h2 class="title">18.8. Client operations</h2></div></div></div><h4 id="creating_a_client">Creating a client</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Run the <code class="literal">create</code> command on a <code class="literal">clients</code> endpoint to create a new client.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create clients -r demorealm -s clientId=myapp -s enabled=true</pre></li><li class="listitem"><p class="simpara">
						Specify a secret if to set a secret for adapters to authenticate.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create clients -r demorealm -s clientId=myapp -s enabled=true -s clientAuthenticatorType=client-secret -s secret=d0b8122f-8dfb-46b7-b68a-f5cc4e25d000</pre></li></ol></div><h4 id="listing_clients">Listing clients</h4><p>
				Use the <code class="literal">get</code> command on the <code class="literal">clients</code> endpoint to list clients.
			</p><p>
				This example filters the output to list only the <code class="literal">id</code> and <code class="literal">clientId</code> attributes:
			</p><pre class="screen">$ kcadm.sh get clients -r demorealm --fields id,clientId</pre><h4 id="getting_a_specific_client">Getting a specific client</h4><p>
				Use the client ID to construct an endpoint URI that targets a specific client, such as <code class="literal">clients/ID</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get clients/c7b8547f-e748-4333-95d0-410b76b3f4a3 -r demorealm</pre><h4 id="getting_the_current_secret_for_a_specific_client">Getting the current secret for a specific client</h4><p>
				Use the client ID to construct an endpoint URI, such as <code class="literal">clients/ID/client-secret</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get clients/$CID/client-secret</pre><h4 id="generate_a_new_secret_for_a_specific_client">Generate a new secret for a specific client</h4><p>
				Use the client ID to construct an endpoint URI, such as <code class="literal">clients/ID/client-secret</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create clients/$CID/client-secret</pre><h4 id="updating_the_current_secret_for_a_specific_client">Updating the current secret for a specific client</h4><p>
				Use the client ID to construct an endpoint URI, such as <code class="literal">clients/ID</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update clients/$CID -s "secret=newSecret"</pre><h4 id="getting_an_adapter_configuration_file_keycloak_json_for_a_specific_client">Getting an adapter configuration file (keycloak.json) for a specific client</h4><p>
				Use the client ID to construct an endpoint URI that targets a specific client, such as <code class="literal">clients/ID/installation/providers/keycloak-oidc-keycloak-json</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get clients/c7b8547f-e748-4333-95d0-410b76b3f4a3/installation/providers/keycloak-oidc-keycloak-json -r demorealm</pre><h4 id="getting_a_wildfly_subsystem_adapter_configuration_for_a_specific_client">Getting a WildFly subsystem adapter configuration for a specific client</h4><p>
				Use the client ID to construct an endpoint URI that targets a specific client, such as <code class="literal">clients/ID/installation/providers/keycloak-oidc-jboss-subsystem</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get clients/c7b8547f-e748-4333-95d0-410b76b3f4a3/installation/providers/keycloak-oidc-jboss-subsystem -r demorealm</pre><h4 id="getting_a_docker_v2_example_configuration_for_a_specific_client">Getting a Docker-v2 example configuration for a specific client</h4><p>
				Use the client ID to construct an endpoint URI that targets a specific client, such as <code class="literal">clients/ID/installation/providers/docker-v2-compose-yaml</code>.
			</p><p>
				The response is in <code class="literal">.zip</code> format.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get http://localhost:8080/auth/admin/realms/demorealm/clients/8f271c35-44e3-446f-8953-b0893810ebe7/installation/providers/docker-v2-compose-yaml -r demorealm &gt; keycloak-docker-compose-yaml.zip</pre><h4 id="updating_a_client">Updating a client</h4><p>
				Use the <code class="literal">update</code> command with the same endpoint URI that you use to get a specific client.
			</p><p>
				For example:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Linux:
					</li></ul></div><pre class="screen">$ kcadm.sh update clients/c7b8547f-e748-4333-95d0-410b76b3f4a3 -r demorealm -s enabled=false -s publicClient=true -s 'redirectUris=["http://localhost:8080/myapp/*"]' -s baseUrl=http://localhost:8080/myapp -s adminUrl=http://localhost:8080/myapp</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Windows:
					</li></ul></div><pre class="screen">c:\&gt; kcadm update clients/c7b8547f-e748-4333-95d0-410b76b3f4a3 -r demorealm -s enabled=false -s publicClient=true -s "redirectUris=[\"http://localhost:8080/myapp/*\"]" -s baseUrl=http://localhost:8080/myapp -s adminUrl=http://localhost:8080/myapp</pre><h4 id="deleting_a_client">Deleting a client</h4><p>
				Use the <code class="literal">delete</code> command with the same endpoint URI that you use to get a specific client.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete clients/c7b8547f-e748-4333-95d0-410b76b3f4a3 -r demorealm</pre><h4 id="adding_or_removing_roles_for_client_s_service_account">Adding or removing roles for client’s service account</h4><p>
				A client’s service account is a user account with username <code class="literal">service-account-CLIENT_ID</code>. You can perform the same user operations on this account as a regular account.
			</p></section><section class="section" id="user_operations"><div class="titlepage"><div><div><h2 class="title">18.9. User operations</h2></div></div></div><h4 id="creating_a_user">Creating a user</h4><p>
				Run the <code class="literal">create</code> command on the <code class="literal">users</code> endpoint to create a new user.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create users -r demorealm -s username=testuser -s enabled=true</pre><h4 id="listing_users">Listing users</h4><p>
				Use the <code class="literal">users</code> endpoint to list users. The target user must change their password the next time they log in.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get users -r demorealm --offset 0 --limit 1000</pre><p>
				You can filter users by <code class="literal">username</code>, <code class="literal">firstName</code>, <code class="literal">lastName</code>, or <code class="literal">email</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get users -r demorealm -q email=google.com
$ kcadm.sh get users -r demorealm -q username=testuser</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Filtering does not use exact matching. This example matches the value of the <code class="literal">username</code> attribute against the <code class="literal">*testuser*</code> pattern.
				</p></div></div><p>
				You can filter across multiple attributes by specifying multiple <code class="literal">-q</code> options. Red Hat Single Sign-On returns users that match the condition for all the attributes only.
			</p><h4 id="getting_a_specific_user">Getting a specific user</h4><p>
				Use the user ID to compose an endpoint URI, such as <code class="literal">users/USER_ID</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get users/0ba7a3fd-6fd8-48cd-a60b-2e8fd82d56e2 -r demorealm</pre><h4 id="updating_a_user">Updating a user</h4><p>
				Use the <code class="literal">update</code> command with the same endpoint URI that you use to get a specific user.
			</p><p>
				For example:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Linux:
					</li></ul></div><pre class="screen">$ kcadm.sh update users/0ba7a3fd-6fd8-48cd-a60b-2e8fd82d56e2 -r demorealm -s 'requiredActions=["VERIFY_EMAIL","UPDATE_PROFILE","CONFIGURE_TOTP","UPDATE_PASSWORD"]'</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Windows:
					</li></ul></div><pre class="screen">c:\&gt; kcadm update users/0ba7a3fd-6fd8-48cd-a60b-2e8fd82d56e2 -r demorealm -s "requiredActions=[\"VERIFY_EMAIL\",\"UPDATE_PROFILE\",\"CONFIGURE_TOTP\",\"UPDATE_PASSWORD\"]"</pre><h4 id="deleting_a_user">Deleting a user</h4><p>
				Use the <code class="literal">delete</code> command with the same endpoint URI that you use to get a specific user.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete users/0ba7a3fd-6fd8-48cd-a60b-2e8fd82d56e2 -r demorealm</pre><h4 id="resetting_a_user_s_password">Resetting a user’s password</h4><p>
				Use the dedicated <code class="literal">set-password</code> command to reset a user’s password.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh set-password -r demorealm --username testuser --new-password NEWPASSWORD --temporary</pre><p>
				This command sets a temporary password for the user. The target user must change the password the next time they log in.
			</p><p>
				You can use <code class="literal">--userid</code> to specify the user by using the <code class="literal">id</code> attribute.
			</p><p>
				You can achieve the same result using the <code class="literal">update</code> command on an endpoint constructed from the one you used to get a specific user, such as <code class="literal">users/USER_ID/reset-password</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update users/0ba7a3fd-6fd8-48cd-a60b-2e8fd82d56e2/reset-password -r demorealm -s type=password -s value=NEWPASSWORD -s temporary=true -n</pre><p>
				The <code class="literal">-n</code> parameter ensures that Red Hat Single Sign-On performs the <code class="literal">PUT</code> command without performing a <code class="literal">GET</code> command before the <code class="literal">PUT</code> command. This is necessary because the <code class="literal">reset-password</code> endpoint does not support <code class="literal">GET</code>.
			</p><h4 id="listing_assigned_available_and_effective_realm_roles_for_a_user">Listing assigned, available, and effective realm roles for a user</h4><p>
				You can use a <code class="literal">get-roles</code> command to list assigned, available, and effective realm roles for a user.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Specify the target user by user name or ID to list the user’s <span class="strong strong"><strong>assigned</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --uusername testuser</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--effective</code> option to list <span class="strong strong"><strong>effective</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --uusername testuser --effective</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--available</code> option to list realm roles that you can add to a user.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --uusername testuser --available</pre></li></ol></div><h4 id="listing_assigned_available_and_effective_client_roles_for_a_user">Listing assigned, available, and effective client roles for a user</h4><p>
				Use a <code class="literal">get-roles</code> command to list assigned, available, and effective client roles for a user.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Specify the target user by user name (<code class="literal">--uusername</code> option) or ID (<code class="literal">--uid</code> option) and client by a clientId attribute (<code class="literal">--cclientid</code> option) or an ID (<code class="literal">--cid</code> option) to list <span class="strong strong"><strong>assigned</strong></span> client roles for the user.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --uusername testuser --cclientid realm-management</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--effective</code> option to list <span class="strong strong"><strong>effective</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --uusername testuser --cclientid realm-management --effective</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--available</code> option to list realm roles that you can add to a user.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --uusername testuser --cclientid realm-management --available</pre></li></ol></div><h4 id="adding_realm_roles_to_a_user">Adding realm roles to a user</h4><p>
				Use an <code class="literal">add-roles</code> command to add realm roles to a user.
			</p><p>
				Use the following example to add the <code class="literal">user</code> role to user <code class="literal">testuser</code>:
			</p><pre class="screen">$ kcadm.sh add-roles --uusername testuser --rolename user -r demorealm</pre><h4 id="removing_realm_roles_from_a_user">Removing realm roles from a user</h4><p>
				Use a <code class="literal">remove-roles</code> command to remove realm roles from a user.
			</p><p>
				Use the following example to remove the <code class="literal">user</code> role from the user <code class="literal">testuser</code>:
			</p><pre class="screen">$ kcadm.sh remove-roles --uusername testuser --rolename user -r demorealm</pre><h4 id="adding_client_roles_to_a_user">Adding client roles to a user</h4><p>
				Use an <code class="literal">add-roles</code> command to add client roles to a user.
			</p><p>
				Use the following example to add two roles defined on the client <code class="literal">realm management</code>, the <code class="literal">create-client</code> role and the <code class="literal">view-users</code> role, to the user <code class="literal">testuser</code>.
			</p><pre class="screen">$ kcadm.sh add-roles -r demorealm --uusername testuser --cclientid realm-management --rolename create-client --rolename view-users</pre><h4 id="removing_client_roles_from_a_user">Removing client roles from a user</h4><p>
				Use a <code class="literal">remove-roles</code> command to remove client roles from a user.
			</p><p>
				Use the following example to remove two roles defined on the realm management client:
			</p><pre class="screen">$ kcadm.sh remove-roles -r demorealm --uusername testuser --cclientid realm-management --rolename create-client --rolename view-users</pre><h4 id="listing_a_user_s_sessions">Listing a user’s sessions</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Identify the user’s ID,
					</li><li class="listitem">
						Use the ID to compose an endpoint URI, such as <code class="literal">users/ID/sessions</code>.
					</li><li class="listitem"><p class="simpara">
						Use the <code class="literal">get</code> command to retrieve a list of the user’s sessions.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$kcadm get users/6da5ab89-3397-4205-afaa-e201ff638f9e/sessions</pre></li></ol></div><h4 id="logging_out_a_user_from_a_specific_session">Logging out a user from a specific session</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Determine the session’s ID as described earlier.
					</li><li class="listitem">
						Use the session’s ID to compose an endpoint URI, such as <code class="literal">sessions/ID</code>.
					</li><li class="listitem"><p class="simpara">
						Use the <code class="literal">delete</code> command to invalidate the session.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh delete sessions/d0eaa7cc-8c5d-489d-811a-69d3c4ec84d1</pre></li></ol></div><h4 id="logging_out_a_user_from_all_sessions">Logging out a user from all sessions</h4><p>
				Use the user’s ID to construct an endpoint URI, such as <code class="literal">users/ID/logout</code>.
			</p><p>
				Use the <code class="literal">create</code> command to perform <code class="literal">POST</code> on that endpoint URI.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create users/6da5ab89-3397-4205-afaa-e201ff638f9e/logout -r demorealm -s realm=demorealm -s user=6da5ab89-3397-4205-afaa-e201ff638f9e</pre></section><section class="section" id="group_operations"><div class="titlepage"><div><div><h2 class="title">18.10. Group operations</h2></div></div></div><h4 id="creating_a_group">Creating a group</h4><p>
				Use the <code class="literal">create</code> command on the <code class="literal">groups</code> endpoint to create a new group.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create groups -r demorealm -s name=Group</pre><h4 id="listing_groups">Listing groups</h4><p>
				Use the <code class="literal">get</code> command on the <code class="literal">groups</code> endpoint to list groups.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get groups -r demorealm</pre><h4 id="getting_a_specific_group">Getting a specific group</h4><p>
				Use the group’s ID to construct an endpoint URI, such as <code class="literal">groups/GROUP_ID</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get groups/51204821-0580-46db-8f2d-27106c6b5ded -r demorealm</pre><h4 id="updating_a_group">Updating a group</h4><p>
				Use the <code class="literal">update</code> command with the same endpoint URI that you use to get a specific group.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update groups/51204821-0580-46db-8f2d-27106c6b5ded -s 'attributes.email=["group@example.com"]' -r demorealm</pre><h4 id="deleting_a_group">Deleting a group</h4><p>
				Use the <code class="literal">delete</code> command with the same endpoint URI that you use to get a specific group.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete groups/51204821-0580-46db-8f2d-27106c6b5ded -r demorealm</pre><h4 id="creating_a_subgroup">Creating a subgroup</h4><p>
				Find the ID of the parent group by listing groups. Use that ID to construct an endpoint URI, such as <code class="literal">groups/GROUP_ID/children</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create groups/51204821-0580-46db-8f2d-27106c6b5ded/children -r demorealm -s name=SubGroup</pre><h4 id="moving_a_group_under_another_group">Moving a group under another group</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Find the ID of an existing parent group and the ID of an existing child group.
					</li><li class="listitem">
						Use the parent group’s ID to construct an endpoint URI, such as <code class="literal">groups/PARENT_GROUP_ID/children</code>.
					</li><li class="listitem">
						Run the <code class="literal">create</code> command on this endpoint and pass the child group’s ID as a JSON body.
					</li></ol></div><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create groups/51204821-0580-46db-8f2d-27106c6b5ded/children -r demorealm -s id=08d410c6-d585-4059-bb07-54dcb92c5094</pre><h4 id="get_groups_for_a_specific_user">Get groups for a specific user</h4><p>
				Use a user’s ID to determine a user’s membership in groups to compose an endpoint URI, such as <code class="literal">users/USER_ID/groups</code>.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get users/b544f379-5fc4-49e5-8a8d-5cfb71f46f53/groups -r demorealm</pre><h4 id="adding_a_user_to_a_group">Adding a user to a group</h4><p>
				Use the <code class="literal">update</code> command with an endpoint URI composed of a user’s ID and a group’s ID, such as <code class="literal">users/USER_ID/groups/GROUP_ID</code>, to add a user to a group.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh update users/b544f379-5fc4-49e5-8a8d-5cfb71f46f53/groups/ce01117a-7426-4670-a29a-5c118056fe20 -r demorealm -s realm=demorealm -s userId=b544f379-5fc4-49e5-8a8d-5cfb71f46f53 -s groupId=ce01117a-7426-4670-a29a-5c118056fe20 -n</pre><h4 id="removing_a_user_from_a_group">Removing a user from a group</h4><p>
				Use the <code class="literal">delete</code> command on the same endpoint URI you use for adding a user to a group, such as <code class="literal">users/USER_ID/groups/GROUP_ID</code>, to remove a user from a group.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete users/b544f379-5fc4-49e5-8a8d-5cfb71f46f53/groups/ce01117a-7426-4670-a29a-5c118056fe20 -r demorealm</pre><h4 id="listing_assigned_available_and_effective_realm_roles_for_a_group">Listing assigned, available, and effective realm roles for a group</h4><p>
				Use a dedicated <code class="literal">get-roles</code> command to list assigned, available, and effective realm roles for a group.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Specify the target group by name (<code class="literal">--gname</code> option), path (<code class="literal">--gpath</code> option), or ID (<code class="literal">--gid</code> option) to list <span class="strong strong"><strong>assigned</strong></span> realm roles for the group.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --gname Group</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--effective</code> option to list <span class="strong strong"><strong>effective</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --gname Group --effective</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--available</code> option to list realm roles that you can add to the group.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --gname Group --available</pre></li></ol></div><h4 id="listing_assigned_available_and_effective_client_roles_for_a_group">Listing assigned, available, and effective client roles for a group</h4><p>
				Use the <code class="literal">get-roles</code> command to list assigned, available, and effective client roles for a group.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Specify the target group by name (<code class="literal">--gname</code> option) or ID (<code class="literal">--gid</code> option),
					</li><li class="listitem"><p class="simpara">
						Specify the client by the clientId attribute (<code class="literal">--cclientid</code> option) or ID (<code class="literal">--id</code> option) to list <span class="strong strong"><strong>assigned</strong></span> client roles for the user.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --gname Group --cclientid realm-management</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--effective</code> option to list <span class="strong strong"><strong>effective</strong></span> realm roles.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --gname Group --cclientid realm-management --effective</pre></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">--available</code> option to list realm roles that you can still add to the group.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh get-roles -r demorealm --gname Group --cclientid realm-management --available</pre></li></ol></div></section><section class="section" id="identity_provider_operations"><div class="titlepage"><div><div><h2 class="title">18.11. Identity provider operations</h2></div></div></div><h4 id="listing_available_identity_providers">Listing available identity providers</h4><p>
				Use the <code class="literal">serverinfo</code> endpoint to list available identity providers.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get serverinfo -r demorealm --fields 'identityProviders(*)'</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red Hat Single Sign-On processes the <code class="literal">serverinfo</code> endpoint similarly to the <code class="literal">realms</code> endpoint. Red Hat Single Sign-On does not resolve the endpoint relative to a target realm because it exists outside any specific realm.
				</p></div></div><h4 id="listing_configured_identity_providers">Listing configured identity providers</h4><p>
				Use the <code class="literal">identity-provider/instances</code> endpoint.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get identity-provider/instances -r demorealm --fields alias,providerId,enabled</pre><h4 id="getting_a_specific_configured_identity_provider">Getting a specific configured identity provider</h4><p>
				Use the identity provider’s <code class="literal">alias</code> attribute to construct an endpoint URI, such as <code class="literal">identity-provider/instances/ALIAS</code>, to get a specific identity provider.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get identity-provider/instances/facebook -r demorealm</pre><h4 id="removing_a_specific_configured_identity_provider">Removing a specific configured identity provider</h4><p>
				Use the <code class="literal">delete</code> command with the same endpoint URI that you use to get a specific configured identity provider to remove a specific configured identity provider.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh delete identity-provider/instances/facebook -r demorealm</pre><h4 id="configuring_a_keycloak_openid_connect_identity_provider">Configuring a Keycloak OpenID Connect identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">keycloak-oidc</code> as the <code class="literal">providerId</code> when you create a new identity provider instance.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes: <code class="literal">authorizationUrl</code>, <code class="literal">tokenUrl</code>, <code class="literal">clientId</code>, and <code class="literal">clientSecret</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=keycloak-oidc -s providerId=keycloak-oidc -s enabled=true -s 'config.useJwksUrl="true"' -s config.authorizationUrl=http://localhost:8180/auth/realms/demorealm/protocol/openid-connect/auth -s config.tokenUrl=http://localhost:8180/auth/realms/demorealm/protocol/openid-connect/token -s config.clientId=demo-oidc-provider -s config.clientSecret=secret</pre></li></ol></div><h4 id="configuring_an_openid_connect_identity_provider">Configuring an OpenID Connect identity provider</h4><p>
				Configure the generic OpenID Connect provider the same way you configure the Keycloak OpenID Connect provider, except you set the <code class="literal">providerId</code> attribute value to <code class="literal">oidc</code>.
			</p><h4 id="configuring_a_saml_2_identity_provider">Configuring a SAML 2 identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">saml</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem">
						Provide the <code class="literal">config</code> attributes: <code class="literal">singleSignOnServiceUrl</code>, <code class="literal">nameIDPolicyFormat</code>, and <code class="literal">signatureAlgorithm</code>.
					</li></ol></div><p>
				For example:
			</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=saml -s providerId=saml -s enabled=true -s 'config.useJwksUrl="true"' -s config.singleSignOnServiceUrl=http://localhost:8180/auth/realms/saml-broker-realm/protocol/saml -s config.nameIDPolicyFormat=urn:oasis:names:tc:SAML:2.0:nameid-format:persistent -s config.signatureAlgorithm=RSA_SHA256</pre><h4 id="configuring_a_facebook_identity_provider">Configuring a Facebook identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">facebook</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes: <code class="literal">clientId</code> and <code class="literal">clientSecret</code>. You can find these attributes in the Facebook Developers application configuration page for your application. See see the <a class="link" href="#facebook" title="9.4.2. Facebook">facebook identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=facebook -s providerId=facebook -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=FACEBOOK_CLIENT_ID -s config.clientSecret=FACEBOOK_CLIENT_SECRET</pre></li></ol></div><h4 id="configuring_a_google_identity_provider">Configuring a Google identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">google</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes: <code class="literal">clientId</code> and <code class="literal">clientSecret</code>. You can find these attributes in the Google Developers application configuration page for your application. See the <a class="link" href="#google" title="9.4.5. Google">Google identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=google -s providerId=google -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=GOOGLE_CLIENT_ID -s config.clientSecret=GOOGLE_CLIENT_SECRET</pre></li></ol></div><h4 id="configuring_a_twitter_identity_provider">Configuring a Twitter identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">twitter</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes <code class="literal">clientId</code> and <code class="literal">clientSecret</code>. You can find these attributes in the Twitter Application Management application configuration page for your application. See the <a class="link" href="#twitter" title="9.4.12. Twitter">Twitter identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=google -s providerId=google -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=TWITTER_API_KEY -s config.clientSecret=TWITTER_API_SECRET</pre></li></ol></div><h4 id="configuring_a_github_identity_provider">Configuring a GitHub identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">github</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes <code class="literal">clientId</code> and <code class="literal">clientSecret</code>. You can find these attributes in the GitHub Developer Application Settings page for your application. See the <a class="link" href="#github" title="9.4.3. GitHub">Github identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=github -s providerId=github -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=GITHUB_CLIENT_ID -s config.clientSecret=GITHUB_CLIENT_SECRET</pre></li></ol></div><h4 id="configuring_a_linkedin_identity_provider">Configuring a LinkedIn identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">linkedin</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes <code class="literal">clientId</code> and <code class="literal">clientSecret</code>. You can find these attributes in the LinkedIn Developer Console application page for your application. See the <a class="link" href="#linkedin" title="9.4.6. LinkedIn">LinkedIn identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=linkedin -s providerId=linkedin -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=LINKEDIN_CLIENT_ID -s config.clientSecret=LINKEDIN_CLIENT_SECRET</pre></li></ol></div><h4 id="configuring_a_microsoft_live_identity_provider">Configuring a Microsoft Live identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">microsoft</code> as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes <code class="literal">clientId</code> and <code class="literal">clientSecret</code>. You can find these attributes in the Microsoft Application Registration Portal page for your application. See the <a class="link" href="#microsoft" title="9.4.7. Microsoft">Microsoft identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=microsoft -s providerId=microsoft -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=MICROSOFT_APP_ID -s config.clientSecret=MICROSOFT_PASSWORD</pre></li></ol></div><h4 id="configuring_a_stack_overflow_identity_provider">Configuring a Stack Overflow identity provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use <code class="literal">stackoverflow</code> command as the <code class="literal">providerId</code>.
					</li><li class="listitem"><p class="simpara">
						Provide the <code class="literal">config</code> attributes <code class="literal">clientId</code>, <code class="literal">clientSecret</code>, and <code class="literal">key</code>. You can find these attributes in the Stack Apps OAuth page for your application. See the <a class="link" href="#stackoverflow" title="9.4.11. Stack overflow">Stack Overflow identity broker</a> page for more information.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create identity-provider/instances -r demorealm -s alias=stackoverflow -s providerId=stackoverflow -s enabled=true  -s 'config.useJwksUrl="true"' -s config.clientId=STACKAPPS_CLIENT_ID -s config.clientSecret=STACKAPPS_CLIENT_SECRET -s config.key=STACKAPPS_KEY</pre></li></ol></div></section><section class="section" id="storage_provider_operations"><div class="titlepage"><div><div><h2 class="title">18.12. Storage provider operations</h2></div></div></div><h4 id="configuring_a_kerberos_storage_provider">Configuring a Kerberos storage provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use the <code class="literal">create</code> command against the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Specify the realm id as a value of the <code class="literal">parentId</code> attribute.
					</li><li class="listitem">
						Specify <code class="literal">kerberos</code> as the value of the <code class="literal">providerId</code> attribute, and <code class="literal">org.keycloak.storage.UserStorageProvider</code> as the value of the <code class="literal">providerType</code> attribute.
					</li><li class="listitem"><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s parentId=demorealmId -s id=demokerberos -s name=demokerberos -s providerId=kerberos -s providerType=org.keycloak.storage.UserStorageProvider -s 'config.priority=["0"]' -s 'config.debug=["false"]' -s 'config.allowPasswordAuthentication=["true"]' -s 'config.editMode=["UNSYNCED"]' -s 'config.updateProfileFirstLogin=["true"]' -s 'config.allowKerberosAuthentication=["true"]' -s 'config.kerberosRealm=["KEYCLOAK.ORG"]' -s 'config.keyTab=["http.keytab"]' -s 'config.serverPrincipal=["HTTP/localhost@KEYCLOAK.ORG"]' -s 'config.cachePolicy=["DEFAULT"]'</pre></li></ol></div><h4 id="configuring_an_ldap_user_storage_provider">Configuring an LDAP user storage provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use the <code class="literal">create</code> command against the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Specify <code class="literal">ldap</code> as the value of the <code class="literal">providerId</code> attribute, and <code class="literal">org.keycloak.storage.UserStorageProvider</code> as the value of the <code class="literal">providerType</code> attribute.
					</li><li class="listitem">
						Provide the realm ID as the value of the <code class="literal">parentId</code> attribute.
					</li><li class="listitem"><p class="simpara">
						Use the following example to create a Kerberos-integrated LDAP provider.
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=kerberos-ldap-provider -s providerId=ldap -s providerType=org.keycloak.storage.UserStorageProvider -s parentId=3d9c572b-8f33-483f-98a6-8bb421667867  -s 'config.priority=["1"]' -s 'config.fullSyncPeriod=["-1"]' -s 'config.changedSyncPeriod=["-1"]' -s 'config.cachePolicy=["DEFAULT"]' -s config.evictionDay=[] -s config.evictionHour=[] -s config.evictionMinute=[] -s config.maxLifespan=[] -s 'config.batchSizeForSync=["1000"]' -s 'config.editMode=["WRITABLE"]' -s 'config.syncRegistrations=["false"]' -s 'config.vendor=["other"]' -s 'config.usernameLDAPAttribute=["uid"]' -s 'config.rdnLDAPAttribute=["uid"]' -s 'config.uuidLDAPAttribute=["entryUUID"]' -s 'config.userObjectClasses=["inetOrgPerson, organizationalPerson"]' -s 'config.connectionUrl=["ldap://localhost:10389"]'  -s 'config.usersDn=["ou=People,dc=keycloak,dc=org"]' -s 'config.authType=["simple"]' -s 'config.bindDn=["uid=admin,ou=system"]' -s 'config.bindCredential=["secret"]' -s 'config.searchScope=["1"]' -s 'config.useTruststoreSpi=["ldapsOnly"]' -s 'config.connectionPooling=["true"]' -s 'config.pagination=["true"]' -s 'config.allowKerberosAuthentication=["true"]' -s 'config.serverPrincipal=["HTTP/localhost@KEYCLOAK.ORG"]' -s 'config.keyTab=["http.keytab"]' -s 'config.kerberosRealm=["KEYCLOAK.ORG"]' -s 'config.debug=["true"]' -s 'config.useKerberosForPasswordAuthentication=["true"]'</pre></li></ol></div><h4 id="removing_a_user_storage_provider_instance">Removing a user storage provider instance</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use the storage provider instance’s <code class="literal">id</code> attribute to compose an endpoint URI, such as <code class="literal">components/ID</code>.
					</li><li class="listitem"><p class="simpara">
						Run the <code class="literal">delete</code> command against this endpoint.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh delete components/3d9c572b-8f33-483f-98a6-8bb421667867 -r demorealm</pre></li></ol></div><h4 id="triggering_synchronization_of_all_users_for_a_specific_user_storage_provider">Triggering synchronization of all users for a specific user storage provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use the storage provider’s <code class="literal">id</code> attribute to compose an endpoint URI, such as <code class="literal">user-storage/ID_OF_USER_STORAGE_INSTANCE/sync</code>.
					</li><li class="listitem">
						Add the <code class="literal">action=triggerFullSync</code> query parameter.
					</li><li class="listitem"><p class="simpara">
						Run the <code class="literal">create</code> command.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create user-storage/b7c63d02-b62a-4fc1-977c-947d6a09e1ea/sync?action=triggerFullSync</pre></li></ol></div><h4 id="triggering_synchronization_of_changed_users_for_a_specific_user_storage_provider">Triggering synchronization of changed users for a specific user storage provider</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Use the storage provider’s <code class="literal">id</code> attribute to compose an endpoint URI, such as <code class="literal">user-storage/ID_OF_USER_STORAGE_INSTANCE/sync</code>.
					</li><li class="listitem">
						Add the <code class="literal">action=triggerChangedUsersSync</code> query parameter.
					</li><li class="listitem"><p class="simpara">
						Run the <code class="literal">create</code> command.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create user-storage/b7c63d02-b62a-4fc1-977c-947d6a09e1ea/sync?action=triggerChangedUsersSync</pre></li></ol></div><h4 id="test_ldap_user_storage_connectivity">Test LDAP user storage connectivity</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">get</code> command on the <code class="literal">testLDAPConnection</code> endpoint.
					</li><li class="listitem">
						Provide query parameters <code class="literal">bindCredential</code>, <code class="literal">bindDn</code>, <code class="literal">connectionUrl</code>, and <code class="literal">useTruststoreSpi</code>.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">action</code> query parameter to <code class="literal">testConnection</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create testLDAPConnection -s action=testConnection -s bindCredential=secret -s bindDn=uid=admin,ou=system -s connectionUrl=ldap://localhost:10389 -s useTruststoreSpi=ldapsOnly</pre></li></ol></div><h4 id="test_ldap_user_storage_authentication">Test LDAP user storage authentication</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">get</code> command on the <code class="literal">testLDAPConnection</code> endpoint.
					</li><li class="listitem">
						Provide the query parameters <code class="literal">bindCredential</code>, <code class="literal">bindDn</code>, <code class="literal">connectionUrl</code>, and <code class="literal">useTruststoreSpi</code>.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">action</code> query parameter to <code class="literal">testAuthentication</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create testLDAPConnection -s action=testAuthentication -s bindCredential=secret -s bindDn=uid=admin,ou=system -s connectionUrl=ldap://localhost:10389 -s useTruststoreSpi=ldapsOnly</pre></li></ol></div></section><section class="section" id="adding_mappers"><div class="titlepage"><div><div><h2 class="title">18.13. Adding mappers</h2></div></div></div><h4 id="adding_a_hard_coded_role_ldap_mapper">Adding a hard-coded role LDAP mapper</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">create</code> command on the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Set the <code class="literal">providerType</code> attribute to <code class="literal">org.keycloak.storage.ldap.mappers.LDAPStorageMapper</code>.
					</li><li class="listitem">
						Set the <code class="literal">parentId</code> attribute to the ID of the LDAP provider instance.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">providerId</code> attribute to <code class="literal">hardcoded-ldap-role-mapper</code>. Ensure you provide a value of <code class="literal">role</code> configuration parameter.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=hardcoded-ldap-role-mapper -s providerId=hardcoded-ldap-role-mapper -s providerType=org.keycloak.storage.ldap.mappers.LDAPStorageMapper -s parentId=b7c63d02-b62a-4fc1-977c-947d6a09e1ea -s 'config.role=["realm-management.create-client"]'</pre></li></ol></div><h4 id="adding_an_ms_active_directory_mapper">Adding an MS Active Directory mapper</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">create</code> command on the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Set the <code class="literal">providerType</code> attribute to <code class="literal">org.keycloak.storage.ldap.mappers.LDAPStorageMapper</code>.
					</li><li class="listitem">
						Set the <code class="literal">parentId</code> attribute to the ID of the LDAP provider instance.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">providerId</code> attribute to <code class="literal">msad-user-account-control-mapper</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=msad-user-account-control-mapper -s providerId=msad-user-account-control-mapper -s providerType=org.keycloak.storage.ldap.mappers.LDAPStorageMapper -s parentId=b7c63d02-b62a-4fc1-977c-947d6a09e1ea</pre></li></ol></div><h4 id="adding_a_user_attribute_ldap_mapper">Adding a user attribute LDAP mapper</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">create</code> command on the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Set the <code class="literal">providerType</code> attribute to <code class="literal">org.keycloak.storage.ldap.mappers.LDAPStorageMapper</code>.
					</li><li class="listitem">
						Set the <code class="literal">parentId</code> attribute to the ID of the LDAP provider instance.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">providerId</code> attribute to <code class="literal">user-attribute-ldap-mapper</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=user-attribute-ldap-mapper -s providerId=user-attribute-ldap-mapper -s providerType=org.keycloak.storage.ldap.mappers.LDAPStorageMapper -s parentId=b7c63d02-b62a-4fc1-977c-947d6a09e1ea -s 'config."user.model.attribute"=["email"]' -s 'config."ldap.attribute"=["mail"]' -s 'config."read.only"=["false"]' -s 'config."always.read.value.from.ldap"=["false"]' -s 'config."is.mandatory.in.ldap"=["false"]'</pre></li></ol></div><h4 id="adding_a_group_ldap_mapper">Adding a group LDAP mapper</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">create</code> command on the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Set the <code class="literal">providerType</code> attribute to <code class="literal">org.keycloak.storage.ldap.mappers.LDAPStorageMapper</code>.
					</li><li class="listitem">
						Set the <code class="literal">parentId</code> attribute to the ID of the LDAP provider instance.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">providerId</code> attribute to <code class="literal">group-ldap-mapper</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=group-ldap-mapper -s providerId=group-ldap-mapper -s providerType=org.keycloak.storage.ldap.mappers.LDAPStorageMapper -s parentId=b7c63d02-b62a-4fc1-977c-947d6a09e1ea -s 'config."groups.dn"=[]' -s 'config."group.name.ldap.attribute"=["cn"]' -s 'config."group.object.classes"=["groupOfNames"]' -s 'config."preserve.group.inheritance"=["true"]' -s 'config."membership.ldap.attribute"=["member"]' -s 'config."membership.attribute.type"=["DN"]' -s 'config."groups.ldap.filter"=[]' -s 'config.mode=["LDAP_ONLY"]' -s 'config."user.roles.retrieve.strategy"=["LOAD_GROUPS_BY_MEMBER_ATTRIBUTE"]' -s 'config."mapped.group.attributes"=["admins-group"]' -s 'config."drop.non.existing.groups.during.sync"=["false"]' -s 'config.roles=["admins"]' -s 'config.groups=["admins-group"]' -s 'config.group=[]' -s 'config.preserve=["true"]' -s 'config.membership=["member"]'</pre></li></ol></div><h4 id="adding_a_full_name_ldap_mapper">Adding a full name LDAP mapper</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Run the <code class="literal">create</code> command on the <code class="literal">components</code> endpoint.
					</li><li class="listitem">
						Set the <code class="literal">providerType</code> attribute to <code class="literal">org.keycloak.storage.ldap.mappers.LDAPStorageMapper</code>.
					</li><li class="listitem">
						Set the <code class="literal">parentId</code> attribute to the ID of the LDAP provider instance.
					</li><li class="listitem"><p class="simpara">
						Set the <code class="literal">providerId</code> attribute to <code class="literal">full-name-ldap-mapper</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="screen">$ kcadm.sh create components -r demorealm -s name=full-name-ldap-mapper -s providerId=full-name-ldap-mapper -s providerType=org.keycloak.storage.ldap.mappers.LDAPStorageMapper -s parentId=b7c63d02-b62a-4fc1-977c-947d6a09e1ea -s 'config."ldap.full.name.attribute"=["cn"]' -s 'config."read.only"=["false"]' -s 'config."write.only"=["true"]'</pre></li></ol></div></section><section class="section" id="authentication_operations"><div class="titlepage"><div><div><h2 class="title">18.14. Authentication operations</h2></div></div></div><h4 id="setting_a_password_policy">Setting a password policy</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Set the realm’s <code class="literal">passwordPolicy</code> attribute to an enumeration expression that includes the specific policy provider ID and optional configuration.
					</li><li class="listitem"><p class="simpara">
						Use the following example to set a password policy to default values. The default values include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								27,500 hashing iterations
							</li><li class="listitem">
								at least one special character
							</li><li class="listitem">
								at least one uppercase character
							</li><li class="listitem">
								at least one digit character
							</li><li class="listitem">
								not be equal to a user’s <code class="literal">username</code>
							</li><li class="listitem"><p class="simpara">
								be at least eight characters long
							</p><pre class="screen">$ kcadm.sh update realms/demorealm -s 'passwordPolicy="hashIterations and specialChars and upperCase and digits and notUsername and length"'</pre></li></ul></div></li><li class="listitem">
						To use values different from defaults, pass the configuration in brackets.
					</li><li class="listitem"><p class="simpara">
						Use the following example to set a password policy to:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								25,000 hash iterations
							</li><li class="listitem">
								at least two special characters
							</li><li class="listitem">
								at least two uppercase characters
							</li><li class="listitem">
								at least two lowercase characters
							</li><li class="listitem">
								at least two digits
							</li><li class="listitem">
								be at least nine characters long
							</li><li class="listitem">
								not be equal to a user’s <code class="literal">username</code>
							</li><li class="listitem"><p class="simpara">
								not repeat for at least four changes back
							</p><pre class="screen">$ kcadm.sh update realms/demorealm -s 'passwordPolicy="hashIterations(25000) and specialChars(2) and upperCase(2) and lowerCase(2) and digits(2) and length(9) and notUsername and passwordHistory(4)"'</pre></li></ul></div></li></ol></div><h4 id="obtaining_the_current_password_policy">Obtaining the current password policy</h4><p>
				You can get the current realm configuration by filtering all output except for the <code class="literal">passwordPolicy</code> attribute.
			</p><p>
				For example, display <code class="literal">passwordPolicy</code> for <code class="literal">demorealm</code>.
			</p><pre class="screen">$ kcadm.sh get realms/demorealm --fields passwordPolicy</pre><h4 id="listing_authentication_flows">Listing authentication flows</h4><p>
				Run the <code class="literal">get</code> command on the <code class="literal">authentication/flows</code> endpoint.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get authentication/flows -r demorealm</pre><h4 id="getting_a_specific_authentication_flow">Getting a specific authentication flow</h4><p>
				Run the <code class="literal">get</code> command on the <code class="literal">authentication/flows/FLOW_ID</code> endpoint.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get authentication/flows/febfd772-e1a1-42fb-b8ae-00c0566fafb8 -r demorealm</pre><h4 id="listing_executions_for_a_flow">Listing executions for a flow</h4><p>
				Run the <code class="literal">get</code> command on the <code class="literal">authentication/flows/FLOW_ALIAS/executions</code> endpoint.
			</p><p>
				For example:
			</p><pre class="screen">$ kcadm.sh get authentication/flows/Copy%20of%20browser/executions -r demorealm</pre><h4 id="adding_configuration_to_an_execution">Adding configuration to an execution</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Get execution for a flow.
					</li><li class="listitem">
						Note the ID of the flow.
					</li><li class="listitem">
						Run the <code class="literal">create</code> command on the <code class="literal">authentication/executions/{executionId}/config</code> endpoint.
					</li></ol></div><p>
				For example:
			</p><pre class="screen">$ kcadm create "authentication/executions/a3147129-c402-4760-86d9-3f2345e401c7/config" -r examplerealm -b '{"config":{"x509-cert-auth.mapping-source-selection":"Match SubjectDN using regular expression","x509-cert-auth.regular-expression":"(.*?)(?:$)","x509-cert-auth.mapper-selection":"Custom Attribute Mapper","x509-cert-auth.mapper-selection.user-attribute-name":"usercertificate","x509-cert-auth.crl-checking-enabled":"","x509-cert-auth.crldp-checking-enabled":false,"x509-cert-auth.crl-relative-path":"crl.pem","x509-cert-auth.ocsp-checking-enabled":"","x509-cert-auth.ocsp-responder-uri":"","x509-cert-auth.keyusage":"","x509-cert-auth.extendedkeyusage":"","x509-cert-auth.confirmation-page-disallowed":""},"alias":"my_otp_config"}'</pre><h4 id="getting_configuration_for_an_execution">Getting configuration for an execution</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Get execution for a flow.
					</li><li class="listitem">
						Note its <code class="literal">authenticationConfig</code> attribute, which contains the config ID.
					</li><li class="listitem">
						Run the <code class="literal">get</code> command on the <code class="literal">authentication/config/ID</code> endpoint.
					</li></ol></div><p>
				For example:
			</p><pre class="screen">$ kcadm get "authentication/config/dd91611a-d25c-421a-87e2-227c18421833" -r examplerealm</pre><h4 id="updating_configuration_for_an_execution">Updating configuration for an execution</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Get the execution for the flow.
					</li><li class="listitem">
						Get the flow’s <code class="literal">authenticationConfig</code> attribute.
					</li><li class="listitem">
						Note the config ID from the attribute.
					</li><li class="listitem">
						Run the <code class="literal">update</code> command on the <code class="literal">authentication/config/ID</code> endpoint.
					</li></ol></div><p>
				For example:
			</p><pre class="screen">$ kcadm update "authentication/config/dd91611a-d25c-421a-87e2-227c18421833" -r examplerealm -b '{"id":"dd91611a-d25c-421a-87e2-227c18421833","alias":"my_otp_config","config":{"x509-cert-auth.extendedkeyusage":"","x509-cert-auth.mapper-selection.user-attribute-name":"usercertificate","x509-cert-auth.ocsp-responder-uri":"","x509-cert-auth.regular-expression":"(.*?)(?:$)","x509-cert-auth.crl-checking-enabled":"true","x509-cert-auth.confirmation-page-disallowed":"","x509-cert-auth.keyusage":"","x509-cert-auth.mapper-selection":"Custom Attribute Mapper","x509-cert-auth.crl-relative-path":"crl.pem","x509-cert-auth.crldp-checking-enabled":"false","x509-cert-auth.mapping-source-selection":"Match SubjectDN using regular expression","x509-cert-auth.ocsp-checking-enabled":""}}'</pre><h4 id="deleting_configuration_for_an_execution">Deleting configuration for an execution</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Get execution for a flow.
					</li><li class="listitem">
						Get the flows <code class="literal">authenticationConfig</code> attribute.
					</li><li class="listitem">
						Note the config ID from the attribute.
					</li><li class="listitem">
						Run the <code class="literal">delete</code> command on the <code class="literal">authentication/config/ID</code> endpoint.
					</li></ol></div><p>
				For example:
			</p><pre class="screen">$ kcadm delete "authentication/config/dd91611a-d25c-421a-87e2-227c18421833" -r examplerealm</pre></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm140556191107216"><h1 class="legalnotice">Legal Notice</h1><div class="para">
				Copyright <span class="trademark"/>© 2021 Red Hat, Inc.
			</div><div class="para">
				Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
			</div><div class="para">
				<a class="ulink" href="http://www.apache.org/licenses/LICENSE-2.0"> http://www.apache.org/licenses/LICENSE-2.0</a>
			</div><div class="para">
				Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
			</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>